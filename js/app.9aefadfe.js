(function(e){function t(t){for(var n,o,s=t[0],u=t[1],l=t[2],h=0,d=[];h<s.length;h++)o=s[h],Object.prototype.hasOwnProperty.call(r,o)&&r[o]&&d.push(r[o][0]),r[o]=0;for(n in u)Object.prototype.hasOwnProperty.call(u,n)&&(e[n]=u[n]);c&&c(t);while(d.length)d.shift()();return a.push.apply(a,l||[]),i()}function i(){for(var e,t=0;t<a.length;t++){for(var i=a[t],n=!0,s=1;s<i.length;s++){var u=i[s];0!==r[u]&&(n=!1)}n&&(a.splice(t--,1),e=o(o.s=i[0]))}return e}var n={},r={app:0},a=[];function o(t){if(n[t])return n[t].exports;var i=n[t]={i:t,l:!1,exports:{}};return e[t].call(i.exports,i,i.exports,o),i.l=!0,i.exports}o.m=e,o.c=n,o.d=function(e,t,i){o.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:i})},o.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},o.t=function(e,t){if(1&t&&(e=o(e)),8&t)return e;if(4&t&&"object"===typeof e&&e&&e.__esModule)return e;var i=Object.create(null);if(o.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var n in e)o.d(i,n,function(t){return e[t]}.bind(null,n));return i},o.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return o.d(t,"a",t),t},o.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},o.p="";var s=window["webpackJsonp"]=window["webpackJsonp"]||[],u=s.push.bind(s);s.push=t,s=s.slice();for(var l=0;l<s.length;l++)t(s[l]);var c=u;a.push([0,"chunk-vendors"]),i()})({0:function(e,t,i){e.exports=i("cd49")},6289:function(e,t,i){},cd49:function(e,t,i){"use strict";i.r(t);i("e260"),i("e6cf"),i("cca6"),i("a79d");var n=i("5a89"),r=i("d4ec"),a=i("bee2");i("dca8");function o(e,t){return void 0!==e&&null!==e?e:t}o.EMPTY_OBJECT=Object.freeze({});i("2af1");function s(e){return void 0!==e&&null!==e}i("b0c0"),i("d3b7"),i("25f0");var u=function(){function e(t){var i;Object(r["a"])(this,e),this.name="DeveloperError",this.message=t;try{throw new Error}catch(n){i=n.stack}this.stack=i}return Object(a["a"])(e,[{key:"toString",value:function(){var e=this.name+": "+this.message;return s(this.stack)&&(e+="\n"+this.stack.toString()),e}}],[{key:"throwInstantiationError",value:function(){throw new e("This function defines an interface and should not be called directly.")}}]),e}();s(Object.create)&&(u.prototype=Object.create(Error.prototype),u.prototype.constructor=u);var l=.1,c=.01,h=.001,d=1e-4,m=1e-5,f=1e-6,v=1e-7,g=1e-8,p=1e-9,y=1e-10,_=1e-11,w=1e-12,T=1e-13,x=1e-14,E=1e-15,S=1e-20,b=1737400,I=65536,R=4294967296,C=function(e,t,i){if(i=o(i,0),!s(e))throw new u("n is required.");if(t<=i)throw new u("maximumValue must be greater than minimumValue.");return++e,e>t&&(e=i),e},O=function(e,t,i,n){if(!s(e))throw new u("left is required.");if(!s(t))throw new u("right is required.");i=o(i,0),n=o(n,i);var r=Math.abs(e-t);return r<=n||r<=n*Math.max(Math.abs(e),Math.abs(t))},k=Math.PI,P=1/Math.PI,M=Math.PI/2,N=Math.PI/3,A=Math.PI/4,D=Math.PI/6,L=3*Math.PI/2,U=2*Math.PI,F=1/(2*Math.PI),H=Math.PI/180,z=180/Math.PI,q=H/3600,B=function(e){if(!s(e))throw new u("degrees is required.");return e*ne.RADIANS_PER_DEGREE},j=function(e){return e<0?-1:1},W=function(e,t,i){if(!s(e))throw new u("value is required");if(!s(t))throw new u("min is required.");if(!s(i))throw new u("max is required.");return e<t?t:e>i?i:e},V=function(e,t){return t=o(t,255),Math.round((.5*ne.clamp(e,-1,1)+.5)*t)},G=function(e,t){return t=o(t,255),ne.clamp(e,0,t)/t*2-1},Y=function(e){if(!s(e))throw new u("angle is required.");return ne.zeroToTwoPi(e+ne.PI)-ne.PI},Z=function(e){if(!s(e))throw new u("angle is required.");var t=ne.mod(e,ne.TWO_PI);return Math.abs(t)<ne.EPSILON14&&Math.abs(e)>ne.EPSILON14?ne.TWO_PI:t},X=function(e,t){if(!s(e))throw new u("m is required.");if(!s(t))throw new u("n is required.");return(e%t+t)%t},Q=function(e){if(!s(e))throw new u("value is required.");return Math.acos(ne.clamp(e,-1,1))},K=function(e){if(!s(e))throw new u("radians is required.");return e*ne.DEGREES_PER_RADIAN},J=function(e,t,i){return(1-i)*e+i*t},$=function(e,t,i){return e-t>i},ee=function(e,t,i){return e-t>-i},te=function(e,t,i){return e-t<-i},ie=function(e,t,i){return e-t<i},ne={EPSILON1:l,EPSILON2:c,EPSILON3:h,EPSILON4:d,EPSILON5:m,EPSILON6:f,EPSILON7:v,EPSILON8:g,EPSILON9:p,EPSILON10:y,EPSILON11:_,EPSILON12:w,EPSILON13:T,EPSILON14:x,EPSILON15:E,EPSILON20:S,incrementWrap:C,equalsEpsilon:O,PI:k,ONE_OVER_PI:P,PI_OVER_TWO:M,PI_OVER_THREE:N,PI_OVER_FOUR:A,PI_OVER_SIX:D,THREE_PI_OVER_TWO:L,TWO_PI:U,ONE_OVER_TWO_PI:F,DEGREES_PER_RADIAN:z,RADIANS_PER_DEGREE:H,RADIANS_PER_ARCSECOND:q,LUNAR_RADIUS:b,FOUR_GIGABYTES:R,toRadians:B,signNotZero:j,clamp:W,toSNorm:V,fromSNorm:G,negativePiToPi:Y,zeroToTwoPi:Z,mod:X,acosClamped:Q,toDegrees:K,lerp:J,greaterThan:$,greaterThanOrEquals:ee,lessThan:te,lessThanOrEquals:ie,SIXTY_FOUR_KILOBYTES:I,sign:o(Math.sign,(function(e){return e=+e,0===e||e!==e?e:e>0?1:-1}))},re=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;Object(r["a"])(this,e),this.x=t,this.y=i,this.z=n}return Object(a["a"])(e,[{key:"clone",value:function(t){return e.clone(this,t)}}],[{key:"pack",value:function(e,t){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return i=o(i,0),t[i++]=e.x,t[i++]=e.y,t[i]=e.z,t}},{key:"unpack",value:function(t){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2?arguments[2]:void 0;return i=o(i,0),s(n)||(n=new e),n.x=t[i++],n.y=t[i++],n.z=t[i],n}},{key:"clone",value:function(t,i){if(s(t))return s(i)?(i.x=t.x,i.y=t.y,i.z=t.z,i):new e(t.x,t.y,t.z)}},{key:"magnitudeSquared",value:function(e){return e.x*e.x+e.y*e.y+e.z*e.z}},{key:"magnitude",value:function(t){return Math.sqrt(e.magnitudeSquared(t))}},{key:"normalize",value:function(t,i){var n=e.magnitude(t);if(i.x=t.x/n,i.y=t.y/n,i.z=t.z/n,isNaN(i.x)||isNaN(i.y)||isNaN(i.z))throw new u("normalized result is not a number");return i}},{key:"multiplyComponents",value:function(e,t,i){return i.x=e.x*t.x,i.y=e.y*t.y,i.z=e.z*t.z,i}},{key:"equalsEpsilon",value:function(e,t,i,n){return e===t||s(e)&&s(t)&&ne.equalsEpsilon(e.x,t.x,i,n)&&ne.equalsEpsilon(e.y,t.y,i,n)&&ne.equalsEpsilon(e.z,t.z,i,n)}},{key:"dot",value:function(e,t){return e.x*t.x+e.y*t.y+e.z*t.z}},{key:"divideByScalar",value:function(e,t,i){return i.x=e.x/t,i.y=e.y/t,i.z=e.z/t,i}},{key:"multiplyByScalar",value:function(e,t,i){return i.x=e.x*t,i.y=e.y*t,i.z=e.z*t,i}},{key:"add",value:function(e,t,i){return i.x=e.x+t.x,i.y=e.y+t.y,i.z=e.z+t.z,i}},{key:"subtract",value:function(e,t,i){return i.x=e.x-t.x,i.y=e.y-t.y,i.z=e.z-t.z,i}},{key:"equals",value:function(e,t){return e===t||s(e)&&s(t)&&e.x===t.x&&e.y===t.y&&e.z===t.z}},{key:"fromElements",value:function(t,i,n,r){return s(r)?(r.x=t,r.y=i,r.z=n,r):new e(t,i,n)}},{key:"cross",value:function(e,t,i){var n=e.x,r=e.y,a=e.z,o=t.x,s=t.y,u=t.z,l=r*u-a*s,c=a*o-n*u,h=n*s-r*o;return i.x=l,i.y=c,i.z=h,i}},{key:"midpoint",value:function(e,t,i){return i.x=.5*(e.x+t.x),i.y=.5*(e.y+t.y),i.z=.5*(e.z+t.z),i}},{key:"abs",value:function(e,t){return t.x=Math.abs(e.x),t.y=Math.abs(e.y),t.z=Math.abs(e.z),t}},{key:"mostOrthogonalAxis",value:function(t,i){var n=e.normalize(t,oe);return e.abs(n,n),i=n.x<=n.y?n.x<=n.z?e.clone(e.UNIT_X,i):e.clone(e.UNIT_Z,i):n.y<=n.z?e.clone(e.UNIT_Y,i):e.clone(e.UNIT_Z,i),i}},{key:"negate",value:function(e,t){return t.x=-e.x,t.y=-e.y,t.z=-e.z,t}},{key:"maximumComponent",value:function(e){return Math.max(e.x,e.y,e.z)}},{key:"fromRadians",value:function(t,i,n,r,a){n=o(n,0);var u=s(r)?r.radiiSquared:le,l=Math.cos(i);se.x=l*Math.cos(t),se.y=l*Math.sin(t),se.z=Math.sin(i),se=e.normalize(se,se),e.multiplyComponents(u,se,ue);var c=Math.sqrt(e.dot(se,ue));return ue=e.divideByScalar(ue,c,ue),se=e.multiplyByScalar(se,n,se),s(a)||(a=new e),e.add(ue,se,a)}},{key:"minimumByComponent",value:function(e,t,i){return i.x=Math.min(e.x,t.x),i.y=Math.min(e.y,t.y),i.z=Math.min(e.z,t.z),i}},{key:"maximumByComponent",value:function(e,t,i){return i.x=Math.max(e.x,t.x),i.y=Math.max(e.y,t.y),i.z=Math.max(e.z,t.z),i}},{key:"lerp",value:function(t,i,n,r){return e.multiplyByScalar(i,n,ce),r=e.multiplyByScalar(t,1-n,r),e.add(ce,r,r)}},{key:"angleBetween",value:function(t,i){e.normalize(t,he),e.normalize(i,de);var n=e.dot(he,de),r=e.magnitude(e.cross(he,de,he));return Math.atan2(r,n)}}]),e}();re.packedLength=3,re.ZERO=Object.freeze(new re(0,0,0)),re.UNIT_X=Object.freeze(new re(1,0,0)),re.UNIT_Y=Object.freeze(new re(0,1,0)),re.UNIT_Z=Object.freeze(new re(0,0,1)),re.distance=function(e,t){return re.subtract(e,t,ae),re.magnitude(ae)},re.fromCartesian4=re.clone;var ae=new re,oe=new re,se=new re,ue=new re,le=new re(40680631590769,40680631590769,40408299984661.445),ce=new re,he=new re,de=new re,me=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;Object(r["a"])(this,e),this.longitude=o(t,0),this.latitude=o(i,0),this.height=o(n,0)}return Object(a["a"])(e,null,[{key:"clone",value:function(t,i){if(s(t))return s(i)?(i.longitude=t.longitude,i.latitude=t.latitude,i.height=t.height,i):new e(t.longitude,t.latitude,t.height)}},{key:"fromRadians",value:function(t,i){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3?arguments[3]:void 0;return n=o(n,0),s(r)?(r.longitude=t,r.latitude=i,r.height=n,r):new e(t,i,n)}}]),e}(),fe=new re,ve=new re;function ge(e,t,i,n,r){if(!s(e))throw new u("cartesian is required.");if(!s(t))throw new u("oneOverRadii is required.");if(!s(i))throw new u("oneOverRadiiSquared is required.");if(!s(n))throw new u("centerToleranceSquared is required.");var a=e.x,o=e.y,l=e.z,c=t.x,h=t.y,d=t.z,m=a*a*c*c,f=o*o*h*h,v=l*l*d*d,g=m+f+v,p=Math.sqrt(1/g),y=re.multiplyByScalar(e,p,fe);if(g<n)return isFinite(p)?re.clone(y,r):void 0;var _=i.x,w=i.y,T=i.z,x=ve;x.x=y.x*_*2,x.y=y.y*w*2,x.z=y.z*T*2;var E,S,b,I,R,C,O,k,P,M,N,A=(1-p)*re.magnitude(e)/(.5*re.magnitude(x)),D=0;do{A-=D,b=1/(1+A*_),I=1/(1+A*w),R=1/(1+A*T),C=b*b,O=I*I,k=R*R,P=C*b,M=O*I,N=k*R,E=m*C+f*O+v*k-1,S=m*P*_+f*M*w+v*N*T;var L=-2*S;D=E/L}while(Math.abs(E)>ne.EPSILON12);return s(r)?(r.x=a*b,r.y=o*I,r.z=l*R,r):new re(a*b,o*I,l*R)}var pe=[.14887433898163,.43339539412925,.67940956829902,.86506336668898,.97390652851717,0],ye=[.29552422471475,.26926671930999,.21908636251598,.14945134915058,.066671344308684,0];function _e(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;e._radii=new re(t,i,n),e._radiiSquared=new re(t*t,i*i,n*n),e._radiiToTheFourth=new re(t*t*t*t,i*i*i*i,n*n*n*n),e._oneOverRadii=new re(0===t?0:1/t,0===i?0:1/i,0===n?0:1/n),e._oneOverRadiiSquared=new re(0===t?0:1/(t*t),0===i?0:1/(i*i),0===n?0:1/(n*n)),e._minimumRadius=Math.min(t,i,n),e._maximumRadius=Math.max(t,i,n),e._centerToleranceSquared=ne.EPSILON1,0!==e._radiiSquared.z&&(e._squaredXOverSquaredZ=e._radiiSquared.x/e._radiiSquared.z)}function we(e,t,i){for(var n=.5*(t+e),r=.5*(t-e),a=0,o=0;o<5;o++){var s=r*pe[o];a+=ye[o]*(i(n+s)+i(n-s))}return a*=r,a}var Te=new re,xe=new re,Ee=new re,Se=new re,be=new re,Ie=function(){function e(t,i,n){Object(r["a"])(this,e),this.geocentricSurfaceNormal=re.normalize,this._radii=void 0,this._radiiSquared=void 0,this._radiiToTheFourth=void 0,this._oneOverRadii=void 0,this._oneOverRadiiSquared=void 0,this._minimumRadius=void 0,this._maximumRadius=void 0,this._centerToleranceSquared=void 0,this._squaredXOverSquaredZ=void 0,_e(this,t,i,n)}return Object(a["a"])(e,[{key:"radii",get:function(){return this._radii}},{key:"radiiSquared",get:function(){return this._radiiSquared}},{key:"radiiToTheFourth",get:function(){return this._radiiToTheFourth}},{key:"oneOverRadii",get:function(){return this._oneOverRadii}},{key:"oneOverRadiiSquared",get:function(){return this._oneOverRadiiSquared}},{key:"minimumRadius",get:function(){return this._minimumRadius}},{key:"maximumRadius",get:function(){return this._maximumRadius}},{key:"clone",value:function(t){return e.clone(this,t)}},{key:"geodeticSurfaceNormalCartographic",value:function(e,t){var i=e.longitude,n=e.latitude,r=Math.cos(n),a=r*Math.cos(i),o=r*Math.sin(i),u=Math.sin(n);return s(t)||(t=new re),t.x=a,t.y=o,t.z=u,re.normalize(t,t)}},{key:"geodeticSurfaceNormal",value:function(e,t){if(!re.equalsEpsilon(e,re.ZERO,ne.EPSILON14))return s(t)||(t=new re),t=re.multiplyComponents(e,this.oneOverRadiiSquared,t),re.normalize(t,t)}},{key:"cartographicToCartesian",value:function(e,t){var i=Te,n=xe;this.geodeticSurfaceNormalCartographic(e,i),re.multiplyComponents(this._radiiSquared,i,n);var r=Math.sqrt(re.dot(i,n));return re.divideByScalar(n,r,n),re.multiplyByScalar(i,e.height,i),s(t)||(t=new re),re.add(n,i,t)}},{key:"cartographicArrayToCartesianArray",value:function(e,t){var i=e.length;s(t)?t.length=i:t=new Array(i);for(var n=0;n<i;n++)t[n]=this.cartographicToCartesian(e[n],t[n]);return t}},{key:"cartesianToCartographic",value:function(e,t){var i=this.scaleToGeodeticSurface(e,Se);if(s(i)){var n=this.geodeticSurfaceNormal(i,Ee),r=re.subtract(e,i,be),a=Math.atan2(n.y,n.x),o=Math.asin(n.z),u=ne.sign(re.dot(r,e))*re.magnitude(r);return s(t)?(t.longitude=a,t.latitude=o,t.height=u,t):new me(a,o,u)}}},{key:"cartesianArrayToCartographicArray",value:function(e,t){var i=e.length;s(t)?t.length=i:t=new Array(i);for(var n=0;n<i;++n)t[n]=this.cartesianToCartographic(e[n],t[n]);return t}},{key:"scaleToGeodeticSurface",value:function(e,t){return ge(e,this._oneOverRadii,this._oneOverRadiiSquared,this._centerToleranceSquared,t)}},{key:"scaleToGeocentricSurface",value:function(e,t){s(t)||(t=new re);var i=e.x,n=e.y,r=e.z,a=this._oneOverRadiiSquared,o=1/Math.sqrt(i*i*a.x+n*n*a.y+r*r*a.z);return re.multiplyByScalar(e,o,t)}},{key:"transformPositionToScaledSpace",value:function(e,t){return s(t)||(t=new re),re.multiplyComponents(e,this._oneOverRadii,t)}},{key:"transformPositionFromScaledSpace",value:function(e,t){return s(t)||(t=new re),re.multiplyComponents(e,this._radii,t)}},{key:"equals",value:function(e){return this===e||s(e)&&re.equals(this._radii,e._radii)}},{key:"toString",value:function(){return this._radii.toString()}},{key:"getSurfaceNormalIntersectionWithZAxis",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2?arguments[2]:void 0;if(!ne.equalsEpsilon(this._radii.x,this._radii.y,ne.EPSILON15))throw new u("Ellipsoid must be an ellipsoid of revolution (radii.x == radii.y)");t=o(t,0);var n=this._squaredXOverSquaredZ;if(s(i)||(i=new re),i.x=0,i.y=0,i.z=e.z*(1-n),!(Math.abs(i.z)>=this._radii.z-t))return i}},{key:"surfaceArea",value:function(e){var t=e.west,i=e.east,n=e.south,r=e.north;while(i<t)i+=ne.TWO_PI;var a=this._radiiSquared,o=a.x,s=a.y,u=a.z,l=o*s;return we(n,r,(function(e){var n=Math.cos(e),r=Math.sin(e);return Math.cos(e)*we(t,i,(function(e){var t=Math.cos(e),i=Math.sin(e);return Math.sqrt(l*r*r+u*(s*t*t+o*i*i)*n*n)}))}))}}],[{key:"clone",value:function(t,i){if(s(t)){var n=t._radii;return s(i)?(re.clone(n,i._radii),re.clone(t._radiiSquared,i._radiiSquared),re.clone(t._radiiToTheFourth,i._radiiToTheFourth),re.clone(t._oneOverRadii,i._oneOverRadii),re.clone(t._oneOverRadiiSquared,i._oneOverRadiiSquared),i._minimumRadius=t._minimumRadius,i._maximumRadius=t._maximumRadius,i._centerToleranceSquared=t._centerToleranceSquared,i):new e(n.x,n.y,n.z)}}},{key:"fromCartesian3",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:re.ZERO,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new e;return s(t)?(_e(i,t.x,t.y,t.z),i):i}},{key:"pack",value:function(e,t){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return i=o(i,0),re.pack(e.radii,t,i),t}},{key:"unpack",value:function(t){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2?arguments[2]:void 0;i=o(i,0);var r=re.unpack(t,i);return e.fromCartesian3(r,n)}}]),e}();Ie.WGS84=Object.freeze(new Ie(6378137,6378137,6356752.314245179)),Ie.UNIT_SPHERE=Object.freeze(new Ie(1,1,1)),Ie.MOON=Object.freeze(new Ie(ne.LUNAR_RADIUS,ne.LUNAR_RADIUS,ne.LUNAR_RADIUS)),Ie.packedLength=re.packedLength;var Re,Ce=function(){function e(t){Object(r["a"])(this,e),this._ellipsoid=o(t,Ie.WGS84),this._semimajorAxis=this._ellipsoid.maximumRadius,this._oneOverSemimajorAxis=1/this._semimajorAxis}return Object(a["a"])(e,[{key:"ellipsoid",get:function(){return this._ellipsoid}},{key:"project",value:function(e,t){var i=this._semimajorAxis,n=e.longitude*i,r=e.latitude*i,a=e.height;return s(t)?(t.x=n,t.y=r,t.z=a,t):new re(n,r,a)}},{key:"unproject",value:function(e,t){if(!s(e))throw new u("cartesian is required");var i=this._oneOverSemimajorAxis,n=e.x*i,r=e.y*i,a=e.z;return s(t)?(t.longitude=n,t.latitude=r,t.height=a,t):new me(n,r,a)}}]),e}();(function(e){e[e["OUTSIDE"]=-1]="OUTSIDE",e[e["INTERSECTING"]=0]="INTERSECTING",e[e["INSIDE"]=1]="INSIDE"})(Re||(Re={}));var Oe=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;Object(r["a"])(this,e),this.west=t,this.south=i,this.east=n,this.north=a}return Object(a["a"])(e,[{key:"width",get:function(){return e.computeWidth(this)}},{key:"height",get:function(){return e.computeHeight(this)}}],[{key:"computeWidth",value:function(e){var t=e.east,i=e.west;return t<i&&(t+=ne.TWO_PI),t-i}},{key:"computeHeight",value:function(e){return e.north-e.south}},{key:"fromRadians",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,a=arguments.length>4?arguments[4]:void 0;return s(a)?(a.west=o(t,0),a.south=o(i,0),a.east=o(n,0),a.north=o(r,0),a):new e(t,i,n,r)}},{key:"southwest",value:function(e,t){return s(t)?(t.longitude=e.west,t.latitude=e.south,t.height=0,t):new me(e.west,e.south)}},{key:"northwest",value:function(e,t){return s(t)?(t.longitude=e.west,t.latitude=e.north,t.height=0,t):new me(e.west,e.north)}},{key:"northeast",value:function(e,t){return s(t)?(t.longitude=e.east,t.latitude=e.north,t.height=0,t):new me(e.east,e.north)}},{key:"southeast",value:function(e,t){return s(t)?(t.longitude=e.east,t.latitude=e.south,t.height=0,t):new me(e.east,e.south)}},{key:"center",value:function(e,t){var i=e.east,n=e.west;i<n&&(i+=ne.TWO_PI);var r=ne.negativePiToPi(.5*(n+i)),a=.5*(e.south+e.north);return s(t)?(t.longitude=r,t.latitude=a,t.height=0,t):new me(r,a)}},{key:"clone",value:function(t,i){if(s(t))return s(i)?(i.west=t.west,i.south=t.south,i.east=t.east,i.north=t.north,i):new e(t.west,t.south,t.east,t.north)}},{key:"intersection",value:function(t,i,n){var r=t.east,a=t.west,o=i.east,u=i.west;r<a&&o>0?r+=ne.TWO_PI:o<u&&r>0&&(o+=ne.TWO_PI),r<a&&u<0?u+=ne.TWO_PI:o<u&&a<0&&(a+=ne.TWO_PI);var l=ne.negativePiToPi(Math.max(a,u)),c=ne.negativePiToPi(Math.min(r,o));if(!((t.west<t.east||i.west<i.east)&&c<=l)){var h=Math.max(t.south,i.south),d=Math.min(t.north,i.north);if(!(h>=d))return s(n)?(n.west=l,n.south=h,n.east=c,n.north=d,n):new e(l,h,c,d)}}},{key:"contains",value:function(e,t){var i=t.longitude,n=t.latitude,r=e.west,a=e.east;return a<r&&(a+=ne.TWO_PI,i<0&&(i+=ne.TWO_PI)),(i>r||ne.equalsEpsilon(i,r,ne.EPSILON14))&&(i<a||ne.equalsEpsilon(i,a,ne.EPSILON14))&&n>=e.south&&n<=e.north}},{key:"simpleIntersection",value:function(t,i,n){var r=Math.max(t.west,i.west),a=Math.max(t.south,i.south),o=Math.min(t.east,i.east),u=Math.min(t.north,i.north);if(!(a>=u||r>=o))return s(n)?(n.west=r,n.south=a,n.east=o,n.north=u,n):new e(r,a,o,u)}},{key:"equals",value:function(e,t){return e===t||s(e)&&s(t)&&e.west===t.west&&e.south===t.south&&e.east===t.east&&e.north===t.north}},{key:"fromDegrees",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,a=arguments.length>4?arguments[4]:void 0;return t=ne.toRadians(o(t,0)),i=ne.toRadians(o(i,0)),n=ne.toRadians(o(n,0)),r=ne.toRadians(o(r,0)),s(a)?(a.west=t,a.south=i,a.east=n,a.north=r,a):new e(t,i,n,r)}}]),e}();Oe.MAX_VALUE=Object.freeze(new Oe(-Math.PI,-ne.PI_OVER_TWO,Math.PI,ne.PI_OVER_TWO));var ke=i("53ca"),Pe={};function Me(e){return e+" is required, actual value was undefined"}function Ne(e,t,i){return"Expected "+i+" to be typeof "+t+", actual typeof was "+e}function Ae(e){for(var t=0,i=0;i<9;++i){var n=e[i];t+=n*n}return Math.sqrt(t)}Pe.typeOf={},Pe.defined=function(e,t){if(!s(t))throw new u(Me(e))},Pe.typeOf.func=function(e,t){if("function"!==typeof t)throw new u(Ne(Object(ke["a"])(t),"function",e))},Pe.typeOf.string=function(e,t){if("string"!==typeof t)throw new u(Ne(Object(ke["a"])(t),"string",e))},Pe.typeOf.number=function(e,t){if("number"!==typeof t)throw new u(Ne(Object(ke["a"])(t),"number",e))},Pe.typeOf.number.lessThan=function(e,t,i){if(Pe.typeOf.number(e,t),t>=i)throw new u("Expected "+e+" to be less than "+i+", actual value was "+t)},Pe.typeOf.number.lessThanOrEquals=function(e,t,i){if(Pe.typeOf.number(e,t),t>i)throw new u("Expected "+e+" to be less than or equal to "+i+", actual value was "+t)},Pe.typeOf.number.greaterThan=function(e,t,i){if(Pe.typeOf.number(e,t),t<=i)throw new u("Expected "+e+" to be greater than "+i+", actual value was "+t)},Pe.typeOf.number.greaterThanOrEquals=function(e,t,i){if(Pe.typeOf.number(e,t),t<i)throw new u("Expected "+e+" to be greater than or equal to "+i+", actual value was "+t)};var De=[1,0,0],Le=[2,2,1];function Ue(e){for(var t=0,i=0;i<3;++i){var n=e[He.getElementIndex(Le[i],De[i])];t+=2*n*n}return Math.sqrt(t)}function Fe(e,t){for(var i=ne.EPSILON15,n=0,r=1,a=0;a<3;++a){var o=Math.abs(e[He.getElementIndex(Le[a],De[a])]);o>n&&(r=a,n=o)}var s=1,u=0,l=De[r],c=Le[r];if(Math.abs(e[He.getElementIndex(c,l)])>i){var h,d=e[He.getElementIndex(c,c)],m=e[He.getElementIndex(l,l)],f=e[He.getElementIndex(c,l)],v=(d-m)/2/f;h=v<0?-1/(-v+Math.sqrt(1+v*v)):1/(v+Math.sqrt(1+v*v)),s=1/Math.sqrt(1+h*h),u=h*s}return t=He.clone(He.IDENTITY,t),t[He.getElementIndex(l,l)]=t[He.getElementIndex(c,c)]=s,t[He.getElementIndex(c,l)]=u,t[He.getElementIndex(l,c)]=-u,t}var He=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,u=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,l=arguments.length>6&&void 0!==arguments[6]?arguments[6]:0,c=arguments.length>7&&void 0!==arguments[7]?arguments[7]:0,h=arguments.length>8&&void 0!==arguments[8]?arguments[8]:0;Object(r["a"])(this,e),this[0]=o(t,0),this[1]=o(a,0),this[2]=o(l,0),this[3]=o(i,0),this[4]=o(s,0),this[5]=o(c,0),this[6]=o(n,0),this[7]=o(u,0),this[8]=o(h,0)}return Object(a["a"])(e,null,[{key:"pack",value:function(e,t){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return Pe.typeOf.object("value",e),Pe.defined("array",t),i=o(i,0),t[i++]=e[0],t[i++]=e[1],t[i++]=e[2],t[i++]=e[3],t[i++]=e[4],t[i++]=e[5],t[i++]=e[6],t[i++]=e[7],t[i++]=e[8],t}},{key:"unpack",value:function(t){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2?arguments[2]:void 0;return Pe.defined("array",t),i=o(i,0),s(n)||(n=new e),n[0]=t[i++],n[1]=t[i++],n[2]=t[i++],n[3]=t[i++],n[4]=t[i++],n[5]=t[i++],n[6]=t[i++],n[7]=t[i++],n[8]=t[i++],n}},{key:"clone",value:function(t,i){if(s(t))return s(i)?(i[0]=t[0],i[1]=t[1],i[2]=t[2],i[3]=t[3],i[4]=t[4],i[5]=t[5],i[6]=t[6],i[7]=t[7],i[8]=t[8],i):new e(t[0],t[3],t[6],t[1],t[4],t[7],t[2],t[5],t[8])}},{key:"getColumn",value:function(e,t,i){var n=3*t,r=e[n],a=e[n+1],o=e[n+2];return i.x=r,i.y=a,i.z=o,i}},{key:"computeEigenDecomposition",value:function(t){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{unitary:new e,diagonal:new e};Pe.typeOf.object("matrix",t);var n=ne.EPSILON20,r=10,a=0,o=0;s(i)||(i={unitary:new e,diagonal:new e});var u=i.unitary=e.clone(e.IDENTITY,i.unitary),l=i.diagonal=e.clone(t,i.diagonal),c=n*Ae(l);while(o<r&&Ue(l)>c)Fe(l,ze),e.transpose(ze,qe),e.multiply(l,ze,l),e.multiply(qe,l,l),e.multiply(u,ze,u),++a>2&&(++o,a=0);return i}},{key:"getElementIndex",value:function(e,t){return 3*e+t}},{key:"transpose",value:function(e,t){var i=e[0],n=e[3],r=e[6],a=e[1],o=e[4],s=e[7],u=e[2],l=e[5],c=e[8];return t[0]=i,t[1]=n,t[2]=r,t[3]=a,t[4]=o,t[5]=s,t[6]=u,t[7]=l,t[8]=c,t}},{key:"multiply",value:function(e,t,i){var n=e[0]*t[0]+e[3]*t[1]+e[6]*t[2],r=e[1]*t[0]+e[4]*t[1]+e[7]*t[2],a=e[2]*t[0]+e[5]*t[1]+e[8]*t[2],o=e[0]*t[3]+e[3]*t[4]+e[6]*t[5],s=e[1]*t[3]+e[4]*t[4]+e[7]*t[5],u=e[2]*t[3]+e[5]*t[4]+e[8]*t[5],l=e[0]*t[6]+e[3]*t[7]+e[6]*t[8],c=e[1]*t[6]+e[4]*t[7]+e[7]*t[8],h=e[2]*t[6]+e[5]*t[7]+e[8]*t[8];return i[0]=n,i[1]=r,i[2]=a,i[3]=o,i[4]=s,i[5]=u,i[6]=l,i[7]=c,i[8]=h,i}},{key:"setColumn",value:function(t,i,n,r){r=e.clone(t,r);var a=3*i;return r[a]=n.x,r[a+1]=n.y,r[a+2]=n.z,r}},{key:"multiplyByVector",value:function(e,t,i){var n=t.x,r=t.y,a=t.z,o=e[0]*n+e[3]*r+e[6]*a,s=e[1]*n+e[4]*r+e[7]*a,u=e[2]*n+e[5]*r+e[8]*a;return i.x=o,i.y=s,i.z=u,i}},{key:"multiplyByScale",value:function(e,t,i){return i[0]=e[0]*t.x,i[1]=e[1]*t.x,i[2]=e[2]*t.x,i[3]=e[3]*t.y,i[4]=e[4]*t.y,i[5]=e[5]*t.y,i[6]=e[6]*t.z,i[7]=e[7]*t.z,i[8]=e[8]*t.z,i}},{key:"fromQuaternion",value:function(t,i){var n=t.x*t.x,r=t.x*t.y,a=t.x*t.z,o=t.x*t.w,u=t.y*t.y,l=t.y*t.z,c=t.y*t.w,h=t.z*t.z,d=t.z*t.w,m=t.w*t.w,f=n-u-h+m,v=2*(r-d),g=2*(a+c),p=2*(r+d),y=-n+u-h+m,_=2*(l-o),w=2*(a-c),T=2*(l+o),x=-n-u+h+m;return s(i)?(i[0]=f,i[1]=p,i[2]=w,i[3]=v,i[4]=y,i[5]=T,i[6]=g,i[7]=_,i[8]=x,i):new e(f,v,g,p,y,_,w,T,x)}},{key:"fromScale",value:function(t,i){return s(i)?(i[0]=t.x,i[1]=0,i[2]=0,i[3]=0,i[4]=t.y,i[5]=0,i[6]=0,i[7]=0,i[8]=t.z,i):new e(t.x,0,0,0,t.y,0,0,0,t.z)}}]),e}();He.packedLength=9,He.IDENTITY=Object.freeze(new He(1,0,0,0,1,0,0,0,1)),He.ZERO=Object.freeze(new He(0,0,0,0,0,0,0,0,0)),He.COLUMN0ROW0=0,He.COLUMN0ROW1=1,He.COLUMN0ROW2=2,He.COLUMN1ROW0=3,He.COLUMN1ROW1=4,He.COLUMN1ROW2=5,He.COLUMN2ROW0=6,He.COLUMN2ROW1=7,He.COLUMN2ROW2=8;var ze=new He,qe=new He,Be=new re,je=new re,We=new re,Ve=new re,Ge=new re,Ye=new re,Ze=new re,Xe=new re,Qe=new re,Ke=new re,Je=new re,$e=new re,et=new re,tt=new re,it=new re,nt=(ne.PI,new Ce),rt=new re,at=new re,ot=new me,st=new me,ut=new re,lt=new re,ct=new re,ht=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:re.ZERO,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;Object(r["a"])(this,e),this.center=re.clone(o(t,re.ZERO)),this.radius=o(i,0)}return Object(a["a"])(e,[{key:"intersectPlane",value:function(t){return e.intersectPlane(this,t)}},{key:"clone",value:function(t){return e.clone(this,t)}}],[{key:"clone",value:function(t,i){if(s(t))return s(i)?(i.center=re.clone(t.center,i.center),i.radius=t.radius,i):new e(t.center,t.radius)}},{key:"fromOrientedBoundingBox",value:function(t){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new e;s(i)||(i=new e);var n=t.halfAxes,r=He.getColumn(n,0,Be),a=He.getColumn(n,1,je),o=He.getColumn(n,2,We);return re.add(r,a,r),re.add(r,o,r),i.center=re.clone(t.center,i.center),i.radius=re.magnitude(r),i}},{key:"fromPoints",value:function(t){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new e;if(s(i)||(i=new e),!s(t)||0===t.length)return i.center=re.clone(re.ZERO,i.center),i.radius=0,i;var n,r=re.clone(t[0],Ke),a=re.clone(r,Ve),o=re.clone(r,Ge),u=re.clone(r,Ye),l=re.clone(r,Ze),c=re.clone(r,Xe),h=re.clone(r,Qe),d=t.length;for(n=1;n<d;n++){re.clone(t[n],r);var m=r.x,f=r.y,v=r.z;m<a.x&&re.clone(r,a),m>l.x&&re.clone(r,l),f<o.y&&re.clone(r,o),f>c.y&&re.clone(r,c),v<u.z&&re.clone(r,u),v>h.z&&re.clone(r,h)}var g=re.magnitudeSquared(re.subtract(l,a,Je)),p=re.magnitudeSquared(re.subtract(c,o,Je)),y=re.magnitudeSquared(re.subtract(h,u,Je)),_=a,w=l,T=g;p>T&&(T=p,_=o,w=c),y>T&&(T=y,_=u,w=h);var x=$e;x.x=.5*(_.x+w.x),x.y=.5*(_.y+w.y),x.z=.5*(_.z+w.z);var E=re.magnitudeSquared(re.subtract(w,x,Je)),S=Math.sqrt(E),b=et;b.x=a.x,b.y=o.y,b.z=u.z;var I=tt;I.x=l.x,I.y=c.y,I.z=h.z;var R=re.midpoint(b,I,it),C=0;for(n=0;n<d;n++){re.clone(t[n],r);var O=re.magnitude(re.subtract(r,R,Je));O>C&&(C=O);var k=re.magnitudeSquared(re.subtract(r,x,Je));if(k>E){var P=Math.sqrt(k);S=.5*(S+P),E=S*S;var M=P-S;x.x=(S*x.x+M*r.x)/P,x.y=(S*x.y+M*r.y)/P,x.z=(S*x.z+M*r.z)/P}}return S<C?(re.clone(x,i.center),i.radius=S):(re.clone(R,i.center),i.radius=C),i}},{key:"fromRectangleWithHeights2D",value:function(t){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:nt,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:new e;if(s(a)||(a=new e),!s(t))return a.center=re.clone(re.ZERO,a.center),a.radius=0,a;i=o(i,nt),Oe.southwest(t,ot),ot.height=n,Oe.northeast(t,st),st.height=r;var u=i.project(ot,rt),l=i.project(st,at),c=l.x-u.x,h=l.y-u.y,d=l.z-u.z;a.radius=.5*Math.sqrt(c*c+h*h+d*d);var m=a.center;return m.x=u.x+.5*c,m.y=u.y+.5*h,m.z=u.z+.5*d,a}},{key:"intersectPlane",value:function(e,t){var i=e.center,n=e.radius,r=t.normal,a=re.dot(r,i)+t.distance;return a<-n?Re.OUTSIDE:a<n?Re.INTERSECTING:Re.INSIDE}},{key:"union",value:function(t,i,n){s(n)||(n=new e);var r=t.center,a=t.radius,o=i.center,u=i.radius,l=re.subtract(o,r,ut),c=re.magnitude(l);if(a>=c+u)return t.clone(n),n;if(u>=c+a)return i.clone(n),n;var h=.5*(a+c+u),d=re.multiplyByScalar(l,(-a+h)/c,lt);return re.add(d,r,d),re.clone(d,n.center),n.radius=h,n}},{key:"distanceSquaredTo",value:function(e,t){var i=re.subtract(e.center,t,ct);return re.magnitudeSquared(i)-e.radius*e.radius}}]),e}(),dt=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;Object(r["a"])(this,e),this.x=o(t,0),this.y=o(i,0)}return Object(a["a"])(e,null,[{key:"clone",value:function(t,i){if(s(t))return s(i)?(i.x=t.x,i.y=t.y,i):new e(t.x,t.y)}},{key:"multiplyByScalar",value:function(e,t,i){return i.x=e.x*t,i.y=e.y*t,i}},{key:"add",value:function(e,t,i){return i.x=e.x+t.x,i.y=e.y+t.y,i}},{key:"equalsEpsilon",value:function(e,t){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,n=arguments.length>3?arguments[3]:void 0;return e===t||s(e)&&s(t)&&ne.equalsEpsilon(e.x,t.x,i,n)&&ne.equalsEpsilon(e.y,t.y,i,n)}},{key:"equals",value:function(e,t){return e===t||s(e)&&s(t)&&e.x===t.x&&e.y===t.y}},{key:"subtract",value:function(e,t,i){return i.x=e.x-t.x,i.y=e.y-t.y,i}},{key:"magnitudeSquared",value:function(e){return e.x*e.x+e.y*e.y}},{key:"magnitude",value:function(t){return Math.sqrt(e.magnitudeSquared(t))}},{key:"fromElements",value:function(t,i,n){return s(n)?(n.x=t,n.y=i,n):new e(t,i)}},{key:"normalize",value:function(t,i){var n=e.magnitude(t);if(i.x=t.x/n,i.y=t.y/n,isNaN(i.x)||isNaN(i.y))throw new u("normalized result is not a number");return i}}]),e}();dt.ZERO=Object.freeze(new dt(0,0)),dt.UNIT_X=Object.freeze(new dt(1,0)),dt.UNIT_Y=Object.freeze(new dt(0,1)),dt.distance=function(e,t){return dt.subtract(e,t,mt),dt.magnitude(mt)};var mt=new dt,ft=new dt;dt.lerp=function(e,t,i,n){return dt.multiplyByScalar(t,i,ft),n=dt.multiplyByScalar(e,1-i,n),dt.add(ft,n,n)};i("a9e3");var vt=function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;Object(r["a"])(this,e),this.start=t,this.stop=i};function gt(e,t,i){var n=e+t;return ne.sign(e)!==ne.sign(t)&&Math.abs(n/Math.max(Math.abs(e),Math.abs(t)))<i?0:n}var pt={computeDiscriminant:function(e,t,i){var n=t*t-4*e*i;return n},computeRealRoots:function(e,t,i){var n;if(0===e)return 0===t?[]:[-i/t];if(0===t){if(0===i)return[0,0];var r=Math.abs(i),a=Math.abs(e);if(r<a&&r/a<ne.EPSILON14)return[0,0];if(r>a&&a/r<ne.EPSILON14)return[];if(n=-i/e,n<0)return[];var o=Math.sqrt(n);return[-o,o]}if(0===i)return n=-t/e,n<0?[n,0]:[0,n];var s=t*t,u=4*e*i,l=gt(s,-u,ne.EPSILON14);if(l<0)return[];var c=-.5*gt(t,ne.sign(t)*Math.sqrt(l),ne.EPSILON14);return t>0?[c/e,i/c]:[i/c,c/e]}},yt={};function _t(e,t,i,n){var r,a,o=e,s=t/3,u=i/3,l=n,c=o*u,h=s*l,d=s*s,m=u*u,f=o*u-d,v=o*l-s*u,g=s*l-m,p=4*f*g-v*v;if(p<0){var y,_,w;d*h>=c*m?(y=o,_=f,w=-2*s*f+o*v):(y=l,_=g,w=-l*v+2*u*g);var T=w<0?-1:1,x=-T*Math.abs(y)*Math.sqrt(-p);a=-w+x;var E=a/2,S=E<0?-Math.pow(-E,1/3):Math.pow(E,1/3),b=a===x?-S:-_/S;return r=_<=0?S+b:-w/(S*S+b*b+_),d*h>=c*m?[(r-s)/o]:[-l/(r+u)]}var I=f,R=-2*s*f+o*v,C=g,O=-l*v+2*u*g,k=Math.sqrt(p),P=Math.sqrt(3)/2,M=Math.abs(Math.atan2(o*k,-R)/3);r=2*Math.sqrt(-I);var N=Math.cos(M);a=r*N;var A=r*(-N/2-P*Math.sin(M)),D=a+A>2*s?a-s:A-s,L=o,U=D/L;M=Math.abs(Math.atan2(l*k,-O)/3),r=2*Math.sqrt(-C),N=Math.cos(M),a=r*N,A=r*(-N/2-P*Math.sin(M));var F=-l,H=a+A<2*u?a+u:A+u,z=F/H,q=L*H,B=-D*H-L*F,j=D*F,W=(u*B-s*j)/(-s*B+u*q);return U<=W?U<=z?W<=z?[U,W,z]:[U,z,W]:[z,U,W]:U<=z?[W,U,z]:W<=z?[W,z,U]:[z,W,U]}yt.computeDiscriminant=function(e,t,i,n){var r=e*e,a=t*t,o=i*i,s=n*n,u=18*e*t*i*n+a*o-27*r*s-4*(e*o*i+a*t*n);return u},yt.computeRealRoots=function(e,t,i,n){var r,a;if(0===e)return pt.computeRealRoots(t,i,n);if(0===t){if(0===i){if(0===n)return[0,0,0];a=-n/e;var o=a<0?-Math.pow(-a,1/3):Math.pow(a,1/3);return[o,o,o]}return 0===n?(r=pt.computeRealRoots(e,0,i),0===r.length?[0]:[r[0],0,r[1]]):_t(e,0,i,n)}return 0===i?0===n?(a=-t/e,a<0?[a,0,0]:[0,0,a]):_t(e,t,0,n):0===n?(r=pt.computeRealRoots(e,t,i),0===r.length?[0]:r[1]<=0?[r[0],r[1],0]:r[0]>=0?[0,r[0],r[1]]:[r[0],0,r[1]]):_t(e,t,i,n)};var wt={};function Tt(e,t,i,n){var r=e*e,a=t-3*r/8,o=i-t*e/2+r*e/8,s=n-i*e/4+t*r/16-3*r*r/256,u=yt.computeRealRoots(1,2*a,a*a-4*s,-o*o);if(u.length>0){var l=-e/4,c=u[u.length-1];if(Math.abs(c)<ne.EPSILON14){var h=pt.computeRealRoots(1,a,s);if(2===h.length){var d,m=h[0],f=h[1];if(m>=0&&f>=0){var v=Math.sqrt(m),g=Math.sqrt(f);return[l-g,l-v,l+v,l+g]}if(m>=0&&f<0)return d=Math.sqrt(m),[l-d,l+d];if(m<0&&f>=0)return d=Math.sqrt(f),[l-d,l+d]}return[]}if(c>0){var p=Math.sqrt(c),y=(a+c-o/p)/2,_=(a+c+o/p)/2,w=pt.computeRealRoots(1,p,y),T=pt.computeRealRoots(1,-p,_);return 0!==w.length?(w[0]+=l,w[1]+=l,0!==T.length?(T[0]+=l,T[1]+=l,w[1]<=T[0]?[w[0],w[1],T[0],T[1]]:T[1]<=w[0]?[T[0],T[1],w[0],w[1]]:w[0]>=T[0]&&w[1]<=T[1]?[T[0],w[0],w[1],T[1]]:T[0]>=w[0]&&T[1]<=w[1]?[w[0],T[0],T[1],w[1]]:w[0]>T[0]&&w[0]<T[1]?[T[0],w[0],T[1],w[1]]:[w[0],T[0],w[1],T[1]]):w):0!==T.length?(T[0]+=l,T[1]+=l,T):[]}}return[]}function xt(e,t,i,n){var r=i*i,a=t*t,o=e*e,s=-2*t,u=i*e+a-4*n,l=o*n-i*t*e+r,c=yt.computeRealRoots(1,s,u,l);if(c.length>0){var h,d,m,f,v,g,p=c[0],y=t-p,_=y*y,w=e/2,T=y/2,x=_-4*n,E=_+4*Math.abs(n),S=o-4*p,b=o+4*Math.abs(p);if(p<0||x*b<S*E){var I=Math.sqrt(S);h=I/2,d=0===I?0:(e*T-i)/I}else{var R=Math.sqrt(x);h=0===R?0:(e*T-i)/R,d=R/2}0===w&&0===h?(m=0,f=0):ne.sign(w)===ne.sign(h)?(m=w+h,f=p/m):(f=w-h,m=p/f),0===T&&0===d?(v=0,g=0):ne.sign(T)===ne.sign(d)?(v=T+d,g=n/v):(g=T-d,v=n/g);var C=pt.computeRealRoots(1,m,v),O=pt.computeRealRoots(1,f,g);if(0!==C.length)return 0!==O.length?C[1]<=O[0]?[C[0],C[1],O[0],O[1]]:O[1]<=C[0]?[O[0],O[1],C[0],C[1]]:C[0]>=O[0]&&C[1]<=O[1]?[O[0],C[0],C[1],O[1]]:O[0]>=C[0]&&O[1]<=C[1]?[C[0],O[0],O[1],C[1]]:C[0]>O[0]&&C[0]<O[1]?[O[0],C[0],O[1],C[1]]:[C[0],O[0],C[1],O[1]]:C;if(0!==O.length)return O}return[]}wt.computeDiscriminant=function(e,t,i,n,r){var a=e*e,o=a*e,s=t*t,u=s*t,l=i*i,c=l*i,h=n*n,d=h*n,m=r*r,f=m*r,v=s*l*h-4*u*d-4*e*c*h+18*e*t*i*d-27*a*h*h+256*o*f+r*(18*u*i*n-4*s*c+16*e*l*l-80*e*t*l*n-6*e*s*h+144*a*i*h)+m*(144*e*s*i-27*s*s-128*a*l-192*a*t*n);return v},wt.computeRealRoots=function(e,t,i,n,r){if(Math.abs(e)<ne.EPSILON15)return yt.computeRealRoots(t,i,n,r);var a=t/e,o=i/e,s=n/e,u=r/e,l=a<0?1:0;switch(l+=o<0?l+1:l,l+=s<0?l+1:l,l+=u<0?l+1:l,l){case 0:return Tt(a,o,s,u);case 1:return xt(a,o,s,u);case 2:return xt(a,o,s,u);case 3:return Tt(a,o,s,u);case 4:return Tt(a,o,s,u);case 5:return xt(a,o,s,u);case 6:return Tt(a,o,s,u);case 7:return Tt(a,o,s,u);case 8:return xt(a,o,s,u);case 9:return Tt(a,o,s,u);case 10:return Tt(a,o,s,u);case 11:return xt(a,o,s,u);case 12:return Tt(a,o,s,u);case 13:return Tt(a,o,s,u);case 14:return Tt(a,o,s,u);case 15:return Tt(a,o,s,u);default:return}};var Et=wt,St=function(){function e(t,i){Object(r["a"])(this,e),i=re.clone(o(i,re.ZERO)),re.equals(i,re.ZERO)||re.normalize(i,i),this.origin=re.clone(o(t,re.ZERO)),this.direction=i}return Object(a["a"])(e,[{key:"at",value:function(e,t){return re.clone(this.direction,t),re.multiplyByScalar(t,e,t),re.add(t,this.origin,t),t}}],[{key:"getPoint",value:function(e,t,i){return s(i)||(i=new re),i=re.multiplyByScalar(e.direction,t,i),re.add(e.origin,i,i)}}]),e}(),bt={rayPlane:function(e,t,i){if(!s(e))throw new u("ray is required.");if(!s(t))throw new u("plane is required.");s(i)||(i=new re);var n=e.origin,r=e.direction,a=t.normal,o=re.dot(a,r);if(!(Math.abs(o)<ne.EPSILON15)){var l=(-t.distance-re.dot(a,n))/o;if(!(l<0))return i=re.multiplyByScalar(r,l,i),re.add(n,i,i)}}},It=new re,Rt=new re,Ct=new re,Ot=new re,kt=new re;bt.rayTriangleParametric=function(e,t,i,n){var r=arguments.length>4&&void 0!==arguments[4]&&arguments[4];if(!s(e))throw new u("ray is required.");if(!s(t))throw new u("p0 is required.");if(!s(i))throw new u("p1 is required.");if(!s(n))throw new u("p2 is required.");r=o(r,!1);var a,l,c,h,d,m=e.origin,f=e.direction,v=re.subtract(i,t,It),g=re.subtract(n,t,Rt),p=re.cross(f,g,Ct),y=re.dot(v,p);if(r){if(y<ne.EPSILON6)return;if(a=re.subtract(m,t,Ot),c=re.dot(a,p),c<0||c>y)return;if(l=re.cross(a,v,kt),h=re.dot(f,l),h<0||c+h>y)return;d=re.dot(g,l)/y}else{if(Math.abs(y)<ne.EPSILON6)return;var _=1/y;if(a=re.subtract(m,t,Ot),c=re.dot(a,p)*_,c<0||c>1)return;if(l=re.cross(a,v,kt),h=re.dot(f,l)*_,h<0||c+h>1)return;d=re.dot(g,l)*_}return d};var Pt={root0:0,root1:0};function Mt(e,t,i,n){var r=t*t-4*e*i;if(!(r<0)){if(r>0){var a=1/(2*e),o=Math.sqrt(r),s=(-t+o)*a,u=(-t-o)*a;return s<u?(n.root0=s,n.root1=u):(n.root0=u,n.root1=s),n}var l=-t/(2*e);if(0!==l)return n.root0=n.root1=l,n}}function Nt(e,t,i){s(i)||(i=new vt);var n=e.origin,r=e.direction,a=t.center,o=t.radius*t.radius,u=re.subtract(n,a,Ct),l=re.dot(r,r),c=2*re.dot(r,u),h=re.magnitudeSquared(u)-o,d=Mt(l,c,h,Pt);if(s(d))return i.start=d.root0,i.stop=d.root1,i}bt.raySphere=function(e,t,i){if(!s(e))throw new u("ray is required.");if(!s(t))throw new u("sphere is required.");if(i=Nt(e,t,i),s(i)&&!(i.stop<0))return i.start=Math.max(i.start,0),i};var At=new re;bt.intersectSphere=function(e,t,i){re.subtract(t.center,e.origin,At);var n=re.dot(At,e.direction),r=re.dot(At,At)-n*n,a=t.radius*t.radius;if(r>a)return null;var o=Math.sqrt(a-r),s=n-o,u=n+o;return s<0&&u<0?null:s<0?St.getPoint(e,u,i):St.getPoint(e,s,i)};var Dt=new re,Lt=new re;function Ut(e,t,i){var n=e+t;return ne.sign(e)!==ne.sign(t)&&Math.abs(n/Math.max(Math.abs(e),Math.abs(t)))<i?0:n}function Ft(e,t,i,n,r){var a,o=n*n,s=r*r,u=(e[He.COLUMN1ROW1]-e[He.COLUMN2ROW2])*s,l=r*(n*Ut(e[He.COLUMN1ROW0],e[He.COLUMN0ROW1],ne.EPSILON15)+t.y),c=e[He.COLUMN0ROW0]*o+e[He.COLUMN2ROW2]*s+n*t.x+i,h=s*Ut(e[He.COLUMN2ROW1],e[He.COLUMN1ROW2],ne.EPSILON15),d=r*(n*Ut(e[He.COLUMN2ROW0],e[He.COLUMN0ROW2])+t.z),m=[];if(0===d&&0===h){if(a=pt.computeRealRoots(u,l,c),0===a.length)return m;var f=a[0],v=Math.sqrt(Math.max(1-f*f,0));if(m.push(new re(n,r*f,r*-v)),m.push(new re(n,r*f,r*v)),2===a.length){var g=a[1],p=Math.sqrt(Math.max(1-g*g,0));m.push(new re(n,r*g,r*-p)),m.push(new re(n,r*g,r*p))}return m}var y=d*d,_=h*h,w=u*u,T=d*h,x=w+_,E=2*(l*u+T),S=2*c*u+l*l-_+y,b=2*(c*l-T),I=c*c-y;if(0===x&&0===E&&0===S&&0===b)return m;a=Et.computeRealRoots(x,E,S,b,I);var R=a.length;if(0===R)return m;for(var C=0;C<R;++C){var O=a[C],k=O*O,P=Math.max(1-k,0),M=Math.sqrt(P),N=void 0;N=ne.sign(u)===ne.sign(c)?Ut(u*k+c,l*O,ne.EPSILON12):ne.sign(c)===ne.sign(l*O)?Ut(u*k,l*O+c,ne.EPSILON12):Ut(u*k+l*O,c,ne.EPSILON12);var A=Ut(h*O,d,ne.EPSILON15),D=N*A;D<0?m.push(new re(n,r*O,r*M)):D>0?m.push(new re(n,r*O,r*-M)):0!==M?(m.push(new re(n,r*O,r*-M)),m.push(new re(n,r*O,r*M)),++C):m.push(new re(n,r*O,r*M))}return m}bt.rayEllipsoid=function(e,t){if(!s(e))throw new u("ray is required.");if(!s(t))throw new u("ellipsoid is required.");var i,n,r,a,o,l=t.oneOverRadii,c=re.multiplyComponents(l,e.origin,Dt),h=re.multiplyComponents(l,e.direction,Lt),d=re.magnitudeSquared(c),m=re.dot(c,h);if(d>1){if(m>=0)return;var f=m*m;if(i=d-1,n=re.magnitudeSquared(h),r=n*i,f<r)return;if(f>r){a=m*m-r,o=-m+Math.sqrt(a);var v=o/n,g=i/o;return v<g?new vt(v,g):{start:g,stop:v}}var p=Math.sqrt(i/n);return new vt(p,p)}return d<1?(i=d-1,n=re.magnitudeSquared(h),r=n*i,a=m*m-r,o=-m+Math.sqrt(a),new vt(0,o/n)):m<0?(n=re.magnitudeSquared(h),new vt(0,-m/n)):void 0};var Ht=new re,zt=new re,qt=new re,Bt=new re,jt=new re,Wt=new He,Vt=new He,Gt=new He,Yt=new He,Zt=new He,Xt=new He,Qt=new He,Kt=new re,Jt=new re,$t=new me;bt.grazingAltitudeLocation=function(e,t){var i=e.origin,n=e.direction;if(!re.equals(i,re.ZERO)){var r=t.geodeticSurfaceNormal(i,Ht);if(re.dot(n,r)>=0)return i}var a=s(this.rayEllipsoid(e,t)),o=t.transformPositionToScaledSpace(n,Ht),u=re.normalize(o,o),l=re.mostOrthogonalAxis(o,Bt),c=re.normalize(re.cross(l,u,zt),zt),h=re.normalize(re.cross(u,c,qt),qt),d=Wt;d[0]=u.x,d[1]=u.y,d[2]=u.z,d[3]=c.x,d[4]=c.y,d[5]=c.z,d[6]=h.x,d[7]=h.y,d[8]=h.z;var m=He.transpose(d,Vt),f=He.fromScale(t.radii,Gt),v=He.fromScale(t.oneOverRadii,Yt),g=Zt;g[0]=0,g[1]=-n.z,g[2]=n.y,g[3]=n.z,g[4]=0,g[5]=-n.x,g[6]=-n.y,g[7]=n.x,g[8]=0;var p,y,_=He.multiply(He.multiply(m,v,Xt),g,Xt),w=He.multiply(He.multiply(_,f,Qt),d,Qt),T=He.multiplyByVector(_,i,jt),x=Ft(w,re.negate(T,Ht),0,0,1),E=x.length;if(E>0){for(var S=re.clone(re.ZERO,Jt),b=Number.NEGATIVE_INFINITY,I=0;I<E;++I){p=He.multiplyByVector(f,He.multiplyByVector(d,x[I],Kt),Kt);var R=re.normalize(re.subtract(p,i,Bt),Bt),C=re.dot(R,n);C>b&&(b=C,S=re.clone(p,S))}var O=t.cartesianToCartographic(S,$t);return b=ne.clamp(b,0,1),y=re.magnitude(re.subtract(S,i,Bt))*Math.sqrt(1-b*b),y=a?-y:y,O.height=y,t.cartographicToCartesian(O,new re)}};i("d81d");function ei(){return!0}function ti(e,t){function i(){throw new u(t)}for(var n in t=o(t,"This object was destroyed, i.e., destroy() was called."),e)"function"===typeof e[n]&&(e[n]=i);e.isDestroyed=ei}Object.defineProperties(n["t"].prototype,{length:{get:function(){return this.children.length}},byteLength:{get:function(){return this._geometryByteLength+this._texturesByteLength}}}),n["t"].prototype.allowPicking=!0,n["t"].prototype._geometryByteLength=0,n["t"].prototype._texturesByteLength=0,n["t"].prototype._trianglesLength=0,n["t"].prototype._index=-1,n["t"].prototype.updateFixedFrame=function(e){for(var t=this.children,i=0,n=t.length;i<n;i++){var r=t[i];s(r.updateFixedFrame)&&r.updateFixedFrame(e)}},n["t"].prototype.postRenderUpdate=function(e){for(var t=this.children,i=0,n=t.length;i<n;i++){var r=t[i];s(r.postRenderUpdate)&&r.postRenderUpdate(e)}},n["t"].prototype.get=function(e){return this.children[e]},n["t"].prototype.addObject=function(e){if(!e.isDestroyed())return this.add(e),e._collection=this,e},n["t"].prototype.removeObject=function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return this.remove(e),(this.destroyChildren||t)&&e.destroy(),e},n["t"].prototype.destroySelf=function(){if(s(this.geometry)){var e=this.geometry.attributes;for(var t in e)e[t].array=null;this.geometry.index.array=null,this.geometry.dispose(),this.geometry=null}var i=this.material;s(i)&&(s(i.map)&&(i.map.dispose(),i.map=null),s(i.aoMap)&&(i.aoMap.dispose(),i.aoMap=null),s(i.lightMap)&&(i.lightMap.dispose(),i.lightMap=null),i.dispose(),i=null)},n["t"].prototype.destroy=function(){return this.destroySelf(),this.traverse((function(e){(e.isMesh||e.isSprite)&&e.destroySelf()})),ti(this)},n["t"].prototype.isDestroyed=function(){return!1},n["M"].ZERO=Object.freeze(new n["M"](0,0,0)),n["M"].UNIT_X=Object.freeze(new n["M"](1,0,0)),n["M"].UNIT_Y=Object.freeze(new n["M"](0,1,0)),n["M"].UNIT_Z=Object.freeze(new n["M"](0,0,1));i("ac1f"),i("466d"),i("00b4"),i("fb6a"),i("1276");function ii(e,t,i){i=o(i,!1);var n,r,a,u={},l=s(e),c=s(t);if(l)for(n in e)Object.prototype.hasOwnProperty.call(e,n)&&(r=e[n],c&&i&&"object"===Object(ke["a"])(r)&&Object.prototype.hasOwnProperty.call(t,n)?(a=t[n],"object"===Object(ke["a"])(a)?u[n]=ii(r,a,i):u[n]=r):u[n]=r);if(c)for(n in t)Object.prototype.hasOwnProperty.call(t,n)&&!Object.prototype.hasOwnProperty.call(u,n)&&(a=t[n],u[n]=a);return u}var ni=0,ri={},ai=function e(t){var i,n=arguments.length>1&&void 0!==arguments[1]&&arguments[1];Object(r["a"])(this,e);var a=t;s(ri[a])?i=ri[a]:(i=ni++,ri[a]=i),n=o(n,!1),this._id=i,this._html=t,this._showOnScreen=n,this._element=void 0};i("a434"),i("4e82");function oi(e,t){return t-e}var si=function(){function e(){Object(r["a"])(this,e),this._listeners=[],this._scopes=[],this._toRemove=[],this._insideRaiseEvent=!1}return Object(a["a"])(e,[{key:"numberOfListeners",get:function(){return this._listeners.length-this._toRemove.length}},{key:"addEventListener",value:function(e,t){this._listeners.push(e),this._scopes.push(t);var i=this;return function(){i.removeEventListener(e,t)}}},{key:"removeEventListener",value:function(e,t){for(var i=this._listeners,n=this._scopes,r=-1,a=0;a<i.length;a++)if(i[a]===e&&n[a]===t){r=a;break}return-1!==r&&(this._insideRaiseEvent?(this._toRemove.push(r),i[r]=void 0,n[r]=void 0):(i.splice(r,1),n.splice(r,1)),!0)}},{key:"raiseEvent",value:function(){var e;this._insideRaiseEvent=!0;for(var t=this._listeners,i=this._scopes,n=t.length,r=arguments.length,a=new Array(r),o=0;o<r;o++)a[o]=arguments[o];for(e=0;e<n;e++){var u=t[e];s(u)&&t[e].apply(i[e],a)}var l=this._toRemove;if(n=l.length,n>0){for(l.sort(oi),e=0;e<n;e++){var c=l[e];t.splice(c,1),i.splice(c,1)}l.length=0}this._insideRaiseEvent=!1}}]),e}();i("b64b"),i("99af"),i("5319"),i("3ca3"),i("ddb0"),i("2b3d"),i("9861"),i("c19f"),i("5cc6"),i("907a"),i("9a8c"),i("a975"),i("735e"),i("c1ac"),i("d139"),i("3a7b"),i("d5d6"),i("82f8"),i("e91f"),i("60bd"),i("5f96"),i("3280"),i("3fcc"),i("ca91"),i("25a1"),i("cd26"),i("3c5d"),i("2954"),i("649e"),i("219c"),i("170b"),i("b39a"),i("72f7"),i("498a"),i("159b"),i("a15b");function ui(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(null===e||"object"!==Object(ke["a"])(e))return e;t=o(t,!1);var i=new e.constructor;for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n)){var r=e[n];t&&(r=ui(r,t)),i[n]=r}return i}i("4d63"),i("c607"),i("2c3e");var li=new RegExp("^(?:([^:/?#]+):)?(?://([^/?#]*))?([^?#]*)(?:\\?([^#]*))?(?:#(.*))?$"),ci=/%[0-9a-z]{2}/gi,hi=/[a-zA-Z0-9\-\._~]/,di=/(.*@)?([^@:]*)(:.*)?/;function mi(e){var t=unescape(e);return hi.test(t)?t:e.toUpperCase()}function fi(e,t,i,n){return(t||"")+i.toLowerCase()+(n||"")}var vi=function(){function e(t){if(Object(r["a"])(this,e),this.scheme=null,this.authority=null,this.path=null,this.query=null,this.fragment=null,t instanceof e)this.scheme=t.scheme,this.authority=t.authority,this.path=t.path,this.query=t.query,this.fragment=t.fragment;else if(t){var i=li.exec(t);this.scheme=i[1],this.authority=i[2],this.path=i[3],this.query=i[4],this.fragment=i[5]}}return Object(a["a"])(e,[{key:"getScheme",value:function(){return this.scheme}},{key:"getAuthority",value:function(){return this.authority}},{key:"getPath",value:function(){return this.path}},{key:"getQuery",value:function(){return this.query}},{key:"getFragment",value:function(){return this.fragment}},{key:"isAbsolute",value:function(){return!!this.scheme&&!this.fragment}},{key:"isSameDocumentAs",value:function(e){return e.scheme==this.scheme&&e.authority==this.authority&&e.path==this.path&&e.query==this.query}},{key:"equals",value:function(e){return this.isSameDocumentAs(e)&&e.fragment==this.fragment}},{key:"normalize",value:function(){this.removeDotSegments(),this.scheme&&(this.scheme=this.scheme.toLowerCase()),this.authority&&(this.authority=this.authority.replace(di,fi).replace(ci,mi)),this.path&&(this.path=this.path.replace(ci,mi)),this.query&&(this.query=this.query.replace(ci,mi)),this.fragment&&(this.fragment=this.fragment.replace(ci,mi))}},{key:"resolve",value:function(t){var i=new e;return this.scheme?(i.scheme=this.scheme,i.authority=this.authority,i.path=this.path,i.query=this.query):(i.scheme=t.scheme,this.authority?(i.authority=this.authority,i.path=this.path,i.query=this.query):(i.authority=t.authority,""==this.path?(i.path=t.path,i.query=this.query||t.query):("/"==this.path.charAt(0)?(i.path=this.path,i.removeDotSegments()):(t.authority&&""==t.path?i.path="/"+this.path:i.path=t.path.substring(0,t.path.lastIndexOf("/")+1)+this.path,i.removeDotSegments()),i.query=this.query))),i.fragment=this.fragment,i}},{key:"removeDotSegments",value:function(){var e,t=this.path.split("/"),i=[],n=""==t[0];n&&t.shift();""==t[0]&&t.shift();while(t.length)e=t.shift(),".."==e?i.pop():"."!=e&&i.push(e);"."!=e&&".."!=e||i.push(""),n&&i.unshift(""),this.path=i.join("/")}},{key:"toString",value:function(){var e="";return this.scheme&&(e+=this.scheme+":"),this.authority&&(e+="//"+this.authority),e+=this.path,this.query&&(e+="?"+this.query),this.fragment&&(e+="#"+this.fragment),e}}]),e}();function gi(e,t){var i;return"undefined"!==typeof document&&(i=document),gi._implementation(e,t,i)}function pi(e){if(!s(e))throw new u("uri is required.");var t=new vi(e);t.normalize();var i=t.path,n=i.lastIndexOf("/");return-1!==n&&(i=i.substr(n+1)),n=i.lastIndexOf("."),i=-1===n?"":i.substr(n+1),i}gi._implementation=function(e,t,i){if(!s(e))throw new u("relative uri is required.");if(!s(t)){if("undefined"===typeof i)return e;t=o(i.baseURI,i.location.href)}var n=new vi(t),r=new vi(e);return r.resolve(n).toString()};var yi=/^blob:/i;function _i(e){return yi.test(e)}var wi,Ti,xi=/^data:/i;function Ei(e){return xi.test(e)}function Si(e){if(!s(e))throw new u("obj is required.");var t="";for(var i in e)if(Object.prototype.hasOwnProperty.call(e,i)){var n=e[i],r=encodeURIComponent(i)+"=";if(Array.isArray(n))for(var a=0,o=n.length;a<o;++a)t+=r+encodeURIComponent(n[a])+"&";else t+=r+encodeURIComponent(n)+"&"}return t=t.slice(0,-1),t}function bi(e){if(!s(e))throw new u("queryString is required.");var t={};if(""===e)return t;for(var i=e.replace(/\+/g,"%20").split(/[&;]/),n=0,r=i.length;n<r;++n){var a=i[n].split("="),o=decodeURIComponent(a[0]),l=a[1];l=s(l)?decodeURIComponent(l):"";var c=t[o];"string"===typeof c?t[o]=[c,l]:Array.isArray(c)?c.push(l):t[o]=l}return t}(function(e){e[e["UNISSUED"]=0]="UNISSUED",e[e["ISSUED"]=1]="ISSUED",e[e["ACTIVE"]=2]="ACTIVE",e[e["RECEIVED"]=3]="RECEIVED",e[e["CANCELLED"]=4]="CANCELLED",e[e["FAILED"]=5]="FAILED"})(wi||(wi={})),function(e){e[e["TERRAIN"]=0]="TERRAIN",e[e["IMAGERY"]=1]="IMAGERY",e[e["TILES3D"]=2]="TILES3D",e[e["OTHER"]=3]="OTHER"}(Ti||(Ti={}));var Ii=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};Object(r["a"])(this,e),t=o(t,o.EMPTY_OBJECT);var i=o(t.throttleByServer,!1),n=o(t.throttle,!1);this.url=t.url,this.requestFunction=t.requestFunction,this.cancelFunction=t.cancelFunction,this.priorityFunction=t.priorityFunction,this.priority=o(t.priority,0),this.throttle=n,this.throttleByServer=i,this.type=o(t.type,Ti.OTHER),this.serverKey=void 0,this.state=wi.UNISSUED,this.deferred=void 0,this.cancelled=!1}return Object(a["a"])(e,[{key:"cancel",value:function(){this.cancelled=!0}},{key:"clone",value:function(t){return s(t)?(t.url=this.url,t.requestFunction=this.requestFunction,t.cancelFunction=this.cancelFunction,t.priorityFunction=this.priorityFunction,t.priority=this.priority,t.throttle=this.throttle,t.throttleByServer=this.throttleByServer,t.type=this.type,t.serverKey=this.serverKey,t.state=wi.UNISSUED,t.deferred=void 0,t.cancelled=!1,t):new e(this)}}]),e}();function Ri(e,t,i){var n=e[t];e[t]=e[i],e[i]=n}var Ci,Oi,ki,Pi=function(){function e(t){Object(r["a"])(this,e),this._comparator=t.comparator,this._array=[],this._length=0,this._maximumLength=void 0}return Object(a["a"])(e,[{key:"length",get:function(){return this._length}},{key:"internalArray",get:function(){return this._array}},{key:"maximumLength",get:function(){return this._maximumLength},set:function(e){var t=this._length;if(e<t){for(var i=this._array,n=e;n<t;++n)i[n]=void 0;this._length=e,i.length=e}this._maximumLength=e}},{key:"comparator",get:function(){return this._comparator}},{key:"reserve",value:function(e){e=o(e,this._length),this._array.length=e}},{key:"heapify",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;e=o(e,0);var t=this._length,i=this._comparator,n=this._array,r=-1,a=!0;while(a){var s=2*(e+1),u=s-1;r=u<t&&i(n[u],n[e])<0?u:e,s<t&&i(n[s],n[r])<0&&(r=s),r!==e?(Ri(n,r,e),e=r):a=!1}}},{key:"resort",value:function(){for(var e=this._length,t=Math.ceil(e/2);t>=0;--t)this.heapify(t)}},{key:"insert",value:function(e){var t,i=this._array,n=this._comparator,r=this._maximumLength,a=this._length++;a<i.length?i[a]=e:i.push(e);while(0!==a){var o=Math.floor((a-1)/2);if(!(n(i[a],i[o])<0))break;Ri(i,a,o),a=o}return s(r)&&this._length>r&&(t=i[r],this._length=r),t}},{key:"pop",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;if(e=o(e,0),0!==this._length){var t=this._array,i=t[e];return Ri(t,e,--this._length),this.heapify(e),t[this._length]=void 0,i}}}]),e}();
/**
  @license
  when.js - https://github.com/cujojs/when

  MIT License (c) copyright B Cavalier & J Hann

 * A lightweight CommonJS Promises/A and when() implementation
 * when is part of the cujo.js family of libraries (http://cujojs.com/)
 *
 * Licensed under the MIT License at:
 * http://www.opensource.org/licenses/mit-license.php
 *
 * @version 1.7.1
 */function Mi(e,t,i,n){return Ni(e).then(t,i,n)}function Ni(e){var t,i;return e instanceof Di?t=e:Hi(e)?(i=Fi(),e.then((function(e){i.resolve(e)}),(function(e){i.reject(e)}),(function(e){i.progress(e)})),t=i.promise):t=Li(e),t}function Ai(e){return Mi(e,Ui)}Mi.defer=Fi,Mi.resolve=Ni,Mi.reject=Ai,Mi.join=ji,Mi.all=Bi,Mi.map=Wi,Mi.reduce=Vi,Mi.any=qi,Mi.some=zi,Mi.chain=Gi,Mi.isPromise=Hi;var Di=function(){function e(t){Object(r["a"])(this,e),this.then=t}return Object(a["a"])(e,[{key:"always",value:function(e,t){return this.then(e,e,t)}},{key:"otherwise",value:function(e){return this.then(ki,e)}},{key:"yield",value:function(e){return this.then((function(){return e}))}},{key:"spread",value:function(e){return this.then((function(t){return Bi(t,(function(t){return e.apply(ki,t)}))}))}}]),e}();function Li(e){var t=new Di((function(t){try{return Ni(t?t(e):e)}catch(i){return Ui(i)}}));return t}function Ui(e){var t=new Di((function(t,i){try{return i?Ni(i(e)):Ui(e)}catch(n){return Ui(n)}}));return t}function Fi(){var e,t,i,n,r,a,o;return t=new Di(s),e={then:s,resolve:u,reject:l,progress:c,promise:t,resolver:{resolve:u,reject:l,progress:c}},i=[],n=[],r=function(e,t,r){var a,o;return a=Fi(),o="function"===typeof r?function(e){try{a.progress(r(e))}catch(t){a.progress(t)}}:function(e){a.progress(e)},i.push((function(i){i.then(e,t).then(a.resolve,a.reject,o)})),n.push(o),a.promise},a=function(e){return Yi(n,e),e},o=function(e){return e=Ni(e),r=e.then,o=Ni,a=Xi,Yi(i,e),n=i=ki,e},e;function s(e,t,i){return r(e,t,i)}function u(e){return o(e)}function l(e){return o(Ui(e))}function c(e){return a(e)}}function Hi(e){return e&&"function"===typeof e.then}function zi(e,t,i,n,r){return Zi(2,arguments),Mi(e,(function(e){var a,o,s,u,l,c,h,d,m,f;if(m=e.length>>>0,a=Math.max(0,Math.min(t,m)),s=[],o=m-a+1,u=[],l=Fi(),a)for(d=l.progress,h=function(e){u.push(e),--o||(c=h=Xi,l.reject(u))},c=function(e){s.push(e),--a||(c=h=Xi,l.resolve(s))},f=0;f<m;++f)f in e&&Mi(e[f],g,v,d);else l.resolve(s);return l.then(i,n,r);function v(e){h(e)}function g(e){c(e)}}))}function qi(e,t,i,n){function r(e){return t?t(e[0]):e[0]}return zi(e,1,r,i,n)}function Bi(e,t,i,n){return Zi(1,arguments),Wi(e,Qi).then(t,i,n)}function ji(){return Wi(arguments,Qi)}function Wi(e,t){return Mi(e,(function(e){var i,n,r,a,o,s;if(r=n=e.length>>>0,i=[],s=Fi(),r)for(a=function(e,n){Mi(e,t).then((function(e){i[n]=e,--r||s.resolve(i)}),s.reject)},o=0;o<n;o++)o in e?a(e[o],o):--r;else s.resolve(i);return s.promise}))}function Vi(e,t){var i=Oi.call(arguments,1);return Mi(e,(function(e){var n;return n=e.length,i[0]=function(e,i,r){return Mi(e,(function(e){return Mi(i,(function(i){return t(e,i,r,n)}))}))},Ci.apply(e,i)}))}function Gi(e,t,i){var n=arguments.length>2;return Mi(e,(function(e){return e=n?i:e,t.resolve(e),e}),(function(e){return t.reject(e),Ui(e)}),t.progress)}function Yi(e,t){var i,n=0;while(i=e[n++])i(t)}function Zi(e,t){var i,n=t.length;while(n>e)if(i=t[--n],null!=i&&"function"!==typeof i)throw new Error("arg "+n+" must be a function")}function Xi(){}function Qi(e){return e}function Ki(e,t){return e.priority-t.priority}Oi=[].slice,Ci=[].reduce||function(e){var t,i,n,r,a;if(a=0,t=Object(this),r=t.length>>>0,i=arguments,i.length<=1)for(;;){if(a in t){n=t[a++];break}if(++a>=r)throw new TypeError}else n=i[1];for(;a<r;++a)a in t&&(n=e(n,t[a],a,t));return n};var Ji={numberOfAttemptedRequests:0,numberOfActiveRequests:0,numberOfCancelledRequests:0,numberOfCancelledActiveRequests:0,numberOfFailedRequests:0,numberOfActiveRequestsEver:0},$i=20,en=new Pi({comparator:Ki});en.maximumLength=$i,en.reserve($i);var tn=[],nn={},rn="undefined"!==typeof document?new vi(document.location.href):new vi,an=new si,on=function(){function e(){Object(r["a"])(this,e)}return Object(a["a"])(e,[{key:"statistics",get:function(){return Ji}},{key:"priorityHeapLength",get:function(){return $i},set:function(e){if(e<$i)while(en.length>e){var t=en.pop();mn(t)}$i=e,en.maximumLength=e,en.reserve(e)}}],[{key:"update",value:function(){var t,i,n=0,r=tn.length;for(t=0;t<r;++t)i=tn[t],i.cancelled&&mn(i),i.state===wi.ACTIVE?n>0&&(tn[t-n]=i):++n;tn.length-=n;var a=en.internalArray,o=en.length;for(t=0;t<o;++t)sn(a[t]);en.resort();var s=Math.max(e.maximumRequests-tn.length,0),u=0;while(u<s&&en.length>0)i=en.pop(),i.cancelled?mn(i):!i.throttleByServer||un(i.serverKey)?(dn(i),++u):mn(i);vn()}},{key:"getServerKey",value:function(e){var t=new vi(e).resolve(rn);t.normalize();var i=t.authority;/:/.test(i)||(i=i+":"+("https"===t.scheme?"443":"80"));var n=nn[i];return s(n)||(nn[i]=0),i}},{key:"request",value:function(t){if(Ei(t.url)||_i(t.url))return an.raiseEvent(),t.state=wi.RECEIVED,t.requestFunction();if(++Ji.numberOfAttemptedRequests,s(t.serverKey)||(t.serverKey=e.getServerKey(t.url)),!e.throttleRequests||!t.throttle)return dn(t);if(!(tn.length>=e.maximumRequests)&&(!t.throttleByServer||un(t.serverKey))){sn(t);var i=en.insert(t);if(s(i)){if(i===t)return;mn(i)}return ln(t)}}},{key:"clearForSpecs",value:function(){while(en.length>0){var e=en.pop();mn(e)}for(var t=tn.length,i=0;i<t;++i)mn(tn[i]);tn.length=0,nn={},Ji.numberOfAttemptedRequests=0,Ji.numberOfActiveRequests=0,Ji.numberOfCancelledRequests=0,Ji.numberOfCancelledActiveRequests=0,Ji.numberOfFailedRequests=0,Ji.numberOfActiveRequestsEver=0}},{key:"numberOfActiveRequestsByServer",value:function(e){return nn[e]}}]),e}();function sn(e){s(e.priorityFunction)&&(e.priority=e.cancelFunction())}function un(e){var t=o(on.requestsByServer[e],on.maximumRequestsPerServer);return nn[e]<t}function ln(e){return e.state===wi.UNISSUED&&(e.state=wi.ISSUED,e.deferred=Mi.defer()),e.deferred.promise}function cn(e){return function(t){e.state!==wi.CANCELLED&&(--Ji.numberOfActiveRequests,--nn[e.serverKey],an.raiseEvent(),e.state=wi.RECEIVED,e.deferred.resolve(t))}}function hn(e){return function(t){e.state!==wi.CANCELLED&&(++Ji.numberOfFailedRequests,--Ji.numberOfActiveRequests,--nn[e.serverKey],an.raiseEvent(t),e.state=wi.FAILED,e.deferred.reject(t))}}function dn(e){var t=ln(e);return e.state=wi.ACTIVE,tn.push(e),++Ji.numberOfActiveRequests,++Ji.numberOfActiveRequestsEver,++nn[e.serverKey],e.requestFunction().then(cn(e)).otherwise(hn(e)),t}function mn(e){var t=e.state===wi.ACTIVE;e.state=wi.CANCELLED,++Ji.numberOfCancelledRequests,e.deferred.reject(),t&&(--Ji.numberOfActiveRequests,--nn[e.serverKey],++Ji.numberOfCancelledActiveRequests),s(e.cancelFunction)&&e.cancelFunction()}function fn(){Ji.numberOfAttemptedRequests=0,Ji.numberOfCancelledRequests=0,Ji.numberOfCancelledActiveRequests=0}function vn(){on.debugShowStatistics&&(Ji.numberOfAttemptedRequests>0&&console.log("Number of attempted requests: "+Ji.numberOfAttemptedRequests),Ji.numberOfActiveRequests>0&&console.log("Number of active requests: "+Ji.numberOfActiveRequests),Ji.numberOfCancelledRequests>0&&console.log("Number of cancelled requests: "+Ji.numberOfCancelledRequests),Ji.numberOfCancelledActiveRequests>0&&console.log("Number of cancelled active requests: "+Ji.numberOfCancelledActiveRequests),Ji.numberOfFailedRequests>0&&console.log("Number of failed requests: "+Ji.numberOfFailedRequests),fn())}on.maximumRequests=50,on.maximumRequestsPerServer=6,on.requestsByServer={"api.cesium.com:443":18,"assets.cesium.com:443":18},on.throttleRequests=!0,on.debugShowStatistics=!1,on.requestCompletedEvent=an,on.requestHeap=en;var gn=function(){function e(t){var i;Object(r["a"])(this,e),this.name="RuntimeError",this.message=t;try{throw new Error}catch(n){i=n.stack}this.stack=i}return Object(a["a"])(e,[{key:"toString",value:function(){var e=this.name+": "+this.message;return s(this.stack)&&(e+="\n"+this.stack.toString()),e}}]),e}(),pn={},yn={};function _n(e){var t=new vi(e);t.normalize();var i=t.getAuthority();if(s(i)){if(-1!==i.indexOf("@")){var n=i.split("@");i=n[1]}if(-1===i.indexOf(":")){var r=t.getScheme();if(s(r)||(r=window.location.protocol,r=r.substring(0,r.length-1)),"http"===r)i+=":80";else{if("https"!==r)return;i+=":443"}}return i}}function wn(e){var t={};if(!e)return t;for(var i=e.split("\r\n"),n=0;n<i.length;++n){var r=i[n],a=r.indexOf(": ");if(a>0){var o=r.substring(0,a),s=r.substring(a+2);t[o]=s}}return t}pn.add=function(e,t){if(!s(e))throw new u("host is required.");if(!s(t)||t<=0)throw new u("port is required to be greater than 0.");var i=e.toLowerCase()+":"+t;s(yn[i])||(yn[i]=!0)},pn.remove=function(e,t){if(!s(e))throw new u("host is required.");if(!s(t)||t<=0)throw new u("port is required to be greater than 0.");var i=e.toLowerCase()+":"+t;s(yn[i])&&delete yn[i]},pn.contains=function(e){if(!s(e))throw new u("url is required.");var t=_n(e);return!(!s(t)||!s(yn[t]))},pn.clear=function(){yn={}};var Tn,xn=function(){function e(t,i,n){Object(r["a"])(this,e),this.statusCode=t,this.response=i,this.responseHeaders=n,"string"===typeof this.responseHeaders&&(this.responseHeaders=wn(this.responseHeaders))}return Object(a["a"])(e,[{key:"toString",value:function(){var e="Request has failed.";return s(this.statusCode)&&(e+=" Status Code: "+this.statusCode),e}}]),e}(),En=/^data:(.*?)(;base64)?,(.*)$/,Sn=function(){try{var e=new XMLHttpRequest;return e.open("GET","#",!0),e.responseType="blob","blob"===e.responseType}catch(t){return!1}}();function bn(e,t,i,n){var r,a=e.query;if(!s(a)||0===a.length)return{};if(-1===a.indexOf("=")){var o={};o[a]=void 0,r=o}else r=bi(a);t._queryParameters=i?On(r,t._queryParameters,n):r,e.query=void 0}function In(e,t){var i=t._queryParameters,n=Object.keys(i);1!==n.length||s(i[n[0]])?e.query=Si(i):e.query=n[0]}function Rn(e,t){return s(e)?s(e.clone)?e.clone():ui(e):t}function Cn(e){if(e.state===wi.ISSUED||e.state===wi.ACTIVE)throw new gn("The Resource is already being fetched.");e.state=wi.UNISSUED,e.deferred=void 0}function On(e,t,i){if(!i)return ii(e,t);var n=ui(e,!0);for(var r in t)if(Object.prototype.hasOwnProperty.call(t,r)){var a=n[r],o=t[r];s(a)?(Array.isArray(a)||(a=n[r]=[a]),n[r]=a.concat(o)):n[r]=Array.isArray(o)?o.slice():o}return n}var kn=function(){function e(t){Object(r["a"])(this,e),t=o(t,o.EMPTY_OBJECT),"string"===typeof t&&(t={url:t}),this._url=void 0,this._templateValues=Rn(t.templateValues,{}),this._queryParameters=Rn(t.queryParameters,{}),this.headers=Rn(t.headers,{}),this.request=o(t.request,new Ii),this.proxy=t.proxy,this.retryCallback=t.retryCallback,this.retryAttempts=o(t.retryAttempts,0),this._retryCount=0;var i=new vi(t.url);bn(i,this,!0,!0),i.fragment=void 0,this._url=i.toString()}return Object(a["a"])(e,[{key:"queryParameters",get:function(){return this._queryParameters}},{key:"templateValues",get:function(){return this._templateValues}},{key:"url",get:function(){return this.getUrlComponent(!0,!0)},set:function(e){var t=new vi(e);bn(t,this,!1),t.fragment=void 0,this._url=t.toString()}},{key:"extension",get:function(){return pi(this._url)}},{key:"isDataUri",get:function(){return Ei(this._url)}},{key:"isBlobUri",get:function(){return _i(this._url)}},{key:"hasHeaders",get:function(){return Object.keys(this.headers).length>0}},{key:"getUrlComponent",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this.isDataUri)return this._url;var i=new vi(this._url);e&&In(i,this);var n=i.toString().replace(/%7B/g,"{").replace(/%7D/g,"}"),r=this._templateValues;return n=n.replace(/{(.*?)}/g,(function(e,t){var i=r[t];return s(i)?encodeURIComponent(i):e})),t&&s(this.proxy)&&(n=this.proxy.getURL(n)),n}},{key:"clone",value:function(t){return s(t)||(t=new e({url:this._url})),t._url=this._url,t._queryParameters=ui(this._queryParameters),t._templateValues=ui(this._templateValues),t.headers=ui(this.headers),t.proxy=this.proxy,t.retryCallback=this.retryCallback,t.retryAttempts=this.retryAttempts,t._retryCount=0,t.request=this.request.clone(),t}},{key:"getDerivedResource",value:function(e){var t=this.clone();if(t._retryCount=0,s(e.url)){var i=new vi(e.url),n=o(e.preserveQueryParameters,!1);bn(i,t,!0,n),i.fragment=void 0,t._url=i.resolve(new vi(gi(this._url))).toString()}return s(e.queryParameters)&&(t._queryParameters=ii(e.queryParameters,t._queryParameters)),s(e.templateValues)&&(t._templateValues=ii(e.templateValues,t.templateValues)),s(e.headers)&&(t.headers=ii(e.headers,t.headers)),s(e.proxy)&&(t.proxy=e.proxy),s(e.request)&&(t.request=e.request),s(e.retryCallback)&&(t.retryCallback=e.retryCallback),s(e.retryAttempts)&&(t.retryAttempts=e.retryAttempts),t}},{key:"setQueryParameters",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this._queryParameters=t?On(this._queryParameters,e,!1):On(e,this._queryParameters,!1)}},{key:"setTemplateValues",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this._templateValues=t?ii(this._templateValues,e):ii(e,this._templateValues)}},{key:"fetchImage",value:function(t){t=o(t,o.EMPTY_OBJECT);var i=o(t.preferImageBitmap,!1),n=o(t.preferBlob,!1),r=o(t.flipY,!1),a=o(t.skipColorSpaceConversion,!1);if(Cn(this.request),!Sn||this.isDataUri||this.isBlobUri||!this.hasHeaders&&!n)return Pn({resource:this,flipY:r,skipColorSpaceConversion:a,preferImageBitmap:i});var u,l,c,h,d=this.fetchBlob();return s(d)?e.supportsImageBitmapOptions().then((function(e){return u=e,l=u&&i,d})).then((function(t){if(s(t)){if(h=t,l)return e.createImageBitmapFromBlob(t,{flipY:r,premultiplyAlpha:!1,skipColorSpaceConversion:a});var i=window.URL.createObjectURL(t);return c=new e({url:i}),Pn({resource:c,flipY:r,skipColorSpaceConversion:a,preferImageBitmap:!1})}})).then((function(e){if(s(e))return e.blob=h,l||window.URL.revokeObjectURL(c.url),e})).otherwise((function(e){return s(c)&&window.URL.revokeObjectURL(c.url),e.blob=h,Mi.reject(e)})):void 0}},{key:"fetchBlob",value:function(){return this.fetch({responseType:"blob"})}},{key:"fetch",value:function(e){return e=Rn(e,{}),e.method="GET",this._makeRequest(e)}},{key:"retryOnError",value:function(e){var t=this.retryCallback;if("function"!==typeof t||this._retryCount>=this.retryAttempts)return Mi(!1);var i=this;return Mi(t(this,e)).then((function(e){return++i._retryCount,e}))}},{key:"_makeRequest",value:function(t){var i=this;Cn(i.request);var n=i.request;n.url=i.url,n.requestFunction=function(){var r=t.responseType,a=ii(t.headers,i.headers),o=t.overrideMimeType,u=t.method,l=t.data,c=Mi.defer(),h=e._Implementations.loadWithXhr(i.url,r,u,l,a,c,o);return s(h)&&s(h.abort)&&(n.cancelFunction=function(){h.abort()}),c.promise};var r=on.request(n);if(s(r))return r.then((function(e){return n.cancelFunction=void 0,e})).otherwise((function(e){return n.cancelFunction=void 0,n.state!==wi.FAILED?Mi.reject(e):i.retryOnError(e).then((function(r){return r?(n.state=wi.UNISSUED,n.deferred=void 0,i.fetch(t)):Mi.reject(e)}))}))}}],[{key:"createImageBitmapFromBlob",value:function(e,t){return createImageBitmap(e,{imageOrientation:t.flipY?"flipY":"none",premultiplyAlpha:t.premultiplyAlpha?"premultiply":"none",colorSpaceConversion:t.skipColorSpaceConversion?"none":"default"})}},{key:"supportsImageBitmapOptions",value:function(){if(s(Tn))return Tn;if("function"!==typeof createImageBitmap)return Tn=Mi.resolve(!1),Tn;var t="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWP4////fwAJ+wP9CNHoHgAAAABJRU5ErkJggg==";return Tn=e.fetchBlob({url:t}).then((function(e){return createImageBitmap(e,{imageOrientation:"flipY",premultiplyAlpha:"none",colorSpaceConversion:"none"})})).then((function(e){return!0})).otherwise((function(){return!1})),Tn}},{key:"createIfNeeded",value:function(t){return t instanceof e?t.getDerivedResource({request:t.request}):"string"!==typeof t?t:new e({url:t})}},{key:"fetchBlob",value:function(t){var i=new e(t);return i.fetchBlob()}}]),e}();function Pn(e){var t=e.resource,i=e.flipY,n=e.skipColorSpaceConversion,r=e.preferImageBitmap,a=t.request;a.url=t.url,a.requestFunction=function(){var e=!1;t.isDataUri||t.isBlobUri||(e=t.isCrossOriginUrl);var o=Mi.defer();return kn._Implementations.createImage(a,e,o,i,n,r),o.promise};var o=on.request(a);if(s(o))return o.otherwise((function(e){return a.state!==wi.FAILED?Mi.reject(e):t.retryOnError(e).then((function(o){return o?(a.state=wi.UNISSUED,a.deferred=void 0,Pn({resource:t,flipY:i,skipColorSpaceConversion:n,preferImageBitmap:r})):Mi.reject(e)}))}))}function Mn(e,t){var i=decodeURIComponent(t);return e?atob(i):i}function Nn(e,t){for(var i=Mn(e,t),n=new ArrayBuffer(i.length),r=new Uint8Array(n),a=0;a<i.length;a++)r[a]=i.charCodeAt(a);return n}function An(e,t){t=o(t,"");var i=e[1],n=!!e[2],r=e[3];switch(t){case"":case"text":return Mn(n,r);case"arraybuffer":return Nn(n,r);case"blob":var a=Nn(n,r);return new Blob([a],{type:i});case"document":var s=new DOMParser;return s.parseFromString(Mn(n,r),i);case"json":return JSON.parse(Mn(n,r));default:throw new u("Unhandled responseType: "+t)}}kn._Implementations={},kn._Implementations.createImage=function(e,t,i,n,r,a){var o=e.url;kn.supportsImageBitmapOptions().then((function(u){if(u&&a){var l="blob",c="GET",h=Mi.defer(),d=kn._Implementations.loadWithXhr(o,l,c,void 0,void 0,h,void 0,void 0,void 0);return s(d)&&s(d.abort)&&(e.cancelFunction=function(){d.abort()}),h.promise.then((function(e){if(s(e))return kn.createImageBitmapFromBlob(e,{flipY:n,premultiplyAlpha:!1,skipColorSpaceConversion:r});i.reject(new gn("Successfully retrieved "+o+" but it contained no content."))})).then(i.resolve)}Dn(o,t,i)})).otherwise(i.reject)};function Dn(e,t,i){var n=new Image;n.onload=function(){i.resolve(n)},n.onerror=function(e){i.reject(e)},t&&(pn.contains(e)?n.crossOrigin="use-credentials":n.crossOrigin=""),n.src=e}kn._Implementations.loadWithXhr=function(e,t,i,n,r,a,o){var u=En.exec(e);if(null===u){var l=new XMLHttpRequest;if(pn.contains(e)&&(l.withCredentials=!0),l.open(i,e,!0),s(o)&&s(l.overrideMimeType)&&l.overrideMimeType(o),s(r))for(var c in r)r.hasOwnProperty(c)&&l.setRequestHeader(c,r[c]);s(t)&&(l.responseType=t);var h=!1;return"string"===typeof e&&(h=0===e.indexOf("file://")||"undefined"!==typeof window&&"file://"===window.location.origin),l.onload=function(){if(!(l.status<200||l.status>=300)||h&&0===l.status){var e=l.response,n=l.responseType;if("HEAD"===i||"OPTIONS"===i){var r=l.getAllResponseHeaders(),o=r.trim().split(/[\r\n]+/),u={};return o.forEach((function(e){var t=e.split(": "),i=t.shift();u[i]=t.join(": ")})),void a.resolve(u)}if(204===l.status)a.resolve();else if(!s(e)||s(t)&&n!==t)if("json"===t&&"string"===typeof e)try{a.resolve(JSON.parse(e))}catch(c){a.reject(c)}else(""===n||"document"===n)&&s(l.responseXML)&&l.responseXML.hasChildNodes()?a.resolve(l.responseXML):""!==n&&"text"!==n||!s(l.responseText)?a.reject(new gn("Invalid XMLHttpRequest response type.")):a.resolve(l.responseText);else a.resolve(e)}else a.reject(new xn(l.status,l.response,l.getAllResponseHeaders()))},l.onerror=function(e){a.reject(new xn)},l.send(n),l}a.resolve(An(u,t))};var Ln=function(){function e(){Object(r["a"])(this,e),this.defaultAlpha=void 0,this.defaultNightAlpha=void 0,this.defaultDayAlpha=void 0,this.defaultBrightness=void 0,this.defaultContrast=void 0,this.defaultHue=void 0,this.defaultSaturation=void 0,this.defaultGamma=void 0,this.defaultMinificationFilter=void 0,this.defaultMagnificationFilter=void 0,u.throwInstantiationError()}return Object(a["a"])(e,null,[{key:"loadImage",value:function(e,t){var i=kn.createIfNeeded(t);return s(e)&&s(e.tileDiscardPolicy)?i.fetchImage({preferBlob:!0,preferImageBitmap:!0,flipY:!0}):i.fetchImage({preferImageBitmap:!0,flipY:!0})}}]),e}(),Un=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Ie.WGS84;Object(r["a"])(this,e),this._ellipsoid=o(t,Ie.WGS84),this._semimajorAxis=this._ellipsoid.maximumRadius,this._oneOverSemimajorAxis=1/this._semimajorAxis}return Object(a["a"])(e,[{key:"ellipsoid",get:function(){return this._ellipsoid}},{key:"project",value:function(t,i){var n=this._semimajorAxis,r=t.longitude*n,a=e.geodeticLatitudeToMercatorAngle(t.latitude)*n,o=t.height;return s(i)?(i.x=r,i.y=a,i.z=o,i):new re(r,a,o)}},{key:"unproject",value:function(t,i){if(!s(t))throw new u("cartesian is required");var n=this._oneOverSemimajorAxis,r=t.x*n,a=e.mercatorAngleToGeodeticLatitude(t.y*n),o=t.z;return s(i)?(i.longitude=r,i.latitude=a,i.height=o,i):new me(r,a,o)}}]),e}();Un.mercatorAngleToGeodeticLatitude=function(e){return ne.PI_OVER_TWO-2*Math.atan(Math.exp(-e))},Un.geodeticLatitudeToMercatorAngle=function(e){e>Un.MaximumLatitude?e=Un.MaximumLatitude:e<-Un.MaximumLatitude&&(e=-Un.MaximumLatitude);var t=Math.sin(e);return.5*Math.log((1+t)/(1-t))},Un.MaximumLatitude=Un.mercatorAngleToGeodeticLatitude(Math.PI);var Fn=function(){function e(t){if(Object(r["a"])(this,e),t=o(t,o.EMPTY_OBJECT),this._ellipsoid=o(t.ellipsoid,Ie.WGS84),this._numberOfLevelZeroTilesX=o(t.numberOfLevelZeroTilesX,1),this._numberOfLevelZeroTilesY=o(t.numberOfLevelZeroTilesY,1),this._projection=new Un(this._ellipsoid),s(t.rectangleSouthwestInMeters)&&s(t.rectangleNortheastInMeters))this._rectangleSouthwestInMeters=t.rectangleSouthwestInMeters,this._rectangleNortheastInMeters=t.rectangleNortheastInMeters;else{var i=this._ellipsoid.maximumRadius*Math.PI;this._rectangleSouthwestInMeters=new dt(-i,-i),this._rectangleNortheastInMeters=new dt(i,i)}var n=this._projection.unproject(this._rectangleSouthwestInMeters),a=this._projection.unproject(this._rectangleNortheastInMeters);this._rectangle=new Oe(n.longitude,n.latitude,a.longitude,a.latitude)}return Object(a["a"])(e,[{key:"ellipsoid",get:function(){return this._ellipsoid}},{key:"rectangle",get:function(){return this._rectangle}},{key:"projection",get:function(){return this._projection}},{key:"getNumberOfXTilesAtLevel",value:function(e){return this._numberOfLevelZeroTilesX<<e}},{key:"getNumberOfYTilesAtLevel",value:function(e){return this._numberOfLevelZeroTilesY<<e}},{key:"positionToTileXY",value:function(e,t,i){var n=this._rectangle;if(Oe.contains(n,e)){var r=this.getNumberOfXTilesAtLevel(t),a=this.getNumberOfYTilesAtLevel(t),o=this._rectangleNortheastInMeters.x-this._rectangleSouthwestInMeters.x,u=o/r,l=this._rectangleNortheastInMeters.y-this._rectangleSouthwestInMeters.y,c=l/a,h=this._projection,d=h.project(e),m=d.x-this._rectangleSouthwestInMeters.x,f=this._rectangleNortheastInMeters.y-d.y,v=m/u|0;v>=r&&(v=r-1);var g=f/c|0;return g>=a&&(g=a-1),s(i)?(i.x=v,i.y=g,i):new dt(v,g)}}},{key:"tileXYToNativeRectangle",value:function(e,t,i,n){var r=this.getNumberOfXTilesAtLevel(i),a=this.getNumberOfYTilesAtLevel(i),o=(this._rectangleNortheastInMeters.x-this._rectangleSouthwestInMeters.x)/r,u=this._rectangleSouthwestInMeters.x+e*o,l=this._rectangleSouthwestInMeters.x+(e+1)*o,c=(this._rectangleNortheastInMeters.y-this._rectangleSouthwestInMeters.y)/a,h=this._rectangleNortheastInMeters.y-t*c,d=this._rectangleNortheastInMeters.y-(t+1)*c;return s(n)?(n.west=u,n.south=d,n.east=l,n.north=h,n):new Oe(u,d,l,h)}},{key:"tileXYToRectangle",value:function(e,t,i,n){var r=this.tileXYToNativeRectangle(e,t,i,n),a=this._projection,o=a.unproject(new dt(r.west,r.south)),s=a.unproject(new dt(r.east,r.north));return r.west=o.longitude,r.south=o.latitude,r.east=s.longitude,r.north=s.latitude,r}},{key:"rectangleToNativeRectangle",value:function(e,t){var i=this._projection,n=i.project(Oe.southwest(e)),r=i.project(Oe.northeast(e));return s(t)?(t.west=n.x,t.south=n.y,t.east=r.x,t.north=r.y,t):new Oe(n.x,n.y,r.x,r.y)}}]),e}(),Hn={service:"WMTS",version:"1.0.0",request:"GetTile"};function zn(e,t,i,n,r,a){var o,u,l=e._tileMatrixLabels,c=s(l)?l[n]:n.toString(),h=e._subdomains,d=e._dimensions,m=s(a)?a.data:void 0;if(e._useKvp){var f={};f.tilematrix=c,f.layer=e._layer,f.style=e._style,f.tilerow=i,f.tilecol=t,f.tilematrixset=e._tileMatrixSetID,f.format=e._format,s(d)&&(f=ii(f,d)),s(m)&&(f=ii(f,m)),u={s:h[(t+i+n)%h.length]},o=e._resource.getDerivedResource({queryParameters:f,request:r}),o.setTemplateValues(u)}else u={TileMatrix:c,TileRow:i.toString(),TileCol:t.toString(),s:h[(t+i+n)%h.length]},o=e._resource.getDerivedResource({request:r}),o.setTemplateValues(u),s(d)&&o.setTemplateValues(d),s(m)&&o.setTemplateValues(m);return Ln.loadImage(e,o)}var qn=function(){function e(t){if(Object(r["a"])(this,e),!s(t.url))throw new u("options.url is required.");if(!s(t.layer))throw new u("options.layer is required.");if(!s(t.style))throw new u("options.style is required.");if(!s(t.tileMatrixSetID))throw new u("options.tileMatrixSetID is required.");this.defaultAlpha=void 0,this.defaultNightAlpha=void 0,this.defaultDayAlpha=void 0,this.defaultBrightness=void 0,this.defaultContrast=void 0;var i=kn.createIfNeeded(t.url),n=t.style,a=t.tileMatrixSetID,l=i.url,c=l.match(/{/g);if(!s(c)||1===c.length&&/{s}/.test(l))i.setQueryParameters(Hn),this._useKvp=!0;else{var h={style:n,Style:n,TileMatrixSet:a};i.setTemplateValues(h),this._useKvp=!1}this._resource=i,this._layer=t.layer,this._style=n,this._tileMatrixSetID=a,this._tileMatrixLabels=t.tileMatrixLabels,this._format=o(t.format,"image/jpeg"),this._tileDiscardPolicy=t.tileDiscardPolicy,this._tilingScheme=s(t.tilingScheme)?t.tilingScheme:new Fn({ellipsoid:t.ellipsoid}),this._tileWidth=o(t.tileWidth,256),this._tileHeight=o(t.tileHeight,256),this._minimumLevel=o(t.minimumLevel,0),this._maximumLevel=t.maximumLevel,this._rectangle=o(t.rectangle,this._tilingScheme.rectangle),this._dimensions=t.dimensions;this._reload=void 0,this._readyPromise=Mi.resolve(!0);var d=this._tilingScheme.positionToTileXY(Oe.southwest(this._rectangle),this._minimumLevel),m=this._tilingScheme.positionToTileXY(Oe.northeast(this._rectangle),this._minimumLevel),f=(Math.abs(m.x-d.x)+1)*(Math.abs(m.y-d.y)+1);if(f>4)throw new u("The imagery provider's rectangle and minimumLevel indicate that there are "+f+" tiles at the minimum level. Imagery providers with more than four tiles at the minimum level are not supported.");this._errorEvent=new si;var v=t.credit;this._credit="string"===typeof v?new ai(v):v,this._subdomains=t.subdomains,Array.isArray(this._subdomains)?this._subdomains=this._subdomains.slice():s(this._subdomains)&&this._subdomains.length>0?this._subdomains=this._subdomains.split(""):this._subdomains=["a","b","c"]}return Object(a["a"])(e,[{key:"url",get:function(){return this._resource.url}},{key:"proxy",get:function(){return this._resource.proxy}},{key:"tileWidth",get:function(){return this._tileWidth}},{key:"tileHeight",get:function(){return this._tileHeight}},{key:"maximumLevel",get:function(){return this._maximumLevel}},{key:"minimumLevel",get:function(){return this._minimumLevel}},{key:"tilingScheme",get:function(){return this._tilingScheme}},{key:"rectangle",get:function(){return this._rectangle}},{key:"errorEvent",get:function(){return this._errorEvent}},{key:"format",get:function(){return this._format}},{key:"ready",get:function(){return!0}},{key:"readyPromise",get:function(){return this._readyPromise}},{key:"dimensions",get:function(){return this._dimensions}},{key:"requestImage",value:function(e,t,i,n){var r,a;return s(r)||(r=zn(this,e,t,i,n,a)),r}}]),e}(),Bn=/^#([0-9a-f])([0-9a-f])([0-9a-f])$/i,jn=/^#([0-9a-f]{2})([0-9a-f]{2})([0-9a-f]{2})$/i,Wn=/^rgba?\(\s*([0-9.]+%?)\s*,\s*([0-9.]+%?)\s*,\s*([0-9.]+%?)(?:\s*,\s*([0-9.]+))?\s*\)$/i,Vn=/^hsla?\(\s*([0-9.]+)\s*,\s*([0-9.]+%)\s*,\s*([0-9.]+%)(?:\s*,\s*([0-9.]+))?\s*\)$/i,Gn=function(e,t,i){return i<0&&(i+=1),i>1&&(i-=1),6*i<1?e+6*(t-e)*i:2*i<1?t:3*i<2?e+(t-e)*(2/3-i)*6:e},Yn=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;Object(r["a"])(this,e),this.red=o(t,1),this.green=o(i,1),this.blue=o(n,1),this.alpha=o(a,1)}return Object(a["a"])(e,[{key:"toCssColorString",value:function(){var t=e.floatToByte(this.red),i=e.floatToByte(this.green),n=e.floatToByte(this.blue);return 1===this.alpha?"rgb("+t+","+i+","+n+")":"rgba("+t+","+i+","+n+","+this.alpha+")"}}],[{key:"clone",value:function(t,i){if(s(t))return s(i)?(i.red=t.red,i.green=t.green,i.blue=t.blue,i.alpha=t.alpha,i):new e(t.red,t.green,t.blue,t.alpha)}},{key:"fromHsl",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,a=arguments.length>4?arguments[4]:void 0;t=o(t,0)%1,i=o(i,0),n=o(n,0),r=o(r,1);var u=n,l=n,c=n;if(0!==i){var h;h=n<.5?n*(1+i):n+i-n*i;var d=2*n-h;u=Gn(d,h,t+1/3),l=Gn(d,h,t),c=Gn(d,h,t-1/3)}return s(a)?(a.red=u,a.green=l,a.blue=c,a.alpha=r,a):new e(u,l,c,r)}},{key:"fromCssColorString",value:function(t,i){s(i)||(i=new e);var n=e[t.toUpperCase()];if(s(n))return e.clone(n,i),i;var r=Bn.exec(t);return null!==r?(i.red=parseInt(r[1],16)/15,i.green=parseInt(r[2],16)/15,i.blue=parseInt(r[3],16)/15,i.alpha=1,i):(r=jn.exec(t),null!==r?(i.red=parseInt(r[1],16)/255,i.green=parseInt(r[2],16)/255,i.blue=parseInt(r[3],16)/255,i.alpha=1,i):(r=Wn.exec(t),null!==r?(i.red=parseFloat(r[1])/("%"===r[1].substr(-1)?100:255),i.green=parseFloat(r[2])/("%"===r[2].substr(-1)?100:255),i.blue=parseFloat(r[3])/("%"===r[3].substr(-1)?100:255),i.alpha=parseFloat(o(r[4],"1.0")),i):(r=Vn.exec(t),null!==r?e.fromHsl(parseFloat(r[1])/360,parseFloat(r[2])/100,parseFloat(r[3])/100,parseFloat(o(r[4],"1.0")),i):(i=void 0,i))))}},{key:"floatToByte",value:function(e){return 1===e?255:256*e|0}}]),e}();Yn.RED=Yn.fromCssColorString("#FF0000");var Zn=function(){function e(t){Object(r["a"])(this,e),t=o(t,o.EMPTY_OBJECT),this._ellipsoid=o(t.ellipsoid,Ie.WGS84),this._rectangle=o(t.rectangle,Oe.MAX_VALUE),this._projection=new Ce(this._ellipsoid),this._numberOfLevelZeroTilesX=o(t.numberOfLevelZeroTilesX,2),this._numberOfLevelZeroTilesY=o(t.numberOfLevelZeroTilesY,1)}return Object(a["a"])(e,[{key:"ellipsoid",get:function(){return this._ellipsoid}},{key:"rectangle",get:function(){return this._rectangle}},{key:"projection",get:function(){return this._projection}},{key:"getNumberOfXTilesAtLevel",value:function(e){return this._numberOfLevelZeroTilesX<<e}},{key:"getNumberOfYTilesAtLevel",value:function(e){return this._numberOfLevelZeroTilesY<<e}},{key:"rectangleToNativeRectangle",value:function(e,t){var i=ne.toDegrees(e.west),n=ne.toDegrees(e.south),r=ne.toDegrees(e.east),a=ne.toDegrees(e.north);return s(t)?(t.west=i,t.south=n,t.east=r,t.north=a,t):new Oe(i,n,r,a)}},{key:"tileXYToNativeRectangle",value:function(e,t,i,n){var r=this.tileXYToRectangle(e,t,i,n);return r.west=ne.toDegrees(r.west),r.south=ne.toDegrees(r.south),r.east=ne.toDegrees(r.east),r.north=ne.toDegrees(r.north),r}},{key:"tileXYToRectangle",value:function(e,t,i,n){var r=this._rectangle,a=this.getNumberOfXTilesAtLevel(i),o=this.getNumberOfYTilesAtLevel(i),u=r.width/a,l=e*u+r.west,c=(e+1)*u+r.west,h=r.height/o,d=r.north-t*h,m=r.north-(t+1)*h;return s(n)||(n=new Oe(l,m,c,d)),n.west=l,n.south=m,n.east=c,n.north=d,n}},{key:"positionToTileXY",value:function(e,t,i){var n=this._rectangle;if(Oe.contains(n,e)){var r=this.getNumberOfXTilesAtLevel(t),a=this.getNumberOfYTilesAtLevel(t),o=n.width/r,u=n.height/a,l=e.longitude;n.east<n.west&&(l+=ne.TWO_PI);var c=(l-n.west)/o|0;c>=r&&(c=r-1);var h=(n.north-e.latitude)/u|0;return h>=a&&(h=a-1),s(i)?(i.x=c,i.y=h,i):new dt(c,h)}}}]),e}(),Xn=function(e){e=o(e,o.EMPTY_OBJECT),this._tilingScheme=s(e.tilingScheme)?e.tilingScheme:new Zn({ellipsoid:e.ellipsoid}),this._color=o(e.color,Yn.RED),this._errorEvent=new si,this._tileWidth=o(e.tileWidth,256),this._tileHeight=o(e.tileHeight,256),this._readyPromise=Mi.resolve(!0)};Object.defineProperties(Xn.prototype,{proxy:{get:function(){}},tileWidth:{get:function(){return this._tileWidth}},tileHeight:{get:function(){return this._tileHeight}},maximumLevel:{get:function(){}},minimumLevel:{get:function(){}},tilingScheme:{get:function(){return this._tilingScheme}},rectangle:{get:function(){return this._tilingScheme.rectangle}},tileDiscardPolicy:{get:function(){}},errorEvent:{get:function(){return this._errorEvent}},ready:{get:function(){return!0}},readyPromise:{get:function(){return this._readyPromise}},credit:{get:function(){}},hasAlphaChannel:{get:function(){return!0}}}),Xn.prototype.getTileCredits=function(e,t,i){},Xn.prototype.requestImage=function(e,t,i){var n=document.createElement("canvas");n.width=256,n.height=256;var r=n.getContext("2d"),a=this._color.toCssColorString();return r.strokeStyle=a,r.lineWidth=2,r.strokeRect(1,1,255,255),r.font="bold 25px Arial",r.textAlign="center",r.fillStyle=a,r.fillText("L: "+i,124,86),r.fillText("X: "+e,124,136),r.fillText("Y: "+t,124,186),n},Xn.prototype.pickFeatures=function(e,t,i,n,r){};var Qn={LEFT_DOWN:0,LEFT_UP:1,LEFT_CLICK:2,LEFT_DOUBLE_CLICK:3,RIGHT_DOWN:5,RIGHT_UP:6,RIGHT_CLICK:7,MIDDLE_DOWN:10,MIDDLE_UP:11,MIDDLE_CLICK:12,MOUSE_MOVE:15,WHEEL:16,PINCH_START:17,PINCH_END:18,PINCH_MOVE:19},Kn=i("262e"),Jn=i("2caf"),$n="\n\n#include <common>\n#include <logdepthbuf_pars_vertex>\n\n#ifdef QUANTIZATION_BITS12\n    in vec4 compressed0;\n    in float compressed1;\n#else\n    in vec4 position3DAndHeight;\n    in vec4 textureCoordAndEncodedNormals;\n#endif\n\n#ifdef QUANTIZATION_BITS12\n    uniform vec2 u_minMaxHeight;\n    uniform mat4 u_scaleAndBias;\n#endif\n\n\nuniform vec4 u_tileRectangle;\nuniform vec3 rtc;\nuniform mat4 u_modifiedModelViewProjection;\n\nvarying vec3 v_textureCoordinates;\nvarying vec2 vHighPrecisionZW;\n\nfloat get2DGeographicYPositionFraction(vec2 textureCoordinates)\n{\n    return textureCoordinates.y;\n}\n\nvec4 getPositionPlanarEarth(vec3 position, float height, vec2 textureCoordinates)\n{\n    float yPositionFraction = get2DGeographicYPositionFraction(textureCoordinates);\n    vec4 rtcPosition2D = vec4( mix(u_tileRectangle.st, u_tileRectangle.pq, vec2(textureCoordinates.x, yPositionFraction)), height, 1.0);\n\n    return projectionMatrix * modelViewMatrix * rtcPosition2D;\n}\n\nvec4 getPositionColumbusViewMode(vec3 position, float height, vec2 textureCoordinates)\n{\n    return getPositionPlanarEarth(position, height, textureCoordinates);\n}\n\nvec4 getPosition(vec3 position, float height, vec2 textureCoordinates) {\n    return getPositionColumbusViewMode(position, height, textureCoordinates);\n}\n\nvec2 czm_decompressTextureCoordinates(float encoded)\n{\n   float temp = encoded / 4096.0;\n   float xZeroTo4095 = floor(temp);\n   float stx = xZeroTo4095 / 4095.0;\n   float sty = (encoded - xZeroTo4095 * 4096.0) / 4095.0;\n   return vec2(stx, sty);\n}\n\n\nvoid main(){\n\n#ifdef QUANTIZATION_BITS12\n    vec2 xy = czm_decompressTextureCoordinates(compressed0.x);\n    vec2 zh = czm_decompressTextureCoordinates(compressed0.y);\n    vec3 position = vec3(xy, zh.x);\n    float height = zh.y;\n    vec2 textureCoordinates = czm_decompressTextureCoordinates(compressed0.z);\n\n    height = height * (u_minMaxHeight.y - u_minMaxHeight.x) + u_minMaxHeight.x;\n    position = (u_scaleAndBias * vec4(position, 1.0)).xyz;\n\n    #if (defined(ENABLE_VERTEX_LIGHTING) || defined(GENERATE_POSITION_AND_NORMAL)) && defined(INCLUDE_WEB_MERCATOR_Y)\n        float webMercatorT = czm_decompressTextureCoordinates(compressed0.w).x;\n        float encodedNormal = compressed1;\n    #elif defined(INCLUDE_WEB_MERCATOR_Y)\n        float webMercatorT = czm_decompressTextureCoordinates(compressed0.w).x;\n        float encodedNormal = 0.0;\n    #elif defined(ENABLE_VERTEX_LIGHTING) || defined(GENERATE_POSITION_AND_NORMAL)\n        float webMercatorT = textureCoordinates.y;\n        float encodedNormal = compressed0.w;\n    #else\n        float webMercatorT = textureCoordinates.y;\n        float encodedNormal = 0.0;\n    #endif\n\n#else\n    \n    vec3 position = position3DAndHeight.xyz;\n    float height = position3DAndHeight.w;\n    vec2 textureCoordinates = textureCoordAndEncodedNormals.xy;\n\n    #if (defined(ENABLE_VERTEX_LIGHTING) || defined(GENERATE_POSITION_AND_NORMAL) || defined(APPLY_MATERIAL)) && defined(INCLUDE_WEB_MERCATOR_Y)\n        float webMercatorT = textureCoordAndEncodedNormals.z;\n        float encodedNormal = textureCoordAndEncodedNormals.w;\n    #elif defined(ENABLE_VERTEX_LIGHTING) || defined(GENERATE_POSITION_AND_NORMAL) || defined(APPLY_MATERIAL)\n        float webMercatorT = textureCoordinates.y;\n        float encodedNormal = textureCoordAndEncodedNormals.z;\n    #elif defined(INCLUDE_WEB_MERCATOR_Y)\n        float webMercatorT = textureCoordAndEncodedNormals.z;\n        float encodedNormal = 0.0;\n    #else\n        float webMercatorT = textureCoordinates.y;\n        float encodedNormal = 0.0;\n    #endif\n\n#endif\n\n    vec3 transformed = vec3(position);\n    vec4 mvPosition = vec4( transformed, 1.0 );\n\n    // gl_Position = getPosition(transformed, height, textureCoordinates);\n\n    // gl_Position = projectionMatrix * modelViewMatrix *  vec4( transformed, 1.0 );\n    \n    gl_Position = u_modifiedModelViewProjection * vec4(position, 1.0);\n\n    v_textureCoordinates = vec3(textureCoordinates, webMercatorT);\n   \n\n    #include <logdepthbuf_vertex>\n    vHighPrecisionZW = gl_Position.zw;\n}\n\n",er=function(e){Object(Kn["a"])(i,e);var t=Object(Jn["a"])(i);function i(){var e,a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},o=arguments.length>1?arguments[1]:void 0;Object(r["a"])(this,i),e=t.call(this,a),e.lights=!1,e.fog=!1;var s=e.createFragmentShader(o);return e.uniforms={u_dayTextures:{value:[]},u_dayTextureTranslationAndScale:{value:[]},u_dayTextureTexCoordsRectangle:{value:[]},u_initialColor:{value:new n["N"](0,0,.5,1)},diffuse:{value:new n["N"](Math.random(),Math.random(),Math.random(),1)},u_tileRectangle:{value:new n["N"]},rtc:{value:new n["M"]},u_minMaxHeight:{value:new n["L"]},u_scaleAndBias:{value:new n["q"]},u_center3D:{value:new n["M"]},u_modifiedModelView:{value:new n["q"]},u_modifiedModelViewProjection:{value:new n["q"]}},e.vertexShader=$n,e.fragmentShader=s,e.defines.TEXTURE_UNITS=o.numberOfDayTextures,e.defines.APPLY_GAMMA="",e}return Object(a["a"])(i,[{key:"dayTextures",get:function(){return this.uniforms.u_dayTextures.value},set:function(e){s(e)&&(this.uniforms.u_dayTextures.value=e)}},{key:"dayTextureTranslationAndScale",get:function(){return this.uniforms.u_dayTextureTranslationAndScale.value},set:function(e){s(e)&&(this.uniforms.u_dayTextureTranslationAndScale.value=e)}},{key:"dayTextureTexCoordsRectangle",get:function(){return this.uniforms.u_dayTextureTexCoordsRectangle.value},set:function(e){s(e)&&(this.uniforms.u_dayTextureTexCoordsRectangle.value=e)}},{key:"diffuse",get:function(){return this.uniforms.diffuse.value},set:function(e){s(e)&&this.uniforms.diffuse.value.copy(e)}},{key:"initialColor",get:function(){return this.uniforms.u_initialColor.value},set:function(e){s(e)&&this.uniforms.u_initialColor.value.copy(e)}},{key:"rtc",get:function(){return this.uniforms.rtc.value},set:function(e){s(e)&&this.uniforms.rtc.value.copy(e)}},{key:"tileRectangle",get:function(){return this.uniforms.u_tileRectangle.value},set:function(e){s(e)&&this.uniforms.u_tileRectangle.value.copy(e)}},{key:"minMaxHeight",get:function(){return this.uniforms.u_minMaxHeight.value},set:function(e){s(e)&&this.uniforms.u_minMaxHeight.value.copy(e)}},{key:"scaleAndBias",get:function(){return this.uniforms.u_scaleAndBias.value},set:function(e){s(e)&&this.uniforms.u_scaleAndBias.value.copy(e)}},{key:"center3D",get:function(){return this.uniforms.u_center3D.value},set:function(e){s(e)&&this.uniforms.u_center3D.value.copy(e)}},{key:"modifiedModelViewProjectionScratch",get:function(){return this.uniforms.u_modifiedModelViewProjection.value},set:function(e){this.modifiedModelViewProjectionScratch.copy(e)}},{key:"createFragmentShader",value:function(e){var t="\n        #include <common>\n        #include <packing>\n        #include <logdepthbuf_pars_fragment>\n\n        varying vec3 v_textureCoordinates;\n        varying vec2 vHighPrecisionZW;\n        uniform vec4 u_initialColor;\n        uniform vec4 diffuse;\n        \n        \n        #if TEXTURE_UNITS > 0\n            uniform sampler2D u_dayTextures[TEXTURE_UNITS];\n            uniform vec4 u_dayTextureTranslationAndScale[TEXTURE_UNITS];\n            uniform bool u_dayTextureUseWebMercatorT[TEXTURE_UNITS];\n            uniform vec4 u_dayTextureTexCoordsRectangle[TEXTURE_UNITS];\n        #endif\n        \n        \n        vec4 sampleAndBlend(\n            vec4 previousColor,\n            sampler2D textureToSample,\n            vec2 tileTextureCoordinates,\n            vec4 textureCoordinateRectangle,\n            vec4 textureCoordinateTranslationAndScale,\n            float textureAlpha,\n            float textureBrightness,\n            float textureContrast,\n            float textureHue,\n            float textureSaturation,\n            float textureOneOverGamma,\n            float split)\n        {\n            \n            \n            vec2 alphaMultiplier = step(textureCoordinateRectangle.st, tileTextureCoordinates);\n            textureAlpha = textureAlpha * alphaMultiplier.x * alphaMultiplier.y;\n        \n            alphaMultiplier = step(vec2(0.0), textureCoordinateRectangle.pq - tileTextureCoordinates);\n            textureAlpha = textureAlpha * alphaMultiplier.x * alphaMultiplier.y;\n        \n            vec2 translation = textureCoordinateTranslationAndScale.xy;\n            vec2 scale = textureCoordinateTranslationAndScale.zw;\n            vec2 textureCoordinates = tileTextureCoordinates * scale + translation;\n            vec4 value = texture2D(textureToSample, textureCoordinates);\n            vec3 color = value.rgb;\n            float alpha = value.a;\n        \n        #ifdef APPLY_SPLIT\n            float splitPosition = czm_imagerySplitPosition;\n            \n            if (split < 0.0 && gl_FragCoord.x > splitPosition) {\n               alpha = 0.0;\n            }\n            \n            else if (split > 0.0 && gl_FragCoord.x < splitPosition) {\n               alpha = 0.0;\n            }\n        #endif\n        \n        #ifdef APPLY_BRIGHTNESS\n            color = mix(vec3(0.0), color, textureBrightness);\n        #endif\n        \n        #ifdef APPLY_CONTRAST\n            color = mix(vec3(0.5), color, textureContrast);\n        #endif\n        \n        #ifdef APPLY_HUE\n            color = czm_hue(color, textureHue);\n        #endif\n        \n        #ifdef APPLY_SATURATION\n            color = czm_saturation(color, textureSaturation);\n        #endif\n        \n        #ifdef APPLY_GAMMA\n            color = pow(color, vec3(textureOneOverGamma));\n        #endif\n        \n            float sourceAlpha = alpha * textureAlpha;\n            float outAlpha = mix(previousColor.a, 1.0, sourceAlpha);\n            vec3 outColor = mix(previousColor.rgb * previousColor.a, color, sourceAlpha) / outAlpha;\n            return vec4(outColor, outAlpha);\n        }\n        \n        \n        vec4 computeDayColor(vec4 initialColor, vec3 textureCoordinates)\n        {\n            vec4 color = initialColor;\n        \n            #pragma unroll_loop_start\n            for ( int i = 0; i < ".concat(e.numberOfDayTextures,"; i ++ ) {\n        \n                color = sampleAndBlend(\n                    color,\n                    u_dayTextures[ i ],\n                    u_dayTextureUseWebMercatorT[ i ] ? textureCoordinates.xz : textureCoordinates.xy,\n                    u_dayTextureTexCoordsRectangle[ i ],\n                    u_dayTextureTranslationAndScale[ i ],\n                    1.0,\n                    0.0,\n                    0.0,\n                    0.0,\n                    0.0,\n                    2.2,\n                    0.0\n                );\n        \n            }\n            #pragma unroll_loop_end\n        \n            return color;\n        }\n        \n        void main(void){\n            #include <logdepthbuf_fragment>\n            \n            gl_FragColor = computeDayColor(u_initialColor, clamp(v_textureCoordinates, 0.0, 1.0));\n\n            #include <tonemapping_fragment>\n            #include <encodings_fragment>\n            #include <fog_fragment>\n            #include <premultiplied_alpha_fragment>\n            #include <dithering_fragment>\n        }\n        ");return t}}]),i}(n["E"]),tr=/{[^}]+}/g,ir={x:fr,y:gr,z:_r,s:wr,reverseX:vr,reverseY:pr,reverseZ:yr,westDegrees:xr,southDegrees:Er,eastDegrees:Sr,northDegrees:br,westProjected:Rr,southProjected:Cr,eastProjected:Or,northProjected:kr,width:Pr,height:Mr},nr=ii(ir,{i:Nr,j:Ar,reverseI:Dr,reverseJ:Lr,longitudeDegrees:zr,latitudeDegrees:qr,longitudeProjected:Br,latitudeProjected:jr,format:Gr}),rr=function(){function e(t){Object(r["a"])(this,e),this.enablePickFeatures=!0,this._errorEvent=new si,this._resource=void 0,this._urlSchemeZeroPadding=void 0,this._pickFeaturesResource=void 0,this._tileWidth=void 0,this._tileHeight=void 0,this._maximumLevel=void 0,this._minimumLevel=void 0,this._tilingScheme=void 0,this._rectangle=void 0,this._tileDiscardPolicy=void 0,this._credit=void 0,this._hasAlphaChannel=void 0,this._readyPromise=void 0,this._tags=void 0,this._pickFeaturesTags=void 0,this.defaultAlpha=void 0,this.defaultNightAlpha=void 0,this.defaultDayAlpha=void 0,this.defaultBrightness=void 0,this.defaultContrast=void 0,this.defaultHue=void 0,this.defaultSaturation=void 0,this.defaultGamma=void 0,this.defaultMinificationFilter=void 0,this.defaultMagnificationFilter=void 0,this.enablePickFeatures=!0,this.reinitialize(t)}return Object(a["a"])(e,[{key:"url",get:function(){return this._resource.url}},{key:"urlSchemeZeroPadding",get:function(){return this._urlSchemeZeroPadding}},{key:"pickFeaturesUrl",get:function(){return this._pickFeaturesResource.url}},{key:"proxy",get:function(){return this._resource.proxy}},{key:"tileWidth",get:function(){return this._tileWidth}},{key:"tileHeight",get:function(){return this._tileHeight}},{key:"maximumLevel",get:function(){return this._maximumLevel}},{key:"minimumLevel",get:function(){return this._minimumLevel}},{key:"tilingScheme",get:function(){return this._tilingScheme}},{key:"rectangle",get:function(){return this._rectangle}},{key:"tileDiscardPolicy",get:function(){return this._tileDiscardPolicy}},{key:"errorEvent",get:function(){return this._errorEvent}},{key:"ready",get:function(){return s(this._resource)}},{key:"readyPromise",get:function(){return this._readyPromise}},{key:"credit",get:function(){return this._credit}},{key:"hasAlphaChannel",get:function(){return this._hasAlphaChannel}},{key:"reinitialize",value:function(e){var t=this;t._readyPromise=Mi(e).then((function(e){if(!s(e))throw new u("options is required.");if(!s(e.url))throw new u("options.url is required.");var i=e.customTags,n=ii(ir,i),r=ii(nr,i),a=kn.createIfNeeded(e.url),l=kn.createIfNeeded(e.pickFeaturesUrl);t.enablePickFeatures=o(e.enablePickFeatures,t.enablePickFeatures),t._urlSchemeZeroPadding=o(e.urlSchemeZeroPadding,t.urlSchemeZeroPadding),t._tileDiscardPolicy=e.tileDiscardPolicy,t._getFeatureInfoFormats=e.getFeatureInfoFormats,t._subdomains=e.subdomains,Array.isArray(t._subdomains)?t._subdomains=t._subdomains.slice():s(t._subdomains)&&t._subdomains.length>0?t._subdomains=t._subdomains.split(""):t._subdomains=["a","b","c"],t._tileWidth=o(e.tileWidth,256),t._tileHeight=o(e.tileHeight,256),t._minimumLevel=o(e.minimumLevel,0),t._maximumLevel=e.maximumLevel,t._tilingScheme=o(e.tilingScheme,new Fn({ellipsoid:e.ellipsoid})),t._rectangle=o(e.rectangle,t._tilingScheme.rectangle),t._rectangle=Oe.intersection(t._rectangle,t._tilingScheme.rectangle),t._hasAlphaChannel=o(e.hasAlphaChannel,!0);var c=e.credit;return"string"===typeof c&&(c=new ai(c)),t._credit=c,t._resource=a,t._tags=n,t._pickFeaturesResource=l,t._pickFeaturesTags=r,!0}))}},{key:"requestImage",value:function(e,t,i,n){if(!this.ready)throw new u("requestImage must not be called before the imagery provider is ready.");return Ln.loadImage(this,lr(this,e,t,i,n))}}]),e}(),ar=!1,or=new Oe,sr=!1,ur=new Oe;function lr(e,t,i,n,r){ar=!1,sr=!1;var a=e._resource,o=a.getUrlComponent(!0),u=e._tags,l={},c=o.match(tr);return s(c)&&c.forEach((function(r){var a=r.substring(1,r.length-1);s(u[a])&&(l[a]=u[a](e,t,i,n))})),a.getDerivedResource({request:r,templateValues:l})}var cr=!1,hr=new dt,dr=!1;function mr(e,t,i){if(e&&e.urlSchemeZeroPadding&&e.urlSchemeZeroPadding.hasOwnProperty(t)){var n=e.urlSchemeZeroPadding[t];if("string"===typeof n){var r=n.length;r>1&&(i=i.length>=r?i:new Array(r-i.toString().length+1).join("0")+i)}}return i}function fr(e,t,i,n){return mr(e,"{x}",t)}function vr(e,t,i,n){var r=e.tilingScheme.getNumberOfXTilesAtLevel(n)-t-1;return mr(e,"{reverseX}",r)}function gr(e,t,i,n){return mr(e,"{y}",i)}function pr(e,t,i,n){var r=e.tilingScheme.getNumberOfYTilesAtLevel(n)-i-1;return mr(e,"{reverseY}",r)}function yr(e,t,i,n){var r=e.maximumLevel,a=s(r)&&n<r?r-n-1:n;return mr(e,"{reverseZ}",a)}function _r(e,t,i,n){return mr(e,"{z}",n)}function wr(e,t,i,n){var r=(t+i+n)%e._subdomains.length;return e._subdomains[r]}function Tr(e,t,i,n){ar||(e.tilingScheme.tileXYToRectangle(t,i,n,or),or.west=ne.toDegrees(or.west),or.south=ne.toDegrees(or.south),or.east=ne.toDegrees(or.east),or.north=ne.toDegrees(or.north),ar=!0)}function xr(e,t,i,n){return Tr(e,t,i,n),or.west}function Er(e,t,i,n){return Tr(e,t,i,n),or.south}function Sr(e,t,i,n){return Tr(e,t,i,n),or.east}function br(e,t,i,n){return Tr(e,t,i,n),or.north}function Ir(e,t,i,n){sr||(e.tilingScheme.tileXYToNativeRectangle(t,i,n,ur),sr=!0)}function Rr(e,t,i,n){return Ir(e,t,i,n),ur.west}function Cr(e,t,i,n){return Ir(e,t,i,n),ur.south}function Or(e,t,i,n){return Ir(e,t,i,n),ur.east}function kr(e,t,i,n){return Ir(e,t,i,n),ur.north}function Pr(e,t,i,n){return e.tileWidth}function Mr(e,t,i,n){return e.tileHeight}function Nr(e,t,i,n,r,a,o){return Hr(e,t,i,n,r,a),hr.x}function Ar(e,t,i,n,r,a,o){return Hr(e,t,i,n,r,a),hr.y}function Dr(e,t,i,n,r,a,o){return Hr(e,t,i,n,r,a),e.tileWidth-hr.x-1}function Lr(e,t,i,n,r,a,o){return Hr(e,t,i,n,r,a),e.tileHeight-hr.y-1}var Ur=new Oe,Fr=new re;function Hr(e,t,i,n,r,a,o){if(!cr){Vr(e,t,i,n,r,a);var s=Fr,u=e.tilingScheme.tileXYToNativeRectangle(t,i,n,Ur);hr.x=e.tileWidth*(s.x-u.west)/u.width|0,hr.y=e.tileHeight*(u.north-s.y)/u.height|0,cr=!0}}function zr(e,t,i,n,r,a,o){return ne.toDegrees(r)}function qr(e,t,i,n,r,a,o){return ne.toDegrees(a)}function Br(e,t,i,n,r,a,o){return Vr(e,t,i,n,r,a),Fr.x}function jr(e,t,i,n,r,a,o){return Vr(e,t,i,n,r,a),Fr.y}var Wr=new me;function Vr(e,t,i,n,r,a,o){if(!dr){if(e.tilingScheme.projection instanceof Ce)Fr.x=ne.toDegrees(r),Fr.y=ne.toDegrees(a);else{var s=Wr;s.longitude=r,s.latitude=a,e.tilingScheme.projection.project(s,Fr)}dr=!0}}function Gr(e,t,i,n,r,a,o){return o}var Yr,Zr,Xr,Qr,Kr;i("6289");function Jr(){if(!s(Zr)){var e=document.createElement("canvas");e.setAttribute("style","image-rendering: -moz-crisp-edges;image-rendering: pixelated;");var t=e.style.imageRendering;Zr=s(t)&&""!==t,Zr&&(Yr=t)}return Zr}function $r(){return Jr()?Yr:void 0}function ea(e){for(var t=e.split("."),i=0,n=t.length;i<n;++i)t[i]=parseInt(t[i],10);return t}function ta(){if(!s(Qr)){Qr=!1;var e=/Firefox\/([\.0-9]+)/.exec(Xr.userAgent);null!==e&&(Qr=!0,ea(e[1]))}return Qr}function ia(){return s(Kr)||(Kr=!ta()&&"undefined"!==typeof PointerEvent&&(!s(Xr.pointerEnabled)||Xr.pointerEnabled)),Kr}Xr="undefined"!==typeof navigator?navigator:{};var na,ra,aa={imageRenderingValue:$r,supportsImageRenderingPixelated:Jr,supportsPointerEvents:ia},oa=function(){function e(){Object(r["a"])(this,e),this._array=[],this._hash={}}return Object(a["a"])(e,[{key:"length",get:function(){return this._array.length}},{key:"values",get:function(){return this._array}},{key:"contains",value:function(e){if("string"!==typeof e&&"number"!==typeof e)throw new u("key is required to be a string or number.");return s(this._hash[e])}},{key:"set",value:function(e,t){if("string"!==typeof e&&"number"!==typeof e)throw new u("key is required to be a string or number.");var i=this._hash[e];t!==i&&(this.remove(e),this._hash[e]=t,this._array.push(t))}},{key:"get",value:function(e){if("string"!==typeof e&&"number"!==typeof e)throw new u("key is required to be a string or number.");return this._hash[e]}},{key:"remove",value:function(e){if(s(e)&&"string"!==typeof e&&"number"!==typeof e)throw new u("key is required to be a string or number.");var t=this._hash[e],i=s(t);if(i){var n=this._array;n.splice(n.indexOf(t),1),delete this._hash[e]}return i}},{key:"removeAll",value:function(){var e=this._array;e.length>0&&(this._hash={},e.length=0)}}]),e}();na="undefined"!==typeof performance&&"function"===typeof performance.now&&isFinite(performance.now())?function(){return performance.now()}:function(){return Date.now()},function(e){e[e["SHIFT"]=0]="SHIFT",e[e["CTRL"]=1]="CTRL",e[e["ALT"]=2]="ALT"}(ra||(ra={}));var sa=window.document;function ua(e,t,i){var n=e._element;if(n===sa)return i.x=t.clientX,i.y=t.clientY,i;var r=n.getBoundingClientRect();return i.x=t.clientX-r.left,i.y=t.clientY-r.top,i}function la(e,t){var i=e;return s(t)&&(i+="+"+t),i}function ca(e){return e.shiftKey?ra.SHIFT:e.ctrlKey?ra.CTRL:e.altKey?ra.ALT:void 0}var ha={LEFT:0,MIDDLE:1,RIGHT:2};function da(e,t,i,n){function r(t){n(e,t)}i.addEventListener(t,r,{capture:!1,passive:!1}),e._removalFunctions.push((function(){i.removeEventListener(t,r,!1)}))}function ma(e){var t,i=e._element,n=s(i.disableRootEvents)?i:sa;aa.supportsPointerEvents()?(da(e,"pointerdown",i,qa),da(e,"pointerup",i,Ba),da(e,"pointermove",i,ja),da(e,"pointercancel",i,Ba)):(da(e,"mousedown",i,_a),da(e,"mouseup",n,Ea),da(e,"mousemove",n,ba),da(e,"touchstart",i,Oa),da(e,"touchend",n,ka),da(e,"touchmove",n,Ua),da(e,"touchcancel",n,ka)),da(e,"dblclick",i,Ra),t="onwheel"in i?"wheel":void 0!==sa.onmousewheel?"mousewheel":"DOMMouseScroll",da(e,t,i,Ca)}function fa(e){for(var t=e._removalFunctions,i=0;i<t.length;++i)t[i]()}var va={position:new n["L"]};function ga(e){e._lastSeenTouchEvent=na()}function pa(e){return na()-e._lastSeenTouchEvent>Wa.mouseEmulationIgnoreMilliseconds}function ya(e,t,i){var n=e.x-t.x,r=e.y-t.y,a=Math.sqrt(n*n+r*r);return a<i}function _a(e,t){if(pa(e)){var i,n=t.button;if(e._buttonDown[n]=!0,n===ha.LEFT)i=Qn.LEFT_DOWN;else if(n===ha.MIDDLE)i=Qn.MIDDLE_DOWN;else{if(n!==ha.RIGHT)return;i=Qn.RIGHT_DOWN}var r=ua(e,t,e._primaryPosition);e._primaryStartPosition.copy(r),e._primaryPreviousPosition.copy(r);var a=ca(t),o=e.getInputAction(i,a);s(o)&&(va.position.copy(r),o(va),t.preventDefault())}}var wa={position:new n["L"]},Ta={position:new n["L"]};function xa(e,t,i,n){var r=ca(n),a=e.getInputAction(t,r),o=e.getInputAction(i,r);if(s(a)||s(o)){var u=ua(e,n,e._primaryPosition);if(s(a)&&(wa.position.copy(u),a(wa)),s(o)){var l=e._primaryStartPosition;ya(l,u,e._clickPixelTolerance)&&(Ta.position.copy(u),o(Ta))}}}function Ea(e,t){if(pa(e)){var i=t.button;i!==ha.LEFT&&i!==ha.MIDDLE&&i!==ha.RIGHT||(e._buttonDown[ha.LEFT]&&(xa(e,Qn.LEFT_UP,Qn.LEFT_CLICK,t),e._buttonDown[ha.LEFT]=!1),e._buttonDown[ha.MIDDLE]&&(xa(e,Qn.MIDDLE_UP,Qn.MIDDLE_CLICK,t),e._buttonDown[ha.MIDDLE]=!1),e._buttonDown[ha.RIGHT]&&(xa(e,Qn.RIGHT_UP,Qn.RIGHT_CLICK,t),e._buttonDown[ha.RIGHT]=!1))}}var Sa={startPosition:new n["L"],endPosition:new n["L"]};function ba(e,t){if(pa(e)){var i=ca(t),n=ua(e,t,e._primaryPosition),r=e._primaryPreviousPosition,a=e.getInputAction(Qn.MOUSE_MOVE,i);s(a)&&(Sa.startPosition.copy(r),Sa.endPosition.copy(n),a(Sa)),r.copy(n),(e._buttonDown[ha.LEFT]||e._buttonDown[ha.MIDDLE]||e._buttonDown[ha.RIGHT])&&t.preventDefault()}}var Ia={position:new n["L"]};function Ra(e,t){var i,n=t.button;if(n===ha.LEFT){i=Qn.LEFT_DOUBLE_CLICK;var r=ca(t),a=e.getInputAction(i,r);s(a)&&(ua(e,t,Ia.position),a(Ia))}}function Ca(e,t){var i;if(s(t.deltaY)){var n=t.deltaMode;i=n===t.DOM_DELTA_PIXEL?-t.deltaY:n===t.DOM_DELTA_LINE?40*-t.deltaY:120*-t.deltaY}else i=t.detail>0?-120*t.detail:t.wheelDelta;if(s(i)){var r=ca(t),a=e.getInputAction(Qn.WHEEL,r);s(a)&&(a(i),t.preventDefault())}}function Oa(e,t){ga(e);var i,r,a,o=t.changedTouches,s=o.length,u=e._positions;for(i=0;i<s;++i)r=o[i],a=r.identifier,u.set(a,ua(e,r,new n["L"]));La(e,t);var l=e._previousPositions;for(i=0;i<s;++i)r=o[i],a=r.identifier,l.set(a,u.get(a).clone())}function ka(e,t){ga(e);var i,n,r,a=t.changedTouches,o=a.length,s=e._positions;for(i=0;i<o;++i)n=a[i],r=n.identifier,s.remove(r);La(e,t);var u=e._previousPositions;for(i=0;i<o;++i)n=a[i],r=n.identifier,u.remove(r)}var Pa={position:new n["L"]},Ma={position1:new n["L"],position2:new n["L"]},Na={position:new n["L"]},Aa={position:new n["L"]},Da={position:new n["L"]};function La(e,t){var i,n,r=ca(t),a=e._positions,o=a.length,u=e._isPinching;if(1!==o&&e._buttonDown[ha.LEFT]){if(e._buttonDown[ha.LEFT]=!1,s(e._touchHoldTimer)&&(clearTimeout(e._touchHoldTimer),e._touchHoldTimer=void 0),i=e.getInputAction(Qn.LEFT_UP,r),s(i)&&(Na.position.copy(e._primaryPosition),i(Na)),0===o&&!e._isTouchHolding&&(n=e.getInputAction(Qn.LEFT_CLICK,r),s(n))){var l=e._primaryStartPosition,c=e._previousPositions.values[0];ya(l,c,e._clickPixelTolerance)&&(Aa.position.copy(e._primaryPosition),n(Aa))}e._isTouchHolding=!1}if(0===o&&u&&(e._isPinching=!1,i=e.getInputAction(Qn.PINCH_END,r),s(i)&&i()),1===o&&!u){var h=a.values[0];e._primaryPosition.copy(h),e._primaryStartPosition.copy(h),e._primaryPreviousPosition.copy(h),e._buttonDown[ha.LEFT]=!0,i=e.getInputAction(Qn.LEFT_DOWN,r),s(i)&&(Pa.position.copy(h),i(Pa)),e._touchHoldTimer=setTimeout((function(){if(!e.isDestroyed()&&(e._touchHoldTimer=void 0,e._isTouchHolding=!0,n=e.getInputAction(Qn.RIGHT_CLICK,r),s(n))){var t=e._primaryStartPosition,i=e._previousPositions.values[0];ya(t,i,e._holdPixelTolerance)&&(Da.position.copy(e._primaryPosition),n(Da))}}),Wa.touchHoldDelayMilliseconds),t.preventDefault()}2!==o||u||(e._isPinching=!0,i=e.getInputAction(Qn.PINCH_START,r),s(i)&&(Ma.position1.copy(a.values[0]),Ma.position2.copy(a.values[1]),i(Ma),t.preventDefault()))}function Ua(e,t){ga(e);var i,n,r,a=t.changedTouches,o=a.length,u=e._positions;for(i=0;i<o;++i){n=a[i],r=n.identifier;var l=u.get(r);s(l)&&ua(e,n,l)}za(e,t);var c=e._previousPositions;for(i=0;i<o;++i)n=a[i],r=n.identifier,c.get(r).copy(u.get(r))}var Fa={startPosition:new n["L"],endPosition:new n["L"]},Ha={distance:{startPosition:new n["L"],endPosition:new n["L"]},angleAndHeight:{startPosition:new n["L"],endPosition:new n["L"]}};function za(e,t){var i,n=ca(t),r=e._positions,a=e._previousPositions,o=r.length;if(1===o&&e._buttonDown[ha.LEFT]){var u=r.values[0];e._primaryPosition.copy(u);var l=e._primaryPreviousPosition;i=e.getInputAction(Qn.MOUSE_MOVE,n),s(i)&&(Fa.startPosition.copy(l),Fa.endPosition.copy(u),i(Fa)),l.copy(u),t.preventDefault()}else if(2===o&&e._isPinching&&(i=e.getInputAction(Qn.PINCH_MOVE,n),s(i))){var c=r.values[0],h=r.values[1],d=a.values[0],m=a.values[1],f=h.x-c.x,v=h.y-c.y,g=.25*Math.sqrt(f*f+v*v),p=m.x-d.x,y=m.y-d.y,_=.25*Math.sqrt(p*p+y*y),w=.125*(h.y+c.y),T=.125*(m.y+d.y),x=Math.atan2(v,f),E=Math.atan2(y,p);Ha.distance.startPosition.set(0,_),Ha.distance.endPosition.set(0,g),Ha.angleAndHeight.startPosition.set(E,T),Ha.angleAndHeight.endPosition.set(x,w),i(Ha)}}function qa(e,t){if(t.target.setPointerCapture(t.pointerId),"touch"===t.pointerType){var i=e._positions,r=t.pointerId;i.set(r,ua(e,t,new n["L"])),La(e,t);var a=e._previousPositions;a.set(r,i.get(r).clone())}else _a(e,t)}function Ba(e,t){if("touch"===t.pointerType){var i=e._positions,n=t.pointerId;i.remove(n),La(e,t);var r=e._previousPositions;r.remove(n)}else Ea(e,t)}function ja(e,t){if("touch"===t.pointerType){var i=e._positions,n=t.pointerId,r=i.get(n);if(!s(r))return;ua(e,t,r),za(e,t);var a=e._previousPositions;a.get(n).copy(i.get(n))}else ba(e,t)}var Wa=function(){function e(t){Object(r["a"])(this,e),this._inputEvents={},this._buttonDown={LEFT:!1,MIDDLE:!1,RIGHT:!1},this._isPinching=!1,this._isTouchHolding=!1,this._lastSeenTouchEvent=-e.mouseEmulationIgnoreMilliseconds,this._primaryStartPosition=new n["L"],this._primaryPosition=new n["L"],this._primaryPreviousPosition=new n["L"],this._positions=new oa,this._previousPositions=new oa,this._removalFunctions=[],this._touchHoldTimer=void 0,this._clickPixelTolerance=5,this._holdPixelTolerance=25,this._element=o(t,sa),ma(this)}return Object(a["a"])(e,[{key:"setInputAction",value:function(e,t,i){if(!s(e))throw new u("action is required.");if(!s(t))throw new u("type is required.");var n=la(t,i);this._inputEvents[n]=e}},{key:"getInputAction",value:function(e,t){if(!s(e))throw new u("type is required.");var i=la(e,t);return this._inputEvents[i]}},{key:"removeInputAction",value:function(e,t){if(!s(e))throw new u("type is required.");var i=la(e,t);delete this._inputEvents[i]}},{key:"isDestroyed",value:function(){return!1}},{key:"destroy",value:function(){return fa(this),ti(this)}}]),e}();Wa.mouseEmulationIgnoreMilliseconds=800,Wa.touchHoldDelayMilliseconds=1500;i("84c3"),i("fb2c");var Va={createTypedArray:function(e,t){if(!s(e))throw new u("numberOfVertices is required.");return e>=ne.SIXTY_FOUR_KILOBYTES?new Uint32Array(t):new Uint16Array(t)}},Ga=[],Ya=[],Za=[];function Xa(e,t){var i,n=new Array(t),r=new Array(e),a=new Array(t),o=new Array(e);for(i=0;i<e;++i)o[i]=i,r[i]=e*t-1-i;for(i=0;i<t;++i)a[i]=(i+1)*e-1,n[i]=(t-i-1)*e;return{westIndicesSouthToNorth:n,southIndicesEastToWest:r,eastIndicesNorthToSouth:a,northIndicesWestToEast:o}}function Qa(e,t,i,n){for(var r=0,a=0;a<t-1;++a){for(var o=0;o<e-1;++o){var s=r,u=s+e,l=u+1,c=s+1;i[n++]=s,i[n++]=u,i[n++]=c,i[n++]=c,i[n++]=u,i[n++]=l,++r}++r}}function Ka(e,t,i,n){for(var r=e[0],a=e.length,o=1;o<a;++o){var s=e[o];i[n++]=r,i[n++]=s,i[n++]=t,i[n++]=t,i[n++]=s,i[n++]=t+1,r=s,++t}return n}var Ja=function(){function e(){Object(r["a"])(this,e),this.requestTileGeometry=u.throwInstantiationError,this.getLevelMaximumGeometricError=u.throwInstantiationError,this.getTileDataAvailable=u.throwInstantiationError,this.loadTileDataAvailability=u.throwInstantiationError,u.throwInstantiationError()}return Object(a["a"])(e,[{key:"errorEvent",get:function(){return u.throwInstantiationError()}},{key:"credit",get:function(){return u.throwInstantiationError()}},{key:"tilingScheme",get:function(){return u.throwInstantiationError()}},{key:"ready",get:function(){return u.throwInstantiationError()}},{key:"readyPromise",get:function(){return u.throwInstantiationError()}},{key:"hasWaterMask",get:function(){return u.throwInstantiationError()}},{key:"hasVertexNormals",get:function(){return u.throwInstantiationError()}},{key:"availability",get:function(){return u.throwInstantiationError()}}],[{key:"getEstimatedLevelZeroGeometricErrorForAHeightmap",value:function(t,i,n){return 2*t.maximumRadius*Math.PI*e.heightmapTerrainQuality/(i*n)}},{key:"getRegularGridIndices",value:function(e,t){if(e*t>=ne.FOUR_GIGABYTES)throw new u("The total number of vertices (width * height) must be less than 4,294,967,296.");var i=Ga[e];s(i)||(Ga[e]=i=[]);var n=i[t];return s(n)||(n=e*t<ne.SIXTY_FOUR_KILOBYTES?i[t]=new Uint16Array((e-1)*(t-1)*6):i[t]=new Uint32Array((e-1)*(t-1)*6),Qa(e,t,n,0)),n}},{key:"getRegularGridAndSkirtIndicesAndEdgeIndices",value:function(t,i){if(t*i>=ne.FOUR_GIGABYTES)throw new u("The total number of vertices (width * height) must be less than 4,294,967,296.");var n=Za[t];s(n)||(Za[t]=n=[]);var r=n[i];if(!s(r)){var a=t*i,o=(t-1)*(i-1)*6,l=2*t+2*i,c=6*Math.max(0,l-4),h=a+l,d=o+c,m=Xa(t,i),f=m.westIndicesSouthToNorth,v=m.southIndicesEastToWest,g=m.eastIndicesNorthToSouth,p=m.northIndicesWestToEast,y=Va.createTypedArray(h,d);Qa(t,i,y,0),e.addSkirtIndices(f,v,g,p,a,y,o),r=n[i]={indices:y,westIndicesSouthToNorth:f,southIndicesEastToWest:v,eastIndicesNorthToSouth:g,northIndicesWestToEast:p,indexCountWithoutSkirts:o}}return r}},{key:"addSkirtIndices",value:function(e,t,i,n,r,a,o){var s=r;o=Ka(e,s,a,o),s+=e.length,o=Ka(t,s,a,o),s+=t.length,o=Ka(i,s,a,o),s+=i.length,Ka(n,s,a,o)}},{key:"getRegularGridIndicesAndEdgeIndices",value:function(t,i){if(t*i>=ne.FOUR_GIGABYTES)throw new u("The total number of vertices (width * height) must be less than 4,294,967,296.");var n=Ya[t];s(n)||(Ya[t]=n=[]);var r=n[i];if(!s(r)){var a=e.getRegularGridIndices(t,i),o=Xa(t,i),l=o.westIndicesSouthToNorth,c=o.southIndicesEastToWest,h=o.eastIndicesNorthToSouth,d=o.northIndicesWestToEast;r=n[i]={indices:a,westIndicesSouthToNorth:l,southIndicesEastToWest:c,eastIndicesNorthToSouth:h,northIndicesWestToEast:d}}return r}}]),e}();Ja.heightmapTerrainQuality=.25;i("cfc3");var $a=new re,eo=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:re.ZERO,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:re.ZERO,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:re.ZERO;Object(r["a"])(this,e),this.minimum=re.clone(o(t,re.ZERO)),this.maximum=re.clone(o(i,re.ZERO)),n=s(n)?re.clone(n):re.midpoint(this.minimum,this.maximum,new re),this.center=n}return Object(a["a"])(e,[{key:"clone",value:function(t){return e.clone(this,t)}},{key:"intersectPlane",value:function(t){return e.intersectPlane(this,t)}},{key:"equals",value:function(t){return e.equals(this,t)}}],[{key:"clone",value:function(t,i){if(s(t))return s(i)?(i.minimum=re.clone(t.minimum,i.minimum),i.maximum=re.clone(t.maximum,i.maximum),i.center=re.clone(t.center,i.center),i):new e(t.minimum,t.maximum,t.center)}},{key:"equals",value:function(e,t){return e===t||s(e)&&s(t)&&re.equals(e.center,t.center)&&re.equals(e.minimum,t.minimum)&&re.equals(e.maximum,t.maximum)}},{key:"intersectPlane",value:function(e,t){$a=re.subtract(e.maximum,e.minimum,$a);var i=re.multiplyByScalar($a,.5,$a),n=t.normal,r=i.x*Math.abs(n.x)+i.y*Math.abs(n.y)+i.z*Math.abs(n.z),a=re.dot(e.center,n)+t.distance;return a-r>0?Re.INSIDE:a+r<0?Re.OUTSIDE:Re.INTERSECTING}}]),e}(),to=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,u=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,l=arguments.length>6&&void 0!==arguments[6]?arguments[6]:0,c=arguments.length>7&&void 0!==arguments[7]?arguments[7]:0,h=arguments.length>8&&void 0!==arguments[8]?arguments[8]:0,d=arguments.length>9&&void 0!==arguments[9]?arguments[9]:0,m=arguments.length>10&&void 0!==arguments[10]?arguments[10]:0,f=arguments.length>11&&void 0!==arguments[11]?arguments[11]:0,v=arguments.length>12&&void 0!==arguments[12]?arguments[12]:0,g=arguments.length>13&&void 0!==arguments[13]?arguments[13]:0,p=arguments.length>14&&void 0!==arguments[14]?arguments[14]:0,y=arguments.length>15&&void 0!==arguments[15]?arguments[15]:0;Object(r["a"])(this,e),this[0]=o(t,0),this[1]=o(s,0),this[2]=o(h,0),this[3]=o(v,0),this[4]=o(i,0),this[5]=o(u,0),this[6]=o(d,0),this[7]=o(g,0),this[8]=o(n,0),this[9]=o(l,0),this[10]=o(m,0),this[11]=o(p,0),this[12]=o(a,0),this[13]=o(c,0),this[14]=o(f,0),this[15]=o(y,0)}return Object(a["a"])(e,null,[{key:"inverseTransformation",value:function(e,t){var i=e[0],n=e[1],r=e[2],a=e[4],o=e[5],s=e[6],u=e[8],l=e[9],c=e[10],h=e[12],d=e[13],m=e[14],f=-i*h-n*d-r*m,v=-a*h-o*d-s*m,g=-u*h-l*d-c*m;return t[0]=i,t[1]=a,t[2]=u,t[3]=0,t[4]=n,t[5]=o,t[6]=l,t[7]=0,t[8]=r,t[9]=s,t[10]=c,t[11]=0,t[12]=f,t[13]=v,t[14]=g,t[15]=1,t}},{key:"multiply",value:function(e,t,i){var n=e[0],r=e[1],a=e[2],o=e[3],s=e[4],u=e[5],l=e[6],c=e[7],h=e[8],d=e[9],m=e[10],f=e[11],v=e[12],g=e[13],p=e[14],y=e[15],_=t[0],w=t[1],T=t[2],x=t[3],E=t[4],S=t[5],b=t[6],I=t[7],R=t[8],C=t[9],O=t[10],k=t[11],P=t[12],M=t[13],N=t[14],A=t[15],D=n*_+s*w+h*T+v*x,L=r*_+u*w+d*T+g*x,U=a*_+l*w+m*T+p*x,F=o*_+c*w+f*T+y*x,H=n*E+s*S+h*b+v*I,z=r*E+u*S+d*b+g*I,q=a*E+l*S+m*b+p*I,B=o*E+c*S+f*b+y*I,j=n*R+s*C+h*O+v*k,W=r*R+u*C+d*O+g*k,V=a*R+l*C+m*O+p*k,G=o*R+c*C+f*O+y*k,Y=n*P+s*M+h*N+v*A,Z=r*P+u*M+d*N+g*A,X=a*P+l*M+m*N+p*A,Q=o*P+c*M+f*N+y*A;return i[0]=D,i[1]=L,i[2]=U,i[3]=F,i[4]=H,i[5]=z,i[6]=q,i[7]=B,i[8]=j,i[9]=W,i[10]=V,i[11]=G,i[12]=Y,i[13]=Z,i[14]=X,i[15]=Q,i}},{key:"fromRotationTranslation",value:function(t,i,n){return i=o(i,re.ZERO),s(n)?(n[0]=t[0],n[1]=t[1],n[2]=t[2],n[3]=0,n[4]=t[3],n[5]=t[4],n[6]=t[5],n[7]=0,n[8]=t[6],n[9]=t[7],n[10]=t[8],n[11]=0,n[12]=i.x,n[13]=i.y,n[14]=i.z,n[15]=1,n):new e(t[0],t[3],t[6],i.x,t[1],t[4],t[7],i.y,t[2],t[5],t[8],i.z,0,0,0,1)}},{key:"fromTranslation",value:function(t,i){return e.fromRotationTranslation(He.IDENTITY,t,i)}},{key:"setTranslation",value:function(e,t,i){return i[0]=e[0],i[1]=e[1],i[2]=e[2],i[3]=e[3],i[4]=e[4],i[5]=e[5],i[6]=e[6],i[7]=e[7],i[8]=e[8],i[9]=e[9],i[10]=e[10],i[11]=e[11],i[12]=t.x,i[13]=t.y,i[14]=t.z,i[15]=e[15],i}},{key:"fromScale",value:function(t,i){return s(i)?(i[0]=t.x,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=t.y,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=t.z,i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,i):new e(t.x,0,0,0,0,t.y,0,0,0,0,t.z,0,0,0,0,1)}},{key:"clone",value:function(t,i){return s(i)?(i[0]=t[0],i[1]=t[1],i[2]=t[2],i[3]=t[3],i[4]=t[4],i[5]=t[5],i[6]=t[6],i[7]=t[7],i[8]=t[8],i[9]=t[9],i[10]=t[10],i[11]=t[11],i[12]=t[12],i[13]=t[13],i[14]=t[14],i[15]=t[15],i):new e(t[0],t[4],t[8],t[12],t[1],t[5],t[9],t[13],t[2],t[6],t[10],t[14],t[3],t[7],t[11],t[15])}},{key:"multiplyByPoint",value:function(e,t,i){var n=t.x,r=t.y,a=t.z,o=e[0]*n+e[4]*r+e[8]*a+e[12],s=e[1]*n+e[5]*r+e[9]*a+e[13],u=e[2]*n+e[6]*r+e[10]*a+e[14];return i.x=o,i.y=s,i.z=u,i}},{key:"getColumn",value:function(e,t,i){var n=4*t,r=e[n],a=e[n+1],o=e[n+2],s=e[n+3];return i.x=r,i.y=a,i.z=o,i.w=s,i}},{key:"getTranslation",value:function(e,t){return t.x=e[12],t.y=e[13],t.z=e[14],t}},{key:"transformToThreeMatrix4",value:function(t,i){return e.toArray(t,i.elements),i}},{key:"setFromThreeMatrix4",value:function(t,i){return e.toArray(t.elements,i),i}},{key:"equals",value:function(e,t){return e===t||s(e)&&s(t)&&e[12]===t[12]&&e[13]===t[13]&&e[14]===t[14]&&e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[4]===t[4]&&e[5]===t[5]&&e[6]===t[6]&&e[8]===t[8]&&e[9]===t[9]&&e[10]===t[10]&&e[3]===t[3]&&e[7]===t[7]&&e[11]===t[11]&&e[15]===t[15]}},{key:"computeView",value:function(e,t,i,n,r){return r[0]=n.x,r[1]=i.x,r[2]=-t.x,r[3]=0,r[4]=n.y,r[5]=i.y,r[6]=-t.y,r[7]=0,r[8]=n.z,r[9]=i.z,r[10]=-t.z,r[11]=0,r[12]=-re.dot(n,e),r[13]=-re.dot(i,e),r[14]=re.dot(t,e),r[15]=1,r}},{key:"computePerspectiveOffCenter",value:function(e,t,i,n,r,a,o){var s=2*r/(t-e),u=2*r/(n-i),l=(t+e)/(t-e),c=(n+i)/(n-i),h=-(a+r)/(a-r),d=-1,m=-2*a*r/(a-r);return o[0]=s,o[1]=0,o[2]=0,o[3]=0,o[4]=0,o[5]=u,o[6]=0,o[7]=0,o[8]=l,o[9]=c,o[10]=h,o[11]=d,o[12]=0,o[13]=0,o[14]=m,o[15]=0,o}},{key:"computeInfinitePerspectiveOffCenter",value:function(e,t,i,n,r,a){var o=2*r/(t-e),s=2*r/(n-i),u=(t+e)/(t-e),l=(n+i)/(n-i),c=-1,h=-1,d=-2*r;return a[0]=o,a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=s,a[6]=0,a[7]=0,a[8]=u,a[9]=l,a[10]=c,a[11]=h,a[12]=0,a[13]=0,a[14]=d,a[15]=0,a}},{key:"multiplyByPointAsVector",value:function(e,t,i){var n=t.x,r=t.y,a=t.z,o=e[0]*n+e[4]*r+e[8]*a,s=e[1]*n+e[5]*r+e[9]*a,u=e[2]*n+e[6]*r+e[10]*a;return i.x=o,i.y=s,i.z=u,i}},{key:"toArray",value:function(e,t){return s(t)?(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t):[e[0],e[1],e[2],e[3],e[4],e[5],e[6],e[7],e[8],e[9],e[10],e[11],e[12],e[13],e[14],e[15]]}},{key:"computeViewportTransformation",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{x:0,y:0,width:0,height:0},t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,r=arguments.length>3?arguments[3]:void 0;s(r)||(r=new n["q"]),e=o(e,o.EMPTY_OBJECT);var a=o(e.x,0),u=o(e.y,0),l=o(e.width,0),c=o(e.height,0);t=o(t,0),i=o(i,1);var h=.5*l,d=.5*c,m=.5*(i-t),f=h,v=d,g=m,p=a+h,y=u+d,_=t+m,w=1;return r[0]=f,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=v,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[10]=g,r[11]=0,r[12]=p,r[13]=y,r[14]=_,r[15]=w,r}},{key:"multiplyByVector",value:function(e,t,i){var n=t.x,r=t.y,a=t.z,o=t.w,s=e[0]*n+e[4]*r+e[8]*a+e[12]*o,u=e[1]*n+e[5]*r+e[9]*a+e[13]*o,l=e[2]*n+e[6]*r+e[10]*a+e[14]*o,c=e[3]*n+e[7]*r+e[11]*a+e[15]*o;return i.x=s,i.y=u,i.z=l,i.w=c,i}}]),e}();to.IDENTITY=Object.freeze(new to(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1));var io=new re,no=Ie.clone(Ie.UNIT_SPHERE),ro=new re,ao=new re;function oo(e,t,i){var n=t,r=i,a=re.subtract(e,n,ao),o=-re.dot(a,n),s=r<0?o>0:o>r&&o*o/re.magnitudeSquared(a)>r;return!s}function so(e,t,i){if(s(t)&&t<0&&e.minimumRadius>-t){var n=re.fromElements(e.radii.x+t,e.radii.y+t,e.radii.z+t,io);e=Ie.fromCartesian3(n,i)}return e}var uo=new re,lo=new re;function co(e,t,i){var n=e.transformPositionToScaledSpace(t,uo),r=re.magnitudeSquared(n),a=Math.sqrt(r),o=re.divideByScalar(n,a,lo);r=Math.max(1,r),a=Math.max(1,a);var s=re.dot(o,i),u=re.magnitude(re.cross(o,i,o)),l=1/a,c=Math.sqrt(r-1)*l;return 1/(s*l-u*c)}function ho(e,t,i,n){s(n)||(n=new re);for(var r=vo(e,t),a=0,o=0,u=i.length;o<u;++o){var l=i[o],c=co(e,l,r);if(c<0)return;a=Math.max(a,c)}return mo(r,a,n)}function mo(e,t,i){if(!(t<=0||t===1/0||t!==t))return re.multiplyByScalar(e,t,i)}var fo=new re;function vo(e,t){return re.equals(t,re.ZERO)?t:(e.transformPositionToScaledSpace(t,fo),re.normalize(fo,fo))}var go=function(){function e(t,i){Object(r["a"])(this,e),this._ellipsoid=t,this._cameraPosition=new re,this._cameraPositionInScaledSpace=new re,this._distanceToLimbInScaledSpaceSquared=0,s(i)&&(this.cameraPosition=i)}return Object(a["a"])(e,[{key:"ellipsoid",get:function(){return this._ellipsoid}},{key:"cameraPosition",get:function(){return this._cameraPosition},set:function(e){var t=this._ellipsoid,i=t.transformPositionToScaledSpace(e,this._cameraPositionInScaledSpace),n=re.magnitudeSquared(i)-1;re.clone(e,this._cameraPosition),this._cameraPositionInScaledSpace=i,this._distanceToLimbInScaledSpaceSquared=n}},{key:"computeHorizonCullingPointPossiblyUnderEllipsoid",value:function(e,t,i,n){var r=so(this._ellipsoid,i,no);return ho(r,e,t,n)}},{key:"isScaledSpacePointVisiblePossiblyUnderEllipsoid",value:function(e,t){var i,n,r=this._ellipsoid;return s(t)&&t<0&&r.minimumRadius>-t?(n=ro,n.x=this._cameraPosition.x/(r.radii.x+t),n.y=this._cameraPosition.y/(r.radii.y+t),n.z=this._cameraPosition.z/(r.radii.z+t),i=n.x*n.x+n.y*n.y+n.z*n.z-1):(n=this._cameraPositionInScaledSpace,i=this._distanceToLimbInScaledSpaceSquared),oo(e,n,i)}}]),e}(),po=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;Object(r["a"])(this,e),this.x=o(t,0),this.y=o(i,0),this.z=o(n,0),this.w=o(a,0)}return Object(a["a"])(e,[{key:"toArray",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e[t+3]=this.w,e}}],[{key:"fromColor",value:function(t,i){return s(i)?(i.x=t.red,i.y=t.green,i.z=t.blue,i.w=t.alpha,i):new e(t.red,t.green,t.blue,t.alpha)}},{key:"clone",value:function(t,i){if(s(t))return s(i)?(i.x=t.x,i.y=t.y,i.z=t.z,i.w=t.w,i):new e(t.x,t.y,t.z,t.w)}},{key:"fromElements",value:function(t,i,n,r,a){return s(a)?(a.x=t,a.y=i,a.z=n,a.w=r,a):new e(t,i,n,r)}}]),e}();po.UNIT_W=Object.freeze(new po(0,0,0,1));var yo=new re,_o=new re,wo=function(){function e(t,i){if(Object(r["a"])(this,e),!ne.equalsEpsilon(re.magnitude(t),1,ne.EPSILON6))throw new u("normal must be normalized.");this.normal=re.clone(t),this.distance=i}return Object(a["a"])(e,null,[{key:"getPointDistance",value:function(e,t){return re.dot(e.normal,t)+e.distance}},{key:"fromPointNormal",value:function(t,i,n){if(!ne.equalsEpsilon(re.magnitude(i),1,ne.EPSILON6))throw new u("normal must be normalized.");var r=-re.dot(i,t);return s(n)?(re.clone(i,n.normal),n.distance=r,n):new e(i,r)}},{key:"projectPointOntoPlane",value:function(t,i,n){s(n)||(n=new re);var r=e.getPointDistance(t,i),a=re.multiplyByScalar(t.normal,r,yo);return re.subtract(i,a,n)}},{key:"fromCartesian4",value:function(t,i){var n=re.fromCartesian4(t,_o),r=t.w;if(!ne.equalsEpsilon(re.magnitude(n),1,ne.EPSILON6))throw new u("normal must be normalized.");return s(i)?(re.clone(n,i.normal),i.distance=r,i):new e(n,r)}}]),e}(),To={},xo={up:{south:"east",north:"west",west:"south",east:"north"},down:{south:"west",north:"east",west:"north",east:"south"},south:{up:"west",down:"east",west:"down",east:"up"},north:{up:"east",down:"west",west:"up",east:"down"},west:{up:"north",down:"south",north:"down",south:"up"},east:{up:"south",down:"north",north:"up",south:"down"}},Eo={north:[-1,0,0],east:[0,1,0],up:[0,0,1],south:[1,0,0],west:[0,-1,0],down:[0,0,-1]},So={},bo={east:new re,north:new re,up:new re,west:new re,south:new re,down:new re},Io=new re,Ro=new re,Co=new re;To.localFrameToFixedFrameGenerator=function(e,t){if(!xo.hasOwnProperty(e)||!xo[e].hasOwnProperty(t))throw new u("firstAxis and secondAxis must be east, north, up, west, south or down.");var i,n=xo[e][t],r=e+t;return s(So[r])?i=So[r]:(i=function(i){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Ie.WGS84,a=arguments.length>2?arguments[2]:void 0;if(!s(i))throw new u("origin is required.");if(s(a)||(a=new to),re.equalsEpsilon(i,re.ZERO,ne.EPSILON14))re.unpack(Eo[e],0,Io),re.unpack(Eo[t],0,Ro),re.unpack(Eo[n],0,Co);else if(ne.equalsEpsilon(i.x,0,ne.EPSILON14)&&ne.equalsEpsilon(i.y,0,ne.EPSILON14)){var l=ne.sign(i.z);re.unpack(Eo[e],0,Io),"east"!==e&&"west"!==e&&re.multiplyByScalar(Io,l,Io),re.unpack(Eo[t],0,Ro),"east"!==t&&"west"!==t&&re.multiplyByScalar(Ro,l,Ro),re.unpack(Eo[n],0,Co),"east"!==n&&"west"!==n&&re.multiplyByScalar(Co,l,Co)}else{r=o(r,Ie.WGS84),r.geodeticSurfaceNormal(i,bo.up);var c=bo.up,h=bo.east;h.x=-i.y,h.y=i.x,h.z=0,re.normalize(h,bo.east),re.cross(c,h,bo.north),re.multiplyByScalar(bo.up,-1,bo.down),re.multiplyByScalar(bo.east,-1,bo.west),re.multiplyByScalar(bo.north,-1,bo.south),Io=bo[e],Ro=bo[t],Co=bo[n]}return a[0]=Io.x,a[1]=Io.y,a[2]=Io.z,a[3]=0,a[4]=Ro.x,a[5]=Ro.y,a[6]=Ro.z,a[7]=0,a[8]=Co.x,a[9]=Co.y,a[10]=Co.z,a[11]=0,a[12]=i.x,a[13]=i.y,a[14]=i.z,a[15]=1,a},So[r]=i),i},To.eastNorthUpToFixedFrame=To.localFrameToFixedFrameGenerator("east","north");var Oo=new St,ko=new re,Po=new po,Mo=function(){function e(t){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Ie.WGS84;if(Object(r["a"])(this,e),i=o(i,Ie.WGS84),t=i.scaleToGeodeticSurface(t),!s(t))throw new u("origin must not be at the center of the ellipsoid.");var n=To.eastNorthUpToFixedFrame(t,i);this._ellipsoid=i,this._origin=t,this._xAxis=re.fromCartesian4(to.getColumn(n,0,Po)),this._yAxis=re.fromCartesian4(to.getColumn(n,1,Po));var a=re.fromCartesian4(to.getColumn(n,2,Po));this._plane=wo.fromPointNormal(t,a)}return Object(a["a"])(e,[{key:"ellipsoid",get:function(){return this._ellipsoid}},{key:"origin",get:function(){return this._origin}},{key:"plane",get:function(){return this._plane}},{key:"xAxis",get:function(){return this._xAxis}},{key:"yAxis",get:function(){return this._yAxis}},{key:"zAxis",get:function(){return this._plane.normal}},{key:"projectPointToNearestOnPlane",value:function(e,t){s(t)||(t=new dt);var i=Oo;i.origin=e,re.clone(this._plane.normal,i.direction);var n=bt.rayPlane(i,this._plane,ko);s(n)||(re.negate(i.direction,i.direction),n=bt.rayPlane(i,this._plane,ko));var r=re.subtract(n,this._origin,n),a=re.dot(this._xAxis,r),o=re.dot(this._yAxis,r);return t.x=a,t.y=o,t}}]),e}(),No=new re,Ao=new re,Do=new re,Lo=new re,Uo=new re,Fo=new re,Ho=new He,zo={unitary:new He,diagonal:new He},qo=new re,Bo=new re;function jo(e,t,i,n,r,a,o,l,c,h){var d=arguments.length>10&&void 0!==arguments[10]?arguments[10]:new gs;if(!s(r)||!s(a)||!s(o)||!s(l)||!s(c)||!s(h))throw new u("all extents (minimum/maximum X/Y/Z) are required.");s(d)||(d=new gs);var m=d.halfAxes;He.setColumn(m,0,t,m),He.setColumn(m,1,i,m),He.setColumn(m,2,n,m);var f=qo;f.x=(r+a)/2,f.y=(o+l)/2,f.z=(c+h)/2;var v=Bo;v.x=(a-r)/2,v.y=(l-o)/2,v.z=(h-c)/2;var g=d.center;return f=He.multiplyByVector(m,f,f),re.add(e,f,g),He.multiplyByScale(m,v,m),d}var Wo=new me,Vo=new re,Go=new me,Yo=new me,Zo=new me,Xo=new me,Qo=new me,Ko=new re,Jo=new re,$o=new re,es=new re,ts=new re,is=new dt,ns=new dt,rs=new dt,as=new dt,os=new dt,ss=new re,us=new re,ls=new re,cs=new re,hs=new dt,ds=new re,ms=new re,fs=new re,vs=new wo(re.UNIT_X,0),gs=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:re.ZERO,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:He.ZERO;Object(r["a"])(this,e),this.center=re.clone(o(t,re.ZERO)),this.halfAxes=He.clone(o(i,He.ZERO))}return Object(a["a"])(e,[{key:"intersectPlane",value:function(t){return e.intersectPlane(this,t)}}],[{key:"pack",value:function(e,t){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return i=o(i,0),re.pack(e.center,t,i),He.pack(e.halfAxes,t,i+re.packedLength),t}},{key:"unpack",value:function(t){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new e;return Pe.defined("array",t),i=o(i,0),s(n)||(n=new e),re.unpack(t,i,n.center),He.unpack(t,i+re.packedLength,n.halfAxes),n}},{key:"fromPoints",value:function(t){var i,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new e;if(s(n)||(n=new e),!s(t)||0===t.length)return n.halfAxes=He.ZERO,n.center=re.ZERO,n;var r=t.length,a=re.clone(t[0],No);for(i=1;i<r;i++)re.add(a,t[i],a);var o=1/r;re.multiplyByScalar(a,o,a);var u,l=0,c=0,h=0,d=0,m=0,f=0;for(i=0;i<r;i++)u=re.subtract(t[i],a,Ao),l+=u.x*u.x,c+=u.x*u.y,h+=u.x*u.z,d+=u.y*u.y,m+=u.y*u.z,f+=u.z*u.z;l*=o,c*=o,h*=o,d*=o,m*=o,f*=o;var v=Ho;v[0]=l,v[1]=c,v[2]=h,v[3]=c,v[4]=d,v[5]=m,v[6]=h,v[7]=m,v[8]=f;var g=He.computeEigenDecomposition(v,zo),p=He.clone(g.unitary,n.halfAxes),y=He.getColumn(p,0,Lo),_=He.getColumn(p,1,Uo),w=He.getColumn(p,2,Fo),T=-Number.MAX_VALUE,x=-Number.MAX_VALUE,E=-Number.MAX_VALUE,S=Number.MAX_VALUE,b=Number.MAX_VALUE,I=Number.MAX_VALUE;for(i=0;i<r;i++)u=t[i],T=Math.max(re.dot(y,u),T),x=Math.max(re.dot(_,u),x),E=Math.max(re.dot(w,u),E),S=Math.min(re.dot(y,u),S),b=Math.min(re.dot(_,u),b),I=Math.min(re.dot(w,u),I);y=re.multiplyByScalar(y,.5*(S+T),y),_=re.multiplyByScalar(_,.5*(b+x),_),w=re.multiplyByScalar(w,.5*(I+E),w);var R=re.add(y,_,n.center);re.add(R,w,R);var C=Do;return C.x=T-S,C.y=x-b,C.z=E-I,re.multiplyByScalar(C,.5,C),He.multiplyByScale(n.halfAxes,C,n.halfAxes),n}},{key:"clone",value:function(t,i){if(s(t))return s(i)?(re.clone(t.center,i.center),He.clone(t.halfAxes,i.halfAxes),i):new e(t.center,t.halfAxes)}},{key:"fromRectangle",value:function(e){var t,i,n,r,a,l,c,h=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,d=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,m=arguments.length>3&&void 0!==arguments[3]?arguments[3]:Ie.WGS84,f=arguments.length>4?arguments[4]:void 0;if(!s(e))throw new u("rectangle is required");if(e.width<0||e.width>ne.TWO_PI)throw new u("Rectangle width must be between 0 and 2*pi");if(e.height<0||e.height>ne.PI)throw new u("Rectangle height must be between 0 and pi");if(s(m)&&!ne.equalsEpsilon(m.radii.x,m.radii.y,ne.EPSILON15))throw new u("Ellipsoid must be an ellipsoid of revolution (radii.x == radii.y)");if(h=o(h,0),d=o(d,0),m=o(m,Ie.WGS84),e.width<=ne.PI){var v=Oe.center(e,Wo),g=m.cartographicToCartesian(v,Vo),p=new Mo(g,m);c=p.plane;var y=v.longitude,_=e.south<0&&e.north>0?0:v.latitude,w=me.fromRadians(y,e.north,d,Go),T=me.fromRadians(e.west,e.north,d,Yo),x=me.fromRadians(e.west,_,d,Zo),E=me.fromRadians(e.west,e.south,d,Xo),S=me.fromRadians(y,e.south,d,Qo),b=m.cartographicToCartesian(w,Ko),I=m.cartographicToCartesian(T,Jo),R=m.cartographicToCartesian(x,$o),C=m.cartographicToCartesian(E,es),O=m.cartographicToCartesian(S,ts),k=p.projectPointToNearestOnPlane(b,is),P=p.projectPointToNearestOnPlane(I,ns),M=p.projectPointToNearestOnPlane(R,rs),N=p.projectPointToNearestOnPlane(C,as),A=p.projectPointToNearestOnPlane(O,os);return t=Math.min(P.x,M.x,N.x),i=-t,r=Math.max(P.y,k.y),n=Math.min(N.y,A.y),T.height=E.height=h,I=m.cartographicToCartesian(T,Jo),C=m.cartographicToCartesian(E,es),a=Math.min(wo.getPointDistance(c,I),wo.getPointDistance(c,C)),l=d,jo(p.origin,p.xAxis,p.yAxis,p.zAxis,t,i,n,r,a,l,f)}var D=e.south>0,L=e.north<0,U=D?e.south:L?e.north:0,F=Oe.center(e,Wo).longitude,H=re.fromRadians(F,U,d,m,ss);H.z=0;var z=Math.abs(H.x)<ne.EPSILON10&&Math.abs(H.y)<ne.EPSILON10,q=z?re.UNIT_X:re.normalize(H,us),B=re.UNIT_Z,j=re.cross(q,B,ls);c=wo.fromPointNormal(H,q,vs);var W=re.fromRadians(F+ne.PI_OVER_TWO,U,d,m,cs);i=re.dot(wo.projectPointOntoPlane(c,W,hs),j),t=-i,r=re.fromRadians(0,e.north,L?h:d,m,ds).z,n=re.fromRadians(0,e.south,D?h:d,m,ms).z;var V=re.fromRadians(e.east,U,d,m,fs);return a=wo.getPointDistance(c,V),l=0,jo(H,j,B,q,t,i,n,r,a,l,f)}},{key:"intersectPlane",value:function(e,t){if(!s(e))throw new u("box is required.");if(!s(t))throw new u("plane is required.");var i=e.center,n=t.normal,r=e.halfAxes,a=n.x,o=n.y,l=n.z,c=Math.abs(a*r[He.COLUMN0ROW0]+o*r[He.COLUMN0ROW1]+l*r[He.COLUMN0ROW2])+Math.abs(a*r[He.COLUMN1ROW0]+o*r[He.COLUMN1ROW1]+l*r[He.COLUMN1ROW2])+Math.abs(a*r[He.COLUMN2ROW0]+o*r[He.COLUMN2ROW1]+l*r[He.COLUMN2ROW2]),h=re.dot(n,i)+t.distance;return h<=-c?Re.OUTSIDE:h>=c?Re.INSIDE:Re.INTERSECTING}}]),e}();gs.packedLength=re.packedLength+He.packedLength;var ps=1/256,ys=256,_s=function(e,t,i){var n=re.magnitudeSquared(e);if(Math.abs(n-1)>ne.EPSILON6)throw new u("vector must be normalized.");if(i.x=e.x/(Math.abs(e.x)+Math.abs(e.y)+Math.abs(e.z)),i.y=e.y/(Math.abs(e.x)+Math.abs(e.y)+Math.abs(e.z)),e.z<0){var r=i.x,a=i.y;i.x=(1-Math.abs(a))*ne.signNotZero(r),i.y=(1-Math.abs(r))*ne.signNotZero(a)}return i.x=ne.toSNorm(i.x,t),i.y=ne.toSNorm(i.y,t),i},ws=function(e,t){return Hs.octEncodeInRange(e,255,t)},Ts=new dt,xs=new Uint8Array(1);function Es(e){return xs[0]=e,xs[0]}var Ss=function(e,t){return Hs.octEncodeInRange(e,65535,Ts),t.x=Es(Ts.x*ps),t.y=Es(Ts.x),t.z=Es(Ts.y*ps),t.w=Es(Ts.y),t},bs=function(e,t,i,n){if(e<0||e>i||t<0||t>i)throw new u("x and y must be unsigned normalized integers between 0 and "+i);if(n.x=ne.fromSNorm(e,i),n.y=ne.fromSNorm(t,i),n.z=1-(Math.abs(n.x)+Math.abs(n.y)),n.z<0){var r=n.x;n.x=(1-Math.abs(n.y))*ne.signNotZero(r),n.y=(1-Math.abs(r))*ne.signNotZero(n.y)}return re.normalize(n,n)},Is=function(e,t,i){return Hs.octDecodeInRange(e,t,255,i)},Rs=function(e,t){var i=e.x,n=e.y,r=e.z,a=e.w;if(i<0||i>255||n<0||n>255||r<0||r>255||a<0||a>255)throw new u("x, y, z, and w must be unsigned normalized integers between 0 and 255");var o=i*ys+n,s=r*ys+a;return Hs.octDecodeInRange(o,s,65535,t)},Cs=function(e){return 256*e.x+e.y},Os=new dt,ks=function(e){return Hs.octEncode(e,Os),Hs.octPackFloat(Os)},Ps=function(e,t){var i=e/256,n=Math.floor(i),r=256*(i-n);return Hs.octDecode(n,r,t)},Ms=function(e,t,i,n){var r=Hs.octEncodeFloat(e),a=Hs.octEncodeFloat(t),o=Hs.octEncode(i,Os);return n.x=65536*o.x+r,n.y=65536*o.y+a,n},Ns=function(e,t,i,n){var r=e.x/65536,a=Math.floor(r),o=65536*(r-a);r=e.y/65536;var s=Math.floor(r),u=65536*(r-s);Hs.octDecodeFloat(o,t),Hs.octDecodeFloat(u,i),Hs.octDecode(a,s,n)},As=function(e){var t=4095*e.x|0,i=4095*e.y|0;return 4096*t+i},Ds=function(e,t){var i=e/4096,n=Math.floor(i);return t.x=n/4095,t.y=(e-4096*n)/4095,t};function Ls(e){return e>>1^-(1&e)}var Us,Fs=function(e,t,i){for(var n=e.length,r=0,a=0,o=0,u=0;u<n;++u)r+=Ls(e[u]),a+=Ls(t[u]),e[u]=r,t[u]=a,s(i)&&(o+=Ls(i[u]),i[u]=o)},Hs={octEncodeInRange:_s,octEncode:ws,octEncodeToCartesian4:Ss,octDecodeInRange:bs,octDecode:Is,octDecodeFromCartesian4:Rs,octPackFloat:Cs,octEncodeFloat:ks,octDecodeFloat:Ps,octPack:Ms,octUnpack:Ns,compressTextureCoordinates:As,decompressTextureCoordinates:Ds,zigZagDeltaDecode:Fs},zs=(i("fd87"),i("8b09"),i("143c"),i("4a9b"),{BYTE:5120,DOUBLE:5130,FLOAT:5126,INT:5124,SHORT:5122,UNSIGNED_BYTE:5121,UNSIGNED_INT:5125,UNSIGNED_SHORT:5123,getSizeInBytes:function(e){if(!s(e))throw new u("value is required.");switch(e){case zs.BYTE:return Int8Array.BYTES_PER_ELEMENT;case zs.UNSIGNED_BYTE:return Uint8Array.BYTES_PER_ELEMENT;case zs.SHORT:return Int16Array.BYTES_PER_ELEMENT;case zs.UNSIGNED_SHORT:return Uint16Array.BYTES_PER_ELEMENT;case zs.INT:return Int32Array.BYTES_PER_ELEMENT;case zs.UNSIGNED_INT:return Uint32Array.BYTES_PER_ELEMENT;case zs.FLOAT:return Float32Array.BYTES_PER_ELEMENT;case zs.DOUBLE:return Float64Array.BYTES_PER_ELEMENT;default:throw new u("componentDatatype is not a valid value.")}}}),qs=new me,Bs={getPosition:function(e,t,i,n,r){var a=t.cartesianToCartographic(e,qs),o=Bs.getHeight(a.height,i,n);return re.fromRadians(a.longitude,a.latitude,o,t,r)},getHeight:function(e,t,i){return(e-i)*t+i}};(function(e){e[e["NONE"]=0]="NONE",e[e["BITS12"]=1]="BITS12"})(Us||(Us={}));var js=new re,Ws=new re,Vs=new dt,Gs=new to,Ys=new to,Zs=Math.pow(2,12),Xs=new re,Qs=new re,Ks={position3DAndHeight:0,textureCoordAndEncodedNormals:1,geodeticSurfaceNormal:2},Js={compressed0:0,compressed1:1,geodeticSurfaceNormal:2},$s=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new re,i=arguments.length>1?arguments[1]:void 0,a=arguments.length>2?arguments[2]:void 0,u=arguments.length>3?arguments[3]:void 0,l=arguments.length>4?arguments[4]:void 0,c=arguments.length>5?arguments[5]:void 0,h=arguments.length>6?arguments[6]:void 0,d=arguments.length>7?arguments[7]:void 0,m=arguments.length>8&&void 0!==arguments[8]?arguments[8]:1,f=arguments.length>9&&void 0!==arguments[9]?arguments[9]:0;Object(r["a"])(this,e);var v,g,p=Us.NONE;if(s(i)&&s(a)&&s(u)&&s(l)){var y=i.minimum,_=i.maximum,w=re.subtract(_,y,Ws),T=u-a,x=Math.max(re.maximumComponent(w),T);p=x<Zs-1?Us.BITS12:Us.NONE,v=to.inverseTransformation(l,new to);var E=re.negate(y,js);to.multiply(to.fromTranslation(E,Gs),v,v);var S=js;S.x=1/w.x,S.y=1/w.y,S.z=1/w.z,to.multiply(to.fromScale(S,Gs),v,v),g=to.clone(l),to.setTranslation(g,re.ZERO,g),l=to.clone(l,new to);var b=to.fromTranslation(y,Gs),I=to.fromScale(w,Ys),R=to.multiply(b,I,Gs);to.multiply(l,R,l),to.multiply(g,R,g)}this.quantization=p,this.minimumHeight=a,this.maximumHeight=u,this.center=re.clone(t),this.toScaledENU=v,this.fromScaledENU=l,this.matrix=g,this._threeMatrix4=new n["q"],this.hasVertexNormals=c,this.hasWebMercatorT=o(h,!1),this.hasGeodeticSurfaceNormals=o(d,!1),this.exaggeration=o(m,1),this.exaggerationRelativeHeight=o(f,0),this.stride=0,this._offsetGeodeticSurfaceNormal=0,this._offsetVertexNormal=0,this._calculateStrideAndOffsets()}return Object(a["a"])(e,[{key:"threeMatrix4",get:function(){return s(this.matrix)&&to.toArray(this.matrix,this._threeMatrix4.elements),this._threeMatrix4}},{key:"encode",value:function(e,t,i,n,r,a,o,s){var u=n.x,l=n.y;if(this.quantization===Us.BITS12){i=to.multiplyByPoint(this.toScaledENU,i,js),i.x=ne.clamp(i.x,0,1),i.y=ne.clamp(i.y,0,1),i.z=ne.clamp(i.z,0,1);var c=this.maximumHeight-this.minimumHeight,h=ne.clamp((r-this.minimumHeight)/c,0,1);dt.fromElements(i.x,i.y,Vs);var d=Hs.compressTextureCoordinates(Vs);dt.fromElements(i.z,h,Vs);var m=Hs.compressTextureCoordinates(Vs);dt.fromElements(u,l,Vs);var f=Hs.compressTextureCoordinates(Vs);if(e[t++]=d,e[t++]=m,e[t++]=f,this.hasWebMercatorT){dt.fromElements(o,0,Vs);var v=Hs.compressTextureCoordinates(Vs);e[t++]=v}}else re.subtract(i,this.center,js),e[t++]=js.x,e[t++]=js.y,e[t++]=js.z,e[t++]=r,e[t++]=u,e[t++]=l,this.hasWebMercatorT&&(e[t++]=o);return this.hasVertexNormals&&(e[t++]=Hs.octPackFloat(a)),this.hasGeodeticSurfaceNormals&&(e[t++]=s.x,e[t++]=s.y,e[t++]=s.z),t}},{key:"addGeodeticSurfaceNormals",value:function(e,t,i){if(!this.hasGeodeticSurfaceNormals){var n=this.stride,r=e.length/n;this.hasGeodeticSurfaceNormals=!0,this._calculateStrideAndOffsets();for(var a=this.stride,o=0;o<r;o++){for(var s=0;s<n;s++){var u=o*n+s,l=o*a+s;t[l]=e[u]}var c=this.decodePosition(t,o,Xs),h=i.geodeticSurfaceNormal(c,Qs),d=o*a+this._offsetGeodeticSurfaceNormal;t[d]=h.x,t[d+1]=h.y,t[d+2]=h.z}}}},{key:"removeGeodeticSurfaceNormals",value:function(e,t){if(this.hasGeodeticSurfaceNormals){var i=this.stride,n=e.length/i;this.hasGeodeticSurfaceNormals=!1,this._calculateStrideAndOffsets();for(var r=this.stride,a=0;a<n;a++)for(var o=0;o<r;o++){var s=a*i+o,u=a*r+o;t[u]=e[s]}}}},{key:"decodePosition",value:function(e,t){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new re;if(s(i)||(i=new re),t*=this.stride,this.quantization===Us.BITS12){var n=Hs.decompressTextureCoordinates(e[t],Vs);i.x=n.x,i.y=n.y;var r=Hs.decompressTextureCoordinates(e[t+1],Vs);return i.z=r.x,to.multiplyByPoint(this.fromScaledENU,i,i)}return i.x=e[t],i.y=e[t+1],i.z=e[t+2],re.add(i,this.center,i)}},{key:"getExaggeratedPosition",value:function(e,t,i){i=this.decodePosition(e,t,i);var n=this.exaggeration,r=this.exaggerationRelativeHeight,a=1!==n;if(a&&this.hasGeodeticSurfaceNormals){var o=this.decodeGeodeticSurfaceNormal(e,t,Qs),s=this.decodeHeight(e,t),u=Bs.getHeight(s,n,r)-s;i.x+=o.x*u,i.y+=o.y*u,i.z+=o.z*u}return i}},{key:"decodeTextureCoordinates",value:function(e,t){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new dt;return s(i)||(i=new dt),t*=this.stride,this.quantization===Us.BITS12?Hs.decompressTextureCoordinates(e[t+2],i):dt.fromElements(e[t+4],e[t+5],i)}},{key:"decodeHeight",value:function(e,t){if(t*=this.stride,this.quantization===Us.BITS12){var i=Hs.decompressTextureCoordinates(e[t+1],Vs);return i.y*(this.maximumHeight-this.minimumHeight)+this.minimumHeight}return e[t+3]}},{key:"decodeWebMercatorT",value:function(e,t){return t*=this.stride,this.quantization===Us.BITS12?Hs.decompressTextureCoordinates(e[t+3],Vs).x:e[t+6]}},{key:"getOctEncodedNormal",value:function(e,t,i){t=t*this.stride+this._offsetVertexNormal;var n=e[t]/256,r=Math.floor(n),a=256*(n-r);return dt.fromElements(r,a,i)}},{key:"decodeGeodeticSurfaceNormal",value:function(e,t,i){return t=t*this.stride+this._offsetGeodeticSurfaceNormal,i.x=e[t],i.y=e[t+1],i.z=e[t+2],i}},{key:"_calculateStrideAndOffsets",value:function(){var e=0;switch(this.quantization){case Us.BITS12:e+=3;break;default:e+=6}this.hasWebMercatorT&&(e+=1),this.hasVertexNormals&&(this._offsetVertexNormal=e,e+=1),this.hasGeodeticSurfaceNormals&&(this._offsetGeodeticSurfaceNormal=e,e+=3),this.stride=e}},{key:"getAttributes",value:function(e){var t=zs.FLOAT,i=zs.getSizeInBytes(t),n=this.stride*i,r=0,a=[];function o(o,s){a.push({index:o,vertexBuffer:e,componentDatatype:t,componentsPerAttribute:s,offsetInBytes:r,strideInBytes:n}),r+=s*i}if(this.quantization===Us.NONE){o(Ks.position3DAndHeight,4);var s=2;s+=this.hasWebMercatorT?1:0,s+=this.hasVertexNormals?1:0,o(Ks.textureCoordAndEncodedNormals,s),this.hasGeodeticSurfaceNormals&&o(Ks.geodeticSurfaceNormal,3)}else{var u=this.hasWebMercatorT||this.hasVertexNormals,l=this.hasWebMercatorT&&this.hasVertexNormals;o(Js.compressed0,u?4:3),l&&o(Js.compressed1,1),this.hasGeodeticSurfaceNormals&&o(Js.geodeticSurfaceNormal,3)}return a}},{key:"getAttributeLocations",value:function(){return this.quantization===Us.NONE?Ks:Js}}],[{key:"clone",value:function(t,i){return s(i)||(i=new e),i.quantization=t.quantization,i.minimumHeight=t.minimumHeight,i.maximumHeight=t.maximumHeight,i.center=re.clone(t.center),i.toScaledENU=to.clone(t.toScaledENU),i.fromScaledENU=to.clone(t.fromScaledENU),i.matrix=to.clone(t.matrix),i.hasVertexNormals=t.hasVertexNormals,i.hasWebMercatorT=t.hasWebMercatorT,i.hasGeodeticSurfaceNormals=t.hasGeodeticSurfaceNormals,i.exaggeration=t.exaggeration,i.exaggerationRelativeHeight=t.exaggerationRelativeHeight,i._calculateStrideAndOffsets(),i}}]),e}(),eu={};eu.DEFAULT_STRUCTURE=Object.freeze({heightScale:1,heightOffset:0,elementsPerHeight:1,stride:1,elementMultiplier:256,isBigEndian:!1});var tu=new re,iu=new to,nu=new re,ru=new re;eu.computeVertices=function(e){if(!s(e)||!s(e.heightmap))throw new u("options.heightmap is required.");if(!s(e.width)||!s(e.height))throw new u("options.width and options.height are required.");if(!s(e.nativeRectangle))throw new u("options.nativeRectangle is required.");if(!s(e.skirtHeight))throw new u("options.skirtHeight is required.");var t,i,n,r,a=Math.cos,l=Math.sin,c=Math.sqrt,h=Math.atan,d=Math.exp,m=ne.PI_OVER_TWO,f=ne.toRadians,v=e.heightmap,g=e.width,p=e.height,y=e.skirtHeight,_=y>0,w=o(e.isGeographic,!0),T=o(e.ellipsoid,Ie.WGS84),x=1/T.maximumRadius,E=Oe.clone(e.nativeRectangle),S=Oe.clone(e.rectangle);s(S)?(t=S.west,i=S.south,n=S.east,r=S.north):w?(t=f(E.west),i=f(E.south),n=f(E.east),r=f(E.north)):(t=E.west*x,i=m-2*h(d(-E.south*x)),n=E.east*x,r=m-2*h(d(-E.north*x)));var b=e.relativeToCenter,I=s(b);b=I?b:re.ZERO;var R=o(e.includeWebMercatorT,!1),C=o(e.exaggeration,1),O=o(e.exaggerationRelativeHeight,0),k=1!==C,P=k,M=o(e.structure,eu.DEFAULT_STRUCTURE),N=o(M.heightScale,eu.DEFAULT_STRUCTURE.heightScale),A=o(M.heightOffset,eu.DEFAULT_STRUCTURE.heightOffset),D=o(M.elementsPerHeight,eu.DEFAULT_STRUCTURE.elementsPerHeight),L=o(M.stride,eu.DEFAULT_STRUCTURE.stride),U=o(M.elementMultiplier,eu.DEFAULT_STRUCTURE.elementMultiplier),F=o(M.isBigEndian,eu.DEFAULT_STRUCTURE.isBigEndian),H=Oe.computeWidth(E),z=Oe.computeHeight(E),q=H/(g-1),B=z/(p-1);w||(H*=x,z*=x);var j,W,V=T.radiiSquared,G=V.x,Y=V.y,Z=V.z,X=65536,Q=-65536,K=To.eastNorthUpToFixedFrame(b,T),J=to.inverseTransformation(K,iu);R&&(j=Un.geodeticLatitudeToMercatorAngle(i),W=1/(Un.geodeticLatitudeToMercatorAngle(r)-j));var $=nu;$.x=Number.POSITIVE_INFINITY,$.y=Number.POSITIVE_INFINITY,$.z=Number.POSITIVE_INFINITY;var ee=ru;ee.x=Number.NEGATIVE_INFINITY,ee.y=Number.NEGATIVE_INFINITY,ee.z=Number.NEGATIVE_INFINITY;var te=Number.POSITIVE_INFINITY,ie=g*p,ae=y>0?2*g+2*p:0,oe=ie+ae,se=new Array(oe),ue=new Array(oe),le=new Array(oe),ce=R?new Array(oe):[],he=P?new Array(oe):[],de=0,me=p,fe=0,ve=g;_&&(--de,++me,--fe,++ve);for(var ge=1e-5,pe=de;pe<me;++pe){var ye=pe;ye<0&&(ye=0),ye>=p&&(ye=p-1);var _e=E.north-B*ye;_e=w?f(_e):m-2*h(d(-_e*x));var we=(_e-i)/(r-i);we=ne.clamp(we,0,1);var Te=pe===de,xe=pe===me-1;y>0&&(Te?_e+=ge*z:xe&&(_e-=ge*z));var Ee=a(_e),Se=l(_e),be=Z*Se,Re=void 0;R&&(Re=(Un.geodeticLatitudeToMercatorAngle(_e)-j)*W);for(var Ce=fe;Ce<ve;++Ce){var ke=Ce;ke<0&&(ke=0),ke>=g&&(ke=g-1);var Pe=ye*(g*L)+ke*L,Me=void 0;if(1===D)Me=v[Pe];else{Me=0;var Ne=void 0;if(F)for(Ne=0;Ne<D;++Ne)Me=Me*U+v[Pe+Ne];else for(Ne=D-1;Ne>=0;--Ne)Me=Me*U+v[Pe+Ne]}Me=Me*N+A,Q=Math.max(Q,Me),X=Math.min(X,Me);var Ae=E.west+q*ke;w?Ae=f(Ae):Ae*=x;var De=(Ae-t)/(n-t);De=ne.clamp(De,0,1);var Le=ye*g+ke;if(y>0){var Ue=Ce===fe,Fe=Ce===ve-1,He=Te||xe||Ue||Fe,ze=(Te||xe)&&(Ue||Fe);if(ze)continue;He&&(Me-=y,Ue?(Le=ie+(p-ye-1),Ae-=ge*H):xe?Le=ie+p+(g-ke-1):Fe?(Le=ie+p+g+ye,Ae+=ge*H):Te&&(Le=ie+p+g+p+ke))}var qe=Ee*a(Ae),Be=Ee*l(Ae),je=G*qe,We=Y*Be,Ve=c(je*qe+We*Be+be*Se),Ge=1/Ve,Ye=je*Ge,Ze=We*Ge,Xe=be*Ge,Qe=new re;Qe.x=Ye+qe*Me,Qe.y=Ze+Be*Me,Qe.z=Xe+Se*Me,to.multiplyByPoint(J,Qe,tu),re.minimumByComponent(tu,$,$),re.maximumByComponent(tu,ee,ee),te=Math.min(te,Me),se[Le]=Qe,le[Le]=new dt(De,we),ue[Le]=Me,R&&(ce[Le]=Re),P&&(he[Le]=T.geodeticSurfaceNormal(Qe))}}var Ke,Je,$e=ht.fromPoints(se);if(s(S)&&(Ke=gs.fromRectangle(S,X,Q,T)),I){var et=new go(T);Je=et.computeHorizonCullingPointPossiblyUnderEllipsoid(b,se,X)}for(var tt=new eo($,ee,b),it=new $s(b,tt,te,Q,K,!1,R,P,C,O),nt=new Float32Array(oe*it.stride),rt=0,at=0;at<oe;++at)rt=it.encode(nt,rt,se[at],le[at],ue[at],void 0,ce[at],he[at]);return{vertices:nt,maximumHeight:Q,minimumHeight:X,encoding:it,boundingSphere3D:$e,orientedBoundingBox:Ke,occludeePointInScaledSpace:Je}};var au=eu,ou=(i("cb29"),{});(function(){var e=function(){var e={defaultNoDataValue:-34027999387901484e22,decode:function(a,o){o=o||{};var s=o.encodedMaskData||null===o.encodedMaskData,u=r(a,o.inputOffset||0,s),l=null!==o.noDataValue?o.noDataValue:e.defaultNoDataValue,c=t(u,o.pixelType||Float32Array,o.encodedMaskData,l,o.returnMask),h={width:u.width,height:u.height,pixelData:c.resultPixels,minValue:c.minValue,maxValue:u.pixels.maxValue,noDataValue:l};return c.resultMask&&(h.maskData=c.resultMask),o.returnEncodedMask&&u.mask&&(h.encodedMaskData=u.mask.bitset?u.mask.bitset:null),o.returnFileInfo&&(h.fileInfo=i(u),o.computeUsedBitDepths&&(h.fileInfo.bitDepths=n(u))),h}},t=function(e,t,i,n,r){var o,s,u=0,l=e.pixels.numBlocksX,c=e.pixels.numBlocksY,h=Math.floor(e.width/l),d=Math.floor(e.height/c),m=2*e.maxZError,f=Number.MAX_VALUE;i=i||(e.mask?e.mask.bitset:null);var v=new t(e.width*e.height);r&&i&&(s=new Uint8Array(e.width*e.height));for(var g,p,y=new Float32Array(h*d),_=0;_<=c;_++){var w=_!==c?d:e.height%c;if(0!==w)for(var T=0;T<=l;T++){var x=T!==l?h:e.width%l;if(0!==x){var E=_*e.width*d+T*h,S=e.width-x,b=e.pixels.blocks[u],I=void 0,R=void 0,C=void 0;b.encoding<2?(0===b.encoding?I=b.rawData:(a(b.stuffedData,b.bitsPerPixel,b.numValidPixels,b.offset,m,y,e.pixels.maxValue),I=y),R=0):C=2===b.encoding?0:b.offset;var O=void 0;if(i)for(p=0;p<w;p++){for(7&E&&(O=i[E>>3],O<<=7&E),g=0;g<x;g++)7&E||(O=i[E>>3]),128&O?(s&&(s[E]=1),o=b.encoding<2?I[R++]:C,f=f>o?o:f,v[E++]=o):(s&&(s[E]=0),v[E++]=n),O<<=1;E+=S}else if(b.encoding<2)for(p=0;p<w;p++){for(g=0;g<x;g++)o=I[R++],f=f>o?o:f,v[E++]=o;E+=S}else for(f=f>C?C:f,p=0;p<w;p++){for(g=0;g<x;g++)v[E++]=C;E+=S}if(1===b.encoding&&R!==b.numValidPixels)throw"Block and Mask do not match";u++}}}return{resultPixels:v,resultMask:s,minValue:f}},i=function(e){return{fileIdentifierString:e.fileIdentifierString,fileVersion:e.fileVersion,imageType:e.imageType,height:e.height,width:e.width,maxZError:e.maxZError,eofOffset:e.eofOffset,mask:e.mask?{numBlocksX:e.mask.numBlocksX,numBlocksY:e.mask.numBlocksY,numBytes:e.mask.numBytes,maxValue:e.mask.maxValue}:null,pixels:{numBlocksX:e.pixels.numBlocksX,numBlocksY:e.pixels.numBlocksY,numBytes:e.pixels.numBytes,maxValue:e.pixels.maxValue,noDataValue:e.noDataValue}}},n=function(e){for(var t=e.pixels.numBlocksX*e.pixels.numBlocksY,i={},n=0;n<t;n++){var r=e.pixels.blocks[n];0===r.encoding?i.float32=!0:1===r.encoding?i[r.bitsPerPixel]=!0:i[0]=!0}return Object.keys(i)},r=function(e,t,i){var n={},r=new Uint8Array(e,t,10);if(n.fileIdentifierString=String.fromCharCode.apply(null,r),"CntZImage"!==n.fileIdentifierString.trim())throw"Unexpected file identifier string: "+n.fileIdentifierString;t+=10;var a=new DataView(e,t,24);if(n.fileVersion=a.getInt32(0,!0),n.imageType=a.getInt32(4,!0),n.height=a.getUint32(8,!0),n.width=a.getUint32(12,!0),n.maxZError=a.getFloat64(16,!0),t+=24,!i)if(a=new DataView(e,t,16),n.mask={},n.mask.numBlocksY=a.getUint32(0,!0),n.mask.numBlocksX=a.getUint32(4,!0),n.mask.numBytes=a.getUint32(8,!0),n.mask.maxValue=a.getFloat32(12,!0),t+=16,n.mask.numBytes>0){var o=new Uint8Array(Math.ceil(n.width*n.height/8));a=new DataView(e,t,n.mask.numBytes);var s=a.getInt16(0,!0),u=2,l=0;do{if(s>0)while(s--)o[l++]=a.getUint8(u++);else{var c=a.getUint8(u++);s=-s;while(s--)o[l++]=c}s=a.getInt16(u,!0),u+=2}while(u<n.mask.numBytes);if(-32768!==s||l<o.length)throw"Unexpected end of mask RLE encoding";n.mask.bitset=o,t+=n.mask.numBytes}else 0===(n.mask.numBytes|n.mask.numBlocksY|n.mask.maxValue)&&(n.mask.bitset=new Uint8Array(Math.ceil(n.width*n.height/8)));a=new DataView(e,t,16),n.pixels={},n.pixels.numBlocksY=a.getUint32(0,!0),n.pixels.numBlocksX=a.getUint32(4,!0),n.pixels.numBytes=a.getUint32(8,!0),n.pixels.maxValue=a.getFloat32(12,!0),t+=16;var h=n.pixels.numBlocksX,d=n.pixels.numBlocksY,m=h+(n.width%h>0?1:0),f=d+(n.height%d>0?1:0);n.pixels.blocks=new Array(m*f);for(var v=0,g=0;g<f;g++)for(var p=0;p<m;p++){var y=0,_=e.byteLength-t;a=new DataView(e,t,Math.min(10,_));var w={};n.pixels.blocks[v++]=w;var T=a.getUint8(0);if(y++,w.encoding=63&T,w.encoding>3)throw"Invalid block encoding ("+w.encoding+")";if(2!==w.encoding){if(0!==T&&2!==T){if(T>>=6,w.offsetType=T,2===T)w.offset=a.getInt8(1),y++;else if(1===T)w.offset=a.getInt16(1,!0),y+=2;else{if(0!==T)throw"Invalid block offset type";w.offset=a.getFloat32(1,!0),y+=4}if(1===w.encoding)if(T=a.getUint8(y),y++,w.bitsPerPixel=63&T,T>>=6,w.numValidPixelsType=T,2===T)w.numValidPixels=a.getUint8(y),y++;else if(1===T)w.numValidPixels=a.getUint16(y,!0),y+=2;else{if(0!==T)throw"Invalid valid pixel count type";w.numValidPixels=a.getUint32(y,!0),y+=4}}if(t+=y,3!==w.encoding){var x=void 0,E=void 0;if(0===w.encoding){var S=(n.pixels.numBytes-1)/4;if(S!==Math.floor(S))throw"uncompressed block has invalid length";x=new ArrayBuffer(4*S),E=new Uint8Array(x),E.set(new Uint8Array(e,t,4*S));var b=new Float32Array(x);w.rawData=b,t+=4*S}else if(1===w.encoding){var I=Math.ceil(w.numValidPixels*w.bitsPerPixel/8),R=Math.ceil(I/4);x=new ArrayBuffer(4*R),E=new Uint8Array(x),E.set(new Uint8Array(e,t,I)),w.stuffedData=new Uint32Array(x),t+=I}}}else t++}return n.eofOffset=t,n},a=function(e,t,i,n,r,a,o){var s,u,l,c=(1<<t)-1,h=0,d=0,m=Math.ceil((o-n)/r),f=4*e.length-Math.ceil(t*i/8);for(e[e.length-1]<<=8*f,s=0;s<i;s++){if(0===d&&(l=e[h++],d=32),d>=t)u=l>>>d-t&c,d-=t;else{var v=t-d;u=(l&c)<<v&c,l=e[h++],d=32-v,u+=l>>>d}a[s]=u<m?n+u*r:o}return a};return e}(),t=function(){var e={unstuff:function(e,t,i,n,r,a,o,s){var u,l,c,h,d,m=(1<<i)-1,f=0,v=0,g=4*e.length-Math.ceil(i*n/8);if(e[e.length-1]<<=8*g,r)for(u=0;u<n;u++)0===v&&(c=e[f++],v=32),v>=i?(l=c>>>v-i&m,v-=i):(h=i-v,l=(c&m)<<h&m,c=e[f++],v=32-h,l+=c>>>v),t[u]=r[l];else for(d=Math.ceil((s-a)/o),u=0;u<n;u++)0===v&&(c=e[f++],v=32),v>=i?(l=c>>>v-i&m,v-=i):(h=i-v,l=(c&m)<<h&m,c=e[f++],v=32-h,l+=c>>>v),t[u]=l<d?a+l*o:s},unstuffLUT:function(e,t,i,n,r,a){var o,s=(1<<t)-1,u=0,l=0,c=0,h=0,d=0,m=[],f=4*e.length-Math.ceil(t*i/8);e[e.length-1]<<=8*f;var v=Math.ceil((a-n)/r);for(l=0;l<i;l++)0===h&&(o=e[u++],h=32),h>=t?(d=o>>>h-t&s,h-=t):(c=t-h,d=(o&s)<<c&s,o=e[u++],h=32-c,d+=o>>>h),m[l]=d<v?n+d*r:a;return m.unshift(n),m},unstuff2:function(e,t,i,n,r,a,o,s){var u,l,c,h,d=(1<<i)-1,m=0,f=0,v=0;if(r)for(u=0;u<n;u++)0===f&&(c=e[m++],f=32,v=0),f>=i?(l=c>>>v&d,f-=i,v+=i):(h=i-f,l=c>>>v&d,c=e[m++],f=32-h,l|=(c&(1<<h)-1)<<i-h,v=h),t[u]=r[l];else{var g=Math.ceil((s-a)/o);for(u=0;u<n;u++)0===f&&(c=e[m++],f=32,v=0),f>=i?(l=c>>>v&d,f-=i,v+=i):(h=i-f,l=c>>>v&d,c=e[m++],f=32-h,l|=(c&(1<<h)-1)<<i-h,v=h),t[u]=l<g?a+l*o:s}return t},unstuffLUT2:function(e,t,i,n,r,a){var o,s=(1<<t)-1,u=0,l=0,c=0,h=0,d=0,m=0,f=[],v=Math.ceil((a-n)/r);for(l=0;l<i;l++)0===h&&(o=e[u++],h=32,m=0),h>=t?(d=o>>>m&s,h-=t,m+=t):(c=t-h,d=o>>>m&s,o=e[u++],h=32-c,d|=(o&(1<<c)-1)<<t-c,m=c),f[l]=d<v?n+d*r:a;return f.unshift(n),f},originalUnstuff:function(e,t,i,n){var r,a,o,s,u=(1<<i)-1,l=0,c=0,h=4*e.length-Math.ceil(i*n/8);for(e[e.length-1]<<=8*h,r=0;r<n;r++)0===c&&(o=e[l++],c=32),c>=i?(a=o>>>c-i&u,c-=i):(s=i-c,a=(o&u)<<s&u,o=e[l++],c=32-s,a+=o>>>c),t[r]=a;return t},originalUnstuff2:function(e,t,i,n){var r,a,o,s,u=(1<<i)-1,l=0,c=0,h=0;for(r=0;r<n;r++)0===c&&(o=e[l++],c=32,h=0),c>=i?(a=o>>>h&u,c-=i,h+=i):(s=i-c,a=o>>>h&u,o=e[l++],c=32-s,a|=(o&(1<<s)-1)<<i-s,h=s),t[r]=a;return t}},t={HUFFMAN_LUT_BITS_MAX:12,computeChecksumFletcher32:function(e){var t=65535,i=65535,n=e.length,r=Math.floor(n/2),a=0;while(r){var o=r>=359?359:r;r-=o;do{t+=e[a++]<<8,i+=t+=e[a++]}while(--o);t=(65535&t)+(t>>>16),i=(65535&i)+(i>>>16)}return 1&n&&(i+=t+=e[a]<<8),t=(65535&t)+(t>>>16),i=(65535&i)+(i>>>16),(i<<16|t)>>>0},readHeaderInfo:function(e,t){var i=t.ptr,n=new Uint8Array(e,i,6),r={};if(r.fileIdentifierString=String.fromCharCode.apply(null,n),0!==r.fileIdentifierString.lastIndexOf("Lerc2",0))throw"Unexpected file identifier string (expect Lerc2 ): "+r.fileIdentifierString;i+=6;var a,o,s=new DataView(e,i,8),u=s.getInt32(0,!0);if(r.fileVersion=u,i+=4,u>=3&&(r.checksum=s.getUint32(4,!0),i+=4),s=new DataView(e,i,12),r.height=s.getUint32(0,!0),r.width=s.getUint32(4,!0),i+=8,u>=4?(r.numDims=s.getUint32(8,!0),i+=4):r.numDims=1,s=new DataView(e,i,40),r.numValidPixel=s.getUint32(0,!0),r.microBlockSize=s.getInt32(4,!0),r.blobSize=s.getInt32(8,!0),r.imageType=s.getInt32(12,!0),r.maxZError=s.getFloat64(16,!0),r.zMin=s.getFloat64(24,!0),r.zMax=s.getFloat64(32,!0),i+=40,t.headerInfo=r,t.ptr=i,u>=3&&(o=u>=4?52:48,a=this.computeChecksumFletcher32(new Uint8Array(e,i-o,r.blobSize-14)),a!==r.checksum))throw"Checksum failed.";return!0},checkMinMaxRanges:function(e,t){var i,n=t.headerInfo,r=this.getDataTypeArray(n.imageType),a=n.numDims*this.getDataTypeSize(n.imageType),o=this.readSubArray(e,t.ptr,r,a),s=this.readSubArray(e,t.ptr+a,r,a);t.ptr+=2*a;var u=!0;for(i=0;i<n.numDims;i++)if(o[i]!==s[i]){u=!1;break}return n.minValues=o,n.maxValues=s,u},readSubArray:function(e,t,i,n){var r;if(i===Uint8Array)r=new Uint8Array(e,t,n);else{var a=new ArrayBuffer(n),o=new Uint8Array(a);o.set(new Uint8Array(e,t,n)),r=new i(a)}return r},readMask:function(e,t){var i,n,r=t.ptr,a=t.headerInfo,o=a.width*a.height,s=a.numValidPixel,u=new DataView(e,r,4),l={};if(l.numBytes=u.getUint32(0,!0),r+=4,(0===s||o===s)&&0!==l.numBytes)throw"invalid mask";if(0===s)i=new Uint8Array(Math.ceil(o/8)),l.bitset=i,n=new Uint8Array(o),t.pixels.resultMask=n,r+=l.numBytes;else if(l.numBytes>0){i=new Uint8Array(Math.ceil(o/8)),u=new DataView(e,r,l.numBytes);var c=u.getInt16(0,!0),h=2,d=0,m=0;do{if(c>0)while(c--)i[d++]=u.getUint8(h++);else{m=u.getUint8(h++),c=-c;while(c--)i[d++]=m}c=u.getInt16(h,!0),h+=2}while(h<l.numBytes);if(-32768!==c||d<i.length)throw"Unexpected end of mask RLE encoding";n=new Uint8Array(o);var f=0,v=0;for(v=0;v<o;v++)7&v?(f=i[v>>3],f<<=7&v):f=i[v>>3],128&f&&(n[v]=1);t.pixels.resultMask=n,l.bitset=i,r+=l.numBytes}return t.ptr=r,t.mask=l,!0},readDataOneSweep:function(e,i,n){var r,a=i.ptr,o=i.headerInfo,s=o.numDims,u=o.width*o.height,l=o.imageType,c=o.numValidPixel*t.getDataTypeSize(l)*s,h=i.pixels.resultMask;if(n===Uint8Array)r=new Uint8Array(e,a,c);else{var d=new ArrayBuffer(c),m=new Uint8Array(d);m.set(new Uint8Array(e,a,c)),r=new n(d)}if(r.length===u*s)i.pixels.resultPixels=r;else{i.pixels.resultPixels=new n(u*s);var f=0,v=0,g=0,p=0;if(s>1)for(g=0;g<s;g++)for(p=g*u,v=0;v<u;v++)h[v]&&(i.pixels.resultPixels[p+v]=r[f++]);else for(v=0;v<u;v++)h[v]&&(i.pixels.resultPixels[v]=r[f++])}return a+=c,i.ptr=a,!0},readHuffmanTree:function(e,n){var r=this.HUFFMAN_LUT_BITS_MAX,a=new DataView(e,n.ptr,16);n.ptr+=16;var o=a.getInt32(0,!0);if(o<2)throw"unsupported Huffman version";var s=a.getInt32(4,!0),u=a.getInt32(8,!0),l=a.getInt32(12,!0);if(u>=l)return!1;var c=new Uint32Array(l-u);t.decodeBits(e,n,c);var h,d,m,f,v=[];for(h=u;h<l;h++)d=h-(h<s?0:s),v[d]={first:c[h-u],second:null};var g=e.byteLength-n.ptr,p=Math.ceil(g/4),y=new ArrayBuffer(4*p),_=new Uint8Array(y);_.set(new Uint8Array(e,n.ptr,g));var w,T=new Uint32Array(y),x=0,E=0;for(w=T[0],h=u;h<l;h++)d=h-(h<s?0:s),f=v[d].first,f>0&&(v[d].second=w<<x>>>32-f,32-x>=f?(x+=f,32===x&&(x=0,E++,w=T[E])):(x+=f-32,E++,w=T[E],v[d].second|=w>>>32-x));var S=0,b=0,I=new i;for(h=0;h<v.length;h++)void 0!==v[h]&&(S=Math.max(S,v[h].first));b=S>=r?r:S,S>=30&&console.log("WARning, large NUM LUT BITS IS "+S);var R,C,O,k,P,M,N=[];for(h=u;h<l;h++)if(d=h-(h<s?0:s),f=v[d].first,f>0)if(R=[f,d],f<=b)for(C=v[d].second<<b-f,O=1<<b-f,m=0;m<O;m++)N[C|m]=R;else for(C=v[d].second,M=I,k=f-1;k>=0;k--)P=C>>>k&1,P?(M.right||(M.right=new i),M=M.right):(M.left||(M.left=new i),M=M.left),0!==k||M.val||(M.val=R[1]);return{decodeLut:N,numBitsLUTQick:b,numBitsLUT:S,tree:I,stuffedData:T,srcPtr:E,bitPos:x}},readHuffman:function(e,t,i){var n,r,a,o,s,u,l,c,h,d,m=t.headerInfo,f=m.numDims,v=t.headerInfo.height,g=t.headerInfo.width,p=g*v,y=this.readHuffmanTree(e,t),_=y.decodeLut,w=y.tree,T=y.stuffedData,x=y.srcPtr,E=y.bitPos,S=y.numBitsLUTQick,b=y.numBitsLUT,I=0===t.headerInfo.imageType?128:0,R=t.pixels.resultMask,C=0;E>0&&(x++,E=0);var O,k=T[x],P=1===t.encodeMode,M=new i(p*f),N=M;for(O=0;O<m.numDims;O++){if(f>1&&(N=new i(M.buffer,p*O,p),C=0),t.headerInfo.numValidPixel===g*v)for(h=0,l=0;l<v;l++)for(c=0;c<g;c++,h++){if(r=0,o=k<<E>>>32-S,s=o,32-E<S&&(o|=T[x+1]>>>64-E-S,s=o),_[s])r=_[s][1],E+=_[s][0];else for(o=k<<E>>>32-b,s=o,32-E<b&&(o|=T[x+1]>>>64-E-b,s=o),n=w,d=0;d<b;d++)if(u=o>>>b-d-1&1,n=u?n.right:n.left,!n.left&&!n.right){r=n.val,E=E+d+1;break}E>=32&&(E-=32,x++,k=T[x]),a=r-I,P?(a+=c>0?C:l>0?N[h-g]:C,a&=255,N[h]=a,C=a):N[h]=a}else for(h=0,l=0;l<v;l++)for(c=0;c<g;c++,h++)if(R[h]){if(r=0,o=k<<E>>>32-S,s=o,32-E<S&&(o|=T[x+1]>>>64-E-S,s=o),_[s])r=_[s][1],E+=_[s][0];else for(o=k<<E>>>32-b,s=o,32-E<b&&(o|=T[x+1]>>>64-E-b,s=o),n=w,d=0;d<b;d++)if(u=o>>>b-d-1&1,n=u?n.right:n.left,!n.left&&!n.right){r=n.val,E=E+d+1;break}E>=32&&(E-=32,x++,k=T[x]),a=r-I,P?(c>0&&R[h-1]?a+=C:l>0&&R[h-g]?a+=N[h-g]:a+=C,a&=255,N[h]=a,C=a):N[h]=a}t.ptr=t.ptr+4*(x+1)+(E>0?4:0)}t.pixels.resultPixels=M},decodeBits:function(t,i,n,r,a){var o=i.headerInfo,s=o.fileVersion,u=0,l=t.byteLength-i.ptr>=5?5:t.byteLength-i.ptr,c=new DataView(t,i.ptr,l),h=c.getUint8(0);u++;var d=h>>6,m=0===d?4:3-d,f=(32&h)>0,v=31&h,g=0;if(1===m)g=c.getUint8(u),u++;else if(2===m)g=c.getUint16(u,!0),u+=2;else{if(4!==m)throw"Invalid valid pixel count type";g=c.getUint32(u,!0),u+=4}var p,y,_,w,T,x,E,S,b,I=2*o.maxZError,R=o.numDims>1?o.maxValues[a]:o.zMax;if(f){i.counter.lut++,S=c.getUint8(u),v,u++,w=Math.ceil((S-1)*v/8),T=Math.ceil(w/4),y=new ArrayBuffer(4*T),_=new Uint8Array(y),i.ptr+=u,_.set(new Uint8Array(t,i.ptr,w)),E=new Uint32Array(y),i.ptr+=w,b=0;while(S-1>>>b)b++;w=Math.ceil(g*b/8),T=Math.ceil(w/4),y=new ArrayBuffer(4*T),_=new Uint8Array(y),_.set(new Uint8Array(t,i.ptr,w)),p=new Uint32Array(y),i.ptr+=w,x=s>=3?e.unstuffLUT2(E,v,S-1,r,I,R):e.unstuffLUT(E,v,S-1,r,I,R),s>=3?e.unstuff2(p,n,b,g,x):e.unstuff(p,n,b,g,x)}else i.counter.bitstuffer++,b=v,i.ptr+=u,b>0&&(w=Math.ceil(g*b/8),T=Math.ceil(w/4),y=new ArrayBuffer(4*T),_=new Uint8Array(y),_.set(new Uint8Array(t,i.ptr,w)),p=new Uint32Array(y),i.ptr+=w,s>=3?null===r?e.originalUnstuff2(p,n,b,g):e.unstuff2(p,n,b,g,!1,r,I,R):null===r?e.originalUnstuff(p,n,b,g):e.unstuff(p,n,b,g,!1,r,I,R))},readTiles:function(e,i,n){var r=i.headerInfo,a=r.width,o=r.height,s=r.microBlockSize,u=r.imageType,l=t.getDataTypeSize(u),c=Math.ceil(a/s),h=Math.ceil(o/s);i.pixels.numBlocksY=h,i.pixels.numBlocksX=c,i.pixels.ptr=0;var d,m,f,v,g,p,y,_,w,T=0,x=0,E=0,S=0,b=0,I=0,R=0,C=0,O=0,k=0,P=0,M=0,N=0,A=0,D=0,L=0,U=new n(s*s),F=o%s||s,H=a%s||s,z=r.numDims,q=i.pixels.resultMask,B=i.pixels.resultPixels;for(E=0;E<h;E++)for(b=E!==h-1?s:F,S=0;S<c;S++)for(I=S!==c-1?s:H,P=E*a*s+S*s,M=a-I,w=0;w<z;w++){if(z>1&&(B=new n(i.pixels.resultPixels.buffer,a*o*w*l,a*o)),R=e.byteLength-i.ptr,d=new DataView(e,i.ptr,Math.min(10,R)),m={},L=0,C=d.getUint8(0),L++,O=C>>6&255,k=C>>2&15,k!==(S*s>>3&15))throw"integrity issue";if(p=3&C,p>3)throw i.ptr+=L,"Invalid block encoding ("+p+")";if(2!==p)if(0===p){if(i.counter.uncompressed++,i.ptr+=L,N=b*I*l,A=e.byteLength-i.ptr,N=N<A?N:A,f=new ArrayBuffer(N%l===0?N:N+l-N%l),v=new Uint8Array(f),v.set(new Uint8Array(e,i.ptr,N)),g=new n(f),D=0,q)for(T=0;T<b;T++){for(x=0;x<I;x++)q[P]&&(B[P]=g[D++]),P++;P+=M}else for(T=0;T<b;T++){for(x=0;x<I;x++)B[P++]=g[D++];P+=M}i.ptr+=D*l}else if(y=t.getDataTypeUsed(u,O),_=t.getOnePixel(m,L,y,d),L+=t.getDataTypeSize(y),3===p)if(i.ptr+=L,i.counter.constantoffset++,q)for(T=0;T<b;T++){for(x=0;x<I;x++)q[P]&&(B[P]=_),P++;P+=M}else for(T=0;T<b;T++){for(x=0;x<I;x++)B[P++]=_;P+=M}else if(i.ptr+=L,t.decodeBits(e,i,U,_,w),L=0,q)for(T=0;T<b;T++){for(x=0;x<I;x++)q[P]&&(B[P]=U[L++]),P++;P+=M}else for(T=0;T<b;T++){for(x=0;x<I;x++)B[P++]=U[L++];P+=M}else i.counter.constant++,i.ptr+=L}},formatFileInfo:function(e){return{fileIdentifierString:e.headerInfo.fileIdentifierString,fileVersion:e.headerInfo.fileVersion,imageType:e.headerInfo.imageType,height:e.headerInfo.height,width:e.headerInfo.width,numValidPixel:e.headerInfo.numValidPixel,microBlockSize:e.headerInfo.microBlockSize,blobSize:e.headerInfo.blobSize,maxZError:e.headerInfo.maxZError,pixelType:t.getPixelType(e.headerInfo.imageType),eofOffset:e.eofOffset,mask:e.mask?{numBytes:e.mask.numBytes}:null,pixels:{numBlocksX:e.pixels.numBlocksX,numBlocksY:e.pixels.numBlocksY,maxValue:e.headerInfo.zMax,minValue:e.headerInfo.zMin,noDataValue:e.noDataValue}}},constructConstantSurface:function(e){var t=e.headerInfo.zMax,i=e.headerInfo.numDims,n=e.headerInfo.height*e.headerInfo.width,r=n*i,a=0,o=0,s=0,u=e.pixels.resultMask;if(u)if(i>1)for(a=0;a<i;a++)for(s=a*n,o=0;o<n;o++)u[o]&&(e.pixels.resultPixels[s+o]=t);else for(o=0;o<n;o++)u[o]&&(e.pixels.resultPixels[o]=t);else if(e.pixels.resultPixels.fill)e.pixels.resultPixels.fill(t);else for(o=0;o<r;o++)e.pixels.resultPixels[o]=t},getDataTypeArray:function(e){var t;switch(e){case 0:t=Int8Array;break;case 1:t=Uint8Array;break;case 2:t=Int16Array;break;case 3:t=Uint16Array;break;case 4:t=Int32Array;break;case 5:t=Uint32Array;break;case 6:t=Float32Array;break;case 7:t=Float64Array;break;default:t=Float32Array}return t},getPixelType:function(e){var t;switch(e){case 0:t="S8";break;case 1:t="U8";break;case 2:t="S16";break;case 3:t="U16";break;case 4:t="S32";break;case 5:t="U32";break;case 6:t="F32";break;case 7:t="F64";break;default:t="F32"}return t},isValidPixelValue:function(e,t){if(null===t)return!1;var i;switch(e){case 0:i=t>=-128&&t<=127;break;case 1:i=t>=0&&t<=255;break;case 2:i=t>=-32768&&t<=32767;break;case 3:i=t>=0&&t<=65536;break;case 4:i=t>=-2147483648&&t<=2147483647;break;case 5:i=t>=0&&t<=4294967296;break;case 6:i=t>=-34027999387901484e22&&t<=34027999387901484e22;break;case 7:i=t>=5e-324&&t<=17976931348623157e292;break;default:i=!1}return i},getDataTypeSize:function(e){var t=0;switch(e){case 0:case 1:t=1;break;case 2:case 3:t=2;break;case 4:case 5:case 6:t=4;break;case 7:t=8;break;default:t=e}return t},getDataTypeUsed:function(e,t){var i=e;switch(e){case 2:case 4:i=e-t;break;case 3:case 5:i=e-2*t;break;case 6:i=0===t?e:1===t?2:1;break;case 7:i=0===t?e:e-2*t+1;break;default:i=e;break}return i},getOnePixel:function(e,t,i,n){var r=0;switch(i){case 0:r=n.getInt8(t);break;case 1:r=n.getUint8(t);break;case 2:r=n.getInt16(t,!0);break;case 3:r=n.getUint16(t,!0);break;case 4:r=n.getInt32(t,!0);break;case 5:r=n.getUInt32(t,!0);break;case 6:r=n.getFloat32(t,!0);break;case 7:r=n.getFloat64(t,!0);break;default:throw"the decoder does not understand this pixel type"}return r}},i=function e(t,i,n){Object(r["a"])(this,e),this.val=t,this.left=i,this.right=n},n={decode:function(e,i){i=i||{};var n=i.noDataValue,r=0,a={};if(a.ptr=i.inputOffset||0,a.pixels={},t.readHeaderInfo(e,a)){var o=a.headerInfo,s=o.fileVersion,u=t.getDataTypeArray(o.imageType);t.readMask(e,a),o.numValidPixel===o.width*o.height||a.pixels.resultMask||(a.pixels.resultMask=i.maskData);var l,c=o.width*o.height;if(a.pixels.resultPixels=new u(c*o.numDims),a.counter={onesweep:0,uncompressed:0,lut:0,bitstuffer:0,constant:0,constantoffset:0},0!==o.numValidPixel)if(o.zMax===o.zMin)t.constructConstantSurface(a);else if(s>=4&&t.checkMinMaxRanges(e,a))t.constructConstantSurface(a);else{var h=new DataView(e,a.ptr,2),d=h.getUint8(0);if(a.ptr++,d)t.readDataOneSweep(e,a,u);else if(s>1&&o.imageType<=1&&Math.abs(o.maxZError-.5)<1e-5){var m=h.getUint8(1);if(a.ptr++,a.encodeMode=m,m>2||s<4&&m>1)throw"Invalid Huffman flag "+m;m?t.readHuffman(e,a,u):t.readTiles(e,a,u)}else t.readTiles(e,a,u)}a.eofOffset=a.ptr,i.inputOffset?(l=a.headerInfo.blobSize+i.inputOffset-a.ptr,Math.abs(l)>=1&&(a.eofOffset=i.inputOffset+a.headerInfo.blobSize)):(l=a.headerInfo.blobSize-a.ptr,Math.abs(l)>=1&&(a.eofOffset=a.headerInfo.blobSize));var f={width:o.width,height:o.height,pixelData:a.pixels.resultPixels,minValue:o.zMin,maxValue:o.zMax,validPixelCount:o.numValidPixel,dimCount:o.numDims,dimStats:{minValues:o.minValues,maxValues:o.maxValues},maskData:a.pixels.resultMask};if(a.pixels.resultMask&&t.isValidPixelValue(o.imageType,n)){var v=a.pixels.resultMask;for(r=0;r<c;r++)v[r]||(f.pixelData[r]=n);f.noDataValue=n}return a.noDataValue=n,i.returnFileInfo&&(f.fileInfo=t.formatFileInfo(a)),f}},getBandCount:function(e){var i=0,n=0,r={ptr:0,pixels:{}};while(n<e.byteLength-58)t.readHeaderInfo(e,r),n+=r.headerInfo.blobSize,i++,r.ptr=n;return i}};return n}(),i=function(){var e=new ArrayBuffer(4),t=new Uint8Array(e),i=new Uint32Array(e);return i[0]=1,1===t[0]}(),n={decode:function(n,r){if(!i)throw"Big endian system is not supported.";r=r||{};var a,o,s=r.inputOffset||0,u=new Uint8Array(n,s,10),l=String.fromCharCode.apply(null,u);if("CntZImage"===l.trim())a=e,o=1;else{if("Lerc2"!==l.substring(0,5))throw"Unexpected file identifier string: "+l;a=t,o=2}var c,h,d,m,f,v,g=0,p=n.byteLength-10,y=[],_={width:0,height:0,pixels:[],pixelType:r.pixelType,mask:null,statistics:[]};while(s<p){var w=a.decode(n,{inputOffset:s,encodedMaskData:c,maskData:d,returnMask:0===g,returnEncodedMask:0===g,returnFileInfo:!0,pixelType:r.pixelType||null,noDataValue:r.noDataValue||null});s=w.fileInfo.eofOffset,0===g&&(c=w.encodedMaskData,d=w.maskData,_.width=w.width,_.height=w.height,_.dimCount=w.dimCount||1,_.pixelType=w.pixelType||w.fileInfo.pixelType,_.mask=w.maskData),o>1&&w.fileInfo.mask&&w.fileInfo.mask.numBytes>0&&y.push(w.maskData),g++,_.pixels.push(w.pixelData),_.statistics.push({minValue:w.minValue,maxValue:w.maxValue,noDataValue:w.noDataValue,dimStats:w.dimStats})}if(o>1&&y.length>1){for(v=_.width*_.height,_.bandMasks=y,d=new Uint8Array(v),d.set(y[0]),m=1;m<y.length;m++)for(h=y[m],f=0;f<v;f++)d[f]=d[f]&h[f];_.maskData=d}return _}};ou.Lerc=n})();var su,uu=ou.Lerc;function lu(e,t){if(e.encoding===su.LERC){var i;try{i=uu.decode(e.heightmap)}catch(o){throw new u(o)}var n=i.statistics[0];if(n.minValue===Number.MAX_VALUE)throw new u("Invalid tile data");e.heightmap=i.pixels[0],e.width=i.width,e.height=i.height}e.ellipsoid=Ie.clone(e.ellipsoid),e.rectangle=Oe.clone(e.rectangle);var r=au.computeVertices(e),a=r.vertices;return t.push(a.buffer),{vertices:a.buffer,numberOfAttributes:r.encoding.stride,minimumHeight:r.minimumHeight,maximumHeight:r.maximumHeight,gridWidth:e.width,gridHeight:e.height,boundingSphere3D:r.boundingSphere3D,orientedBoundingBox:r.orientedBoundingBox,occludeePointInScaledSpace:r.occludeePointInScaledSpace,encoding:r.encoding,westIndicesSouthToNorth:r.westIndicesSouthToNorth,southIndicesEastToWest:r.southIndicesEastToWest,eastIndicesNorthToSouth:r.eastIndicesNorthToSouth,northIndicesWestToEast:r.northIndicesWestToEast}}(function(e){e[e["NONE"]=0]="NONE",e[e["LERC"]=1]="LERC"})(su||(su={}));var cu,hu,du=function e(t,i,n,a,s,u,l,c,h){var d=arguments.length>9&&void 0!==arguments[9]?arguments[9]:6,m=arguments.length>10?arguments[10]:void 0,f=arguments.length>11?arguments[11]:void 0,v=arguments.length>12?arguments[12]:void 0,g=arguments.length>13?arguments[13]:void 0,p=arguments.length>14?arguments[14]:void 0,y=arguments.length>15?arguments[15]:void 0;Object(r["a"])(this,e),this.center=t,this.vertices=i,this.stride=o(d,6),this.indices=n,this.indexCountWithoutSkirts=a,this.vertexCountWithoutSkirts=s,this.minimumHeight=u,this.maximumHeight=l,this.boundingSphere3D=c,this.occludeePointInScaledSpace=h,this.orientedBoundingBox=m,this.encoding=f,this.westIndicesSouthToNorth=v,this.southIndicesEastToWest=g,this.eastIndicesNorthToSouth=p,this.northIndicesWestToEast=y},mu=function(){function e(t){Object(r["a"])(this,e),this._buffer=t.buffer,this._width=t.width,this._height=t.height,this._childTileMask=o(t.childTileMask,15),this._encoding=o(t.encoding,su.NONE);var i=au.DEFAULT_STRUCTURE,n=t.structure;s(n)?n!==i&&(n.heightScale=o(n.heightScale,i.heightScale),n.heightOffset=o(n.heightOffset,i.heightOffset),n.elementsPerHeight=o(n.elementsPerHeight,i.elementsPerHeight),n.stride=o(n.stride,i.stride),n.elementMultiplier=o(n.elementMultiplier,i.elementMultiplier),n.isBigEndian=o(n.isBigEndian,i.isBigEndian)):n=i,this._structure=n,this._createdByUpsampling=o(t.createdByUpsampling,!1),this._waterMask=t.waterMask,this._skirtHeight=void 0,this._bufferType=this._encoding===su.LERC?Float32Array:this._buffer.constructor,this._mesh=void 0}return Object(a["a"])(e,[{key:"createMesh",value:function(e){e=o(e,o.EMPTY_OBJECT);var t=e.tilingScheme,i=e.x,n=e.y,r=e.level,a=o(e.exaggeration,1),u=o(e.exaggerationRelativeHeight,0),l=(o(e.throttle,!0),t.ellipsoid),c=t.tileXYToNativeRectangle(i,n,r),h=t.tileXYToRectangle(i,n,r),d=l.cartographicToCartesian(Oe.center(h)),m=this._structure,f=Ja.getEstimatedLevelZeroGeometricErrorForAHeightmap(l,this._width,t.getNumberOfXTilesAtLevel(0)),v=f/(1<<r);this._skirtHeight=Math.min(4*v,1e3);var g=Mi(lu({heightmap:this._buffer,structure:m,includeWebMercatorT:!0,width:this._width,height:this._height,nativeRectangle:c,rectangle:h,relativeToCenter:d,ellipsoid:l,skirtHeight:this._skirtHeight,isGeographic:t.projection instanceof Ce,exaggeration:a,exaggerationRelativeHeight:u,encoding:this._encoding},[]));if(s(g)){var p=this;return Mi(g,(function(e){var t;p._skirtHeight>0&&(t=Ja.getRegularGridAndSkirtIndicesAndEdgeIndices(e.gridWidth,e.gridHeight));var i=e.gridWidth*e.gridHeight;return p._mesh=new du(d,new Float32Array(e.vertices),t.indices,t.indexCountWithoutSkirts,i,e.minimumHeight,e.maximumHeight,ht.clone(e.boundingSphere3D),re.clone(e.occludeePointInScaledSpace),e.numberOfAttributes,gs.clone(e.orientedBoundingBox),$s.clone(e.encoding),t.westIndicesSouthToNorth,t.southIndicesEastToWest,t.eastIndicesNorthToSouth,t.northIndicesWestToEast),p._buffer=void 0,p._mesh}))}}},{key:"_createMeshSync",value:function(e){var t=e.tilingScheme,i=e.x,n=e.y,r=e.level,a=o(e.exaggeration,1),s=o(e.exaggerationRelativeHeight,0),u=t.ellipsoid,l=t.tileXYToNativeRectangle(i,n,r),c=t.tileXYToRectangle(i,n,r),h=u.cartographicToCartesian(Oe.center(c)),d=this._structure,m=Ja.getEstimatedLevelZeroGeometricErrorForAHeightmap(u,this._width,t.getNumberOfXTilesAtLevel(0)),f=m/(1<<r);this._skirtHeight=Math.min(4*f,1e3);var v,g=au.computeVertices({heightmap:this._buffer,structure:d,includeWebMercatorT:!0,width:this._width,height:this._height,nativeRectangle:l,rectangle:c,relativeToCenter:h,ellipsoid:u,skirtHeight:this._skirtHeight,isGeographic:t.projection instanceof Ce,exaggeration:a,exaggerationRelativeHeight:s});this._buffer=void 0,v=this._skirtHeight>0?Ja.getRegularGridAndSkirtIndicesAndEdgeIndices(this._width,this._height):Ja.getRegularGridIndicesAndEdgeIndices(this._width,this._height);var p=g.gridWidth*g.gridHeight;return this._mesh=new du(h,g.vertices,v.indices,v.indexCountWithoutSkirts,p,g.minimumHeight,g.maximumHeight,g.boundingSphere3D,g.occludeePointInScaledSpace,g.encoding.stride,g.orientedBoundingBox,g.encoding,v.westIndicesSouthToNorth,v.southIndicesEastToWest,v.eastIndicesNorthToSouth,v.northIndicesWestToEast),this._mesh}},{key:"wasCreatedByUpsampling",value:function(){return this._createdByUpsampling}},{key:"isChildAvailable",value:function(e,t,i,n){if(!s(e))throw new u("thisX is required.");if(!s(t))throw new u("thisY is required.");if(!s(i))throw new u("childX is required.");if(!s(n))throw new u("childY is required.");var r=2;return i!==2*e&&++r,n!==2*t&&(r-=2),0!==(this._childTileMask&1<<r)}}]),e}(),fu=function(){function e(t){Object(r["a"])(this,e),t=o(t,o.EMPTY_OBJECT),this._tilingScheme=t.tilingScheme,s(this._tilingScheme)||(this._tilingScheme=new Zn({ellipsoid:o(t.ellipsoid,Ie.WGS84)})),this._levelZeroMaximumGeometricError=Ja.getEstimatedLevelZeroGeometricErrorForAHeightmap(this._tilingScheme.ellipsoid,64,this._tilingScheme.getNumberOfXTilesAtLevel(0)),this._errorEvent=new si,this._readyPromise=Mi.resolve(!0)}return Object(a["a"])(e,[{key:"errorEvent",get:function(){return this._errorEvent}},{key:"credit",get:function(){}},{key:"tilingScheme",get:function(){return this._tilingScheme}},{key:"ready",get:function(){return!0}},{key:"readyPromise",get:function(){return this._readyPromise}},{key:"hasWaterMask",get:function(){return!1}},{key:"hasVertexNormals",get:function(){return!1}},{key:"availability",get:function(){}},{key:"requestTileGeometry",value:function(e,t,i,n){var r=16,a=16;return Mi.resolve(new mu({buffer:new Uint8Array(r*a),width:r,height:a}))}},{key:"getLevelMaximumGeometricError",value:function(e){return this._levelZeroMaximumGeometricError/(1<<e)}},{key:"getTileDataAvailable",value:function(e,t,i){}},{key:"loadTileDataAvailability",value:function(e,t,i){}}]),e}(),vu=function(e){Object(Kn["a"])(i,e);var t=Object(Jn["a"])(i);function i(e){var n;return Object(r["a"])(this,i),n=t.call(this),n.destroyChildren=null===e||void 0===e?void 0:e.destroyChildren,n}return i}(n["t"]);(function(e){e[e["COLUMBUS_VIEW"]=1]="COLUMBUS_VIEW",e[e["MORPHING"]=0]="MORPHING",e[e["SCENE2D"]=2]="SCENE2D",e[e["SCENE3D"]=3]="SCENE3D"})(cu||(cu={})),function(e){e[e["NONE"]=-1]="NONE",e[e["PARTIAL"]=0]="PARTIAL",e[e["FULL"]=1]="FULL"}(hu||(hu={}));var gu,pu,yu=function(e){Object(Kn["a"])(i,e);var t=Object(Jn["a"])(i);function i(e,n){var a;return Object(r["a"])(this,i),a=t.call(this,e,n),a.derivedCommands={originalMaterial:a.material,oit:void 0,picking:void 0,oitMaterial:void 0,depth:void 0,basicMaterial:void 0},a.isCommand=!0,a.allowPicking=!0,a.isDrawMeshCommand=!0,a.frustumCulled=!1,a.frustumCulled=!1,a.owner=void 0,a}return Object(a["a"])(i,[{key:"levelId",get:function(){return this.owner.levelId}},{key:"compressVertices",value:function(){}},{key:"update",value:function(e){}}]),i}(n["r"]);function _u(e){var t,i=e.name,n=e.message;t=s(i)&&s(n)?i+": "+n:e.toString();var r=e.stack;return s(r)&&(t+="\n"+r),t}(function(e){e[e["START"]=0]="START",e[e["LOADING"]=1]="LOADING",e[e["DONE"]=2]="DONE",e[e["FAILED"]=3]="FAILED"})(gu||(gu={})),function(e){e[e["FAILED"]=0]="FAILED",e[e["UNLOADED"]=1]="UNLOADED",e[e["RECEIVING"]=2]="RECEIVING",e[e["RECEIVED"]=3]="RECEIVED",e[e["TRANSFORMING"]=4]="TRANSFORMING",e[e["TRANSFORMED"]=5]="TRANSFORMED",e[e["READY"]=6]="READY"}(pu||(pu={}));var wu,Tu=function(){function e(t,i,n,a,s){var u=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,l=arguments.length>6?arguments[6]:void 0;Object(r["a"])(this,e),this.provider=t,this.message=i,this.x=n,this.y=a,this.level=s,this.timesRetried=o(u,0),this.retry=!1,this.error=l}return Object(a["a"])(e,null,[{key:"handleError",value:function(t,i,n,r,a,o,u,l,c){var h=t;return s(t)?(h.provider=i,h.message=r,h.x=a,h.y=o,h.level=u,h.retry=!1,h.error=c,++h.timesRetried):h=new e(i,r,a,o,u,0,c),n.numberOfListeners>0?n.raiseEvent(h):console.log('An error occurred in "'+i.constructor.name+'": '+_u(r)),h.retry&&s(l)&&l(),h}},{key:"handleSuccess",value:function(e){s(e)&&(e.timesRetried=-1)}}]),e}();function xu(){}(function(e){e[e["UNLOADED"]=0]="UNLOADED",e[e["TRANSITIONING"]=1]="TRANSITIONING",e[e["RECEIVED"]=2]="RECEIVED",e[e["TEXTURE_LOADED"]=3]="TEXTURE_LOADED",e[e["READY"]=4]="READY",e[e["FAILED"]=5]="FAILED",e[e["INVALID"]=6]="INVALID",e[e["PLACEHOLDER"]=7]="PLACEHOLDER"})(wu||(wu={}));var Eu=new re,Su=new re,bu=new re,Iu=new me;function Ru(e,t,i,n,r,a){var o=e.getExaggeratedPosition(n,r,a);if(s(t)&&t!==cu.SCENE3D){var u=i.ellipsoid,l=u.cartesianToCartographic(o,Iu);o=i.project(l,a),o=re.fromElements(o.z,o.x,o.y,a)}return o}function Cu(e,t,i,n,r,a,o){e.vertexArray=Du._createVertexArrayForMesh(t,e.mesh),e.terrainState=pu.READY,e.fill=e.fill&&e.fill.destroy(o)}function Ou(e,t,i,n,r){var a=e.data,o=e.parent;if(a.terrainState===pu.FAILED&&void 0!==o){var s=void 0!==o.data&&void 0!==o.data.terrainData&&!1!==o.data.terrainData.canUpsample;s||Du.processStateMachine(o,t,i,n,r,!0)}if(a.terrainState===pu.FAILED&&Mu(a,e,t,i,e.x,e.y,e.level),a.terrainState===pu.UNLOADED&&Nu(a,i,e.x,e.y,e.level),a.terrainState===pu.RECEIVED&&Pu(a,t,i,e.x,e.y,e.level),a.terrainState===pu.TRANSFORMED&&Cu(a,t.context,i,e.x,e.y,e.level,r),a.terrainState>=pu.RECEIVED&&void 0===a.waterMaskTexture&&i.hasWaterMask){var u=a.terrainData;u.waterMask}}var ku={tilingScheme:void 0,x:0,y:0,level:0,exaggeration:1,exaggerationRelativeHeight:0,throttle:!0};function Pu(e,t,i,n,r,a){var o=i.tilingScheme,u=ku;u.tilingScheme=o,u.x=n,u.y=r,u.level=a,u.exaggeration=t.terrainExaggeration,u.exaggerationRelativeHeight=t.terrainExaggerationRelativeHeight,u.throttle=!0;var l=e.terrainData,c=l.createMesh(u);s(c)&&(e.terrainState=pu.TRANSFORMING,Mi(c,(function(t){e.mesh=t,e.terrainState=pu.TRANSFORMED}),(function(){e.terrainState=pu.FAILED})))}function Mu(e,t,i,n,r,a,o){var u=t.parent;if(u){var l=u.data.terrainData,c=u.x,h=u.y,d=u.level;if(s(l)){var m=l.upsample(n.tilingScheme,c,h,d,r,a,o);s(m)&&(e.terrainState=pu.RECEIVING,Mi(m,(function(t){e.terrainData=t,e.terrainState=pu.RECEIVED})))}}else t.state=gu.FAILED}function Nu(e,t,i,n,r){function a(t){e.terrainData=t,e.terrainState=pu.RECEIVED,e.request=void 0}function o(a){if(e.request.state===wi.CANCELLED)return e.terrainData=void 0,e.terrainState=pu.UNLOADED,void(e.request=void 0);e.terrainState=pu.FAILED,e.request=void 0;var o="Failed to obtain terrain tile X: "+i+" Y: "+n+" Level: "+r+'. Error message: "'+a+'"';t._requestError=Tu.handleError(t._requestError,t,t.errorEvent,o,i,n,r,u)}function u(){var u=new Ii({throttle:!1,throttleByServer:!0,type:Ti.TERRAIN});e.request=u;var l=t.requestTileGeometry(i,n,r,u);s(l)?(e.terrainState=pu.RECEIVING,Mi(l,a,o)):(e.terrainState=pu.UNLOADED,e.request=void 0)}u()}function Au(e,t,i){var n=t.getTileDataAvailable(e.x,e.y,e.level);if(!s(n)&&s(e.parent)){var r=e.parent,a=r.data;s(a)&&s(a.terrainData)&&(n=a.terrainData.isChildAvailable(r.x,r.y,e.x,e.y))}!1===n&&(e.data.terrainState=pu.FAILED);for(var o=0,u=i.length;o<u;++o){var l=i.get(o);l.show&&l._createTileImagerySkeletons(e,t)}}var Du=function(){function e(){Object(r["a"])(this,e),this.imagery=[],this.terrainData=void 0,this.vertexArray=void 0,this.tileBoundingRegion=void 0,this.occludeePointInScaledSpace=new re,this.boundingVolumeSourceTile=void 0,this.boundingVolumeIsFromMesh=!1,this.terrainState=pu.UNLOADED,this.mesh=void 0,this.fill=void 0,this.pickBoundingSphere=new ht,this.surfaceShader=void 0,this.isClipped=!0,this.clippedByBoundaries=!1}return Object(a["a"])(e,[{key:"renderedMesh",get:function(){return s(this.vertexArray)?this.mesh:s(this.fill)?this.fill.mesh:void 0}},{key:"freeVertexArray",value:function(){e._freeVertexArray(this.vertexArray),this.vertexArray=void 0,e._freeVertexArray(this.wireframeVertexArray),this.wireframeVertexArray=void 0}},{key:"processImagery",value:function(e,t,i,n){var r,a,o=e.data,u=e.upsampledFromParent,l=!1,c=!0,h=o.imagery;for(r=0,a=h.length;r<a;++r){var d=h[r];if(s(d.loadingImagery)){if(d.loadingImagery.state===wu.PLACEHOLDER){var m=d.loadingImagery.imageryLayer;if(m.imageryProvider.ready){d.freeResources(),h.splice(r,1),m._createTileImagerySkeletons(e,t,r),--r,a=h.length;continue}u=!1}var f=d.processStateMachine(e,i,n);c=c&&f,l=l||f||s(d.readyImagery),u=u&&s(d.loadingImagery)&&(d.loadingImagery.state===wu.FAILED||d.loadingImagery.state===wu.INVALID)}else u=!1}return e.upsampledFromParent=u,e.renderable=e.renderable&&(l||c),c}},{key:"freeResources",value:function(){this.terrainData=void 0,this.terrainState=pu.UNLOADED,this.mesh=void 0,this.fill=this.fill&&this.fill.destroy();for(var e=this.imagery,t=0,i=e.length;t<i;++t)e[t].freeResources();this.imagery.length=0,this.freeVertexArray()}},{key:"pick",value:function(e,t,i,n,r){var a=this.renderedMesh;if(s(a)){for(var o=a.vertices,u=a.indices,l=a.encoding,c=u.length,h=Number.MAX_VALUE,d=0;d<c;d+=3){var m=u[d],f=u[d+1],v=u[d+2],g=Ru(l,t,i,o,m,Eu),p=Ru(l,t,i,o,f,Su),y=Ru(l,t,i,o,v,bu),_=bt.rayTriangleParametric(e,g,p,y,n);s(_)&&_<h&&_>=0&&(h=_)}return h!==Number.MAX_VALUE?St.getPoint(e,h,r):void 0}}}],[{key:"_freeVertexArray",value:function(e){if(s(e)){var t=e.index,i=e.attributes;for(var n in i)i[n].data.array=[];s(t)&&(t.array=[]),e.dispose()}}},{key:"initialize",value:function(t,i,n){var r=t.data;s(r)||(r=t.data=new e),t.state===gu.START&&(Au(t,i,n),t.state=gu.LOADING)}},{key:"processStateMachine",value:function(t,i,n,r,a,o){e.initialize(t,n,r);var u=t.data;if(t.state===gu.LOADING&&Ou(t,i,n,r,a),!o){var l=t.renderable;t.renderable=s(u.vertexArray);var c=u.terrainState===pu.READY;t.upsampledFromParent=s(u.terrainData)&&u.terrainData.wasCreatedByUpsampling();var h=u.processImagery(t,n,i);if(c&&h){var d=t._loadedCallbacks,m={};for(var f in d)d.hasOwnProperty(f)&&(d[f](t)||(m[f]=d[f]));t._loadedCallbacks=m,t.state=gu.DONE}l&&(t.renderable=!0)}}},{key:"_createVertexArrayForMesh",value:function(e,t){var i=t.vertices,r=new n["c"],a=t.encoding.getAttributes([]),o=t.indices.indexBuffers||{},u=o[e.id];if(s(u)?++u.referenceCount:(u=new n["J"](t.indices,1).onUpload(xu),o[e.id]=u,t.indices.indexBuffers=o),r.setIndex(u),t.encoding.quantization===Us.BITS12){var l=new n["i"](i,4).onUpload(xu);r.setAttribute("compressed0",l)}else{var c=new n["l"](i,a[0].componentsPerAttribute+a[1].componentsPerAttribute),h=new n["m"](c,a[0].componentsPerAttribute,0,!1),d=new n["m"](c,a[1].componentsPerAttribute,a[0].componentsPerAttribute,!1);r.setAttribute("position3DAndHeight",h),r.setAttribute("textureCoordAndEncodedNormals",d)}return t.geometry=r,r}}]),e}();function Lu(e,t,i){var n,r,a=0,o=e.length-1;while(a<=o)if(n=~~((a+o)/2),r=i(e[n],t),r<0)a=n+1;else{if(!(r>0))return n;o=n-1}return~(o+1)}var Uu,Fu,Hu=function(){function e(){Object(r["a"])(this,e),this._array=[],this._offset=0,this._length=0}return Object(a["a"])(e,[{key:"length",get:function(){return this._length}},{key:"enqueue",value:function(e){this._array.push(e),this._length++}},{key:"dequeue",value:function(){if(0!==this._length){var e=this._array,t=this._offset,i=e[t];return e[t]=void 0,t++,t>10&&2*t>e.length&&(this._array=e.slice(t),t=0),this._offset=t,this._length--,i}}},{key:"peek",value:function(){if(0!==this._length)return this._array[this._offset]}},{key:"contains",value:function(e){return-1!==this._array.indexOf(e)}},{key:"clear",value:function(){this._array.length=this._offset=this._length=0}},{key:"sort",value:function(e){this._offset>0&&(this._array=this._array.slice(this._offset),this._offset=0),this._array.sort(e)}}]),e}();(function(e){e[e["WEST"]=0]="WEST",e[e["NORTH"]=1]="NORTH",e[e["EAST"]=2]="EAST",e[e["SOUTH"]=3]="SOUTH",e[e["NORTHWEST"]=4]="NORTHWEST",e[e["NORTHEAST"]=5]="NORTHEAST",e[e["SOUTHWEST"]=6]="SOUTHWEST",e[e["SOUTHEAST"]=7]="SOUTHEAST"})(Uu||(Uu={})),function(e){e[e["NONE"]=0]="NONE",e[e["CULLED"]=1]="CULLED",e[e["RENDERED"]=2]="RENDERED",e[e["REFINED"]=3]="REFINED",e[e["RENDERED_AND_KICKED"]=6]="RENDERED_AND_KICKED",e[e["REFINED_AND_KICKED"]=7]="REFINED_AND_KICKED",e[e["CULLED_BUT_NEEDED"]=9]="CULLED_BUT_NEEDED"}(Fu||(Fu={}));var zu={NONE:0,CULLED:1,RENDERED:2,REFINED:3,RENDERED_AND_KICKED:6,REFINED_AND_KICKED:7,CULLED_BUT_NEEDED:9,wasKicked:function(e){return e>=zu.RENDERED_AND_KICKED},originalResult:function(e){return 3&e},kick:function(e){return 4|e}},qu=zu;function Bu(e){this.tile=e,this.frameLastUpdated=void 0,this.westMeshes=[],this.westTiles=[],this.southMeshes=[],this.southTiles=[],this.eastMeshes=[],this.eastTiles=[],this.northMeshes=[],this.northTiles=[],this.southwestMesh=void 0,this.southwestTile=void 0,this.southeastMesh=void 0,this.southeastTile=void 0,this.northwestMesh=void 0,this.northwestTile=void 0,this.northeastMesh=void 0,this.northeastTile=void 0,this.changedThisFrame=!0,this.visitedFrame=void 0,this.enqueuedFrame=void 0,this.mesh=void 0,this.vertexArray=void 0,this.waterMaskTexture=void 0,this.waterMaskTranslationAndScale=new po}Bu.prototype.update=function(e,t,i){this.changedThisFrame&&(cl(e,t,this.tile,i),this.changedThisFrame=!1)},Bu.prototype.destroy=function(e){this._destroyVertexArray(e),s(this.waterMaskTexture)&&(--this.waterMaskTexture.referenceCount,0===this.waterMaskTexture.referenceCount&&this.waterMaskTexture.destroy(),this.waterMaskTexture=void 0)},Bu.prototype._destroyVertexArray=function(e){s(this.vertexArray)&&(s(e)?e.push(this.vertexArray):Du._freeVertexArray(this.vertexArray),this.vertexArray=void 0)};var ju=new Hu;function Wu(e,t,i,n,r,a,o,l,c){if(void 0!==n){var h=n;while(h&&(h._lastSelectionResultFrame!==r||qu.wasKicked(h._lastSelectionResult)||qu.originalResult(h._lastSelectionResult)===qu.CULLED)){if(o)return;var d=h.parent;if(a>=Uu.NORTHWEST&&void 0!==d)switch(a){case Uu.NORTHWEST:h=h===d.northwestChild?d:void 0;break;case Uu.NORTHEAST:h=h===d.northeastChild?d:void 0;break;case Uu.SOUTHWEST:h=h===d.southwestChild?d:void 0;break;case Uu.SOUTHEAST:h=h===d.southeastChild?d:void 0;break}else h=d}if(void 0!==h)if(h._lastSelectionResult!==qu.RENDERED){if(qu.originalResult(n._lastSelectionResult)!==qu.CULLED)switch(a){case Uu.WEST:Wu(e,t,i,n.northwestChild,r,a,!0,l,c),Wu(e,t,i,n.southwestChild,r,a,!0,l,c);break;case Uu.EAST:Wu(e,t,i,n.southeastChild,r,a,!0,l,c),Wu(e,t,i,n.northeastChild,r,a,!0,l,c);break;case Uu.SOUTH:Wu(e,t,i,n.southwestChild,r,a,!0,l,c),Wu(e,t,i,n.southeastChild,r,a,!0,l,c);break;case Uu.NORTH:Wu(e,t,i,n.northeastChild,r,a,!0,l,c),Wu(e,t,i,n.northwestChild,r,a,!0,l,c);break;case Uu.NORTHWEST:Wu(e,t,i,n.northwestChild,r,a,!0,l,c);break;case Uu.NORTHEAST:Wu(e,t,i,n.northeastChild,r,a,!0,l,c);break;case Uu.SOUTHWEST:Wu(e,t,i,n.southwestChild,r,a,!0,l,c);break;case Uu.SOUTHEAST:Wu(e,t,i,n.southeastChild,r,a,!0,l,c);break;default:throw new u("Invalid edge")}}else{if(s(h.data.vertexArray))return;Vu(e,t,i,h,a,r,l,c)}}}function Vu(e,t,i,n,r,a,o,s){var u=n.data;if(void 0===u.fill)u.fill=new Bu(n);else if(u.fill.visitedFrame===a)return;u.fill.enqueuedFrame!==a&&(u.fill.enqueuedFrame=a,u.fill.changedThisFrame=!1,o.enqueue(n)),Gu(e,t,i,n,r,s)}function Gu(e,t,i,n,r,a){var o,u,l,c,h,d,m,f=n.data.fill,v=i.data.fill;switch(s(v)?(v.visitedFrame=t.frameNumber,v.changedThisFrame&&(cl(e,t,i,a),v.changedThisFrame=!1),o=i.data.fill.mesh):o=i.data.mesh,r){case Uu.WEST:u=f.westMeshes,l=f.westTiles;break;case Uu.SOUTH:u=f.southMeshes,l=f.southTiles;break;case Uu.EAST:u=f.eastMeshes,l=f.eastTiles;break;case Uu.NORTH:u=f.northMeshes,l=f.northTiles;break;case Uu.NORTHWEST:return f.changedThisFrame=f.changedThisFrame||f.northwestMesh!==o,f.northwestMesh=o,void(f.northwestTile=i);case Uu.NORTHEAST:return f.changedThisFrame=f.changedThisFrame||f.northeastMesh!==o,f.northeastMesh=o,void(f.northeastTile=i);case Uu.SOUTHWEST:return f.changedThisFrame=f.changedThisFrame||f.southwestMesh!==o,f.southwestMesh=o,void(f.southwestTile=i);case Uu.SOUTHEAST:return f.changedThisFrame=f.changedThisFrame||f.southeastMesh!==o,f.southeastMesh=o,void(f.southeastTile=i)}if(i.level<=n.level)return f.changedThisFrame=f.changedThisFrame||u[0]!==o||1!==u.length,u[0]=o,l[0]=i,u.length=1,void(l.length=1);var g,p=i.rectangle,y=n.rectangle;switch(r){case Uu.WEST:for(g=(y.north-y.south)*ne.EPSILON5,c=0;c<l.length;++c)if(d=l[c],m=d.rectangle,ne.greaterThan(p.north,m.south,g))break;for(h=c;h<l.length;++h)if(d=l[h],m=d.rectangle,ne.greaterThanOrEquals(p.south,m.north,g))break;break;case Uu.SOUTH:for(g=(y.east-y.west)*ne.EPSILON5,c=0;c<l.length;++c)if(d=l[c],m=d.rectangle,ne.lessThan(p.west,m.east,g))break;for(h=c;h<l.length;++h)if(d=l[h],m=d.rectangle,ne.lessThanOrEquals(p.east,m.west,g))break;break;case Uu.EAST:for(g=(y.north-y.south)*ne.EPSILON5,c=0;c<l.length;++c)if(d=l[c],m=d.rectangle,ne.lessThan(p.south,m.north,g))break;for(h=c;h<l.length;++h)if(d=l[h],m=d.rectangle,ne.lessThanOrEquals(p.north,m.south,g))break;break;case Uu.NORTH:for(g=(y.east-y.west)*ne.EPSILON5,c=0;c<l.length;++c)if(d=l[c],m=d.rectangle,ne.greaterThan(p.east,m.west,g))break;for(h=c;h<l.length;++h)if(d=l[h],m=d.rectangle,ne.greaterThanOrEquals(p.west,m.east,g))break;break}h-c===1?(f.changedThisFrame=f.changedThisFrame||u[c]!==o,u[c]=o,l[c]=i):(f.changedThisFrame=!0,u.splice(c,h-c,o),l.splice(c,h-c,i))}Bu.updateFillTiles=function(e,t,i,n){var r=e._quadtree,a=r._levelZeroTiles,o=r._lastSelectionFrameNumber,u=ju;u.clear();for(var l=0;l<t.length;++l){var c=t[l];s(c.data.vertexArray)&&u.enqueue(t[l])}var h=u.dequeue();while(void 0!==h){var d=h.findTileToWest(a),m=h.findTileToSouth(a),f=h.findTileToEast(a),v=h.findTileToNorth(a);Wu(e,i,h,d,o,Uu.EAST,!1,u,n),Wu(e,i,h,m,o,Uu.NORTH,!1,u,n),Wu(e,i,h,f,o,Uu.WEST,!1,u,n),Wu(e,i,h,v,o,Uu.SOUTH,!1,u,n);var g=d.findTileToNorth(a),p=d.findTileToSouth(a),y=f.findTileToNorth(a),_=f.findTileToSouth(a);Wu(e,i,h,g,o,Uu.SOUTHEAST,!1,u,n),Wu(e,i,h,y,o,Uu.SOUTHWEST,!1,u,n),Wu(e,i,h,p,o,Uu.NORTHEAST,!1,u,n),Wu(e,i,h,_,o,Uu.NORTHWEST,!1,u,n),h=u.dequeue()}};var Yu=new me,Zu=new me,Xu=new re,Qu=new re,Ku=new dt,Ju=new dt,$u=new dt;function el(){this.height=0,this.encodedNormal=new dt}function tl(e,t,i,n,r,a,o,u,l){if(s(r))return r;var c;if(s(a)&&s(o))c=.5*(a.height+o.height);else if(s(a))c=a.height;else if(s(o))c=o.height;else if(s(u))c=u.height;else{var h=e.tile.data,d=h.tileBoundingRegion,m=0,f=0;s(d)&&(m=d.minimumHeight,f=d.maximumHeight),c=.5*(m+f)}return _l(e,t,i,n,c,l),l}var il={minimumHeight:0,maximumHeight:0},nl=new re,rl=new el,al=new el,ol=new el,sl=new el,ul="undefined"!==typeof Uint8Array?new Uint8Array(81):void 0,ll={tilingScheme:void 0,x:0,y:0,level:0,exaggeration:1,exaggerationRelativeHeight:0};function cl(e,t,i,n){Du.initialize(i,e.terrainProvider,e._imageryLayers);var r=i.data,a=r.fill,o=i.rectangle,u=t.terrainExaggeration,l=t.terrainExaggerationRelativeHeight,c=1!==u,h=i.tilingScheme.ellipsoid,d=wl(a,h,0,1,a.northwestTile,a.northwestMesh,a.northTiles,a.northMeshes,a.westTiles,a.westMeshes,ol),m=wl(a,h,0,0,a.southwestTile,a.southwestMesh,a.westTiles,a.westMeshes,a.southTiles,a.southMeshes,rl),f=wl(a,h,1,0,a.southeastTile,a.southeastMesh,a.southTiles,a.southMeshes,a.eastTiles,a.eastMeshes,al),v=wl(a,h,1,1,a.northeastTile,a.northeastMesh,a.eastTiles,a.eastMeshes,a.northTiles,a.northMeshes,sl);d=tl(a,h,0,1,d,m,v,f,ol),m=tl(a,h,0,0,m,d,f,v,rl),f=tl(a,h,1,1,f,m,v,d,al),v=tl(a,h,1,1,v,f,d,m,sl);var g,p,y=m.height,_=f.height,w=d.height,T=v.height,x=Math.min(y,_,w,T),E=Math.max(y,_,w,T),S=.5*(x+E),b=e.getLevelMaximumGeometricError(i.level),I=h.maximumRadius-b,R=4*Math.acos(I/h.maximumRadius);if(R*=1.5,o.width>R&&E-x<=b){var C=new mu({width:9,height:9,buffer:ul,structure:{heightOffset:E}}),O=ll;O.tilingScheme=i.tilingScheme,O.x=i.x,O.y=i.y,O.level=i.level,O.exaggeration=u,O.exaggerationRelativeHeight=l,a.mesh=C._createMeshSync(O)}else{var k=c,P=Oe.center(o,Zu);P.height=S;var M,N=h.cartographicToCartesian(P,nl),A=new $s(N,void 0,void 0,void 0,void 0,!0,!0,k,u,l),D=5;for(M=a.westMeshes,g=0,p=M.length;g<p;++g)D+=M[g].eastIndicesNorthToSouth.length;for(M=a.southMeshes,g=0,p=M.length;g<p;++g)D+=M[g].northIndicesWestToEast.length;for(M=a.eastMeshes,g=0,p=M.length;g<p;++g)D+=M[g].westIndicesSouthToNorth.length;for(M=a.northMeshes,g=0,p=M.length;g<p;++g)D+=M[g].southIndicesEastToWest.length;var L=il;L.minimumHeight=x,L.maximumHeight=E;var U=A.stride,F=new Float32Array(D*U),H=0,z=H;H=hl(h,o,A,F,H,0,1,d.height,d.encodedNormal,1,L),H=xl(a,h,A,F,H,a.westTiles,a.westMeshes,Uu.EAST,L);var q=H;H=hl(h,o,A,F,H,0,0,m.height,m.encodedNormal,0,L),H=xl(a,h,A,F,H,a.southTiles,a.southMeshes,Uu.NORTH,L);var B=H;H=hl(h,o,A,F,H,1,0,f.height,f.encodedNormal,0,L),H=xl(a,h,A,F,H,a.eastTiles,a.eastMeshes,Uu.WEST,L);var j=H;H=hl(h,o,A,F,H,1,1,v.height,v.encodedNormal,1,L),H=xl(a,h,A,F,H,a.northTiles,a.northMeshes,Uu.SOUTH,L),x=L.minimumHeight,E=L.maximumHeight;var W=gs.fromRectangle(o,x,E,i.tilingScheme.ellipsoid),V=Un.geodeticLatitudeToMercatorAngle(o.south),G=1/(Un.geodeticLatitudeToMercatorAngle(o.north)-V),Y=(Un.geodeticLatitudeToMercatorAngle(P.latitude)-V)*G,Z=h.geodeticSurfaceNormalCartographic(Yu,Qu),X=Hs.octEncode(Z,Ku),Q=H;A.encode(F,H*U,W.center,dt.fromElements(.5,.5,$u),S,X,Y,Z),++H;var K,J=H,$=J<256?1:2,ee=3*(J-1),te=ee*$,ie=(F.length-J*U)*Float32Array.BYTES_PER_ELEMENT;if(ie>=te){var ne=J*U*Float32Array.BYTES_PER_ELEMENT;K=J<256?new Uint8Array(F.buffer,ne,ee):new Uint16Array(F.buffer,ne,ee)}else K=J<256?new Uint8Array(ee):new Uint16Array(ee);F=new Float32Array(F.buffer,0,J*U);var re=0;for(g=0;g<J-2;++g)K[re++]=Q,K[re++]=g,K[re++]=g+1;K[re++]=Q,K[re++]=g,K[re++]=0;var ae=[];for(g=q;g>=z;--g)ae.push(g);var oe=[];for(g=B;g>=q;--g)oe.push(g);var se=[];for(g=j;g>=B;--g)se.push(g);var ue=[];for(ue.push(0),g=Q-1;g>=j;--g)ue.push(g);a.mesh=new du(A.center,F,K,ee,J,x,E,ht.fromOrientedBoundingBox(W),Cl(e,W.center,o,x,E),A.stride,W,A,ae,oe,se,ue)}var le=t.context;a._destroyVertexArray(n),a.vertexArray=Du._createVertexArrayForMesh(le,a.mesh),r.processImagery(i,e.terrainProvider,t,!0);var ce=a.waterMaskTexture;if(a.waterMaskTexture=void 0,e.terrainProvider.hasWaterMask){var he=r._findAncestorTileWithTerrainData(i);s(he)&&s(he.data.waterMaskTexture)&&(a.waterMaskTexture=he.data.waterMaskTexture,++a.waterMaskTexture.referenceCount,r._computeWaterMaskTranslationAndScale(i,he,a.waterMaskTranslationAndScale))}s(ce)&&(--ce.referenceCount,0===ce.referenceCount&&ce.destroy())}function hl(e,t,i,n,r,a,o,s,u,l,c){var h=Yu;h.longitude=ne.lerp(t.west,t.east,a),h.latitude=ne.lerp(t.south,t.north,o),h.height=s;var d,m=e.cartographicToCartesian(h,Xu);i.hasGeodeticSurfaceNormals&&(d=e.geodeticSurfaceNormal(m,Qu));var f=Ju;return f.x=a,f.y=o,i.encode(n,r*i.stride,m,f,s,u,l,d),c.minimumHeight=Math.min(c.minimumHeight,s),c.maximumHeight=Math.max(c.maximumHeight,s),r+1}var dl=new Oe;function ml(e,t,i,n){var r=e.rectangle,a=t.rectangle;0===t.x&&1===i.x&&e.x===e.tilingScheme.getNumberOfXTilesAtLevel(e.level)-1?(r=Oe.clone(e.rectangle,dl),r.west-=ne.TWO_PI,r.east-=ne.TWO_PI):0===e.x&&0===i.x&&t.x===t.tilingScheme.getNumberOfXTilesAtLevel(t.level)-1&&(r=Oe.clone(e.rectangle,dl),r.west+=ne.TWO_PI,r.east+=ne.TWO_PI);var o=r.east-r.west,s=(a.west-r.west)/o,u=(a.east-r.west)/o,l=r.north-r.south,c=(a.south-r.south)/l,h=(a.north-r.south)/l,d=(i.x-s)/(u-s),m=(i.y-c)/(h-c);return Math.abs(d)<ne.EPSILON5?d=0:Math.abs(d-1)<ne.EPSILON5&&(d=1),Math.abs(m)<ne.EPSILON5?m=0:Math.abs(m-1)<ne.EPSILON5&&(m=1),n.x=d,n.y=m,n}var fl=new dt;function vl(e,t,i,n,r){var a=e.encoding,o=e.vertices;if(r.height=a.decodeHeight(o,t),a.hasVertexNormals)a.getOctEncodedNormal(o,t,r.encodedNormal);else{var s=r.encodedNormal;s.x=0,s.y=0}}var gl=new dt,pl=new re;function yl(e,t,i,n,r,a,o,s,u,l){var c,h=n.encoding,d=n.vertices,m=ml(t,i,h.decodeTextureCoordinates(d,r,$u),$u),f=ml(t,i,h.decodeTextureCoordinates(d,a,Ju),Ju);c=u?(o-m.x)/(f.x-m.x):(s-m.y)/(f.y-m.y);var v,g=h.decodeHeight(d,r),p=h.decodeHeight(d,a),y=i.rectangle;if(Yu.longitude=ne.lerp(y.west,y.east,o),Yu.latitude=ne.lerp(y.south,y.north,s),l.height=Yu.height=ne.lerp(g,p,c),h.hasVertexNormals){var _=h.getOctEncodedNormal(d,r,fl),w=h.getOctEncodedNormal(d,a,gl),T=Hs.octDecode(_.x,_.y,Xu),x=Hs.octDecode(w.x,w.y,pl);v=re.lerp(T,x,c,Xu),re.normalize(v,v),Hs.octEncode(v,l.encodedNormal)}else v=e.geodeticSurfaceNormalCartographic(Yu,Xu),Hs.octEncode(v,l.encodedNormal)}function _l(e,t,i,n,r,a){a.height=r;var o=t.geodeticSurfaceNormalCartographic(Yu,Xu);Hs.octEncode(o,a.encodedNormal)}function wl(e,t,i,n,r,a,o,u,l,c,h){var d,m,f=Il(e,t,u,o,!1,i,n,h)||Il(e,t,c,l,!0,i,n,h);return f?h:bl(r,a)?(d=0===i?0===n?a.eastIndicesNorthToSouth[0]:a.southIndicesEastToWest[0]:0===n?a.northIndicesWestToEast[0]:a.westIndicesSouthToNorth[0],vl(a,d,i,n,h),h):(m=0===i?0===n?Tl(e.westMeshes,e.westTiles,Uu.EAST,e.southMeshes,e.southTiles,Uu.NORTH,i,n):Tl(e.northMeshes,e.northTiles,Uu.SOUTH,e.westMeshes,e.westTiles,Uu.EAST,i,n):0===n?Tl(e.southMeshes,e.southTiles,Uu.NORTH,e.eastMeshes,e.eastTiles,Uu.WEST,i,n):Tl(e.eastMeshes,e.eastTiles,Uu.WEST,e.northMeshes,e.northTiles,Uu.SOUTH,i,n),s(m)?(_l(e,t,i,n,m,h),h):void 0)}function Tl(e,t,i,n,r,a,o,u){var l=Sl(e,t,!1,i,o,u),c=Sl(n,r,!0,a,o,u);return s(l)&&s(c)?.5*(l+c):s(l)?l:c}function xl(e,t,i,n,r,a,o,s,u){for(var l=0;l<a.length;++l)r=El(e,t,i,n,r,a[l],o[l],s,u);return r}function El(e,t,i,n,r,a,o,s,u){var l=a.rectangle;s===Uu.EAST&&0===e.tile.x?(l=Oe.clone(a.rectangle,dl),l.west-=ne.TWO_PI,l.east-=ne.TWO_PI):s===Uu.WEST&&0===a.x&&(l=Oe.clone(a.rectangle,dl),l.west+=ne.TWO_PI,l.east+=ne.TWO_PI);var c,h,d,m,f=e.tile.rectangle;switch(r>0&&(i.decodeTextureCoordinates(n,r-1,$u),c=$u.x,h=$u.y),s){case Uu.WEST:d=o.westIndicesSouthToNorth,m=!1;break;case Uu.NORTH:d=o.northIndicesWestToEast,m=!0;break;case Uu.EAST:d=o.eastIndicesNorthToSouth,m=!1;break;case Uu.SOUTH:d=o.southIndicesEastToWest,m=!0;break}var v,g,p=a,y=e.tile,_=o.encoding,w=o.vertices,T=i.stride;_.hasWebMercatorT&&(v=Un.geodeticLatitudeToMercatorAngle(f.south),g=1/(Un.geodeticLatitudeToMercatorAngle(f.north)-v));for(var x=0;x<d.length;++x){var E=d[x],S=_.decodeTextureCoordinates(w,E,$u);ml(p,y,S,S);var b=S.x,I=S.y,R=m?b:I;if(!(R<0||R>1)&&!(Math.abs(b-c)<ne.EPSILON5&&Math.abs(I-h)<ne.EPSILON5)){var C=Math.abs(b)<ne.EPSILON5||Math.abs(b-1)<ne.EPSILON5,O=Math.abs(I)<ne.EPSILON5||Math.abs(I-1)<ne.EPSILON5;if(!C||!O){var k=_.decodePosition(w,E,Xu),P=_.decodeHeight(w,E),M=void 0;_.hasVertexNormals?M=_.getOctEncodedNormal(w,E,Ku):(M=Ku,M.x=0,M.y=0);var N=I;if(_.hasWebMercatorT){var A=ne.lerp(f.south,f.north,I);N=(Un.geodeticLatitudeToMercatorAngle(A)-v)*g}var D=void 0;i.hasGeodeticSurfaceNormals&&(D=t.geodeticSurfaceNormal(k,Qu)),i.encode(n,r*T,k,S,P,M,N,D),u.minimumHeight=Math.min(u.minimumHeight,P),u.maximumHeight=Math.max(u.maximumHeight,P),++r}}}return r}function Sl(e,t,i,n,r,a){var o,u,l;i?(o=0,u=e.length,l=1):(o=e.length-1,u=-1,l=-1);for(var c=o;c!==u;c+=l){var h=e[c],d=t[c];if(bl(d,h)){var m=void 0;switch(n){case Uu.WEST:m=h.westIndicesSouthToNorth;break;case Uu.SOUTH:m=h.southIndicesEastToWest;break;case Uu.EAST:m=h.eastIndicesNorthToSouth;break;case Uu.NORTH:m=h.northIndicesWestToEast;break}var f=m[i?0:m.length-1];if(s(f))return h.encoding.decodeHeight(h.vertices,f)}}}function bl(e,t){return s(t)&&(!s(e.data.fill)||!e.data.fill.changedThisFrame)}function Il(e,t,i,n,r,a,o,s){var u,l,c,h,d,m=n[r?0:i.length-1],f=i[r?0:i.length-1];if(bl(m,f)&&(0===a?0===o?(u=r?f.northIndicesWestToEast:f.eastIndicesNorthToSouth,l=r,c=r):(u=r?f.eastIndicesNorthToSouth:f.southIndicesEastToWest,l=!r,c=!1):0===o?(u=r?f.westIndicesSouthToNorth:f.northIndicesWestToEast,l=!r,c=!0):(u=r?f.southIndicesEastToWest:f.westIndicesSouthToNorth,l=r,c=!r),u.length>0)){h=r?0:u.length-1,d=u[h],f.encoding.decodeTextureCoordinates(f.vertices,d,$u);var v=ml(m,e.tile,$u,$u);if(v.x===a&&v.y===o)return vl(f,d,a,o,s),!0;if(h=Lu(u,l?a:o,(function(t,i){f.encoding.decodeTextureCoordinates(f.vertices,t,$u);var n=ml(m,e.tile,$u,$u);return c?l?n.x-a:n.y-o:l?a-n.x:o-n.y})),!(h<0))return vl(f,u[h],a,o,s),!0;if(h=~h,h>0&&h<u.length)return yl(t,m,e.tile,f,u[h-1],u[h],a,o,l,s),!0}return!1}var Rl=[new re,new re,new re,new re];function Cl(e,t,i,n,r,a){var o=e.quadtree._occluders.ellipsoid,s=o.ellipsoid,u=Rl;return re.fromRadians(i.west,i.south,r,s,u[0]),re.fromRadians(i.east,i.south,r,s,u[1]),re.fromRadians(i.west,i.north,r,s,u[2]),re.fromRadians(i.east,i.north,r,s,u[3]),o.computeHorizonCullingPointPossiblyUnderEllipsoid(t,u,n,a)}var Ol=new re,kl=new re,Pl=new re,Ml=new re,Nl=new re,Al=new re,Dl=new me,Ll=new wo(re.UNIT_X,0),Ul=new St,Fl=new re,Hl=new re,zl=new re(0,-1,0),ql=new re(0,0,-1),Bl=new re;function jl(e,t,i){i.cartographicToCartesian(Oe.southwest(t),e.southwestCornerCartesian),i.cartographicToCartesian(Oe.northeast(t),e.northeastCornerCartesian),Dl.longitude=t.west,Dl.latitude=.5*(t.south+t.north),Dl.height=0;var n=i.cartographicToCartesian(Dl,Nl),r=re.cross(n,re.UNIT_Z,Ol);re.normalize(r,e.westNormal),Dl.longitude=t.east;var a=i.cartographicToCartesian(Dl,Al),o=re.cross(re.UNIT_Z,a,Ol);re.normalize(o,e.eastNormal);var s,u=re.subtract(n,a,Ol),l=re.normalize(u,Ml),c=t.south;if(c>0){Dl.longitude=.5*(t.west+t.east),Dl.latitude=c;var h=i.cartographicToCartesian(Dl,Ul.origin);re.clone(l,Ul.direction);var d=wo.fromPointNormal(e.southwestCornerCartesian,e.westNormal,Ll);bt.rayPlane(Ul,d,e.southwestCornerCartesian),s=i.geodeticSurfaceNormal(h,kl)}else s=i.geodeticSurfaceNormalCartographic(Oe.southeast(t),kl);var m=re.cross(s,u,Pl);re.normalize(m,e.southNormal);var f,v=t.north;if(v<0){Dl.longitude=.5*(t.west+t.east),Dl.latitude=v;var g=i.cartographicToCartesian(Dl,Ul.origin);re.negate(l,Ul.direction);var p=wo.fromPointNormal(e.northeastCornerCartesian,e.eastNormal,Ll);bt.rayPlane(Ul,p,e.northeastCornerCartesian),f=i.geodeticSurfaceNormal(g,kl)}else f=i.geodeticSurfaceNormalCartographic(Oe.northwest(t),kl);var y=re.cross(u,f,Pl);re.normalize(y,e.northNormal)}var Wl=function(){function e(t){Object(r["a"])(this,e),this.rectangle=Oe.clone(t.rectangle),this.minimumHeight=o(t.minimumHeight,0),this.maximumHeight=o(t.maximumHeight,0),this.southwestCornerCartesian=new re,this.northeastCornerCartesian=new re,this.westNormal=new re,this.southNormal=new re,this.eastNormal=new re,this.northNormal=new re;var i=o(t.ellipsoid,Ie.WGS84);jl(this,t.rectangle,i),this._orientedBoundingBox=void 0,this._boundingSphere=void 0,o(t.computeBoundingVolumes,!0)&&this.computeBoundingVolumes(i)}return Object(a["a"])(e,[{key:"boundingVolume",get:function(){return this._orientedBoundingBox}},{key:"boundingSphere",get:function(){return this._boundingSphere}},{key:"computeBoundingVolumes",value:function(e){this._orientedBoundingBox=gs.fromRectangle(this.rectangle,this.minimumHeight,this.maximumHeight,e),this._boundingSphere=ht.fromOrientedBoundingBox(this._orientedBoundingBox)}},{key:"distanceToCamera",value:function(e){var t,i,n,r=e.camera,a=r.positionWC,o=r.positionCartographic,s=0;if(!Oe.contains(this.rectangle,o)){var u=this.southwestCornerCartesian,l=this.northeastCornerCartesian,c=this.westNormal,h=this.southNormal,d=this.eastNormal,m=this.northNormal;e.mode!==cu.SCENE3D&&(u=e.mapProjection.project(Oe.southwest(this.rectangle),Fl),u.z=u.y,u.y=u.x,u.x=0,l=e.mapProjection.project(Oe.northeast(this.rectangle),Hl),l.z=l.y,l.y=l.x,l.x=0,c=zl,d=re.UNIT_Y,h=ql,m=re.UNIT_Z);var f=re.subtract(a,u,Bl),v=re.dot(f,c),g=re.dot(f,h),p=re.subtract(a,l,Bl),y=re.dot(p,d),_=re.dot(p,m);v>0?s+=v*v:y>0&&(s+=y*y),g>0?s+=g*g:_>0&&(s+=_*_)}if(e.mode===cu.SCENE3D?(t=o.height,i=this.minimumHeight,n=this.maximumHeight):(t=a.x,i=0,n=0),t>n){var w=t-n;s+=w*w}else if(t<i){var T=i-t;s+=T*T}return Math.sqrt(s)}}]),e}(),Vl=[],Gl=[],Yl=[new re,new re,new re,new re],Zl=new re;function Xl(e,t,i,n,r,a){var o=e.quadtree._occluders.ellipsoid,s=o.ellipsoid,u=Yl;return re.fromRadians(i.west,i.south,r,s,u[0]),re.fromRadians(i.east,i.south,r,s,u[1]),re.fromRadians(i.west,i.north,r,s,u[2]),re.fromRadians(i.east,i.north,r,s,u[3]),o.computeHorizonCullingPointPossiblyUnderEllipsoid(t,u,n,a)}function Ql(e,t,i){var n=e.data;void 0===n&&(n=e.data=new Du);var r=e.tilingScheme.ellipsoid;void 0===n.tileBoundingRegion&&(n.tileBoundingRegion=new Wl({computeBoundingVolumes:!1,rectangle:e.rectangle,ellipsoid:r,minimumHeight:0,maximumHeight:0}));var a=n.tileBoundingRegion,o=a.minimumHeight,u=a.maximumHeight,l=!1,c=e,h=n.mesh,d=n.terrainData;if(void 0!==h&&void 0!==h.minimumHeight&&void 0!==h.maximumHeight)a.minimumHeight=h.minimumHeight,a.maximumHeight=h.maximumHeight,l=!0;else if(void 0!==d&&void 0!==d._minimumHeight&&void 0!==d._maximumHeight)a.minimumHeight=d._minimumHeight,a.maximumHeight=d._maximumHeight;else{a.minimumHeight=Number.NaN,a.maximumHeight=Number.NaN;var m=e.parent;while(void 0!==m){var f=m.data;if(void 0!==f){var v=f.mesh,g=f.terrainData;if(void 0!==v&&void 0!==v.minimumHeight&&void 0!==v.maximumHeight){a.minimumHeight=v.minimumHeight,a.maximumHeight=v.maximumHeight;break}if(void 0!==g&&void 0!==g._minimumHeight&&void 0!==g._maximumHeight){a.minimumHeight=g._minimumHeight,a.maximumHeight=g._maximumHeight;break}}m=m.parent}c=m}if(void 0!==c){var p=i.terrainExaggeration,y=i.terrainExaggerationRelativeHeight,_=1!==p;if(_&&(l=!1,a.minimumHeight=Bs.getHeight(a.minimumHeight,p,y),a.maximumHeight=Bs.getHeight(a.maximumHeight,p,y)),l)n.boundingVolumeIsFromMesh||(a._orientedBoundingBox=gs.clone(h.orientedBoundingBox,a._orientedBoundingBox),a._boundingSphere=ht.clone(h.boundingSphere3D,a._boundingSphere),n.occludeePointInScaledSpace=re.clone(h.occludeePointInScaledSpace,n.occludeePointInScaledSpace),s(n.occludeePointInScaledSpace)||(n.occludeePointInScaledSpace=Xl(t,a._orientedBoundingBox.center,e.rectangle,a.minimumHeight,a.maximumHeight,n.occludeePointInScaledSpace)));else{var w=void 0===a._orientedBoundingBox||void 0===a._boundingSphere,T=a.minimumHeight!==o||a.maximumHeight!==u;(T||w)&&(a.computeBoundingVolumes(r),n.occludeePointInScaledSpace=Xl(t,a._orientedBoundingBox.center,e.rectangle,a.minimumHeight,a.maximumHeight,n.occludeePointInScaledSpace))}n.boundingVolumeSourceTile=c,n.boundingVolumeIsFromMesh=l}else n.boundingVolumeSourceTile=void 0,n.boundingVolumeIsFromMesh=!1}var Kl=new ht,Jl=new Oe,$l=new Oe,ec=new me;function tc(e,t){if(t.west<t.east)return t;var i=Oe.clone(t,$l),n=Oe.center(e,ec);return n.longitude>0?i.east=ne.PI:i.west=-ne.PI,i}function ic(e,t){return!Oe.equals(e.cartographicLimitRectangle,Oe.MAX_VALUE)}var nc=new to,rc=new n["N"](0,0,0,0),ac=new n["N"],oc=(new n["M"],new n["M"],new n["M"],new re),sc={surfaceTile:void 0,enableLighting:!1,useWebMercatorProjection:!1};function uc(e,t){var i=e.loadingImagery;s(i)||(i=e.readyImagery);var n=t.loadingImagery;return s(n)||(n=t.readyImagery),i.imageryLayer._layerIndex-n.imageryLayer._layerIndex}var lc,cc=function(e,t,i,n){var r=new er({},i);return r.defines.INCLUDE_WEB_MERCATOR_Y="",n===Us.NONE||(r.defines.QUANTIZATION_BITS12=""),r},hc=function(e,t,i){var n=t.data;s(n.vertexArray)||(void 0===n.fill&&(n.fill=new Bu(t)),n.fill.update(e,i));var r=n.renderedMesh,a=r.center,o=r.encoding,u=ac,l=!1,c=sc;c.frameState=i,c.surfaceTile=n;var h=o.quantization;c.enableLighting=e.enableLighting,c.useWebMercatorProjection=l;var d=n.imagery,m=0,f=d.length,v=e._firstPassInitialColor;do{var g=0,p=void 0,y=void 0,_=[],w=[],T=[];while(m<f){var x=d[m],E=x.readyImagery;if(++m,s(E)){var S=x.useWebMercatorT?E.textureWebMercator:E.texture,b=E.imageryLayer;s(x.textureTranslationAndScale)||(x.textureTranslationAndScale=b._calculateTextureTranslationAndScale(t,x)),_[g]=S,w[g]=x.textureTranslationAndScale,T[g]=x.textureCoordinateRectangle,++g}}c.numberOfDayTextures=_.length,e._drawCommands.length<=e._usedDrawCommands?(p=new yu,p.owner=t,p.frustumCulled=!1,p.boundingVolume=new ht,p.orientedBoundingBox=void 0,y=cc(i,e,c,h),e._drawCommands.push(p),e._uniformMaps.push(y)):(p=e._drawCommands[e._usedDrawCommands],y=e._uniformMaps[e._usedDrawCommands]),(y.defines.TEXTURE_UNITS!==y.dayTextures.length||f!==y.dayTextures.length||h===Us.BITS12&&!s(y.defines.QUANTIZATION_BITS12)||h===Us.NONE&&s(y.defines.QUANTIZATION_BITS12))&&(y.dispose(),y=cc(i,e,c,h)),++e._usedDrawCommands,y.dayTextures=_,y.dayTextureTranslationAndScale=w,y.dayTextureTexCoordsRectangle=T,po.clone(v,y.initialColor),p.owner=t;var I=i.camera.viewMatrix,R=i.camera.frustum.cesiumProjectMatrix,C=to.multiplyByPoint(I,a,oc);to.setTranslation(I,C,nc),to.multiply(R,nc,nc),to.transformToThreeMatrix4(nc,y.modifiedModelViewProjectionScratch),y.tileRectangle=u,y.minMaxHeight.x=o.minimumHeight,y.minMaxHeight.y=o.maximumHeight,y.scaleAndBias=o.threeMatrix4,p.geometry=r.geometry,p.material=y,s(y.defines.QUANTIZATION_BITS12),s(r.geometry.attributes.compressed0);var O=p.boundingVolume,k=p.orientedBoundingBox;if(i.mode!==cu.SCENE3D){ht.fromRectangleWithHeights2D(t.rectangle,i.mapProjection,n.minimumHeight,n.maximumHeight,O);var P=O.center;re.fromElements(P.x,P.y,P.z,P),i.mode===cu.MORPHING&&(O=ht.union(n.boundingSphere3D,O,O))}else p.boundingVolume=ht.clone(n.boundingSphere3D,O),p.orientedBoundingBox=gs.clone(n.orientedBoundingBox,k);i.commandList.push(p),v=rc}while(m<f)},dc=function(){function e(t){Object(r["a"])(this,e),this._quadtree=void 0,this._imageryLayers=t.imageryLayers,this._terrainProvider=t.terrainProvider,this._errorEvent=new si,this._imageryLayersUpdatedEvent=new si,this._imageryLayers.layerAdded.addEventListener(e.prototype._onLayerAdded,this),this._imageryLayers.layerRemoved.addEventListener(e.prototype._onLayerRemoved,this),this._imageryLayers.layerMoved.addEventListener(e.prototype._onLayerMoved,this),this._imageryLayers.layerShownOrHidden.addEventListener(e.prototype._onLayerShownOrHidden,this),this._tileLoadedEvent=new si,this._imageryLayersUpdatedEvent=new si,this._tilesToRenderByTextureCount=[],this._drawCommands=[],this._compressCommands=[],this._uniformMaps=[],this._compressUniformMaps=[],this._usedDrawCommands=0,this._usedCompressCommands=0,this._vertexArraysToDestroy=[],this._tileLoadedEvent=new si,this.cartographicLimitRectangle=Oe.clone(Oe.MAX_VALUE),this._hasLoadedTilesThisFrame=!1,this._hasFillTilesThisFrame=!1,this._debug={wireframe:!1,boundingSphereTile:void 0},this._layerOrderChanged=!1,this._baseColor=void 0,this._firstPassInitialColor=new po(0,0,.5,1),this.baseColor=new Yn(0,0,.5,1)}return Object(a["a"])(e,[{key:"baseColor",get:function(){return this._baseColor},set:function(e){if(!s(e))throw new u("value is required.");this._baseColor=e,this._firstPassInitialColor=po.fromColor(e,this._firstPassInitialColor)}},{key:"quadtree",get:function(){return this._quadtree},set:function(e){this._quadtree=e}},{key:"tilingScheme",get:function(){return this._terrainProvider.tilingScheme}},{key:"terrainProvider",get:function(){return this._terrainProvider},set:function(e){if(this._terrainProvider!==e){if(!s(e))throw new u("terrainProvider is required.");this._terrainProvider=e,s(this._quadtree)&&this._quadtree.invalidateAllTiles()}}},{key:"imageryLayersUpdatedEvent",get:function(){return this._imageryLayersUpdatedEvent}},{key:"ready",get:function(){return this._terrainProvider.ready&&(0===this._imageryLayers.length||this._imageryLayers.get(0).imageryProvider.ready)}},{key:"anRefine",value:function(e){if(s(e.data.terrainData))return!0;var t=this.terrainProvider.getTileDataAvailable(2*e.x,2*e.y,e.level+1);return void 0!==t}},{key:"beginUpdate",value:function(e){for(var t=this._tilesToRenderByTextureCount,i=0,n=t.length;i<n;++i){var r=t[i];s(r)&&(r.length=0)}this._usedDrawCommands=0,this._hasLoadedTilesThisFrame=!1,this._hasFillTilesThisFrame=!1}},{key:"endUpdate",value:function(e){for(var t=this._tilesToRenderByTextureCount,i=0,n=t.length;i<n;++i){var r=t[i];if(s(r))for(var a=0,o=r.length;a<o;++a){var u=r[a],l=u.data.tileBoundingRegion;hc(this,u,e),e.minimumTerrainHeight=Math.min(e.minimumTerrainHeight,l.minimumHeight)}}}},{key:"_onLayerAdded",value:function(e,t){if(e.show){var i=this._terrainProvider,n=this,r=e.imageryProvider,a=this._imageryLayersUpdatedEvent;r._reload=function(){e._imageryCache={},n._quadtree.forEachLoadedTile((function(t){if(!s(t._loadedCallbacks[e._layerIndex])){var i,n=t.data.imagery,r=n.length,a=-1;for(i=0;i<r;++i){var u=n[i],l=o(u.readyImagery,u.loadingImagery);if(l.imageryLayer===e)-1===a&&(a=i);else if(-1!==a)break}if(-1!==a);}}))},this._quadtree.forEachLoadedTile((function(t){e._createTileImagerySkeletons(t,i)&&(t.state=gu.LOADING,0===t.level||t._lastSelectionResultFrame===n.quadtree._lastSelectionFrameNumber&&t._lastSelectionResult===qu.RENDERED||(t.renderable=!1))})),this._layerOrderChanged=!0,a.raiseEvent()}}},{key:"_onLayerRemoved",value:function(e,t){this._quadtree.forEachLoadedTile((function(t){for(var i=t.data.imagery,n=-1,r=0,a=0,o=i.length;a<o;++a){var u=i[a],l=u.loadingImagery;if(s(l)||(l=u.readyImagery),l.imageryLayer===e)-1===n&&(n=a),u.freeResources(),++r;else if(-1!==n)break}-1!==n&&i.splice(n,r)})),s(e.imageryProvider)&&(e.imageryProvider._reload=void 0),this._imageryLayersUpdatedEvent.raiseEvent()}},{key:"_onLayerMoved",value:function(e,t,i){this._layerOrderChanged=!0,this._imageryLayersUpdatedEvent.raiseEvent()}},{key:"_onLayerShownOrHidden",value:function(e,t,i){i?this._onLayerAdded(e,t):this._onLayerRemoved(e,t)}},{key:"update",value:function(e){this._imageryLayers._update()}},{key:"initialize",value:function(e){this._imageryLayers.queueReprojectionCommands(e),this._layerOrderChanged&&(this._layerOrderChanged=!1,this._quadtree.forEachLoadedTile((function(e){e.data.imagery.sort(uc)})));for(var t=this._vertexArraysToDestroy,i=t.length,n=0;n<i;++n)Du._freeVertexArray(t[n]);t.length=0}},{key:"cancelReprojections",value:function(){this._imageryLayers.cancelReprojections()}},{key:"computeDistanceToTile",value:function(e,t){Ql(e,this,t);var i=e.data,n=i.boundingVolumeSourceTile;if(void 0===n)return 9999999999;var r=i.tileBoundingRegion,a=r.minimumHeight,o=r.maximumHeight;if(i.boundingVolumeSourceTile!==e){var s=t.camera.positionCartographic.height,u=Math.abs(s-a),l=Math.abs(s-o);u>l?(r.minimumHeight=a,r.maximumHeight=a):(r.minimumHeight=o,r.maximumHeight=o)}var c=r.distanceToCamera(t);return r.minimumHeight=a,r.maximumHeight=o,c}},{key:"computeTileVisibility",value:function(e,t,i){var n=this.computeDistanceToTile(e,t);e._distance=n;var r=ic(this,t),a=e.data,o=a.tileBoundingRegion;if(void 0===a.boundingVolumeSourceTile)return hu.PARTIAL;var u=t.cullingVolume,l=o.boundingVolume;s(l)||(l=o.boundingSphere),a.clippedByBoundaries=!1;var c,h=tc(e.rectangle,this.cartographicLimitRectangle),d=Oe.simpleIntersection(h,e.rectangle,Jl);if(!s(d))return hu.NONE;if(Oe.equals(d,e.rectangle)||(a.clippedByBoundaries=!0),t.mode!==cu.SCENE3D&&(l=Kl,ht.fromRectangleWithHeights2D(e.rectangle,t.mapProjection,o.minimumHeight,o.maximumHeight,l),re.fromElements(l.center.z,l.center.x,l.center.y,l.center),t.mode===cu.MORPHING&&s(a.renderedMesh)&&(l=ht.union(o.boundingSphere,l,l))),!s(l))return hu.PARTIAL;var m=u.computeVisibility(l);if(m===Re.OUTSIDE?c=hu.NONE:m===Re.INTERSECTING?c=hu.PARTIAL:m===Re.INSIDE&&(c=hu.FULL),c===hu.NONE)return c;var f=!1;if(t.mode===cu.SCENE3D&&!f&&s(i)&&!r){var v=a.occludeePointInScaledSpace;return s(v)?i.ellipsoid.isScaledSpacePointVisiblePossiblyUnderEllipsoid(v,o.minimumHeight)?c:hu.NONE:c}return c}},{key:"computeTileLoadPriority",value:function(e,t){var i=e.data;if(void 0===i)return 0;var n=i.tileBoundingRegion.boundingVolume;if(void 0===n)return 0;var r=t.camera.positionWC,a=t.camera.directionWC,o=re.subtract(n.center,r,Zl),s=re.magnitude(o);return s<ne.EPSILON5?0:(re.divideByScalar(o,s,o),(1-re.dot(o,a))*e._distance)}},{key:"canRefine",value:function(e){if(s(e.data.terrainData))return!0;var t=this.terrainProvider.getTileDataAvailable(2*e.x,2*e.y,e.level+1);return void 0!==t}},{key:"canRenderWithoutLosingDetail",value:function(e){var t=e.data,i=Vl;i.length=this._imageryLayers.length;var n,r,a,o=!1,u=!1;for(s(t)&&(o=t.terrainState===pu.READY,u=!0,n=t.imagery),r=0,a=i.length;r<a;++r)i[r]=u;if(s(n))for(r=0,a=n.length;r<a;++r){var l=n[r],c=l.loadingImagery,h=!s(c)||c.state===wu.FAILED||c.state===wu.INVALID,d=(l.loadingImagery||l.readyImagery).imageryLayer._layerIndex;i[d]=h&&i[d]}var m=this.quadtree._lastSelectionFrameNumber,f=Gl;f.length=0,f.push(e.southwestChild,e.southeastChild,e.northwestChild,e.northeastChild);while(f.length>0){var v=f.pop(),g=v._lastSelectionResultFrame===m?v._lastSelectionResult:qu.NONE;if(g===qu.RENDERED){var p=v.data;if(!s(p))continue;if(!o&&v.data.terrainState===pu.READY)return!1;var y=v.data.imagery;for(r=0,a=y.length;r<a;++r){var _=y[r],w=_.loadingImagery,T=!s(w)||w.state===wu.FAILED||w.state===wu.INVALID,x=(_.loadingImagery||_.readyImagery).imageryLayer._layerIndex;if(T&&!i[x])return!1}}else g===qu.REFINED&&f.push(v.southwestChild,v.southeastChild,v.northwestChild,v.northeastChild)}return!0}},{key:"showTileThisFrame",value:function(e,t){for(var i=0,n=e.data.imagery,r=0,a=n.length;r<a;++r){var o=n[r];s(o.readyImagery)&&0!==o.readyImagery.imageryLayer.alpha&&++i}var u=this._tilesToRenderByTextureCount[i];s(u)||(u=[],this._tilesToRenderByTextureCount[i]=u),u.push(e);var l=e.data;s(l.vertexArray)?this._hasLoadedTilesThisFrame=!0:this._hasFillTilesThisFrame=!0;var c=this._debug;++c.tilesRendered,c.texturesRendered+=i}},{key:"loadTile",value:function(e,t){var i,n=t.data,r=!0;s(n)&&(r=n.boundingVolumeSourceTile!==t||t._lastSelectionResult===qu.CULLED_BUT_NEEDED,i=n.terrainState),Du.processStateMachine(t,e,this.terrainProvider,this._imageryLayers,this._vertexArraysToDestroy,r),n=t.data,r&&i!==n.terrainState&&this.computeTileVisibility(t,e,this.quadtree.occluders)!==hu.NONE&&n.boundingVolumeSourceTile===t&&(r=!1,Du.processStateMachine(t,e,this.terrainProvider,this._imageryLayers,this._vertexArraysToDestroy,r))}},{key:"getLevelMaximumGeometricError",value:function(e){return this._terrainProvider.getLevelMaximumGeometricError(e)}}]),e}(),mc=(i("e9c4"),"\n\n\nattribute vec4 position;\nattribute float webMercatorT;\n\nuniform vec2 u_textureDimensions;\n\nuniform mat4 modelViewMatrix; // optional\nuniform mat4 projectionMatrix; // optional\n\nvarying vec2 v_textureCoordinates;\n\nvoid main()\n{\n    v_textureCoordinates = vec2(position.x, webMercatorT);\n    // gl_Position = projectionMatrix * modelViewMatrix * (vec4(position.xyz, 1.0) * vec4(u_textureDimensions, 1.0, 1.0) + vec4(0.0, 0.0, 0.0, 0.0));\n\n    gl_Position = projectionMatrix * modelViewMatrix * (vec4(position.xyz + vec3(-0.5, -0.5, 0.0), 1.0));\n}\n"),fc="\nprecision mediump float;\nprecision mediump int;\n\nuniform sampler2D u_texture;\nuniform vec4 u_randomColor;\nvarying vec2 v_textureCoordinates;\n\nvoid main()\n{\n    gl_FragColor = texture2D(u_texture, v_textureCoordinates);\n}\n",vc=function(e){Object(Kn["a"])(i,e);var t=Object(Jn["a"])(i);function i(){var e,a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return Object(r["a"])(this,i),e=t.call(this,a),e.lights=!1,e.fog=!1,e.uniforms={u_texture:{value:new n["I"]},u_textureDimensions:{value:new n["L"]}},e.vertexShader=mc,e.fragmentShader=fc,e.side=n["h"],e}return Object(a["a"])(i,[{key:"texture",get:function(){return this.uniforms.u_texture.value},set:function(e){s(e)&&(this.uniforms.u_texture.value=e)}},{key:"textureDimensions",get:function(){return this.uniforms.u_textureDimensions.value},set:function(e){s(e)&&this.uniforms.u_textureDimensions.value.copy(e)}}]),i}(n["z"]),gc=function(){function e(t,i,n,a,o){if(Object(r["a"])(this,e),this.imageryLayer=t,this.x=i,this.y=n,this.level=a,this.request=void 0,0!==a){var u=i/2|0,l=n/2|0,c=a-1;this.parent=t.getImageryFromCache(u,l,c)}if(this.state=wu.UNLOADED,this.imageUrl=void 0,this.image=void 0,this.texture=void 0,this.textureWebMercator=void 0,this.credits=void 0,this.referenceCount=0,!s(o)&&t.imageryProvider.ready){var h=t.imageryProvider.tilingScheme;o=h.tileXYToRectangle(i,n,a)}this.rectangle=o}return Object(a["a"])(e,[{key:"addReference",value:function(){++this.referenceCount}},{key:"releaseReference",value:function(){return--this.referenceCount,0===this.referenceCount?(this.imageryLayer.removeImageryFromCache(this),s(this.parent)&&this.parent.releaseReference(),s(this.image)&&s(this.image.destroy)&&this.image.destroy(),s(this.texture)&&(this.texture.dispose(),this.texture=null),s(this.textureWebMercator)&&this.texture!==this.textureWebMercator&&this.textureWebMercator.destroy(),ti(this),0):this.referenceCount}},{key:"processStateMachine",value:function(e,t,i){this.state!==wu.UNLOADED||i||(this.state=wu.TRANSITIONING,this.imageryLayer._requestImagery(this)),this.state===wu.RECEIVED&&(this.state=wu.TRANSITIONING,this.imageryLayer._createTexture(e.context,this));var n=this.state===wu.READY&&t&&!this.texture;(this.state===wu.TEXTURE_LOADED||n)&&(this.state=wu.TRANSITIONING,this.imageryLayer._reprojectTexture(e,this,t))}}],[{key:"createPlaceholder",value:function(t){var i=new e(t,0,0,0);return i.addReference(),i.state=wu.PLACEHOLDER,i}}]),e}(),pc=function(){function e(t,i,n){Object(r["a"])(this,e),this.readyImagery=void 0,this.loadingImagery=t,this.textureCoordinateRectangle=i,this.textureTranslationAndScale=void 0,this.useWebMercatorT=n}return Object(a["a"])(e,[{key:"freeResources",value:function(){s(this.readyImagery)&&this.readyImagery.releaseReference(),s(this.loadingImagery)&&this.loadingImagery.releaseReference()}},{key:"processStateMachine",value:function(e,t,i){var n=this.loadingImagery,r=n.imageryLayer;if(n.processStateMachine(t,!this.useWebMercatorT,i),n.state===wu.READY)return s(this.readyImagery)&&this.readyImagery.releaseReference(),this.readyImagery=this.loadingImagery,this.loadingImagery=void 0,this.textureTranslationAndScale=r._calculateTextureTranslationAndScale(e,this),!0;var a,o=n.parent;while(s(o)&&(o.state!==wu.READY||!this.useWebMercatorT&&!s(o.texture)))o.state!==wu.FAILED&&o.state!==wu.INVALID&&(a=a||o),o=o.parent;return this.readyImagery!==o&&(s(this.readyImagery)&&this.readyImagery.releaseReference(),this.readyImagery=o,s(o)&&(o.addReference(),this.textureTranslationAndScale=r._calculateTextureTranslationAndScale(e,this))),(n.state===wu.FAILED||n.state===wu.INVALID)&&(!s(a)||(a.processStateMachine(t,!this.useWebMercatorT,i),!1))}}]),e}();(function(e){e[e["LEFT"]=-1]="LEFT",e[e["NONE"]=0]="NONE",e[e["RIGHT"]=1]="RIGHT"})(lc||(lc={}));var yc=function(){function e(t){Object(r["a"])(this,e),this.geometry=new n["c"],this.material=new n["E"],this.uniformMap=t.uniformMap,this.outputTexture=t.outputTexture,this.preExecute=t.preExecute,this.postExecute=t.postExecute,this.persists=o(t.persists,!1),this.owner=t.owner}return Object(a["a"])(e,[{key:"execute",value:function(e){e.execute(this)}}]),e}(),_c={_maxAnisotropy:0,get maxAnisotropy(){return _c._maxAnisotropy}},wc=new Oe,Tc=new Oe,xc=new Oe,Ec=new Oe,Sc=function(e,t,i){return JSON.stringify([e,t,i])},bc=function(e,t,i){var n=e._imageryProvider,r=n.tilingScheme,a=r.ellipsoid,o=e._imageryProvider.tilingScheme.projection instanceof Ce?1:Math.cos(i),s=r.rectangle,u=a.maximumRadius*s.width*o/(n.tileWidth*r.getNumberOfXTilesAtLevel(0)),l=u/t,c=Math.log(l)/Math.log(2),h=Math.round(c);return 0|h},Ic=function(e,t,i,n){i.state=wu.READY},Rc=new Float32Array(128),Cc=function(e,t,i,r){var a=t.cache.imageryLayer_reproject;if(!s(a)){a=t.cache.imageryLayer_reproject={vertexAttribute:void 0,material:void 0,geometry:void 0,destroy:function(){s(this.framebuffer)&&this.framebuffer.destroy(),s(this.vertexArray)&&this.vertexArray.destroy(),s(this.shaderProgram)&&this.shaderProgram.destroy()}};for(var o=new Float32Array(256),u=0,l=0;l<64;++l){var c=l/63;o[u++]=0,o[u++]=c,o[u++]=1,o[u++]=c}var h=Ja.getRegularGridIndices(2,64),d=new n["b"](h,1);d.usage=n["H"],a.material=new vc,a.geometry=e.geometry,a.geometry.setAttribute("position",new n["b"](o,2)),a.geometry.setAttribute("webMercatorT",new n["b"](new Float32Array(128),1)),a.geometry.setIndex(d)}i.sampler=a.sampler;var m=a.material,f=a.geometry,v=i.image.width,g=i.image.height;m.textureDimensions.x=v,m.textureDimensions.y=g,m.texture=i;var p=Math.sin(r.south),y=.5*Math.log((1+p)/(1-p));p=Math.sin(r.north);var _=.5*Math.log((1+p)/(1-p)),w=1/(_-y),T=new n["I"](void 0);T.isRenderTargetTexture=!0,T.image={width:v,height:g,depth:1};for(var x=r.south,E=r.north,S=Rc,b=0,I=0;I<64;++I){var R=I/63,C=ne.lerp(x,E,R);p=Math.sin(C);var O=.5*Math.log((1+p)/(1-p)),k=(O-y)*w;S[b++]=k,S[b++]=k}f.attributes.webMercatorT.array=S,f.attributes.webMercatorT.needsUpdate=!0,e.outputTexture=T,e.geometry=f,e.material=m},Oc=function(){function e(t,i){Object(r["a"])(this,e),this._imageryProvider=t,this._minimumTerrainLevel=i.minimumTerrainLevel,this._maximumTerrainLevel=i.maximumTerrainLevel,this._rectangle=o(i.rectangle,Oe.MAX_VALUE),this._imageryCache={},this._skeletonPlaceholder=new pc(gc.createPlaceholder(this)),this.show=o(i.show,!0),this._show=!0,this._layerIndex=-1,this._isBaseLayer=!1,this._requestImageError=void 0,this._reprojectComputeCommands=[]}return Object(a["a"])(e,[{key:"imageryProvider",get:function(){return this._imageryProvider}},{key:"rectangle",get:function(){return this._rectangle}},{key:"queueReprojectionCommands",value:function(e){for(var t=this._reprojectComputeCommands,i=t.length,n=0;n<i;++n)e.computeCommandList.push(t[n]);t.length=0}},{key:"isBaseLayer",value:function(){return this._isBaseLayer}},{key:"_createTileImagerySkeletons",value:function(e,t,i){var n=e.data;if(s(this._minimumTerrainLevel)&&e.level<this._minimumTerrainLevel)return!1;if(s(this._maximumTerrainLevel)&&e.level>this._maximumTerrainLevel)return!1;var r=this._imageryProvider;if(s(i)||(i=n.imagery.length),!r.ready)return this._skeletonPlaceholder.loadingImagery.addReference(),n.imagery.splice(i,0,this._skeletonPlaceholder),!0;var a=r.tilingScheme.projection instanceof Un&&e.rectangle.north<Un.MaximumLatitude&&e.rectangle.south>-Un.MaximumLatitude,o=Oe.intersection(r.rectangle,this._rectangle,wc),u=Oe.intersection(e.rectangle,o,Tc);if(!s(u)){if(!this.isBaseLayer())return!1;var l=o,c=e.rectangle;u=Tc,c.south>=l.north?u.north=u.south=l.north:c.north<=l.south?u.north=u.south=l.south:(u.south=Math.max(c.south,l.south),u.north=Math.min(c.north,l.north)),c.west>=l.east?u.west=u.east=l.east:c.east<=l.west?u.west=u.east=l.west:(u.west=Math.max(c.west,l.west),u.east=Math.min(c.east,l.east))}var h=0;u.south>0?h=u.south:u.north<0&&(h=u.north);var d=1,m=d*t.getLevelMaximumGeometricError(e.level),f=bc(this,m,h);f=Math.max(0,f);var v=r.maximumLevel;if(f>v&&(f=v),s(r.minimumLevel)){var g=r.minimumLevel;f<g&&(f=g)}var p=r.tilingScheme,y=p.positionToTileXY(Oe.northwest(u),f),_=p.positionToTileXY(Oe.southeast(u),f),w=e.rectangle.width/512,T=e.rectangle.height/512,x=p.tileXYToRectangle(y.x,y.y,f);Math.abs(x.south-e.rectangle.north)<T&&y.y<_.y&&++y.y,Math.abs(x.east-e.rectangle.west)<w&&y.x<_.x&&++y.x;var E=p.tileXYToRectangle(_.x,_.y,f);Math.abs(E.north-e.rectangle.south)<T&&_.y>y.y&&--_.y,Math.abs(E.west-e.rectangle.east)<w&&_.x>y.x&&--_.x;var S,b,I=Oe.clone(e.rectangle,Ec),R=p.tileXYToRectangle(y.x,y.y,f),C=Oe.intersection(R,o,xc);a?(p.rectangleToNativeRectangle(I,I),p.rectangleToNativeRectangle(R,R),p.rectangleToNativeRectangle(C,C),p.rectangleToNativeRectangle(o,o),S=p.tileXYToNativeRectangle.bind(p),w=I.width/512,T=I.height/512):S=p.tileXYToRectangle.bind(p);var O,k=0,P=1;!this.isBaseLayer()&&Math.abs(C.west-I.west)>=w&&(k=Math.min(1,(C.west-I.west)/I.width)),!this.isBaseLayer()&&Math.abs(C.north-I.north)>=T&&(P=Math.max(0,(C.north-I.south)/I.height));for(var M=P,N=y.x;N<=_.x;N++)if(b=k,R=S(N,y.y,f),C=Oe.simpleIntersection(R,o,xc),s(C)){k=Math.min(1,(C.east-I.west)/I.width),N===_.x&&(this.isBaseLayer()||Math.abs(C.east-I.east)<w)&&(k=1),P=M;for(var A=y.y;A<=_.y;A++)if(O=P,R=S(N,A,f),C=Oe.simpleIntersection(R,o,xc),s(C)){P=Math.max(0,(C.south-I.south)/I.height),A===_.y&&(this.isBaseLayer()||Math.abs(C.south-I.south)<T)&&(P=0);var D=new po(b,P,k,O),L=this.getImageryFromCache(N,A,f);n.imagery.splice(i,0,new pc(L,D,a)),++i}}return!0}},{key:"getImageryFromCache",value:function(e,t,i,n){var r=Sc(e,t,i),a=this._imageryCache[r];return s(a)||(a=new gc(this,e,t,i,n),this._imageryCache[r]=a),a.addReference(),a}},{key:"_requestImagery",value:function(e){var t=this._imageryProvider,i=this;function r(n){if(e.request.state===wi.CANCELLED)return e.state=wu.UNLOADED,void(e.request=void 0);e.state=wu.FAILED,e.request=void 0;var r="Failed to obtain image tile X: "+e.x+" Y: "+e.y+" Level: "+e.level+".";i._requestImageError=Tu.handleError(i._requestImageError,t,t.errorEvent,r,e.x,e.y,e.level,o,n)}function a(t){if(!s(t))return r();var a=new n["d"](t);a.anisotropy=_c.maxAnisotropy,e.image=a,e.state=wu.RECEIVED,e.request=void 0,Tu.handleSuccess(i._requestImageError)}function o(){var i=new Ii({throttle:!1,throttleByServer:!0,type:Ti.IMAGERY});e.request=i,e.state=wu.TRANSITIONING;var n=t.requestImage(e.x,e.y,e.level,i);if(!s(n))return e.state=wu.UNLOADED,void(e.request=void 0);s(t.getTileCredits)&&(e.credits=t.getTileCredits(e.x,e.y,e.level)),Mi(n,a,r)}o()}},{key:"_createTexture",value:function(e,t){var i=this._imageryProvider,n=t.image;if(s(i.tileDiscardPolicy)){var r=i.tileDiscardPolicy;if(s(r)){if(!r.isReady())return void(t.state=wu.RECEIVED);if(r.shouldDiscardImage(n))return void(t.state=wu.INVALID)}}i.tilingScheme.projection instanceof Un?t.textureWebMercator=n:t.texture=n,t.image=void 0,t.state=wu.TEXTURE_LOADED}},{key:"_reprojectTexture",value:function(e,t){var i=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],n=t.textureWebMercator||t.texture,r=t.rectangle,a=e.context;if(i=o(i,!0),i&&!(this._imageryProvider.tilingScheme.projection instanceof Ce)&&r.width/n.image.width>1e-5){var s=this;t.addReference();var u=new yc({persists:!0,owner:this,preExecute:function(e){Cc(e,a,n,t.rectangle)},postExecute:function(e){t.texture=e,Ic(s,a,t,e),t.releaseReference()}});this._reprojectComputeCommands.push(u)}else i&&(t.texture=n),Ic(this,a,t,n)}},{key:"_calculateTextureTranslationAndScale",value:function(e,t){var i=t.readyImagery.rectangle,n=e.rectangle;if(t.useWebMercatorT){var r=t.readyImagery.imageryLayer.imageryProvider.tilingScheme;i=r.rectangleToNativeRectangle(i,wc),n=r.rectangleToNativeRectangle(n,Ec)}var a=n.width,o=n.height,s=a/i.width,u=o/i.height;return new po(s*(n.west-i.west)/a,u*(n.south-i.south)/o,s,u)}},{key:"cancelReprojections",value:function(){this._reprojectComputeCommands.length=0}},{key:"removeImageryFromCache",value:function(e){var t=Sc(e.x,e.y,e.level);delete this._imageryCache[t]}},{key:"destroy",value:function(){return ti(this)}}]),e}();Oc.DEFAULT_BRIGHTNESS=1,Oc.DEFAULT_CONTRAST=1,Oc.DEFAULT_HUE=0,Oc.DEFAULT_SATURATION=1,Oc.DEFAULT_GAMMA=1,Oc.DEFAULT_SPLIT=lc.NONE,Oc.DEFAULT_BRIGHTNESS=1,Oc.DEFAULT_CONTRAST=1,Oc.DEFAULT_HUE=0,Oc.DEFAULT_SATURATION=1,Oc.DEFAULT_GAMMA=1,Oc.DEFAULT_SPLIT=lc.NONE;var kc=function(){function e(){Object(r["a"])(this,e),this._layers=[],this.layerAdded=new si,this.layerRemoved=new si,this.layerMoved=new si,this.layerShownOrHidden=new si}return Object(a["a"])(e,[{key:"length",get:function(){return this._layers.length}},{key:"add",value:function(e,t){var i=s(t);if(!s(e))throw new u("layer is required.");if(i){if(t<0)throw new u("index must be greater than or equal to zero.");if(t>this._layers.length)throw new u("index must be less than or equal to the number of layers.")}i?this._layers.splice(t,0,e):(t=this._layers.length,this._layers.push(e)),this._update(),this.layerAdded.raiseEvent(e,t)}},{key:"addImageryProvider",value:function(e,t){if(!s(e))throw new u("imageryProvider is required.");var i=new Oc(e,{});return this.add(i,t),i}},{key:"remove",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];t=o(t,!0);var i=this._layers.indexOf(e);return-1!==i&&(this._layers.splice(i,1),this._update(),this.layerRemoved.raiseEvent(e,i),t&&e.destroy(),!0)}},{key:"removeAll",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];e=o(e,!0);for(var t=this._layers,i=0,n=t.length;i<n;i++){var r=t[i];this.layerRemoved.raiseEvent(r,i),e&&r.destroy()}this._layers=[]}},{key:"contains",value:function(e){return-1!==this.indexOf(e)}},{key:"indexOf",value:function(e){return this._layers.indexOf(e)}},{key:"get",value:function(e){if(!s(e))throw new u("index is required.");return this._layers[e]}},{key:"isDestroyed",value:function(){return!1}},{key:"destroy",value:function(){return this.removeAll(!0),ti(this)}},{key:"_update",value:function(){var e,t,i,n,r=!0,a=this._layers;for(i=0,n=a.length;i<n;++i)t=a[i],t._layerIndex=i,t.show?(t._isBaseLayer=r,r=!1):t._isBaseLayer=!1,t.show!==t._show&&(s(t._show)&&(s(e)||(e=[]),e.push(t)),t._show=t.show);if(s(e))for(i=0,n=e.length;i<n;++i)t=e[i],this.layerShownOrHidden.raiseEvent(t,t._layerIndex,t.show)}},{key:"queueReprojectionCommands",value:function(e){for(var t=this._layers,i=0,n=t.length;i<n;++i)t[i].queueReprojectionCommands(e)}},{key:"cancelReprojections",value:function(){for(var e=this._layers,t=0,i=e.length;t<i;++t)e[t].cancelReprojections()}}]),e}(),Pc=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{ellipsoid:Ie.WGS84};Object(r["a"])(this,e),this._ellipsoid=new go(t.ellipsoid,re.ZERO)}return Object(a["a"])(e,[{key:"ellipsoid",get:function(){return this._ellipsoid}}]),e}(),Mc=(i("4de4"),function(){function e(t){Object(r["a"])(this,e),this._tilingScheme=t.tilingScheme,this._x=t.x,this._y=t.y,this._level=t.level,this._parent=t.parent,this._rectangle=this._tilingScheme.tileXYToRectangle(this._x,this._y,this._level),this._southwestChild=void 0,this._southeastChild=void 0,this._northwestChild=void 0,this._northeastChild=void 0,this.replacementPrevious=void 0,this.replacementNext=void 0,this._distance=0,this._loadPriority=0,this._customData=[],this._frameUpdated=void 0,this._lastSelectionResult=qu.NONE,this._lastSelectionResultFrame=void 0,this._loadedCallbacks={},this.state=gu.START,this.renderable=!1,this.upsampledFromParent=!1,this.data=void 0}return Object(a["a"])(e,[{key:"tilingScheme",get:function(){return this._tilingScheme}},{key:"x",get:function(){return this._x}},{key:"y",get:function(){return this._y}},{key:"level",get:function(){return this._level}},{key:"parent",get:function(){return this._parent}},{key:"rectangle",get:function(){return this._rectangle}},{key:"children",get:function(){return[this.northwestChild,this.northeastChild,this.southwestChild,this.southeastChild]}},{key:"southwestChild",get:function(){return s(this._southwestChild)||(this._southwestChild=new e({tilingScheme:this.tilingScheme,x:2*this.x,y:2*this.y+1,level:this.level+1,parent:this})),this._southwestChild}},{key:"southeastChild",get:function(){return s(this._southeastChild)||(this._southeastChild=new e({tilingScheme:this.tilingScheme,x:2*this.x+1,y:2*this.y+1,level:this.level+1,parent:this})),this._southeastChild}},{key:"northwestChild",get:function(){return s(this._northwestChild)||(this._northwestChild=new e({tilingScheme:this.tilingScheme,x:2*this.x,y:2*this.y,level:this.level+1,parent:this})),this._northwestChild}},{key:"northeastChild",get:function(){return s(this._northeastChild)||(this._northeastChild=new e({tilingScheme:this.tilingScheme,x:2*this.x+1,y:2*this.y,level:this.level+1,parent:this})),this._northeastChild}},{key:"customData",get:function(){return this._customData}},{key:"needsLoading",get:function(){return this.state<gu.DONE}},{key:"_updateCustomData",value:function(e,t,i){var n,r,a,o=this.customData;if(s(t)&&s(i)){for(o=o.filter((function(e){return-1===i.indexOf(e)})),this._customData=o,a=this._rectangle,n=0;n<t.length;++n)r=t[n],Oe.contains(a,r.positionCartographic)&&o.push(r);this._frameUpdated=e}else{var u=this._parent;if(s(u)&&this._frameUpdated!==u._frameUpdated){o.length=0,a=this._rectangle;var l=u.customData;for(n=0;n<l.length;++n)r=l[n],Oe.contains(a,r.positionCartographic)&&o.push(r);this._frameUpdated=u._frameUpdated}}}},{key:"freeResources",value:function(){this.state=gu.START,this.renderable=!1,this.upsampledFromParent=!1,s(this.data)&&s(this.data.freeResources)&&this.data.freeResources(),Nc(this._southwestChild),this._southwestChild=void 0,Nc(this._southeastChild),this._southeastChild=void 0,Nc(this._northwestChild),this._northwestChild=void 0,Nc(this._northeastChild),this._northeastChild=void 0}}],[{key:"createLevelZeroTiles",value:function(t){if(!s(t))throw new u("tilingScheme is required.");for(var i=t.getNumberOfXTilesAtLevel(0),n=t.getNumberOfYTilesAtLevel(0),r=new Array(i*n),a=0,o=0;o<n;++o)for(var l=0;l<i;++l)r[a++]=new e({tilingScheme:t,x:l,y:o,level:0});return r}}]),e}());function Nc(e){s(e)&&e.freeResources()}function Ac(e,t){var i=t.replacementPrevious,n=t.replacementNext;t===e._lastBeforeStartOfFrame&&(e._lastBeforeStartOfFrame=n),t===e.head?e.head=n:i.replacementNext=n,t===e.tail?e.tail=i:n.replacementPrevious=i,t.replacementPrevious=void 0,t.replacementNext=void 0,--e.count}var Dc=function(){function e(){Object(r["a"])(this,e),this.head=void 0,this.tail=void 0,this.count=0,this._lastBeforeStartOfFrame=void 0}return Object(a["a"])(e,[{key:"markStartOfRenderFrame",value:function(){this._lastBeforeStartOfFrame=this.head}},{key:"trimTiles",value:function(e){var t=this.tail,i=!0;while(i&&s(this._lastBeforeStartOfFrame)&&this.count>e&&s(t)){i=t!==this._lastBeforeStartOfFrame;var n=t.replacementPrevious;t.eligibleForUnloading&&(t.freeResources(),Ac(this,t)),t=n}}},{key:"markTileRendered",value:function(e){var t=this.head;if(t!==e){if(++this.count,!s(t))return e.replacementPrevious=void 0,e.replacementNext=void 0,this.head=e,void(this.tail=e);(s(e.replacementPrevious)||s(e.replacementNext))&&Ac(this,e),e.replacementPrevious=void 0,e.replacementNext=t,t.replacementPrevious=e,this.head=e}else e===this._lastBeforeStartOfFrame&&(this._lastBeforeStartOfFrame=e.replacementNext)}}]),e}();function Lc(e,t){var i=e._tileLoadQueueHigh.length+e._tileLoadQueueMedium.length+e._tileLoadQueueLow.length;(i!==e._lastTileLoadQueueLength||e._tilesInvalidated)&&(e._lastTileLoadQueueLength=i);var n=e._debug;n.enableDebugOutput&&!n.suspendLodUpdate&&(n.maxDepth=e._tilesToRender.reduce((function(e,t){return Math.max(e,t.level)}),-1),n.tilesRendered=e._tilesToRender.length,n.tilesVisited===n.lastTilesVisited&&n.tilesRendered===n.lastTilesRendered&&n.tilesCulled===n.lastTilesCulled&&n.maxDepth===n.lastMaxDepth&&n.tilesWaitingForChildren===n.lastTilesWaitingForChildren&&n.maxDepthVisited===n.lastMaxDepthVisited||(console.log("Visited "+n.tilesVisited+", Rendered: "+n.tilesRendered+", Culled: "+n.tilesCulled+", Max Depth Rendered: "+n.maxDepth+", Max Depth Visited: "+n.maxDepthVisited+", Waiting for children: "+n.tilesWaitingForChildren),n.lastTilesVisited=n.tilesVisited,n.lastTilesRendered=n.tilesRendered,n.lastTilesCulled=n.tilesCulled,n.lastMaxDepth=n.maxDepth,n.lastTilesWaitingForChildren=n.tilesWaitingForChildren,n.lastMaxDepthVisited=n.maxDepthVisited))}function Uc(e){var t=e._debug;t.maxDepth=0,t.maxDepthVisited=0,t.tilesVisited=0,t.tilesCulled=0,t.tilesRendered=0,t.tilesWaitingForChildren=0,e._tileLoadQueueHigh.length=0,e._tileLoadQueueMedium.length=0,e._tileLoadQueueLow.length=0}function Fc(e){var t=e._tileReplacementQueue;t.head=void 0,t.tail=void 0,t.count=0,Uc(e);var i=e._levelZeroTiles;if(s(i))for(var n=0;n<i.length;++n){for(var r=i[n],a=r.customData,o=a.length,u=0;u<o;++u){var l=a[u];l.level=0,e._addHeightCallbacks.push(l)}i[n].freeResources()}e._levelZeroTiles=void 0,e._tileProvider.cancelReprojections()}var Hc,zc=function(){function e(t){Object(r["a"])(this,e),this.isDestroyed=function(){return!1},this.destroy=function(){this._tileProvider=this._tileProvider&&this._tileProvider.destroy()},this._tileProvider=t.tileProvider,this._tileProvider.quadtree=this,this._debug={enableDebugOutput:!1,maxDepth:0,maxDepthVisited:0,tilesVisited:0,tilesCulled:0,tilesRendered:0,tilesWaitingForChildren:0,lastMaxDepth:-1,lastMaxDepthVisited:-1,lastTilesVisited:-1,lastTilesCulled:-1,lastTilesRendered:-1,lastTilesWaitingForChildren:-1,suspendLodUpdate:!1};var i=this._tileProvider.tilingScheme,n=i.ellipsoid;this._tilesToRender=[],this._tileLoadQueueHigh=[],this._tileLoadQueueMedium=[],this._tileLoadQueueLow=[],this._tileReplacementQueue=new Dc,this._levelZeroTiles=void 0,this._loadQueueTimeSlice=5,this._tilesInvalidated=!1,this._addHeightCallbacks=[],this._removeHeightCallbacks=[],this._tileToUpdateHeights=[],this._lastTileIndex=0,this._updateHeightsTimeSlice=2,this._cameraPositionCartographic=void 0,this._cameraReferenceFrameOriginCartographic=void 0,this.maximumScreenSpaceError=o(t.maximumScreenSpaceError,2),this.tileCacheSize=o(t.tileCacheSize,100),this.loadingDescendantLimit=20,this.preloadAncestors=!0,this.preloadSiblings=!1,this._occluders=new Pc({ellipsoid:n}),this._tileLoadProgressEvent=new si,this._lastTileLoadQueueLength=0,this._lastSelectionFrameNumber=void 0}return Object(a["a"])(e,[{key:"tileProvider",get:function(){return this._tileProvider}},{key:"tileLoadProgressEvent",get:function(){return this._tileLoadProgressEvent}},{key:"occluders",get:function(){return this._occluders}},{key:"invalidateAllTiles",value:function(){this._tilesInvalidated=!0}},{key:"forEachLoadedTile",value:function(e){var t=this._tileReplacementQueue.head;while(s(t))t.state!==gu.START&&e(t),t=t.replacementNext}},{key:"forEachRenderedTile",value:function(e){for(var t=this._tilesToRender,i=0,n=t.length;i<n;++i)e(t[i])}},{key:"updateHeight",value:function(e,t){var i=this,n={positionOnEllipsoidSurface:void 0,positionCartographic:e,level:-1,callback:t,removeFunc:function(){for(var e=i._addHeightCallbacks,t=e.length,r=0;r<t;++r)if(e[r]===n){e.splice(r,1);break}i._removeHeightCallbacks.push(n)}};return i._addHeightCallbacks.push(n),n.removeFunc}},{key:"update",value:function(e){s(this._tileProvider.update)&&this._tileProvider.update(e)}},{key:"beginFrame",value:function(e){var t=e.passes;t.render&&(this._tilesInvalidated&&(Fc(this),this._tilesInvalidated=!1),this._tileProvider.initialize(e),Uc(this),this._debug.suspendLodUpdate||this._tileReplacementQueue.markStartOfRenderFrame())}},{key:"render",value:function(e){var t=e.passes,i=this._tileProvider;t.render&&(i.beginUpdate(e),Wc(this,e),ch(this,e),i.endUpdate(e)),t.pick&&this._tilesToRender.length>0&&i.updateForPick(e)}},{key:"endFrame",value:function(e){var t=e.passes;t.render&&e.mode!==cu.MORPHING&&(ih(this,e),lh(this,e),Lc(this,e))}}]),e}(),qc=new me;function Bc(e,t){var i=Oe.center(e.rectangle,qc),n=i.longitude-Hc.longitude,r=i.latitude-Hc.latitude;i=Oe.center(t.rectangle,qc);var a=i.longitude-Hc.longitude,o=i.latitude-Hc.latitude;return n*n+r*r-(a*a+o*o)}new re;var jc=[];function Wc(e,t){var i=e._debug;if(!i.suspendLodUpdate){var n,r=e._tilesToRender;r.length=0;var a,o=e._tileProvider;if(!s(e._levelZeroTiles)){if(!o.ready)return;var u=o.tilingScheme;e._levelZeroTiles=Mc.createLevelZeroTiles(u);var l=e._levelZeroTiles.length;if(jc.length<l)for(jc=new Array(l),n=0;n<l;++n)void 0===jc[n]&&(jc[n]=new Gc)}e._occluders.ellipsoid.cameraPosition=t.camera.positionWC;var c=e._levelZeroTiles,h=c.length>1?e._occluders:void 0;Hc=t.camera.positionCartographic,c.sort(Bc);var d,m=e._addHeightCallbacks,f=e._removeHeightCallbacks,v=t.frameNumber;if(m.length>0||f.length>0){for(n=0,d=c.length;n<d;++n)a=c[n],a._updateCustomData(v,m,f);m.length=0,f.length=0}var g=t.camera;e._cameraPositionCartographic=g.positionCartographic;var p=new re(0,0,0);for(e._cameraReferenceFrameOriginCartographic=e.tileProvider.tilingScheme.ellipsoid.cartesianToCartographic(p,e._cameraReferenceFrameOriginCartographic),n=0,d=c.length;n<d;++n)a=c[n],e._tileReplacementQueue.markTileRendered(a),a.renderable?$c(e,a,o,t,h,!1,jc[n]):(Vc(e,e._tileLoadQueueHigh,a,t),++i.tilesWaitingForChildren);e._lastSelectionFrameNumber=v}}function Vc(e,t,i,n){i.needsLoading&&(void 0!==e.tileProvider.computeTileLoadPriority&&(i._loadPriority=e.tileProvider.computeTileLoadPriority(i,n)),t.push(i))}for(var Gc=function e(){Object(r["a"])(this,e),this.allAreRenderable=!0,this.anyWereRenderedLastFrame=!1,this.notYetRenderableCount=0},Yc=function(){function e(){Object(r["a"])(this,e),this.southwest=new Gc,this.southeast=new Gc,this.northwest=new Gc,this.northeast=new Gc}return Object(a["a"])(e,[{key:"combine",value:function(e){var t=this.southwest,i=this.southeast,n=this.northwest,r=this.northeast;e.allAreRenderable=t.allAreRenderable&&i.allAreRenderable&&n.allAreRenderable&&r.allAreRenderable,e.anyWereRenderedLastFrame=t.anyWereRenderedLastFrame||i.anyWereRenderedLastFrame||n.anyWereRenderedLastFrame||r.anyWereRenderedLastFrame,e.notYetRenderableCount=t.notYetRenderableCount+i.notYetRenderableCount+n.notYetRenderableCount+r.notYetRenderableCount}}]),e}(),Zc=new Array(31),Xc=0;Xc<Zc.length;++Xc)Zc[Xc]=new Yc;function Qc(e,t,i,n,r){var a=e._debug;++a.tilesVisited,e._tileReplacementQueue.markTileRendered(i),i._updateCustomData(t.frameNumber),i.level>a.maxDepthVisited&&(a.maxDepthVisited=i.level);var o=eh(e,t,i)<e.maximumScreenSpaceError,u=i.southwestChild,l=i.southeastChild,c=i.northwestChild,h=i.northeastChild,d=e._lastSelectionFrameNumber,m=i._lastSelectionResultFrame===d?i._lastSelectionResult:qu.NONE,f=e.tileProvider;if(o||n){var v=qu.originalResult(m)===qu.RENDERED,g=qu.originalResult(m)===qu.CULLED||m===qu.NONE,p=i.state===gu.DONE,y=v||g||p;if(y||s(f.canRenderWithoutLosingDetail)&&(y=f.canRenderWithoutLosingDetail(i)),y)return o&&Vc(e,e._tileLoadQueueMedium,i,t),th(e,i),r.allAreRenderable=i.renderable,r.anyWereRenderedLastFrame=m===qu.RENDERED,r.notYetRenderableCount=i.renderable?0:1,i._lastSelectionResultFrame=t.frameNumber,i._lastSelectionResult=qu.RENDERED,void(r.anyWereRenderedLastFrame||e._tileToUpdateHeights.push(i));n=!0,o&&Vc(e,e._tileLoadQueueHigh,i,t)}if(f.canRefine(i)){var _=u.upsampledFromParent&&l.upsampledFromParent&&c.upsampledFromParent&&h.upsampledFromParent;if(_)return th(e,i),Vc(e,e._tileLoadQueueMedium,i,t),e._tileReplacementQueue.markTileRendered(u),e._tileReplacementQueue.markTileRendered(l),e._tileReplacementQueue.markTileRendered(c),e._tileReplacementQueue.markTileRendered(h),r.allAreRenderable=i.renderable,r.anyWereRenderedLastFrame=m===qu.RENDERED,r.notYetRenderableCount=i.renderable?0:1,i._lastSelectionResultFrame=t.frameNumber,i._lastSelectionResult=qu.RENDERED,void(r.anyWereRenderedLastFrame||e._tileToUpdateHeights.push(i));i._lastSelectionResultFrame=t.frameNumber,i._lastSelectionResult=qu.REFINED;var w=e._tilesToRender.length,T=e._tileLoadQueueLow.length,x=e._tileLoadQueueMedium.length,E=e._tileLoadQueueHigh.length,S=e._tileToUpdateHeights.length;if(Kc(e,u,l,c,h,t,n,r),w!==e._tilesToRender.length){var b=r.allAreRenderable,I=r.anyWereRenderedLastFrame,R=r.notYetRenderableCount,C=!1;if(!b&&!I){for(var O=e._tilesToRender,k=w;k<O.length;++k){var P=O[k];while(void 0!==P&&P!==i)P._lastSelectionResult=qu.kick(P._lastSelectionResult),P=P.parent}e._tilesToRender.length=w,e._tileToUpdateHeights.length=S,th(e,i),i._lastSelectionResult=qu.RENDERED;var M=m===qu.RENDERED;!M&&R>e.loadingDescendantLimit&&(e._tileLoadQueueLow.length=T,e._tileLoadQueueMedium.length=x,e._tileLoadQueueHigh.length=E,Vc(e,e._tileLoadQueueMedium,i,t),r.notYetRenderableCount=i.renderable?0:1,C=!0),r.allAreRenderable=i.renderable,r.anyWereRenderedLastFrame=M,M||e._tileToUpdateHeights.push(i),++a.tilesWaitingForChildren}e.preloadAncestors&&!C&&Vc(e,e._tileLoadQueueLow,i,t)}}else i._lastSelectionResultFrame=t.frameNumber,i._lastSelectionResult=qu.RENDERED,th(e,i),Vc(e,e._tileLoadQueueHigh,i,t),r.allAreRenderable=i.renderable,r.anyWereRenderedLastFrame=m===qu.RENDERED,r.notYetRenderableCount=i.renderable?0:1}function Kc(e,t,i,n,r,a,o,s){var u=a.camera.positionCartographic,l=e._tileProvider,c=e._occluders,h=Zc[t.level],d=h.southwest,m=h.southeast,f=h.northwest,v=h.northeast;u.longitude<t.rectangle.east?u.latitude<t.rectangle.north?($c(e,t,l,a,c,o,d),$c(e,i,l,a,c,o,m),$c(e,n,l,a,c,o,f),$c(e,r,l,a,c,o,v)):($c(e,n,l,a,c,o,f),$c(e,t,l,a,c,o,d),$c(e,r,l,a,c,o,v),$c(e,i,l,a,c,o,m)):u.latitude<t.rectangle.north?($c(e,i,l,a,c,o,m),$c(e,t,l,a,c,o,d),$c(e,r,l,a,c,o,v),$c(e,n,l,a,c,o,f)):($c(e,r,l,a,c,o,v),$c(e,n,l,a,c,o,f),$c(e,i,l,a,c,o,m),$c(e,t,l,a,c,o,d)),h.combine(s)}function Jc(e,t){var i=t.rectangle;return s(e._cameraPositionCartographic)&&Oe.contains(i,e._cameraPositionCartographic)||s(e._cameraReferenceFrameOriginCartographic)&&Oe.contains(i,e._cameraReferenceFrameOriginCartographic)}function $c(e,t,i,n,r,a,o){if(i.computeTileVisibility(t,n,r)!==hu.NONE)return Qc(e,n,t,a,o);if(++e._debug.tilesCulled,e._tileReplacementQueue.markTileRendered(t),o.allAreRenderable=!0,o.anyWereRenderedLastFrame=!1,o.notYetRenderableCount=0,Jc(e,t)){s(t.data)&&s(t.data.vertexArray)||Vc(e,e._tileLoadQueueMedium,t,n);var u=e._lastSelectionFrameNumber,l=t._lastSelectionResultFrame===u?t._lastSelectionResult:qu.NONE;l!==qu.CULLED_BUT_NEEDED&&l!==qu.RENDERED&&e._tileToUpdateHeights.push(t),t._lastSelectionResult=qu.CULLED_BUT_NEEDED}else e.preloadSiblings||0===t.level?(Vc(e,e._tileLoadQueueLow,t,n),t._lastSelectionResult=qu.CULLED):t._lastSelectionResult=qu.CULLED;t._lastSelectionResultFrame=n.frameNumber}function eh(e,t,i){var n=e._tileProvider.getLevelMaximumGeometricError(i.level),r=i._distance,a=t.scene.drawingBufferSize.height,o=t.camera.frustum.sseDenominator,s=n*a/(r*o);return s/=t.pixelRatio,s}function th(e,t){e._tilesToRender.push(t)}function ih(e,t){var i=e._tileLoadQueueHigh,n=e._tileLoadQueueMedium,r=e._tileLoadQueueLow;if(0!==i.length||0!==n.length||0!==r.length){e._tileReplacementQueue.trimTiles(e.tileCacheSize);var a=na()+e._loadQueueTimeSlice,o=e._tileProvider,s=rh(e,t,o,a,i,!1);s=rh(e,t,o,a,n,s),rh(e,t,o,a,r,s)}}function nh(e,t){return e._loadPriority-t._loadPriority}function rh(e,t,i,n,r,a){void 0!==i.computeTileLoadPriority&&r.sort(nh);for(var o=0,s=r.length;o<s&&(na()<n||!a);++o){var u=r[o];e._tileReplacementQueue.markTileRendered(u),i.loadTile(t,u),a=!0}return a}var ah=new n["A"],oh=new me,sh=new re,uh=[];function lh(e,t){if(e.tileProvider.ready){var i=uh;i.length=0;var n,r=e._tileToUpdateHeights,a=na(),u=e._updateHeightsTimeSlice,l=a+u,c=t.mode,h=t.mapProjection,d=e.tileProvider.tilingScheme.ellipsoid;while(r.length>0){var m=r[0];if(s(m.data)&&s(m.data.mesh)){var f=m.customData,v=f.length,g=!1;for(n=e._lastTileIndex;n<v;++n){var p=f[n],y=m.data.terrainData,_=s(y)&&y.wasCreatedByUpsampling();if(m.level>p.level&&!_){if(s(p.positionOnEllipsoidSurface)||(p.positionOnEllipsoidSurface=re.fromRadians(p.positionCartographic.longitude,p.positionCartographic.latitude,0,d)),c===cu.SCENE3D){var w=d.geodeticSurfaceNormal(p.positionOnEllipsoidSurface,ah.direction),T=d.getSurfaceNormalIntersectionWithZAxis(p.positionOnEllipsoidSurface,11500,ah.origin);if(!s(T)){var x=void 0;s(m.data.tileBoundingRegion)&&(x=m.data.tileBoundingRegion.minimumHeight);var E=Math.min(o(x,0),-11500),S=re.multiplyByScalar(w,Math.abs(E)+1,sh);re.subtract(p.positionOnEllipsoidSurface,S,ah.origin)}}else me.clone(p.positionCartographic,oh),oh.height=-11500,h.project(oh,sh),re.fromElements(sh.z,sh.x,sh.y,sh),re.clone(sh,ah.origin),re.clone(re.UNIT_X,ah.direction);var b=m.data.pick(ah,c,h,!1,sh);s(b)&&(p.callback(b),p.level=m.level)}if(na()>=l){g=!0;break}}if(g){e._lastTileIndex=n;break}e._lastTileIndex=0,r.shift()}else{var I=m._lastSelectionResultFrame===e._lastSelectionFrameNumber?m._lastSelectionResult:qu.NONE;I!==qu.RENDERED&&I!==qu.CULLED_BUT_NEEDED||i.push(m),r.shift(),e._lastTileIndex=0}}for(n=0;n<i.length;n++)r.push(i[n])}}function ch(e,t){for(var i=e._tileProvider,n=e._tilesToRender,r=0,a=n.length;r<a;++r){var o=n[r];i.showTileThisFrame(o,t)}}var hh=new re,dh=new re,mh=new me,fh=new St,vh=[],gh={start:0,stop:0};new re,new n["B"],new n["L"],new n["r"](new n["F"](6378137,32,32));function ph(e,t){return s(e)&&Oe.contains(e.rectangle,t)?e:void 0}function yh(e){return function(t,i){var n=ht.distanceSquaredTo(t.pickBoundingSphere,e),r=ht.distanceSquaredTo(i.pickBoundingSphere,e);return n-r}}var _h,wh=function(e){Object(Kn["a"])(i,e);var t=Object(Jn["a"])(i);function i(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Ie.WGS84;Object(r["a"])(this,i),e=t.call(this);var a=new fu({ellipsoid:n});e._ellipsoid=n;var o=new kc;return e._imageryLayerCollection=o,e._surface=new zc({tileProvider:new dc({terrainProvider:new fu,imageryLayers:o})}),e._terrainProvider=a,e._terrainProviderChanged=new si,e.maximumScreenSpaceError=2,e.tileCacheSize=100,e.showGroundAtmosphere=!0,e._zoomedOutOceanSpecularIntensity=.4,e.terrainExaggeration=1,e.terrainExaggerationRelativeHeight=0,e.terrainProvider=new fu,e}return Object(a["a"])(i,[{key:"ellipsoid",get:function(){return this._ellipsoid}},{key:"terrainProvider",get:function(){return this._terrainProvider},set:function(e){e!==this._terrainProvider&&(this._terrainProvider=e,this._terrainProviderChanged.raiseEvent(e))}},{key:"imageryLayers",get:function(){return this._imageryLayerCollection}},{key:"imageryLayersUpdatedEvent",get:function(){return this._surface.tileProvider.imageryLayersUpdatedEvent}},{key:"tilesLoaded",get:function(){return!s(this._surface)||this._surface.tileProvider.ready&&0===this._surface._tileLoadQueueHigh.length&&0===this._surface._tileLoadQueueMedium.length&&0===this._surface._tileLoadQueueLow.length}},{key:"terrainProviderChanged",get:function(){return this._terrainProviderChanged}},{key:"getHeight",value:function(e){if(!s(e))throw new u("cartographic is required");var t=this._surface._levelZeroTiles;if(s(t)){var i,n,r=t.length;for(n=0;n<r;++n)if(i=t[n],Oe.contains(i.rectangle,e))break;if(!(n>=r)){var a=i;while(s(i))i=ph(i._southwestChild,e)||ph(i._southeastChild,e)||ph(i._northwestChild,e)||i._northeastChild,s(i)&&s(i.data)&&s(i.data.renderedMesh)&&(a=i);if(i=a,s(i)&&s(i.data)&&s(i.data.renderedMesh)){var l=this._surface._tileProvider.tilingScheme.projection,c=this._surface._tileProvider.tilingScheme.ellipsoid,h=re.fromRadians(e.longitude,e.latitude,0,c,hh),d=fh,m=c.geodeticSurfaceNormal(h,d.direction),f=c.getSurfaceNormalIntersectionWithZAxis(h,11500,d.origin);if(!s(f)){var v;s(i.data.tileBoundingRegion)&&(v=i.data.tileBoundingRegion.minimumHeight);var g=Math.min(o(v,0),-11500),p=re.multiplyByScalar(m,Math.abs(g)+1,dh);re.subtract(h,p,d.origin)}var y=i.data.pick(d,void 0,l,!1,dh);if(s(y))return c.cartesianToCartographic(y,mh).height}}}}},{key:"render",value:function(e){if(this.visible){var t=this._surface,i=e.passes;i.render&&t.render(e)}}},{key:"beginFrame",value:function(e){var t=this._surface,i=t.tileProvider,n=(this.terrainProvider,e.passes);e.mode;n.render&&(this.showGroundAtmosphere?this._zoomedOutOceanSpecularIntensity=.4:this._zoomedOutOceanSpecularIntensity=.5,i.terrainProvider=this.terrainProvider,t.maximumScreenSpaceError=this.maximumScreenSpaceError,t.tileCacheSize=this.tileCacheSize,i.terrainProvider=this.terrainProvider,t.beginFrame(e))}},{key:"endFrame",value:function(e){this.visible&&e.passes.render&&this._surface.endFrame(e)}},{key:"update",value:function(e){this.visible&&e.passes.render&&this._surface.update(e)}},{key:"pickWorldCoordinates",value:function(e,t){var i=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],n=arguments.length>3?arguments[3]:void 0;i=o(i,!0);var r=t.mode,a=t.mapProjection,u=vh;u.length=0;var l,c,h,d=this._surface._tilesToRender,m=d.length;for(c=0;c<m;++c){l=d[c];var f=l.data;if(s(f)){var v=f.pickBoundingSphere;if(r!==cu.SCENE3D)f.pickBoundingSphere=v=ht.fromRectangleWithHeights2D(l.rectangle,a,f.tileBoundingRegion.minimumHeight,f.tileBoundingRegion.maximumHeight,v),re.fromElements(v.center.z,v.center.x,v.center.y,v.center);else{if(!s(f.renderedMesh))continue;ht.clone(f.tileBoundingRegion.boundingSphere,v)}var g=bt.raySphere(e,v,gh);s(g)&&u.push(f)}}for(u.sort(yh(e.origin)),m=u.length,c=0;c<m;++c)if(h=u[c].pick(e,t.mode,t.mapProjection,i,n),s(h))break;return h}}]),i}(vu),Th=i("257e"),xh=i("b85c"),Eh=(i("38cf"),i("22b5")),Sh={LINEAR_NONE:Eh["a"].Linear.None,QUADRATIC_IN:Eh["a"].Quadratic.In,QUADRATIC_OUT:Eh["a"].Quadratic.Out,QUADRATIC_IN_OUT:Eh["a"].Quadratic.InOut,CUBIC_IN:Eh["a"].Cubic.In,CUBIC_OUT:Eh["a"].Cubic.Out,CUBIC_IN_OUT:Eh["a"].Cubic.InOut,QUARTIC_IN:Eh["a"].Quartic.In,QUARTIC_OUT:Eh["a"].Quartic.Out,QUARTIC_IN_OUT:Eh["a"].Quartic.InOut,QUINTIC_IN:Eh["a"].Quintic.In,QUINTIC_OUT:Eh["a"].Quintic.Out,QUINTIC_IN_OUT:Eh["a"].Quintic.InOut,SINUSOIDAL_IN:Eh["a"].Sinusoidal.In,SINUSOIDAL_OUT:Eh["a"].Sinusoidal.Out,SINUSOIDAL_IN_OUT:Eh["a"].Sinusoidal.InOut,EXPONENTIAL_IN:Eh["a"].Exponential.In,EXPONENTIAL_OUT:Eh["a"].Exponential.Out,EXPONENTIAL_IN_OUT:Eh["a"].Exponential.InOut,CIRCULAR_IN:Eh["a"].Circular.In,CIRCULAR_OUT:Eh["a"].Circular.Out,CIRCULAR_IN_OUT:Eh["a"].Circular.InOut,ELASTIC_IN:Eh["a"].Elastic.In,ELASTIC_OUT:Eh["a"].Elastic.Out,ELASTIC_IN_OUT:Eh["a"].Elastic.InOut,BACK_IN:Eh["a"].Back.In,BACK_OUT:Eh["a"].Back.Out,BACK_IN_OUT:Eh["a"].Back.InOut,BOUNCE_IN:Eh["a"].Bounce.In,BOUNCE_OUT:Eh["a"].Bounce.Out,BOUNCE_IN_OUT:Eh["a"].Bounce.InOut};(function(e){e[e["SECONDS_PER_MILLISECOND"]=.001]="SECONDS_PER_MILLISECOND",e[e["SECONDS_PER_MINUTE"]=60]="SECONDS_PER_MINUTE",e[e["MINUTES_PER_HOUR"]=60]="MINUTES_PER_HOUR",e[e["HOURS_PER_DAY"]=24]="HOURS_PER_DAY",e[e["SECONDS_PER_HOUR"]=3600]="SECONDS_PER_HOUR",e[e["MINUTES_PER_DAY"]=1440]="MINUTES_PER_DAY",e[e["SECONDS_PER_DAY"]=86400]="SECONDS_PER_DAY",e[e["DAYS_PER_JULIAN_CENTURY"]=36525]="DAYS_PER_JULIAN_CENTURY",e[e["PICOSECOND"]=1e-9]="PICOSECOND",e[e["MODIFIED_JULIAN_DATE_DIFFERENCE"]=2400000.5]="MODIFIED_JULIAN_DATE_DIFFERENCE"})(_h||(_h={}));var bh=function(){function e(t,i,n,a,o,s,u,l,c,h){Object(r["a"])(this,e),this._tweens=t,this._tweenjs=i,this._startObject=ui(n),this._stopObject=ui(a),this._duration=o,this._delay=s,this._easingFunction=u,this._update=l,this._complete=c,this.cancel=h,this.needsStart=!0}return Object(a["a"])(e,[{key:"startObject",get:function(){return this._startObject}},{key:"stopObject",get:function(){return this._stopObject}},{key:"duration",get:function(){return this._duration}},{key:"delay",get:function(){return this._delay}},{key:"easingFunction",get:function(){return this._easingFunction}},{key:"update",get:function(){return this._update}},{key:"complete",get:function(){return this._complete}},{key:"tweenjs",get:function(){return this._tweenjs}},{key:"cancelTween",value:function(){this._tweens.remove(this)}}]),e}(),Ih=function(){function e(){Object(r["a"])(this,e),this._tweens=[]}return Object(a["a"])(e,[{key:"length",get:function(){return this._tweens.length}},{key:"add",value:function(e){if(e=o(e,o.EMPTY_OBJECT),!s(e.startObject)||!s(e.stopObject))throw new u("options.startObject and options.stopObject are required.");if(!s(e.duration)||e.duration<0)throw new u("options.duration is required and must be positive.");if(0===e.duration)return s(e.complete)&&e.complete(),new bh(this);var t=e.duration/_h.SECONDS_PER_MILLISECOND,i=o(e.delay,0),n=i/_h.SECONDS_PER_MILLISECOND,r=o(e.easingFunction,Sh.LINEAR_NONE),a=e.startObject,l=new Eh["b"](a);l.to(ui(e.stopObject),t),l.delay(n),l.easing(r),s(e.update)&&l.onUpdate((function(){e.update(a)})),l.onComplete(o(e.complete,null)),l.repeat(o(e._repeat,0));var c=new bh(this,l,e.startObject,e.stopObject,e.duration,i,r,e.update,e.complete,e.cancel);return this._tweens.push(c),c}},{key:"remove",value:function(e){if(!s(e))return!1;var t=this._tweens.indexOf(e);return-1!==t&&(e.tweenjs.stop(),s(e.cancel)&&e.cancel(),this._tweens.splice(t,1),!0)}},{key:"removeAll",value:function(){for(var e=this._tweens,t=0;t<e.length;++t){var i=e[t];i.tweenjs.stop(),s(i.cancel)&&i.cancel()}e.length=0}},{key:"contains",value:function(e){return s(e)&&-1!==this._tweens.indexOf(e)}},{key:"get",value:function(e){return this._tweens[e]}},{key:"update",value:function(e){var t=this._tweens,i=0;e=s(e)?e/_h.SECONDS_PER_MILLISECOND:na();while(i<t.length){var n=t[i],r=n.tweenjs;n.needsStart?(n.needsStart=!1,r.start(e)):r.update(e)?i++:(r.stop(),t.splice(i,1))}}}]),e}(),Rh=function(){function e(){Object(r["a"])(this,e),this.enabled=!0,this.needsSwap=!0,this.clear=!1,this.renderToScreen=!1}return Object(a["a"])(e,[{key:"setSize",value:function(){}},{key:"render",value:function(e,t,i,n,r){console.error("THREE.Pass: .render() must be implemented in derived pass.")}}]),e}(),Ch=new n["u"](-.5,.5,.5,-.5,0,.5),Oh=new n["c"];Oh.setAttribute("position",new n["i"]([-1,3,0,-1,-1,0,3,-1,0],3)),Oh.setAttribute("uv",new n["i"]([0,2,0,0,2,0],2));var kh=function(){function e(t){Object(r["a"])(this,e),this._mesh=new n["r"](Oh,t)}return Object(a["a"])(e,[{key:"material",get:function(){return this._mesh.material},set:function(e){this._mesh.material=e}},{key:"dispose",value:function(){this._mesh.geometry.dispose()}},{key:"render",value:function(e){e.render(this._mesh,Ch)}}]),e}(),Ph=function(e){Object(Kn["a"])(i,e);var t=Object(Jn["a"])(i);function i(e,a){var o;return Object(r["a"])(this,i),o=t.call(this),o.textureID=void 0!==a?a:"tDiffuse",e instanceof n["E"]?(o.uniforms=e.uniforms,o.material=e):e&&(o.uniforms=n["K"].clone(e.uniforms),o.material=new n["E"]({uniforms:o.uniforms,vertexShader:e.vertexShader,fragmentShader:e.fragmentShader})),o.fsQuad=new kh(o.material),o}return Object(a["a"])(i,[{key:"render",value:function(e,t,i){this.uniforms[this.textureID]&&(this.uniforms[this.textureID].value=i.texture),this.fsQuad.material=this.material,this.renderToScreen?(e.setRenderTarget(null),this.fsQuad.render(e)):(e.setRenderTarget(t),this.clear&&e.clear(e.autoClearColor,e.autoClearDepth,e.autoClearStencil),this.fsQuad.render(e))}}]),i}(Rh),Mh=i("32d9"),Nh=function(){function e(t,i){Object(r["a"])(this,e),this._scene=t,this._renderer=t.renderer,this._context=i,this.renderTarget=new n["P"](256,256),this.effectComposer=void 0,this.computedShaderPass=void 0}return Object(a["a"])(e,[{key:"updateRenderTarget",value:function(e){var t=e.image,i=t.width,n=t.height;this.renderTarget.setSize(i,n),this.renderTarget.setTexture(e),this.effectComposer.setSize(i,n),this._renderer.clear(),this.effectComposer.reset(this.renderTarget)}},{key:"execute",value:function(e){var t=this.renderTarget;s(e.preExecute)&&e.preExecute(e),s(this.effectComposer)||(this.effectComposer=new Mh["a"](this._renderer,this.renderTarget),this.effectComposer.renderToScreen=!1,this.computedShaderPass=new Ph(new vc),this.effectComposer.addPass(this.computedShaderPass));var i=this.computedShaderPass,n=e.outputTexture;this.updateRenderTarget(n),i.fsQuad._mesh.geometry=e.geometry,i.fsQuad._mesh.frustumCulled=!1,i.material.uniforms.u_texture.value=e.material.texture,i.material.textureDimensions=e.material.textureDimensions,this.effectComposer.render(),i.material.uniforms.u_texture.value.dispose(),s(e.postExecute)&&e.postExecute(t.texture)}}]),e}(),Ah=new re,Dh=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;Object(r["a"])(this,e),this.x=t,this.y=i,this.z=n,this.w=a}return Object(a["a"])(e,null,[{key:"fromAxisAngle",value:function(t,i,n){var r=i/2,a=Math.sin(r);Ah=re.normalize(t,Ah);var o=Ah.x*a,u=Ah.y*a,l=Ah.z*a,c=Math.cos(r);return s(n)?(n.x=o,n.y=u,n.z=l,n.w=c,n):new e(o,u,l,c)}},{key:"multiply",value:function(e,t,i){var n=e.x,r=e.y,a=e.z,o=e.w,s=t.x,u=t.y,l=t.z,c=t.w,h=o*s+n*c+r*l-a*u,d=o*u-n*l+r*c+a*s,m=o*l+n*u-r*s+a*c,f=o*c-n*s-r*u-a*l;return i.x=h,i.y=d,i.z=m,i.w=f,i}},{key:"fromHeadingPitchRoll",value:function(t,i){return Hh=e.fromAxisAngle(re.UNIT_X,t.roll,Lh),Fh=e.fromAxisAngle(re.UNIT_Y,-t.pitch,i),i=e.multiply(Fh,Hh,Fh),Uh=e.fromAxisAngle(re.UNIT_Z,-t.heading,Lh),e.multiply(Uh,i,i)}}]),e}(),Lh=new Dh,Uh=new Dh,Fh=new Dh,Hh=new Dh;function zh(e){var t=e._uSquared,i=e._ellipsoid.maximumRadius,n=e._ellipsoid.minimumRadius,r=(i-n)/i,a=Math.cos(e._startHeading),o=Math.sin(e._startHeading),s=(1-r)*Math.tan(e._start.latitude),u=1/Math.sqrt(1+s*s),l=u*s,c=Math.atan2(s,a),h=u*o,d=h*h,m=1-d,f=Math.sqrt(m),v=t/4,g=v*v,p=g*v,y=g*g,_=1+v-3*g/4+5*p/4-175*y/64,w=1-v+15*g/8-35*p/8,T=1-3*v+35*g/4,x=1-5*v,E=_*c-w*Math.sin(2*c)*v/2-T*Math.sin(4*c)*g/16-x*Math.sin(6*c)*p/48-5*Math.sin(8*c)*y/512,S=e._constants;S.a=i,S.b=n,S.f=r,S.cosineHeading=a,S.sineHeading=o,S.tanU=s,S.cosineU=u,S.sineU=l,S.sigma=c,S.sineAlpha=h,S.sineSquaredAlpha=d,S.cosineSquaredAlpha=m,S.cosineAlpha=f,S.u2Over4=v,S.u4Over16=g,S.u6Over64=p,S.u8Over256=y,S.a0=_,S.a1=w,S.a2=T,S.a3=x,S.distanceRatio=E}function qh(e,t){return e*t*(4+e*(4-3*t))/16}function Bh(e,t,i,n,r,a,o){var s=qh(e,i);return(1-s)*e*t*(n+s*r*(o+s*a*(2*o*o-1)))}function jh(e,t,i,n,r,a,o){var s,u,l,c,h,d=(t-i)/t,m=a-n,f=Math.atan((1-d)*Math.tan(r)),v=Math.atan((1-d)*Math.tan(o)),g=Math.cos(f),p=Math.sin(f),y=Math.cos(v),_=Math.sin(v),w=g*y,T=g*_,x=p*_,E=p*y,S=m,b=ne.TWO_PI,I=Math.cos(S),R=Math.sin(S);do{I=Math.cos(S),R=Math.sin(S);var C=T-E*I;l=Math.sqrt(y*y*R*R+C*C),u=x+w*I,s=Math.atan2(l,u);var O=void 0;0===l?(O=0,c=1):(O=w*R/l,c=1-O*O),b=S,h=u-2*x/c,isFinite(h)||(h=0),S=m+Bh(d,O,c,s,l,u,h)}while(Math.abs(S-b)>ne.EPSILON12);var k=c*(t*t-i*i)/(i*i),P=1+k*(4096+k*(k*(320-175*k)-768))/16384,M=k*(256+k*(k*(74-47*k)-128))/1024,N=h*h,A=M*l*(h+M*(u*(2*N-1)-M*h*(4*l*l-3)*(4*N-3)/6)/4),D=i*P*(s-A),L=Math.atan2(y*R,T-E*I),U=Math.atan2(g*R,T*I-E);e._distance=D,e._startHeading=L,e._endHeading=U,e._uSquared=k}var Wh=new re,Vh=new re;function Gh(e,t,i,n){re.normalize(n.cartographicToCartesian(t,Vh),Wh),re.normalize(n.cartographicToCartesian(i,Vh),Vh);jh(e,n.maximumRadius,n.minimumRadius,t.longitude,t.latitude,i.longitude,i.latitude),e._start=me.clone(t,e._start),e._end=me.clone(i,e._end),e._start.height=0,e._end.height=0,zh(e)}var Yh=function(){function e(t,i,n){Object(r["a"])(this,e);var a=o(n,Ie.WGS84);this._ellipsoid=a,this._start=new me,this._end=new me,this._constants={},this._startHeading=void 0,this._endHeading=void 0,this._distance=void 0,this._uSquared=void 0,s(t)&&s(i)&&Gh(this,t,i,a)}return Object(a["a"])(e,[{key:"ellipsoid",get:function(){return this._ellipsoid}},{key:"surfaceDistance",get:function(){return this._distance}},{key:"start",get:function(){return this._start}},{key:"end",get:function(){return this._end}},{key:"startHeading",get:function(){return this._startHeading}},{key:"endHeading",get:function(){return this._endHeading}},{key:"setEndPoints",value:function(e,t){Gh(this,e,t,this._ellipsoid)}},{key:"interpolateUsingFraction",value:function(e,t){return this.interpolateUsingSurfaceDistance(this._distance*e,t)}},{key:"interpolateUsingSurfaceDistance",value:function(e,t){var i=this._constants,n=i.distanceRatio+e/i.b,r=Math.cos(2*n),a=Math.cos(4*n),o=Math.cos(6*n),u=Math.sin(2*n),l=Math.sin(4*n),c=Math.sin(6*n),h=Math.sin(8*n),d=n*n,m=n*d,f=i.u8Over256,v=i.u2Over4,g=i.u6Over64,p=i.u4Over16,y=2*m*f*r/3+n*(1-v+7*p/4-15*g/4+579*f/64-(p-15*g/4+187*f/16)*r-(5*g/4-115*f/16)*a-29*f*o/16)+(v/2-p+71*g/32-85*f/16)*u+(5*p/16-5*g/4+383*f/96)*l-d*((g-11*f/2)*u+5*f*l/2)+(29*g/96-29*f/16)*c+539*f*h/1536,_=Math.asin(Math.sin(y)*i.cosineAlpha),w=Math.atan(i.a/i.b*Math.tan(_));y-=i.sigma;var T=Math.cos(2*i.sigma+y),x=Math.sin(y),E=Math.cos(y),S=i.cosineU*E,b=i.sineU*x,I=Math.atan2(x*i.sineHeading,S-b*i.cosineHeading),R=I-Bh(i.f,i.sineAlpha,i.cosineSquaredAlpha,y,x,E,T);return s(t)?(t.longitude=this._start.longitude+R,t.latitude=w,t.height=0,t):new me(this._start.longitude+R,w,0)}}]),e}(),Zh=function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;Object(r["a"])(this,e),this.heading=t,this.pitch=i,this.range=n},Xh=function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;Object(r["a"])(this,e),this.heading=t,this.pitch=i,this.roll=n},Qh=function(e){Object(Kn["a"])(i,e);var t=Object(Jn["a"])(i);function i(e,n){return Object(r["a"])(this,i),t.call(this,n.left,n.right,n.top,n.bottom,n.near,n.far)}return i}(n["u"]),Kh=[new re,new re,new re];re.clone(re.UNIT_X,Kh[0]),re.clone(re.UNIT_Y,Kh[1]),re.clone(re.UNIT_Z,Kh[2]);new re,new re;var Jh=new wo(new re(1,0,0),0),$h=function(){function e(t){Object(r["a"])(this,e),this.planes=o(t,[])}return Object(a["a"])(e,[{key:"computeVisibility",value:function(e){if(!s(e))throw new u("boundingVolume is required.");for(var t=this.planes,i=!1,n=0,r=t.length;n<r;++n){var a=e.intersectPlane(wo.fromCartesian4(t[n],Jh));if(a===Re.OUTSIDE)return Re.OUTSIDE;a===Re.INTERSECTING&&(i=!0)}return i?Re.INTERSECTING:Re.INSIDE}},{key:"setFromThreeFrustum",value:function(e){for(var t=0;t<6;t++){var i=e.planes[t];s(this.planes[t])||(this.planes[t]=new po);var n=this.planes[t];n.x=i.normal.x,n.y=i.normal.y,n.z=i.normal.z,n.w=i.constant}}}]),e}(),ed=new re,td=new re,id=new re,nd=new re,rd=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};Object(r["a"])(this,e),this.left=t.left,this._left=void 0,this.right=t.right,this._right=void 0,this.top=t.top,this._top=void 0,this.bottom=t.bottom,this._bottom=void 0,this.near=o(t.near,1),this._near=this.near,this.far=o(t.far,5e8),this._far=this.far,this._cullingVolume=new $h,this._perspectiveMatrix=new to,this._infinitePerspective=new to}return Object(a["a"])(e,[{key:"projectionMatrix",get:function(){return ad(this),this._perspectiveMatrix}},{key:"infiniteProjectionMatrix",get:function(){return ad(this),this._infinitePerspective}},{key:"computeCullingVolume",value:function(e,t,i){if(!s(e))throw new u("position is required.");if(!s(t))throw new u("direction is required.");if(!s(i))throw new u("up is required.");var n=this._cullingVolume.planes,r=this.top,a=this.bottom,o=this.right,l=this.left,c=this.near,h=this.far,d=re.cross(t,i,ed),m=td;re.multiplyByScalar(t,c,m),re.add(e,m,m);var f=id;re.multiplyByScalar(t,h,f),re.add(e,f,f);var v=nd;re.multiplyByScalar(d,l,v),re.add(m,v,v),re.subtract(v,e,v),re.normalize(v,v),re.cross(v,i,v),re.normalize(v,v);var g=n[0];return s(g)||(g=n[0]=new po),g.x=v.x,g.y=v.y,g.z=v.z,g.w=-re.dot(v,e),re.multiplyByScalar(d,o,v),re.add(m,v,v),re.subtract(v,e,v),re.cross(i,v,v),re.normalize(v,v),g=n[1],s(g)||(g=n[1]=new po),g.x=v.x,g.y=v.y,g.z=v.z,g.w=-re.dot(v,e),re.multiplyByScalar(i,a,v),re.add(m,v,v),re.subtract(v,e,v),re.cross(d,v,v),re.normalize(v,v),g=n[2],s(g)||(g=n[2]=new po),g.x=v.x,g.y=v.y,g.z=v.z,g.w=-re.dot(v,e),re.multiplyByScalar(i,r,v),re.add(m,v,v),re.subtract(v,e,v),re.cross(v,d,v),re.normalize(v,v),g=n[3],s(g)||(g=n[3]=new po),g.x=v.x,g.y=v.y,g.z=v.z,g.w=-re.dot(v,e),g=n[4],s(g)||(g=n[4]=new po),g.x=t.x,g.y=t.y,g.z=t.z,g.w=-re.dot(t,m),re.negate(t,v),g=n[5],s(g)||(g=n[5]=new po),g.x=v.x,g.y=v.y,g.z=v.z,g.w=-re.dot(v,f),this._cullingVolume}},{key:"getPixelDimensions",value:function(e,t,i,n,r){if(ad(this),!s(e)||!s(t))throw new u("Both drawingBufferWidth and drawingBufferHeight are required.");if(e<=0)throw new u("drawingBufferWidth must be greater than zero.");if(t<=0)throw new u("drawingBufferHeight must be greater than zero.");if(!s(i))throw new u("distance is required.");if(!s(n))throw new u("pixelRatio is required");if(n<=0)throw new u("pixelRatio must be greater than zero.");if(!s(r))throw new u("A result object is required.");var a=1/this.near,o=this.top*a,l=2*n*i*o/t;o=this.right*a;var c=2*n*i*o/e;return r.x=c,r.y=l,r}},{key:"clone",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new e;return s(t)||(t=new e),t.right=this.right,t.left=this.left,t.top=this.top,t.bottom=this.bottom,t.near=this.near,t.far=this.far,t._left=void 0,t._right=void 0,t._top=void 0,t._bottom=void 0,t._near=void 0,t._far=void 0,t}},{key:"equals",value:function(t){return s(t)&&t instanceof e&&this.right===t.right&&this.left===t.left&&this.top===t.top&&this.bottom===t.bottom&&this.near===t.near&&this.far===t.far}},{key:"equalsEpsilon",value:function(t,i,n){return t===this||s(t)&&t instanceof e&&ne.equalsEpsilon(this.right,t.right,i,n)&&ne.equalsEpsilon(this.left,t.left,i,n)&&ne.equalsEpsilon(this.top,t.top,i,n)&&ne.equalsEpsilon(this.bottom,t.bottom,i,n)&&ne.equalsEpsilon(this.near,t.near,i,n)&&ne.equalsEpsilon(this.far,t.far,i,n)}}]),e}();function ad(e){if(!s(e.right)||!s(e.left)||!s(e.top)||!s(e.bottom)||!s(e.near)||!s(e.far))throw new u("right, left, top, bottom, near, or far parameters are not set.");var t=e.top,i=e.bottom,n=e.right,r=e.left,a=e.near,o=e.far;if(t!==e._top||i!==e._bottom||r!==e._left||n!==e._right||a!==e._near||o!==e._far){if(e.near<=0||e.near>e.far)throw new u("near must be greater than zero and less than far.");e._left=r,e._right=n,e._top=t,e._bottom=i,e._near=a,e._far=o,e._perspectiveMatrix=to.computePerspectiveOffCenter(r,n,i,t,a,o,e._perspectiveMatrix),e._infinitePerspective=to.computeInfinitePerspectiveOffCenter(r,n,i,t,a,e._infinitePerspective)}}var od=new re,sd=new n["M"],ud=new n["M"],ld=new to,cd=function(e){var t=e._mode,i=!1;cu.SCENE2D;var r=e.positionCartesian3,a=!re.equals(r,e.position)||i;a&&(r=re.clone(e.position,e.positionCartesian3));var o=e._right,s=!re.equals(o,e.right);s&&(re.normalize(e.right,e.right),o=re.clone(e.right,e._right)),t!==cu.SCENE3D&&t!==cu.MORPHING||(e._positionCartographic=e._projection.ellipsoid.cartesianToCartographic(e.positionCartesian3,e._positionCartographic)),e.fov===e._fov&&e.aspect===e._aspect&&e.near===e._near&&e.far===e._far||(e._aspect=e.aspect,e._fovRadius=e.fovRadius,e._fovy=n["p"].degToRad(e.fov),e._near=e.near,e._far=e.far,e._sseDenominator=2*Math.tan(.5*e.fovy))},hd=new n["M"],dd=new n["w"],md=function(e){Object(Kn["a"])(i,e);var t=Object(Jn["a"])(i);function i(e,a){var s;Object(r["a"])(this,i),s=t.call(this,a.fov,a.aspect,a.near,a.far),s.scene=e,s._offCenterFrustum=new rd,s._frustum=new n["j"],s._projScreenMatrix=new n["q"],s.containerWidth=0,s.containerHeight=0,s.up.set(0,0,1),s._positionCartographic=new me,s.positionCartesian3=new re,s._mode=e.mode,s._fov=s.fov,s._aspect=s.aspect,s._near=s.near,s._far=s.far,s._aspectRatio=void 0,s._sseDenominator=0,s._projection=e.mapProjection,s.transform=to.clone(to.IDENTITY),s.cesiumUp=new re,s._cesiumUp=new re,s._cesiumUpWC=new re,s.right=new re,s._right=new re,s._rightWC=new re,s.xOffset=o(a.xOffset,0),s._xOffset=s.xOffset,s.yOffset=o(a.yOffset,0),s._yOffset=s.yOffset;var u=60;if(s.aspect>1){var l=360*Math.atan(Math.tan(u*Math.PI/360)/s.aspect)/Math.PI;s.fov=l}else s.fov=2*Math.atan(Math.tan(u*Math.PI/180/2)*s.aspect)*180/Math.PI;return s._cullingVolume=new $h,s.updateProjectionMatrix(),s}return Object(a["a"])(i,[{key:"worldDirection",get:function(){return this.getWorldDirection(ud)}},{key:"directionWC",get:function(){return this.getWorldDirection(sd),od.x=sd.x,od.y=sd.y,od.z=sd.z,od}},{key:"frustum",get:function(){return this.updateProjectionMatrix(),this._projScreenMatrix.multiplyMatrices(this.projectionMatrix,this.matrixWorldInverse),this._frustum.setFromProjectionMatrix(this._projScreenMatrix),this._frustum}},{key:"positionWC",get:function(){return this.positionCartesian3.x=this.position.x,this.positionCartesian3.y=this.position.y,this.positionCartesian3.z=this.position.z,this.positionCartesian3}},{key:"fovy",get:function(){return fd(this),this._fovy}},{key:"positionCartographic",get:function(){var e=hd;return e.x=this.position.x,e.y=this.position.y,e.z=this.position.z,cd(this),this._positionCartographic}},{key:"fovRadius",get:function(){return n["p"].degToRad(this.fov)}},{key:"sseDenominator",get:function(){return cd(this),this._sseDenominator}},{key:"aspectRatio",get:function(){return this.aspect},set:function(e){this.aspect=e}},{key:"cesiumProjectMatrix",get:function(){return to.setFromThreeMatrix4(this.projectionMatrix,ld)}},{key:"resize",value:function(e){var t=e.clientWidth,i=e.clientHeight;this.aspect=t/i,this.aspect>1?this.fov=360*Math.atan(Math.tan(60*Math.PI/360)/this.aspect)/Math.PI:this.fov=60,this.updateProjectionMatrix(),this.containerWidth=t,this.containerHeight=i}},{key:"computeCullingVolume",value:function(e,t,i){return fd(this),this._offCenterFrustum.computeCullingVolume(e,t,i)}},{key:"applyCesiumQuaternion",value:function(e){dd.x=e.x,dd.y=e.y,dd.z=e.z,dd.w=e.w,this.applyQuaternion(dd)}},{key:"setMatrix",value:function(e){this.matrixAutoUpdate&&this.updateMatrix(),this.matrix.copy(e),this.matrix.decompose(this.position,this.quaternion,this.scale)}}]),i}(n["v"]);function fd(e){if(!s(e.fov)||!s(e.aspectRatio)||!s(e.near)||!s(e.far))throw new u("fov, aspectRatio, near, or far parameters are not set.");var t=e._offCenterFrustum;e.fov===e._fov&&e.aspectRatio===e._aspectRatio&&e.near===e._near&&e.far===e._far||(e._aspectRatio=e.aspectRatio,e._fov=e.fov,e._fovy=n["p"].degToRad(e.fov),e.aspectRatio=e.aspect,e._near=e.near,e._far=e.far,e._sseDenominator=2*Math.tan(.5*e.fovRadius),e._xOffset=e.xOffset,e._yOffset=e.yOffset,t.top=e.near*Math.tan(.5*e._fovy),t.bottom=-t.top,t.right=e.aspectRatio*t.top,t.left=-t.right,t.near=e.near,t.far=e.far,t.right+=e.xOffset,t.left+=e.xOffset,t.top+=e.yOffset,t.bottom+=e.yOffset)}var vd=new Dh,gd=new He,pd=new re,yd=new re,_d=new re,wd=new re,Td=new Dh,xd=new He,Ed=new to,Sd=new to,bd={destination:void 0,orientation:{direction:void 0,up:void 0,heading:void 0,pitch:void 0,roll:void 0},convert:void 0,endTransform:void 0},Id=new Xh;new n["q"];function Rd(e){to.computeView(e._position,e._direction,e._up,e._right,e._viewMatrix),to.multiply(e._viewMatrix,e._actualInvTransform,e._viewMatrix),to.inverseTransformation(e._viewMatrix,e._invViewMatrix),to.transformToThreeMatrix4(e._invViewMatrix,e.frustum.matrixWorld),e.frustum.matrixWorld.decompose(e.frustum.position,e.frustum.quaternion,e.frustum.scale)}var Cd=function(){function e(t,i){Object(r["a"])(this,e),this._scene=t,this._transform=to.clone(to.IDENTITY),this._invTransform=to.clone(to.IDENTITY),this._actualTransform=to.clone(to.IDENTITY),this._actualInvTransform=to.clone(to.IDENTITY),this._transformChanged=!1,this.position=new re,this._position=new re,this._positionWC=new re,this._positionCartographic=new me,this._oldPositionWC=void 0,this.positionWCDeltaMagnitude=0,this.positionWCDeltaMagnitudeLastFrame=0,this.timeSinceMoved=0,this._lastMovedTimestamp=0,this.direction=new re,this._direction=new re,this._directionWC=new re,this.up=new re,this._up=new re,this._upWC=new re,this.right=new re,this._right=new re,this._rightWC=new re,this.frustum=new md(t,i),this.defaultMoveAmount=1e5,this.defaultLookAmount=Math.PI/60,this.defaultRotateAmount=Math.PI/3600,this.defaultZoomAmount=1e5,this.constrainedAxis=void 0,this.maximumZoomFactor=1.5,this._moveStart=new si,this._moveEnd=new si,this._changed=new si,this._changedPosition=void 0,this._changedDirection=void 0,this._changedFrustum=void 0,this.percentageChanged=.5,this._viewMatrix=new to,this._invViewMatrix=new to,Rd(this),this._mode=cu.SCENE3D,this._modeChanged=!0;var n=t.mapProjection;this._projection=n,this._maxCoord=n.project(new me(Math.PI,ne.PI_OVER_TWO)),this._max2Dfrustum=void 0,Bd(this,e.DEFAULT_VIEW_RECTANGLE,this.position,!0);var a=re.magnitude(this.position);a+=a*e.DEFAULT_VIEW_FACTOR,re.normalize(this.position,this.position),re.multiplyByScalar(this.position,a,this.position)}return Object(a["a"])(e,[{key:"transform",get:function(){return this._transform}},{key:"inverseTransform",get:function(){return Wd(this),this._invTransform}},{key:"viewMatrix",get:function(){return Wd(this),this._viewMatrix}},{key:"inverseViewMatrix",get:function(){return Wd(this),this.inverseViewMatrix}},{key:"positionCartographic",get:function(){return Wd(this),this._positionCartographic}},{key:"positionWC",get:function(){return Wd(this),this._positionWC}},{key:"directionWC",get:function(){return Wd(this),this._directionWC}},{key:"upWC",get:function(){return Wd(this),this._upWC}},{key:"rightWC",get:function(){return Wd(this),this._rightWC}},{key:"heading",get:function(){var e=this._projection.ellipsoid,t=to.clone(this._transform,Ed),i=To.eastNorthUpToFixedFrame(this.positionWC,e,Sd);this._setTransform(i);var n=dm(this.direction,this.up);return this._setTransform(t),n}},{key:"pitch",get:function(){var e=this._projection.ellipsoid,t=to.clone(this._transform,Ed),i=To.eastNorthUpToFixedFrame(this.positionWC,e,Sd);this._setTransform(i);var n=mm(this.direction);return this._setTransform(t),n}},{key:"roll",get:function(){var e=this._projection.ellipsoid,t=to.clone(this._transform,Ed),i=To.eastNorthUpToFixedFrame(this.positionWC,e,Sd);this._setTransform(i);var n=fm(this.direction,this.up,this.right);return this._setTransform(t),n}},{key:"resize",value:function(e){this.frustum.resize(e)}},{key:"getRectangleCameraCoordinates",value:function(e,t){if(!s(e))throw new u("rectangle is required");var i=this._mode;if(s(t)||(t=new re),i===cu.SCENE3D)return Bd(this,e,t);i===cu.COLUMBUS_VIEW||cu.SCENE2D}},{key:"setView",value:function(e){e=o(e,o.EMPTY_OBJECT);var t=o(e.orientation,o.EMPTY_OBJECT),i=this._mode;if(i!==cu.MORPHING){s(e.endTransform)&&this._setTransform(e.endTransform);o(e.convert,!0);var n=o(e.destination,re.clone(this.positionWC,im));s(n)&&s(n.west)&&(n=this.getRectangleCameraCoordinates(n,im),!1),s(t.direction)&&(t=hm(this,n,t,bd.orientation)),Id.heading=o(t.heading,0),Id.pitch=o(t.pitch,-ne.PI_OVER_TWO),Id.roll=o(t.roll,0),i===cu.SCENE3D?sm(this,n,Id):cu.SCENE2D}}},{key:"lookAt",value:function(e){this.frustum.lookAt(e.x,e.y,e.z)}},{key:"move",value:function(e,t){if(!s(e))throw new u("direction is required.");var i=this.position;re.multiplyByScalar(e,t,pd),re.add(i,pd,i),this._mode,cu.SCENE2D,this._adjustOrthographicFrustum(!0)}},{key:"moveForward",value:function(e){e=o(e,this.defaultMoveAmount),this._mode===cu.SCENE2D||this.move(this.direction,e)}},{key:"moveBackward",value:function(e){e=o(e,this.defaultMoveAmount),this._mode===cu.SCENE2D||this.move(this.direction,-e)}},{key:"moveUp",value:function(e){e=o(e,this.defaultMoveAmount),this.move(this.up,e)}},{key:"moveDown",value:function(e){e=o(e,this.defaultMoveAmount),this.move(this.up,-e)}},{key:"moveRight",value:function(e){e=o(e,this.defaultMoveAmount),this.move(this.right,e)}},{key:"moveLeft",value:function(e){e=o(e,this.defaultMoveAmount),this.move(this.right,-e)}},{key:"lookLeft",value:function(e){e=o(e,this.defaultLookAmount),this._mode!==cu.SCENE2D&&this.look(this.up,-e)}},{key:"lookRight",value:function(e){e=o(e,this.defaultLookAmount),this._mode!==cu.SCENE2D&&this.look(this.up,e)}},{key:"lookUp",value:function(e){e=o(e,this.defaultLookAmount),this._mode!==cu.SCENE2D&&this.look(this.right,-e)}},{key:"lookDown",value:function(e){e=o(e,this.defaultLookAmount),this._mode!==cu.SCENE2D&&this.look(this.right,e)}},{key:"look",value:function(e,t){if(!s(e))throw new u("axis is required.");var i=o(t,this.defaultLookAmount),n=Dh.fromAxisAngle(e,-i,vd),r=He.fromQuaternion(n,gd),a=this.direction,l=this.up,c=this.right;He.multiplyByVector(r,a,a),He.multiplyByVector(r,l,l),He.multiplyByVector(r,c,c),this.frustum.applyCesiumQuaternion(n)}},{key:"twistLeft",value:function(e){e=o(e,this.defaultLookAmount),this.look(this.direction,e)}},{key:"twistRight",value:function(e){e=o(e,this.defaultLookAmount),this.look(this.direction,-e)}},{key:"_adjustOrthographicFrustum",value:function(e){}},{key:"getPickRay",value:function(e,t){if(!s(e))throw new u("windowPosition is required.");return s(t)||(t=new St),Zd(this,e,t)}},{key:"_setTransform",value:function(e){var t=re.clone(this.positionWC,yd),i=re.clone(this.upWC,_d),n=re.clone(this.directionWC,wd);to.clone(e,this._transform),this._transformChanged=!0,Wd(this);var r=this._actualInvTransform;to.multiplyByPoint(r,t,this.position),to.multiplyByPointAsVector(r,n,this.direction),to.multiplyByPointAsVector(r,i,this.up),re.cross(this.direction,this.up,this.right),Wd(this)}},{key:"rotate",value:function(e,t){if(!s(e))throw new u("axis is required.");var i=o(t,this.defaultRotateAmount),n=Dh.fromAxisAngle(e,-i,Td),r=He.fromQuaternion(n,xd);He.multiplyByVector(r,this.position,this.position),He.multiplyByVector(r,this.direction,this.direction),He.multiplyByVector(r,this.up,this.up),re.cross(this.direction,this.up,this.right),re.cross(this.right,this.direction,this.up),this._adjustOrthographicFrustum(!1),this.frustum.applyCesiumQuaternion(n)}},{key:"rotateDown",value:function(e){e=o(e,this.defaultRotateAmount),$d(this,e)}},{key:"rotateUp",value:function(e){e=o(e,this.defaultRotateAmount),$d(this,-e)}},{key:"rotateRight",value:function(e){e=o(e,this.defaultRotateAmount),em(this,-e)}},{key:"rotateLeft",value:function(e){e=o(e,this.defaultRotateAmount),em(this,e)}},{key:"zoomIn",value:function(e){e=o(e,this.defaultZoomAmount),this._mode===cu.SCENE2D||tm(this,e)}},{key:"pickEllipsoid",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Ie.WGS84,i=arguments.length>2?arguments[2]:void 0,n=this._scene.canvas;if(0!==n.clientWidth&&0!==n.clientHeight){if(s(i)||(i=new re),t=o(t,Ie.WGS84),this._mode===cu.SCENE3D)i=gm(this,e,t,i);else if(this._mode===cu.SCENE2D);else if(this._mode!==cu.COLUMBUS_VIEW)return;return i}}},{key:"worldToCameraCoordinates",value:function(e,t){if(!s(e))throw new u("cartesian is required.");return s(t)||(t=new po),Wd(this),to.multiplyByVector(this._actualInvTransform,e,t)}},{key:"getMagnitude",value:function(){return re.magnitude(this.position)}},{key:"update",value:function(e){if(!s(e))throw new u("mode is required.");if(e===cu.SCENE2D&&!(this.frustum instanceof Qh))throw new u("An OrthographicOffCenterFrustum is required in 2D.");e!==this._mode&&(this._mode=e,this._modeChanged=e!==cu.MORPHING,this._mode,cu.SCENE2D)}},{key:"_updateCameraChanged",value:function(){var e=this;if(pm(e),0!==e._changed.numberOfListeners){var t=e.percentageChanged;if(e._mode,cu.SCENE2D,!s(e._changedDirection))return e._changedPosition=re.clone(e.positionWC,e._changedPosition),void(e._changedDirection=re.clone(e.directionWC,e._changedDirection));var i,n=ne.acosClamped(re.dot(e.directionWC,e._changedDirection));i=s(e.frustum.fovy)?n/(.5*e.frustum.fovy):n;var r=re.distance(e.positionWC,e._changedPosition),a=r/e.positionCartographic.height;(i>t||a>t)&&(e._changed.raiseEvent(Math.max(i,a)),e._changedPosition=re.clone(e.positionWC,e._changedPosition),e._changedDirection=re.clone(e.directionWC,e._changedDirection))}}}]),e}();Cd.TRANSFORM_2D=new to(0,0,1,0,1,0,0,0,0,1,0,0,0,0,0,1),Cd.TRANSFORM_2D_INVERSE=to.inverseTransformation(Cd.TRANSFORM_2D,new to),Cd.DEFAULT_VIEW_RECTANGLE=Oe.fromDegrees(-95,-20,-70,90),Cd.DEFAULT_VIEW_FACTOR=.5,Cd.DEFAULT_OFFSET=new Zh(0,-ne.PI_OVER_FOUR,0);var Od,kd=new me,Pd=new me,Md=new re,Nd=new re,Ad=new re,Dd=new re,Ld=new re,Ud=new re,Fd=new re,Hd=new re,zd={direction:new re,right:new re,up:new re};function qd(e,t,i,n){var r=Math.abs(re.dot(t,i));return r/n-re.dot(e,i)}function Bd(e,t,i,n){var r=e._projection.ellipsoid,a=n?e:zd,o=t.north,u=t.south,l=t.east,c=t.west;c>l&&(l+=ne.TWO_PI);var h,d=.5*(c+l);if(u<-ne.PI_OVER_TWO+ne.RADIANS_PER_DEGREE&&o>ne.PI_OVER_TWO-ne.RADIANS_PER_DEGREE)h=0;else{var m=kd;m.longitude=d,m.latitude=o,m.height=0;var f=Pd;f.longitude=d,f.latitude=u,f.height=0;var v=Od;s(v)&&v.ellipsoid===r||(Od=v=new Yh(void 0,void 0,r)),v.setEndPoints(m,f),h=v.interpolateUsingFraction(.5,kd).latitude}var g=kd;g.longitude=d,g.latitude=h,g.height=0;var p=r.cartographicToCartesian(g,Fd),y=kd;y.longitude=l,y.latitude=o;var _=r.cartographicToCartesian(y,Md);y.longitude=c;var w=r.cartographicToCartesian(y,Ad);y.longitude=d;var T=r.cartographicToCartesian(y,Ld);y.latitude=u;var x=r.cartographicToCartesian(y,Ud);y.longitude=l;var E=r.cartographicToCartesian(y,Dd);y.longitude=c;var S=r.cartographicToCartesian(y,Nd);re.subtract(w,p,w),re.subtract(E,p,E),re.subtract(_,p,_),re.subtract(S,p,S),re.subtract(T,p,T),re.subtract(x,p,x);var b=r.geodeticSurfaceNormal(p,a.direction);re.negate(b,b);var I=re.cross(b,re.UNIT_Z,a.right);re.normalize(I,I);var R,C=re.cross(I,b,a.up);if(e.frustum instanceof Qh){var O,k,P=Math.max(re.distance(_,w),re.distance(E,S)),M=Math.max(re.distance(_,E),re.distance(w,S)),N=e.frustum._offCenterFrustum.right/e.frustum._offCenterFrustum.top,A=M*N;P>A?(O=P,k=O/N):(k=M,O=A),R=Math.max(O,k)}else{var D=Math.tan(.5*e.frustum.fovy),L=e.frustum.aspectRatio*D;if(R=Math.max(qd(b,C,w,D),qd(b,C,E,D),qd(b,C,_,D),qd(b,C,S,D),qd(b,C,T,D),qd(b,C,x,D),qd(b,I,w,L),qd(b,I,E,L),qd(b,I,_,L),qd(b,I,S,L),qd(b,I,T,L),qd(b,I,x,L)),u<0&&o>0){var U=kd;U.longitude=c,U.latitude=0,U.height=0;var F=r.cartographicToCartesian(U,Hd);re.subtract(F,p,F),R=Math.max(R,qd(b,C,F,D),qd(b,I,F,L)),U.longitude=l,F=r.cartographicToCartesian(U,Hd),re.subtract(F,p,F),R=Math.max(R,qd(b,C,F,D),qd(b,I,F,L))}}return re.add(p,re.multiplyByScalar(b,-R,Hd),i)}var jd=new re;function Wd(e){var t=e._mode,i=!1,n=0;cu.SCENE2D;var r=e._position,a=!re.equals(r,e.position)||i;a&&(r=re.clone(e.position,e._position));var o=e._up,s=!re.equals(o,e.up);s&&(re.normalize(e.up,e.up),o=re.clone(e.up,e._up));var u=e._direction,l=!re.equals(u,e.direction);l&&(re.normalize(e.direction,e.direction),u=re.clone(e.direction,e._direction));var c=e._right,h=!re.equals(c,e.right);h&&(re.normalize(e.right,e.right),c=re.clone(e.right,e._right));var d=e._transformChanged||e._modeChanged;e._transformChanged=!1,d&&(to.inverseTransformation(e._transform,e._invTransform),e._mode===cu.COLUMBUS_VIEW||e._mode===cu.SCENE2D||to.clone(e._transform,e._actualTransform),to.inverseTransformation(e._actualTransform,e._actualInvTransform),e._modeChanged=!1);var m=e._actualTransform;if(a||d)if(e._positionWC=to.multiplyByPoint(m,r,e._positionWC),t===cu.SCENE3D||t===cu.MORPHING)e._positionCartographic=e._projection.ellipsoid.cartesianToCartographic(e._positionWC,e._positionCartographic);else{var f=jd;f.x=e._positionWC.y,f.y=e._positionWC.z,f.z=e._positionWC.x,t===cu.SCENE2D&&(f.z=n),e._projection.unproject(f,e._positionCartographic)}if(l||s||h){var v=re.dot(u,re.cross(o,c,jd));if(Math.abs(1-v)>ne.EPSILON2){var g=1/re.magnitudeSquared(o),p=re.dot(o,u)*g,y=re.multiplyByScalar(u,p,jd);o=re.normalize(re.subtract(o,y,e._up),e._up),re.clone(o,e.up),c=re.cross(u,o,e._right),re.clone(c,e.right)}}(l||d)&&(e._directionWC=to.multiplyByPointAsVector(m,u,e._directionWC),re.normalize(e._directionWC,e._directionWC)),(s||d)&&(e._upWC=to.multiplyByPointAsVector(m,o,e._upWC),re.normalize(e._upWC,e._upWC)),(h||d)&&(e._rightWC=to.multiplyByPointAsVector(m,c,e._rightWC),re.normalize(e._rightWC,e._rightWC)),(a||l||s||h||d)&&Rd(e)}var Vd=new re,Gd=new re,Yd=new re;new n["B"],new n["L"];function Zd(e,t,i){var r=e._scene.canvas,a=r.clientWidth,o=r.clientHeight,s=Math.tan(.5*n["p"].degToRad(e.frustum.fov)),u=e.frustum.aspectRatio*s,l=e.frustum.near,c=2/a*t.x-1,h=2/o*(o-t.y)-1,d=e.positionWC;re.clone(d,i.origin);var m=re.multiplyByScalar(e.directionWC,l,Vd);re.add(d,m,m);var f=re.multiplyByScalar(e.rightWC,c*l*u,Gd),v=re.multiplyByScalar(e.upWC,h*l*s,Yd),g=re.add(m,f,i.direction);return re.add(g,v,g),re.subtract(g,d,g),re.normalize(g,g),i}var Xd=new re,Qd=new re,Kd=new re,Jd=new re;function $d(e,t){var i=e.position;if(s(e.constrainedAxis)&&!re.equalsEpsilon(e.position,re.ZERO,ne.EPSILON2)){var n=re.normalize(i,Xd),r=re.equalsEpsilon(n,e.constrainedAxis,ne.EPSILON2),a=re.equalsEpsilon(n,re.negate(e.constrainedAxis,Jd),ne.EPSILON2);if(r||a)(r&&t<0||a&&t>0)&&e.rotate(e.right,t);else{var o=re.normalize(e.constrainedAxis,Qd),u=re.dot(n,o),l=ne.acosClamped(u);t>0&&t>l&&(t=l-ne.EPSILON4),u=re.dot(n,re.negate(o,Jd)),l=ne.acosClamped(u),t<0&&-t>l&&(t=-l+ne.EPSILON4);var c=re.cross(o,n,Kd);e.rotate(c,t)}}else e.rotate(e.right,t)}function em(e,t){s(e.constrainedAxis)?e.rotate(e.constrainedAxis,t):e.rotate(e.up,t)}function tm(e,t){e.move(e.direction,t)}var im=new re,nm=new to,rm=new to,am=new Dh,om=new He;new me;function sm(e,t,i){var n=to.clone(e.transform,nm),r=To.eastNorthUpToFixedFrame(t,e._projection.ellipsoid,rm);e._setTransform(r),re.clone(re.ZERO,e.position),i.heading=i.heading-ne.PI_OVER_TWO;var a=Dh.fromHeadingPitchRoll(i,am),o=He.fromQuaternion(a,om);He.getColumn(o,0,e.direction),He.getColumn(o,2,e.up),re.cross(e.direction,e.up,e.right),e._setTransform(n),e._adjustOrthographicFrustum(!0)}var um=new re,lm=new re,cm=new re;function hm(e,t,i,n){var r=re.clone(i.direction,um),a=re.clone(i.up,lm);if(e._scene.mode===cu.SCENE3D){var o=e._projection.ellipsoid,s=To.eastNorthUpToFixedFrame(t,o,Ed),u=to.inverseTransformation(s,Sd);to.multiplyByPointAsVector(u,r,r),to.multiplyByPointAsVector(u,a,a)}var l=re.cross(r,a,cm);return n.heading=dm(r,a),n.pitch=mm(r),n.roll=fm(r,a,l),n}function dm(e,t){var i;return i=ne.equalsEpsilon(Math.abs(e.z),1,ne.EPSILON3)?Math.atan2(t.y,t.x)-ne.PI_OVER_TWO:Math.atan2(e.y,e.x)-ne.PI_OVER_TWO,ne.TWO_PI-ne.zeroToTwoPi(i)}function mm(e){return ne.PI_OVER_TWO-ne.acosClamped(e.z)}function fm(e,t,i){var n=0;return ne.equalsEpsilon(Math.abs(e.z),1,ne.EPSILON3)||(n=Math.atan2(-i.z,t.z),n=ne.zeroToTwoPi(n+ne.TWO_PI)),n}var vm=new St;function gm(e,t){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Ie.WGS84,n=arguments.length>3?arguments[3]:void 0;i=o(i,Ie.WGS84);var r=e.getPickRay(t,vm),a=bt.rayEllipsoid(r,i);if(a){var s=a.start>0?a.start:a.stop;return St.getPoint(r,s,n)}}function pm(e){if(s(e._oldPositionWC)){e.positionWCDeltaMagnitudeLastFrame=e.positionWCDeltaMagnitude;var t=re.subtract(e.positionWC,e._oldPositionWC,e._oldPositionWC);e.positionWCDeltaMagnitude=re.magnitude(t),e._oldPositionWC=re.clone(e.positionWC,e._oldPositionWC),e.positionWCDeltaMagnitude>0?(e.timeSinceMoved=0,e._lastMovedTimestamp=na()):e.timeSinceMoved=Math.max(na()-e._lastMovedTimestamp,0)/1e3}else e._oldPositionWC=re.clone(e.positionWC,e._oldPositionWC)}function ym(e,t){var i={};return{fragmentShaderText:t,duplicateUniformNames:i}}var _m=function(){function e(t){Object(r["a"])(this,e);var i=t.vertexShaderText,n=t.fragmentShaderText,a=ym(i,n);this._attributeLocations=t.attributeLocations,this._cachedShader=void 0,this._vertexShaderSource=t.vertexShaderSource,this._vertexShaderText=t.vertexShaderText,this._fragmentShaderSource=t.fragmentShaderSource,this._fragmentShaderText=a.fragmentShaderText}return Object(a["a"])(e,null,[{key:"fromCache",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return e=o(e,o.EMPTY_OBJECT),e.context.shaderCache.getShaderProgram(e)}}]),e}(),wm=function(e,t){var i=/#define OUTPUT_DECLARATION/,n=e.split("\n");if(/#version 300 es/g.test(e))return e;var r,a,o=-1;for(r=0;r<n.length;++r)if(a=n[r],i.test(a)){o=r;break}if(-1===o)throw new u("Could not find a #define OUTPUT_DECLARATION!");var s=[];for(r=0;r<10;r++){var l="gl_FragData\\["+r+"\\]",c="czm_out"+r,h=new RegExp(l,"g");h.test(e)&&(bm(c,s),Tm(l,c,n),n.splice(o,0,"layout(location = "+r+") out vec4 "+c+";"),o+=1)}var d="czm_fragColor";Em("gl_FragColor",n)&&(bm(d,s),Tm("gl_FragColor",d,n),n.splice(o,0,"layout(location = 0) out vec4 czm_fragColor;"),o+=1);var m=Im(s,n),f={};for(r=0;r<n.length;r++)for(var v in a=n[r],m)if(m.hasOwnProperty(v)){var g=new RegExp("(layout)[^]+(out)[^]+("+v+")[^]+","g");g.test(a)&&(f[a]=v)}for(var p in f)if(f.hasOwnProperty(p)){var y=f[p],_=n.indexOf(p),w=m[y],T=w.length,x=void 0;for(x=0;x<T;x++)n.splice(_,0,w[x]);for(_+=T+1,x=T-1;x>=0;x--)n.splice(_,0,"#endif //"+w[x])}var E="WEBGL_2",S="#define "+E,b="#version 300 es",I=!1;for(r=0;r<n.length;r++)if(/#version/.test(n[r])){n[r]=b,I=!0;break}return I||n.splice(0,0,b),n.splice(1,0,S),Rm("EXT_draw_buffers",E,n),Rm("EXT_frag_depth",E,n),Rm("OES_standard_derivatives",E,n),Tm("texture2D","texture",n),Tm("texture3D","texture",n),Tm("textureCube","texture",n),Tm("gl_FragDepthEXT","gl_FragDepth",n),t?Tm("varying","in",n):(Tm("attribute","in",n),Tm("varying","out",n)),Sm(n)};function Tm(e,t,i){for(var n="(^|[^\\w])("+e+")($|[^\\w])",r=new RegExp(n,"g"),a=i.length,o=0;o<a;++o){var s=i[o];i[o]=s.replace(r,"$1"+t+"$3")}}function xm(e,t,i){for(var n=i.length,r=0;r<n;++r){var a=i[r];i[r]=a.replace(e,t)}}var Em=function(e,t){for(var i="(^|[^\\w])("+e+")($|[^\\w])",n=new RegExp(i,"g"),r=t.length,a=0;a<r;++a){var o=t[a];if(n.test(o))return!0}return!1};function Sm(e){for(var t="",i=e.length,n=0;n<i;++n)t+=e[n]+"\n";return t}function bm(e,t){-1===t.indexOf(e)&&t.push(e)}function Im(e,t){for(var i={},n=e.length,r=[],a=0;a<t.length;++a){var o=t[a],u=/(#ifdef|#if)/g.test(o),l=/#else/g.test(o),c=/#endif/g.test(o);if(u)r.push(o);else if(l){var h=r[r.length-1],d=h.replace("ifdef","ifndef");/if/g.test(d)&&(d=d.replace(/(#if\s+)(\S*)([^]*)/,"$1!($2)$3")),r.pop(),r.push(d)}else if(c)r.pop();else if(!/layout/g.test(o))for(var m=0;m<n;++m){var f=e[m];-1!==o.indexOf(f)&&(s(i[f])?i[f]=i[f].filter((function(e){return r.indexOf(e)>=0})):i[f]=r.slice())}}return i}function Rm(e,t,i){var n="#extension\\s+GL_"+e+"\\s+:\\s+[a-zA-Z0-9]+\\s*$";xm(new RegExp(n,"g"),"",i),Tm("GL_"+e,t,i)}var Cm=wm;function Om(e){return e=e.replace(/\/\/.*/g,""),e.replace(/\/\*\*[\s\S]*?\*\//gm,(function(e){for(var t=e.match(/\n/gm).length,i="",n=0;n<t;++n)i+="\n";return i}))}function km(e,t,i){for(var n,r=0;r<i.length;++r)i[r].name===e&&(n=i[r]);return s(n)||(t=Om(t),n={name:e,glslSource:t,dependsOn:[],requiredBy:[],evaluated:!1},i.push(n)),n}function Pm(e,t){if(!e.evaluated){e.evaluated=!0;var i=e.glslSource.match(/\bczm_[a-zA-Z0-9_]*/g);s(i)&&null!==i&&(i=i.filter((function(e,t){return i.indexOf(e)===t})),i.forEach((function(i){if(i!==e.name&&Dm._czmBuiltinsAndUniforms.hasOwnProperty(i)){var n=km(i,Dm._czmBuiltinsAndUniforms[i],t);e.dependsOn.push(n),n.requiredBy.push(e),Pm(n,t)}})))}}function Mm(e){var t=[],i=[];while(e.length>0){var n=e.pop();i.push(n),0===n.requiredBy.length&&t.push(n)}while(t.length>0){var r=t.shift();e.push(r);for(var a=0;a<r.dependsOn.length;++a){var o=r.dependsOn[a],s=o.requiredBy.indexOf(r);o.requiredBy.splice(s,1),0===o.requiredBy.length&&t.push(o)}}for(var l=[],c=0;c<i.length;++c)0!==i[c].requiredBy.length&&l.push(i[c]);if(0!==l.length){for(var h="A circular dependency was found in the following built-in functions/structs/constants: \n",d=0;d<l.length;++d)h=h+l[d].name+"\n";throw new u(h)}}function Nm(e){var t=[],i=km("main",e,t);Pm(i,t),Mm(t);for(var n="",r=t.length-1;r>=0;--r)n=n+t[r].glslSource+"\n";return n.replace(i.glslSource,"")}function Am(e,t,i){var n,r,a,o="",l=e.sources;if(s(l))for(n=0,r=l.length;n<r;++n)o+="\n#line 0\n"+l[n];o=Om(o),o=o.replace(/#version\s+(.*?)\n/gm,(function(e,t){if(s(a)&&a!==t)throw new u("inconsistent versions found: "+a+" and "+t);return a=t,"\n"}));var c=[];o=o.replace(/#extension.*\n/gm,(function(e){return c.push(e),"\n"})),o=o.replace(/precision\s(lowp|mediump|highp)\s(float|int);/,"");var h=e.pickColorQualifier;s(h)&&(o=Dm.createPickFragmentShaderSource(o,h));var d="";s(a)&&(d="#version "+a+"\n");var m=c.length;for(n=0;n<m;n++)d+=c[n];t&&(d+="  #ifdef GL_FRAGMENT_PRECISION_HIGH\n      precision highp float;\n  #else\n      precision mediump float;\n      #define highp mediump\n  #endif\n\n");var f=e.defines;if(s(f))for(n=0,r=f.length;n<r;++n){var v=f[n];0!==v.length&&(d+="#define "+v+"\n")}return i.webgl2&&(d+="#define OUTPUT_DECLARATION\n\n"),i.textureFloatLinear&&(d+="#define OES_texture_float_linear\n\n"),i.floatingPointTexture&&(d+="#define OES_texture_float\n\n"),e.includeBuiltIns&&(d+=Nm(o)),d+="\n#line 0\n",d+=o,i.webgl2&&(d=Cm(d,t)),d}var Dm=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};Object(r["a"])(this,e),this.sources=s(t.sources)?t.sources.slice(0):[],t=o(t,o.EMPTY_OBJECT);var i=t.pickColorQualifier;if(s(i)&&"uniform"!==i&&"varying"!==i)throw new u("options.pickColorQualifier must be 'uniform' or 'varying'.");this.defines=s(t.defines)?t.defines.slice(0):[],this.sources=s(t.sources)?t.sources.slice(0):[],this.pickColorQualifier=i,this.includeBuiltIns=o(t.includeBuiltIns,!0)}return Object(a["a"])(e,[{key:"clone",value:function(){return new e({sources:this.sources,defines:this.defines,pickColorQualifier:this.pickColorQualifier,includeBuiltIns:this.includeBuiltIns})}},{key:"createCombinedVertexShader",value:function(e){return Am(this,!1,e)}},{key:"createCombinedFragmentShader",value:function(e){return Am(this,!0,e)}}],[{key:"replaceMain",value:function(e,t){return t="void "+t+"()",e.replace(/void\s+main\s*\(\s*(?:void)?\s*\)/g,t)}},{key:"createPickFragmentShaderSource",value:function(t,i){var n=e.replaceMain(t,"czm_old_main"),r=i+" vec4 czm_pickColor; \nvoid main() \n{ \n    czm_old_main(); \n    if (gl_FragColor.a == 0.0) { \n       discard; \n    } \n    gl_FragColor = czm_pickColor; \n}";return n+"\n"+r}}]),e}();Dm._czmBuiltinsAndUniforms={};var Lm,Um,Fm=function(){function e(t){Object(r["a"])(this,e),this._shaders={},this._numberOfShaders=0,this._shadersToRelease={},this._context=t}return Object(a["a"])(e,[{key:"getShaderProgram",value:function(e){var t=e.vertexShaderSource,i=e.fragmentShaderSource,n=e.attributeLocations;"string"===typeof t&&(t=new Dm({sources:[t]})),"string"===typeof i&&(i=new Dm({sources:[i]}));var r,a=t.createCombinedVertexShader(this._context),o=i.createCombinedFragmentShader(this._context),u=a+o+JSON.stringify(n);if(s(this._shaders[u]))r=this._shaders[u],delete this._shadersToRelease[u];else{this._context;var l=new _m({vertexShaderSource:t,vertexShaderText:a,fragmentShaderSource:i,fragmentShaderText:o,attributeLocations:n});r={cache:this,shaderProgram:l,keyword:u,derivedKeywords:[],count:0},l._cachedShader=r,this._shaders[u]=r,++this._numberOfShaders}return++r.count,r.shaderProgram}}]),e}(),Hm=i("096e"),zm=function(){function e(t){Object(r["a"])(this,e),this.cache={},this._id=Object(Hm["a"])(),this.drawingBufferHeight=new dt,this._shaderCache=new Fm(this),this.scene=t;var i=t.drawingBufferSize,a=new n["O"](i.width,i.height,{format:n["y"]});this.sceneFrameBuffer=a,_c._maxAnisotropy=t.renderer.capabilities.getMaxAnisotropy()}return Object(a["a"])(e,[{key:"id",get:function(){return this._id}},{key:"colorTexture",get:function(){return this.sceneFrameBuffer.texture[0]}},{key:"depthTexture",get:function(){return this.sceneFrameBuffer.texture[1]}},{key:"normalTexture",get:function(){return this.sceneFrameBuffer.texture[2]}},{key:"shaderCache",get:function(){return this._shaderCache}},{key:"webgl2",get:function(){return this.scene.renderer.capabilities.isWebGL2}},{key:"textureFloatLinear",get:function(){return!0}},{key:"floatingPointTexture",get:function(){return!0}}]),e}(),qm={uniforms:{colorTexture:{value:null},amount:{value:.005},angle:{value:0}},vertexShader:"\n\n        varying vec2 vUv;\n\n        void main() {\n\n            vUv = uv;\n            gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\n        }",fragmentShader:"\n\n        uniform sampler2D colorTexture;\n        uniform float amount;\n        uniform float angle;\n\n        varying vec2 vUv;\n\n        void main() {\n\n            // vec2 offset = amount * vec2( cos(angle), sin(angle));\n            // vec4 cr = texture2D(colorTexture, vUv + offset);\n            // vec4 cga = texture2D(colorTexture, vUv);\n            // vec4 cb = texture2D(colorTexture, vUv - offset);\n            // gl_FragColor = vec4(cr.r, cga.g, cb.b, cga.a);\n\n\n            gl_FragColor =  texture2D(colorTexture, vUv);\n        }"},Bm=function(e){Object(Kn["a"])(i,e);var t=Object(Jn["a"])(i);function i(){var e;return Object(r["a"])(this,i),e=t.call(this),e.uniforms=n["K"].clone(qm.uniforms),e.vertexShader=qm.vertexShader,e.fragmentShader=qm.fragmentShader,e}return i}(n["E"]),jm=i("93e9"),Wm=i("360d"),Vm=function(){function e(t){Object(r["a"])(this,e),this.scene=t;var i=t.renderer;this.mainEffectComposer=new Mh["a"](i,t.context.sceneFrameBuffer);var n=new jm["a"](t,t.activeCamera);this.mainEffectComposer.addPass(n);var a=new Wm["a"](new Bm);a.uniforms.amount.value=.0015}return Object(a["a"])(e,[{key:"setSize",value:function(e){this.mainEffectComposer.setSize(e.clientWidth,e.clientHeight)}},{key:"render",value:function(){this.mainEffectComposer.render()}}]),e}(),Gm=function(){function e(t){Object(r["a"])(this,e),this.scene=t,this.context=t.context,this.newFrame=!1,this.frameNumber=0,this.pixelRatio=1,this.mode=cu.SCENE3D,this.passes={render:!1,pick:!1,depth:!1,postProcess:!1,offscreen:!1},this.commandList=[],this.computeCommandList=[],this.shadowMaps=[],this.cullingVolume=new $h,this.maximumScreenSpaceError=2,this.mapProjection=void 0,this.cameraUnderground=!1,this.afterRender=[],this.terrainExaggeration=1,this.terrainExaggerationRelativeHeight=0,this.minimumTerrainHeight=0}return Object(a["a"])(e,[{key:"camera",get:function(){return this.scene.camera}}]),e}(),Ym=new n["L"],Zm=function(e){Object(Kn["a"])(i,e);var t=Object(Jn["a"])(i);function i(e){var a;return Object(r["a"])(this,i),a=t.call(this,e),a.autoClear=!1,a.toneMapping=n["o"],a.toneMappingExposure=1,a.outputEncoding=n["R"],a.setClearColor(1215658),a}return Object(a["a"])(i,[{key:"drawingBufferSize",get:function(){return this.getDrawingBufferSize(Ym)}}]),i}(n["Q"]),Xm=function e(t){Object(r["a"])(this,e),this.scene=t},Qm=function(){function e(t){Object(r["a"])(this,e),this.scene=t,this.pickDepth=new Xm(t)}return Object(a["a"])(e,[{key:"pickPositionWorldCoordinates",value:function(e,t){this.scene.useDepthPicking}}]),e}(),Km=function(e){Object(Kn["a"])(i,e);var t=Object(Jn["a"])(i);function i(){var e;return Object(r["a"])(this,i),e=t.call(this),e._primitives=[],e}return Object(a["a"])(i,[{key:"update",value:function(e){if(this.visible)for(var t=this._primitives,i=0;i<t.length;++i)t[i].update(e)}},{key:"prePassesUpdate",value:function(e){for(var t=this._primitives,i=0;i<t.length;++i){var n=t[i];s(n.prePassesUpdate)&&n.prePassesUpdate(e)}}}]),i}(vu),Jm=function(e){Object(Kn["a"])(i,e);var t=Object(Jn["a"])(i);function i(){var e;return Object(r["a"])(this,i),e=t.call(this),e.frustum=void 0,e}return Object(a["a"])(i,[{key:"addPickCommands",value:function(e){for(var t=0,i=e.length;t<i;t++){var n=e[t];n.allowPicking&&this.addObject(n)}}},{key:"updateCommands",value:function(e){this.children}}]),i}(vu);function $m(e,t){var i=e.toString();return s(t)&&(i+="+"+t),i}function ef(e,t){dt.clone(e.distance.startPosition,t.distance.startPosition),dt.clone(e.distance.endPosition,t.distance.endPosition),dt.clone(e.angleAndHeight.startPosition,t.angleAndHeight.startPosition),dt.clone(e.angleAndHeight.endPosition,t.angleAndHeight.endPosition)}function tf(e,t,i){var n=$m(Lm.PINCH,t),r=e._update,a=e._isDown,o=e._eventStartPosition,u=e._pressTime,l=e._releaseTime;r[n]=!0,a[n]=!1,o[n]=new dt;var c=e._movement[n];s(c)||(c=e._movement[n]={}),c.distance={startPosition:new dt,endPosition:new dt},c.angleAndHeight={startPosition:new dt,endPosition:new dt},c.prevAngle=0,e._eventHandler.setInputAction((function(t){e._buttonsDown++,a[n]=!0,u[n]=new Date,dt.lerp(t.position1,t.position2,.5,o[n])}),Qn.PINCH_START,t),e._eventHandler.setInputAction((function(){e._buttonsDown=Math.max(e._buttonsDown-1,0),a[n]=!1,l[n]=new Date}),Qn.PINCH_END,t),e._eventHandler.setInputAction((function(e){if(a[n]){r[n]?(ef(e,c),r[n]=!1,c.prevAngle=c.angleAndHeight.startPosition.x):(dt.clone(e.distance.endPosition,c.distance.endPosition),dt.clone(e.angleAndHeight.endPosition,c.angleAndHeight.endPosition));var t=c.angleAndHeight.endPosition.x,o=c.prevAngle,s=2*Math.PI;while(t>=o+Math.PI)t-=s;while(t<o-Math.PI)t+=s;c.angleAndHeight.endPosition.x=-t*i.clientWidth/12,c.angleAndHeight.startPosition.x=-o*i.clientWidth/12}}),Qn.PINCH_MOVE,t)}function nf(e,t){var i=$m(Lm.WHEEL,t),n=e._update;n[i]=!0;var r=e._movement[i];s(r)||(r=e._movement[i]={}),r.startPosition=new dt,r.endPosition=new dt,e._eventHandler.setInputAction((function(e){var t=15*ne.toRadians(e);n[i]?(dt.clone(dt.ZERO,r.startPosition),r.endPosition.x=0,r.endPosition.y=t,n[i]=!1):r.endPosition.y=r.endPosition.y+t}),Qn.WHEEL,t)}function rf(e,t,i){var n=$m(i,t),r=e._isDown,a=e._eventStartPosition,o=e._pressTime,u=e._releaseTime;r[n]=!1,a[n]=new dt;var l,c,h=e._lastMovement[n];s(h)||(h=e._lastMovement[n]={startPosition:new dt,endPosition:new dt,valid:!1}),i===Lm.LEFT_DRAG?(l=Qn.LEFT_DOWN,c=Qn.LEFT_UP):i===Lm.RIGHT_DRAG?(l=Qn.RIGHT_DOWN,c=Qn.RIGHT_UP):i===Lm.MIDDLE_DRAG&&(l=Qn.MIDDLE_DOWN,c=Qn.MIDDLE_UP),e._eventHandler.setInputAction((function(t){e._buttonsDown++,h.valid=!1,r[n]=!0,o[n]=new Date,dt.clone(t.position,a[n])}),l,t),e._eventHandler.setInputAction((function(){e._buttonsDown=Math.max(e._buttonsDown-1,0),r[n]=!1,u[n]=new Date}),c,t)}function af(e,t){dt.clone(e.startPosition,t.startPosition),dt.clone(e.endPosition,t.endPosition)}function of(e,t){var i=e._update,n=e._movement,r=e._lastMovement,a=e._isDown;for(var o in Lm)if(Object.prototype.hasOwnProperty.call(Lm,o)){var u=Lm[o];if(s(u)){var l=$m(u,t);i[l]=!0,s(e._lastMovement[l])||(e._lastMovement[l]={startPosition:new dt,endPosition:new dt,valid:!1}),s(e._movement[l])||(e._movement[l]={startPosition:new dt,endPosition:new dt})}}e._eventHandler.setInputAction((function(o){for(var u in Lm)if(Object.prototype.hasOwnProperty.call(Lm,u)){var l=Lm[u];if(s(l)){var c=$m(l,t);a[c]&&(i[c]?(af(n[c],r[c]),r[c].valid=!0,af(o,n[c]),i[c]=!1):dt.clone(o.endPosition,n[c].endPosition))}}dt.clone(o.endPosition,e._currentMousePosition)}),Qn.MOUSE_MOVE,t)}(function(e){e[e["LEFT_DRAG"]=0]="LEFT_DRAG",e[e["RIGHT_DRAG"]=1]="RIGHT_DRAG",e[e["MIDDLE_DRAG"]=2]="MIDDLE_DRAG",e[e["WHEEL"]=3]="WHEEL",e[e["PINCH"]=4]="PINCH"})(Lm||(Lm={})),function(e){e[e["ROTATE"]=0]="ROTATE",e[e["INFINITE_SCROLL"]=1]="INFINITE_SCROLL"}(Um||(Um={}));var sf=function(){function e(t){if(Object(r["a"])(this,e),!s(t))throw new u("canvas is required.");for(var i in this._eventHandler=new Wa(t),this._update={},this._movement={},this._lastMovement={},this._isDown={},this._eventStartPosition={},this._pressTime={},this._releaseTime={},this._buttonsDown=0,this._currentMousePosition=new dt,nf(this,void 0),tf(this,void 0,t),rf(this,void 0,Lm.LEFT_DRAG),rf(this,void 0,Lm.RIGHT_DRAG),rf(this,void 0,Lm.MIDDLE_DRAG),of(this,void 0),ra)if(Object.prototype.hasOwnProperty.call(ra,i)){var n=ra[i];s(n)&&(nf(this,n),tf(this,n,t),rf(this,n,Lm.LEFT_DRAG),rf(this,n,Lm.RIGHT_DRAG),rf(this,n,Lm.MIDDLE_DRAG),of(this,n))}}return Object(a["a"])(e,[{key:"currentMousePosition",get:function(){return this._currentMousePosition}},{key:"anyButtonDown",get:function(){var e=!this._update[$m(Lm.WHEEL)]||!this._update[$m(Lm.WHEEL,ra.SHIFT)]||!this._update[$m(Lm.WHEEL,ra.CTRL)]||!this._update[$m(Lm.WHEEL,ra.ALT)];return this._buttonsDown>0||e}},{key:"isMoving",value:function(e,t){if(!s(e))throw new u("type is required.");var i=$m(e,t);return!this._update[i]}},{key:"getMovement",value:function(e,t){if(!s(e))throw new u("type is required.");var i=$m(e,t),n=this._movement[i];return n}},{key:"getLastMovement",value:function(e,t){if(!s(e))throw new u("type is required.");var i=$m(e,t),n=this._lastMovement[i];if(n.valid)return n}},{key:"isButtonDown",value:function(e,t){if(!s(e))throw new u("type is required.");var i=$m(e,t);return this._isDown[i]}},{key:"getStartMousePosition",value:function(e,t){if(!s(e))throw new u("type is required.");if(e===Lm.WHEEL)return this._currentMousePosition;var i=$m(e,t);return this._eventStartPosition[i]}},{key:"getButtonPressTime",value:function(e,t){if(!s(e))throw new u("type is required.");var i=$m(e,t);return this._pressTime[i]}},{key:"getButtonReleaseTime",value:function(e,t){if(!s(e))throw new u("type is required.");var i=$m(e,t);return this._releaseTime[i]}},{key:"reset",value:function(){for(var e in this._update)Object.prototype.hasOwnProperty.call(this._update,e)&&(this._update[e]=!0)}},{key:"isDestroyed",value:function(){return!1}},{key:"destroy",value:function(){return this._eventHandler=this._eventHandler&&this._eventHandler.destroy(),ti(this)}}]),e}(),uf=sf,lf=new re,cf=new re;function hf(e,t){if(e<0)return 0;var i=25*(1-t);return Math.exp(-i*e)}function df(e){return dt.equalsEpsilon(e.startPosition,e.endPosition,ne.EPSILON14)}var mf=.4;function ff(e,t,i,n,r,a,o){var u=a[o];s(u)||(u=a[o]={startPosition:new dt,endPosition:new dt,motion:new dt,inertiaEnabled:!0});var l=e.getButtonPressTime(t,i),c=e.getButtonReleaseTime(t,i),h=l&&c&&(c.getTime()-l.getTime())/1e3,d=new Date,m=c&&(d.getTime()-c.getTime())/1e3;if(l&&c&&h<mf){var f=hf(m,n),v=e.getLastMovement(t,i);if(!s(v)||df(v)||!u.inertiaEnabled)return;if(u.motion.x=.5*(v.endPosition.x-v.startPosition.x),u.motion.y=.5*(v.endPosition.y-v.startPosition.y),u.startPosition=dt.clone(v.startPosition,u.startPosition),u.endPosition=dt.multiplyByScalar(u.motion,f,u.endPosition),u.endPosition=dt.add(u.startPosition,u.endPosition,u.endPosition),isNaN(u.endPosition.x)||isNaN(u.endPosition.y)||dt.distance(u.startPosition,u.endPosition)<.5)return;if(!e.isButtonDown(t,i)){var g=e.getStartMousePosition(t,i);r(a,g,u)}}}function vf(e,t){if(s(t)){var i=e[t];s(i)&&(i.inertiaEnabled=!0);var n=e._inertiaDisablers[t];if(s(n))for(var r=n.length,a=0;a<r;++a)i=e[n[a]],s(i)&&(i.inertiaEnabled=!1)}}var gf=[];function pf(e,t,i,n,r,a){if(s(i)){var o=e._aggregator;Array.isArray(i)||(gf[0]=i,i=gf);for(var u=i.length,l=0;l<u;++l){var c=i[l],h=s(c.eventType)?c.eventType:c,d=c.modifier,m=o.isMoving(h,d)&&o.getMovement(h,d),f=o.getStartMousePosition(h,d);e.enableInputs&&t&&(m?(n(e,f,m),vf(e,a)):r<1&&ff(o,h,d,r,n,e,a))}}}var yf=new St,_f=new re,wf=(new dt,new re),Tf=new dt,xf=new re,Ef=new re,Sf=new re,bf=new re,If=new re,Rf=new re,Cf=new re,Of=new re,kf=new re,Pf=new re,Mf=new re,Nf=new re,Af=new re,Df=new re,Lf=new re,Uf=new re,Ff=new re,Hf=new re,zf={orientation:new Xh};function qf(e,t,i,n,r,a){var o=1;s(a)&&(o=ne.clamp(Math.abs(a),.25,1));var u=e.minimumZoomDistance*o,l=e.maximumZoomDistance,c=r-u,h=n*c;h=ne.clamp(h,e._minimumZoomRate,e._maximumZoomRate);var d=i.endPosition.y-i.startPosition.y,m=d/e._scene.canvas.clientHeight;m=Math.min(m,e.maximumMovementRatio);var f=h*m;if(e.enableCollisionDetection||0===e.minimumZoomDistance||!s(e._globe)){if(f>0&&Math.abs(r-u)<1)return;if(f<0&&Math.abs(r-l)<1)return;r-f<u?f=r-u-1:r-f>l&&(f=r-l)}var v=e._scene,g=v.camera,p=v.mode,y=zf.orientation;if(y.heading=g.heading,y.pitch=g.pitch,y.roll=g.roll,g.frustum instanceof Qh)Math.abs(f)>0&&(g.zoomIn(f),g._adjustOrthographicFrustum());else{var _,w=dt.equals(t,e._zoomMouseStart),T=e._zoomingOnVector,x=e._rotatingZoom;if(w||(e._zoomMouseStart=dt.clone(t,e._zoomMouseStart),s(e._globe)&&(p===cu.SCENE2D||(_=tv(e,t,_f))),s(_)?(e._useZoomWorldPosition=!0,e._zoomWorldPosition=re.clone(_,e._zoomWorldPosition)):e._useZoomWorldPosition=!1,T=e._zoomingOnVector=!1,x=e._rotatingZoom=!1,e._zoomingUnderground=e._cameraUnderground),e._useZoomWorldPosition){var E=p===cu.COLUMBUS_VIEW;if(g.positionCartographic.height<2e6&&(x=!0),!w||x){if(p===cu.SCENE2D){var S=e._zoomWorldPosition,b=g.position;if(!re.equals(S,b)&&g.positionCartographic.height<2*e._maxCoord.x){var I=g.position.x,R=re.subtract(S,b,wf);re.normalize(R,R);var C=re.distance(S,b)*f/(.5*g.getMagnitude());g.move(R,.5*C),(g.position.x<0&&I>0||g.position.x>0&&I<0)&&(_=g.getPickRay(t,yf).origin,_=re.fromElements(_.y,_.z,_.x),e._zoomWorldPosition=re.clone(_,e._zoomWorldPosition))}}else if(p===cu.SCENE3D){var O=re.normalize(g.position,If);if(e._cameraUnderground||e._zoomingUnderground||g.positionCartographic.height<3e3&&Math.abs(re.dot(g.direction,O))<.6)E=!0;else{var k=v.canvas,P=Tf;P.x=k.clientWidth/2,P.y=k.clientHeight/2;var M=tv(e,P,xf);if(s(M))if(g.positionCartographic.height<1e6){if(!(re.dot(g.direction,O)>=-.5)){var N=Cf;re.clone(g.position,N);var A=e._zoomWorldPosition,D=Rf;if(D=re.normalize(A,D),re.dot(D,O)<0)return;var L=Lf,U=Pf;re.clone(g.direction,U),re.add(N,re.multiplyByScalar(U,1e3,Uf),L);var F=Mf,H=Nf;re.subtract(A,N,F),re.normalize(F,H);var z=re.dot(O,H);if(z>=0)return void(e._zoomMouseStart.x=-1);var q=Math.acos(-z),B=re.magnitude(N),j=re.magnitude(A),W=B-f,V=re.magnitude(F),G=Math.asin(ne.clamp(V/j*Math.sin(q),-1,1)),Y=Math.asin(ne.clamp(W/j*Math.sin(q),-1,1)),Z=G-Y+q,X=Of;re.normalize(N,X);var Q=kf;Q=re.cross(H,X,Q),Q=re.normalize(Q,Q),re.normalize(re.cross(X,Q,Uf),U),re.multiplyByScalar(re.normalize(L,Uf),re.magnitude(L)-f,L),re.normalize(N,N),re.multiplyByScalar(N,W,N);var K=Af;re.multiplyByScalar(re.add(re.multiplyByScalar(X,Math.cos(Z)-1,Ff),re.multiplyByScalar(U,Math.sin(Z),Hf),Uf),W,K),re.add(N,K,N),re.normalize(L,X),re.normalize(re.cross(X,Q,Uf),U);var J=Df;return re.multiplyByScalar(re.add(re.multiplyByScalar(X,Math.cos(Z)-1,Ff),re.multiplyByScalar(U,Math.sin(Z),Hf),Uf),re.magnitude(L),J),re.add(L,J,L),re.clone(N,g.position),re.normalize(re.subtract(L,N,Uf),g.direction),re.clone(g.direction,g.direction),re.cross(g.direction,g.up,g.right),re.cross(g.right,g.direction,g.up),void g.setView(zf)}E=!0}else{var $=re.normalize(M,Ef),ee=re.normalize(e._zoomWorldPosition,Sf),te=re.dot(ee,$);if(te>0&&te<1){var ie=ne.acosClamped(te),ae=re.cross(ee,$,bf),oe=Math.abs(ie)>ne.toRadians(20)?.75*g.positionCartographic.height:g.positionCartographic.height-f,se=f/oe;g.rotate(ae,ie*se)}}else E=!0}}e._rotatingZoom=!E}!w&&E||T||g.zoomIn(f),e._cameraUnderground||g.setView(zf)}else g.zoomIn(f)}}var Bf=new St,jf=new St,Wf=new re;function Vf(e,t,i){var n=e._scene,r=n.camera,a=r.getPickRay(i.startPosition,Bf).origin,o=r.getPickRay(i.endPosition,jf).origin;a=re.fromElements(a.y,a.z,a.x,a),o=re.fromElements(o.y,o.z,o.x,o);var s=re.subtract(a,o,Wf),u=re.magnitude(s);u>0&&(re.normalize(s,s),r.move(s,u))}function Gf(e,t,i){s(i.distance)&&(i=i.distance);var n=e._scene,r=n.camera;qf(e,t,i,e._zoomFactor,r.getMagnitude())}var Yf=new dt,Zf=new dt;function Xf(e,t,i){if(s(i.angleAndHeight))Qf(e,t,i.angleAndHeight);else{var n=e._scene,r=n.camera,a=n.canvas,o=a.clientWidth,u=a.clientHeight,l=Yf;l.x=2/o*i.startPosition.x-1,l.y=2/u*(u-i.startPosition.y)-1,l=dt.normalize(l,l);var c=Zf;c.x=2/o*i.endPosition.x-1,c.y=2/u*(u-i.endPosition.y)-1,c=dt.normalize(c,c);var h=ne.acosClamped(l.x);l.y<0&&(h=ne.TWO_PI-h);var d=ne.acosClamped(c.x);c.y<0&&(d=ne.TWO_PI-d);var m=d-h;r.twistRight(m)}}function Qf(e,t,i){var n=e._rotateFactor*e._rotateRateRangeAdjustment;n>e._maximumRotateRate&&(n=e._maximumRotateRate),n<e._minimumRotateRate&&(n=e._minimumRotateRate);var r=e._scene,a=r.camera,o=r.canvas,s=(i.endPosition.x-i.startPosition.x)/o.clientWidth;s=Math.min(s,e.maximumMovementRatio);var u=n*s*Math.PI*4;a.twistRight(u)}function Kf(e){var t=e._scene.mapMode2D===Um.ROTATE;to.equals(to.IDENTITY,e._scene.camera.transform)?(pf(e,e.enableTranslate,e.translateEventTypes,Vf,e.inertiaTranslate,"_lastInertiaTranslateMovement"),pf(e,e.enableZoom,e.zoomEventTypes,Gf,e.inertiaZoom,"_lastInertiaZoomMovement"),t&&pf(e,e.enableRotate,e.tiltEventTypes,Xf,e.inertiaSpin,"_lastInertiaTiltMovement")):(pf(e,e.enableZoom,e.zoomEventTypes,Gf,e.inertiaZoom,"_lastInertiaZoomMovement"),t&&pf(e,e.enableRotate,e.translateEventTypes,Xf,e.inertiaSpin,"_lastInertiaSpinMovement"))}var Jf=new St,$f=new re,ev=new re;function tv(e,t,i){var n=e._scene,r=e._globe,a=n.camera;if(s(r)){var o,u=!e._cameraUnderground;n.pickPositionSupported&&(o=n.pickPositionWorldCoordinates(t,$f));var l=a.getPickRay(t,Jf),c=r.pickWorldCoordinates(l,n,u,ev),h=s(o)?re.distance(o,a.positionWC):Number.POSITIVE_INFINITY,d=s(c)?re.distance(c,a.positionWC):Number.POSITIVE_INFINITY;return h<d?re.clone(o,i):re.clone(c,i)}}var iv=new me;function nv(e){var t=e._ellipsoid,i=e._scene,n=i.camera,r=i.mode,a=0;if(r===cu.SCENE3D){var u=t.cartesianToCartographic(n.position,iv);s(u)&&(a=u.height)}else a=n.position.z;var l=o(e._scene.globeHeight,0),c=Math.abs(l-a);return c}var rv=new re;function av(e,t,i){var n=t.origin,r=t.direction,a=nv(e),o=re.normalize(n,rv),s=Math.abs(re.dot(o,r));return s=2*Math.max(s,.5),a*s}function ov(e,t,i,n){var r=re.distance(t.origin,i),a=nv(e),o=ne.clamp(5*a,e._minimumUndergroundPickDistance,e._maximumUndergroundPickDistance);return r>o&&(r=Math.min(r,a/5),r=Math.max(r,100)),St.getPoint(t,r,n)}function sv(e,t,i,n){var r;return s(i)?(r=re.distance(t.origin,i),r>e._maximumUndergroundPickDistance&&(r=nv(e))):r=nv(e),St.getPoint(t,r,n)}var uv=new dt;function lv(e,t){var i=t.endPosition,n=dt.subtract(t.endPosition,t.startPosition,uv),r=e._strafeEndMousePosition;dt.add(r,n,r),t.endPosition=r,Yv(e,t,e._strafeStartPosition),t.endPosition=i}var cv=new St,hv=new St,dv=new re,mv=new re,fv=new re,vv=new re,gv=new wo(re.UNIT_X,0),pv=new dt,yv=new dt;function _v(e,t,i){if(re.equals(t,e._translateMousePosition)||(e._looking=!1),re.equals(t,e._strafeMousePosition)||(e._strafing=!1),e._looking)Dg(e,t,i);else if(e._strafing)lv(e,i);else{var n,r=e._scene,a=r.camera,o=e._cameraUnderground,u=dt.clone(i.startPosition,pv),l=dt.clone(i.endPosition,yv),c=a.getPickRay(u,cv),h=re.clone(re.ZERO,vv),d=re.UNIT_X;if(a.position.z<e._minimumPickingTerrainHeight&&(n=tv(e,u,dv),s(n)&&(h.x=n.x)),o||h.x>a.position.z&&s(n)){var m=n;return o&&(m=sv(e,c,n,dv)),dt.clone(t,e._strafeMousePosition),dt.clone(t,e._strafeEndMousePosition),re.clone(m,e._strafeStartPosition),e._strafing=!0,void Yv(e,i,e._strafeStartPosition)}var f=wo.fromPointNormal(h,d,gv);c=a.getPickRay(u,cv);var v=bt.rayPlane(c,f,dv),g=a.getPickRay(l,hv),p=bt.rayPlane(g,f,mv);if(!s(v)||!s(p))return e._looking=!0,Dg(e,t,i),void dt.clone(t,e._translateMousePosition);var y=re.subtract(v,p,fv),_=y.x;y.x=y.y,y.y=y.z,y.z=_;var w=re.magnitude(y);w>ne.EPSILON6&&(re.normalize(y,y),a.move(y,w))}}var wv=new dt,Tv=new St,xv=new re,Ev=new re,Sv=new to,bv=new to,Iv=new re,Rv=new wo(re.UNIT_X,0),Cv=new re,Ov=new me,kv=new to,Pv=new Dh,Mv=new He,Nv=new re;function Av(e,t,i){if(s(i.angleAndHeight)&&(i=i.angleAndHeight),dt.equals(t,e._tiltCenterMousePosition)||(e._tiltCVOffMap=!1,e._looking=!1),e._looking)Dg(e,t,i);else{var n=e._scene,r=n.camera;e._tiltCVOffMap||!e.onMap()||Math.abs(r.position.z)>e._minimumPickingTerrainHeight?(e._tiltCVOffMap=!0,Dv(e,t,i)):Lv(e,t,i)}}function Dv(e,t,i){var n=e._scene,r=n.camera,a=n.canvas,o=wv;o.x=a.clientWidth/2,o.y=a.clientHeight/2;var u,l=r.getPickRay(o,Tv),c=re.UNIT_X,h=l.origin,d=l.direction,m=re.dot(c,d);if(Math.abs(m)>ne.EPSILON6&&(u=-re.dot(c,h)/m),!s(u)||u<=0)return e._looking=!0,Dg(e,t,i),void dt.clone(t,e._tiltCenterMousePosition);var f=re.multiplyByScalar(d,u,xv);re.add(h,f,f);var v=n.mapProjection,g=v.ellipsoid;re.fromElements(f.y,f.z,f.x,f);var p=v.unproject(f,Ov);g.cartographicToCartesian(p,f);var y=To.eastNorthUpToFixedFrame(f,g,Sv),_=e._globe,w=e._ellipsoid;e._globe=void 0,e._ellipsoid=Ie.UNIT_SPHERE,e._rotateFactor=1,e._rotateRateRangeAdjustment=1;var T=to.clone(r.transform,kv);r._setTransform(y),tg(e,t,i,re.UNIT_Z),r._setTransform(T),e._globe=_,e._ellipsoid=w;var x=w.maximumRadius;e._rotateFactor=1/x,e._rotateRateRangeAdjustment=x}function Lv(e,t,i){var n,r,a=e._scene,o=a.camera,u=e._cameraUnderground,l=re.UNIT_X;if(dt.equals(t,e._tiltCenterMousePosition))n=re.clone(e._tiltCenter,xv);else{if(o.position.z<e._minimumPickingTerrainHeight&&(n=tv(e,t,xv)),!s(n)){r=o.getPickRay(t,Tv);var c,h=r.origin,d=r.direction,m=re.dot(l,d);if(Math.abs(m)>ne.EPSILON6&&(c=-re.dot(l,h)/m),!s(c)||c<=0)return e._looking=!0,Dg(e,t,i),void dt.clone(t,e._tiltCenterMousePosition);n=re.multiplyByScalar(d,c,xv),re.add(h,n,n)}u&&(s(r)||(r=o.getPickRay(t,Tv)),ov(e,r,n,n)),dt.clone(t,e._tiltCenterMousePosition),re.clone(n,e._tiltCenter)}var f=a.canvas,v=wv;v.x=f.clientWidth/2,v.y=e._tiltCenterMousePosition.y,r=o.getPickRay(v,Tv);var g=re.clone(re.ZERO,Iv);g.x=n.x;var p=wo.fromPointNormal(g,l,Rv),y=bt.rayPlane(r,p,Ev),_=o._projection,w=_.ellipsoid;re.fromElements(n.y,n.z,n.x,n);var T=_.unproject(n,Ov);w.cartographicToCartesian(T,n);var x,E=To.eastNorthUpToFixedFrame(n,w,Sv);s(y)?(re.fromElements(y.y,y.z,y.x,y),T=_.unproject(y,Ov),w.cartographicToCartesian(T,y),x=To.eastNorthUpToFixedFrame(y,w,bv)):x=E;var S=e._globe,b=e._ellipsoid;e._globe=void 0,e._ellipsoid=Ie.UNIT_SPHERE,e._rotateFactor=1,e._rotateRateRangeAdjustment=1;var I=re.UNIT_Z,R=to.clone(o.transform,kv);o._setTransform(E);var C=re.cross(re.UNIT_Z,re.normalize(o.position,Cv),Cv),O=re.dot(o.right,C);if(tg(e,t,i,I,!1,!0),o._setTransform(x),O<0){var k=i.startPosition.y-i.endPosition.y;(u&&k<0||!u&&k>0)&&(I=void 0);var P=o.constrainedAxis;o.constrainedAxis=void 0,tg(e,t,i,I,!0,!1),o.constrainedAxis=P}else tg(e,t,i,I,!0,!1);if(s(o.constrainedAxis)){var M=re.cross(o.direction,o.constrainedAxis,Nv);re.equalsEpsilon(M,re.ZERO,ne.EPSILON6)||(re.dot(M,o.right)<0&&re.negate(M,M),re.cross(M,o.direction,o.up),re.cross(o.direction,o.up,o.right),re.normalize(o.up,o.up),re.normalize(o.right,o.right))}o._setTransform(R),e._globe=S,e._ellipsoid=b;var N=b.maximumRadius;e._rotateFactor=1/N,e._rotateRateRangeAdjustment=N;var A=re.clone(o.positionWC,Cv);if(e.enableCollisionDetection&&Hg(e),!re.equals(o.positionWC,A)){o._setTransform(x),o.worldToCameraCoordinatesPoint(A,A);var D=re.magnitudeSquared(A);re.magnitudeSquared(o.position)>D&&(re.normalize(o.position,o.position),re.multiplyByScalar(o.position,Math.sqrt(D),o.position));var L=re.angleBetween(A,o.position),U=re.cross(A,o.position,A);re.normalize(U,U);var F=Dh.fromAxisAngle(U,L,Pv),H=He.fromQuaternion(F,Mv);He.multiplyByVector(H,o.direction,o.direction),He.multiplyByVector(H,o.up,o.up),re.cross(o.direction,o.up,o.right),re.cross(o.right,o.direction,o.up),o._setTransform(R)}}var Uv=new dt,Fv=new St,Hv=new re;function zv(e,t,i){s(i.distance)&&(i=i.distance);var n,r=e._scene,a=r.camera,o=r.canvas,u=e._cameraUnderground;u?n=t:(n=Uv,n.x=o.clientWidth/2,n.y=o.clientHeight/2);var l,c,h=a.getPickRay(n,Fv),d=h.origin,m=h.direction,f=a.position.z;if(f<e._minimumPickingTerrainHeight&&(l=tv(e,n,Hv)),s(l)&&(c=re.distance(d,l)),u){var v=av(e,h,f);c=s(c)?Math.min(c,v):v}if(!s(c)){var g=re.UNIT_X;c=-re.dot(g,d)/re.dot(g,m)}qf(e,t,i,e._zoomFactor,c)}function qv(e){var t=e._scene,i=t.camera;if(to.equals(to.IDENTITY,i.transform)){var n=e._tweens;if(e._aggregator.anyButtonDown&&n.removeAll(),pf(e,e.enableTilt,e.tiltEventTypes,Av,e.inertiaSpin,"_lastInertiaTiltMovement"),pf(e,e.enableTranslate,e.translateEventTypes,_v,e.inertiaTranslate,"_lastInertiaTranslateMovement"),pf(e,e.enableZoom,e.zoomEventTypes,zv,e.inertiaZoom,"_lastInertiaZoomMovement"),pf(e,e.enableLook,e.lookEventTypes,Dg),!e._aggregator.anyButtonDown&&!n.contains(e._tween)){var r=i.createCorrectPositionTween(e.bounceAnimationTime);s(r)&&(e._tween=n.add(r))}n.update()}else pf(e,e.enableRotate,e.rotateEventTypes,tg,e.inertiaSpin,"_lastInertiaSpinMovement"),pf(e,e.enableZoom,e.zoomEventTypes,mg,e.inertiaZoom,"_lastInertiaZoomMovement")}var Bv=new St,jv=new wo(re.UNIT_X,0),Wv=new re,Vv=new re,Gv=new re;function Yv(e,t,i){var n=e._scene,r=n.camera,a=r.getPickRay(t.endPosition,Bv),o=re.clone(r.direction,Vv);n.mode===cu.COLUMBUS_VIEW&&re.fromElements(o.z,o.x,o.y,o);var u=wo.fromPointNormal(i,o,jv),l=bt.rayPlane(a,u,Wv);s(l)&&(o=re.subtract(i,l,o),n.mode===cu.COLUMBUS_VIEW&&re.fromElements(o.y,o.z,o.x,o),re.add(r.position,o,r.position))}var Zv=new re,Xv=new me,Qv=new re,Kv=new Ie,Jv=new re,$v=new re;function eg(e,t,i){var n=e._scene,r=n.camera,a=e._cameraUnderground,o=e._ellipsoid;if(to.equals(r.transform,to.IDENTITY)){var u,l,c=o.geodeticSurfaceNormal(r.position,Jv);if(dt.equals(t,e._rotateMousePosition))if(e._looking)Dg(e,t,i,c);else if(e._rotating)tg(e,t,i);else if(e._strafing)lv(e,i);else{if(re.magnitude(r.position)<re.magnitude(e._rotateStartPosition))return;u=re.magnitude(e._rotateStartPosition),l=Qv,l.x=l.y=l.z=u,o=Ie.fromCartesian3(l,Kv),cg(e,t,i,o)}else{e._looking=!1,e._rotating=!1,e._strafing=!1;var h=o.cartesianToCartographic(r.positionWC,Xv).height,d=e._globe;if(s(d)&&h<e._minimumPickingTerrainHeight){var m=tv(e,i.startPosition,Gv);if(s(m)){var f=!1,v=r.getPickRay(i.startPosition,Jf);if(a)f=!0,sv(e,v,m,m);else{var g=o.geodeticSurfaceNormal(m,$v),p=Math.abs(re.dot(v.direction,g))<.05;f=!!p||re.magnitude(r.position)<re.magnitude(m)}f?(dt.clone(t,e._strafeEndMousePosition),re.clone(m,e._strafeStartPosition),e._strafing=!0,Yv(e,i,e._strafeStartPosition)):(u=re.magnitude(m),l=Qv,l.x=l.y=l.z=u,o=Ie.fromCartesian3(l,Kv),cg(e,t,i,o),re.clone(m,e._rotateStartPosition))}else e._looking=!0,Dg(e,t,i,c)}else s(r.pickEllipsoid(i.startPosition,e._ellipsoid,Zv))?(cg(e,t,i,e._ellipsoid),re.clone(Zv,e._rotateStartPosition)):h>e._minimumTrackBallHeight?(e._rotating=!0,tg(e,t,i)):(e._looking=!0,Dg(e,t,i,c));dt.clone(t,e._rotateMousePosition)}}else tg(e,t,i)}function tg(e,t,i,n,r,a){r=o(r,!1),a=o(a,!1);var u=e._scene,l=u.camera,c=u.canvas,h=l.constrainedAxis;s(n)&&(l.constrainedAxis=n);var d=re.magnitude(l.position),m=e._rotateFactor*(d-e._rotateRateRangeAdjustment);m>e._maximumRotateRate&&(m=e._maximumRotateRate),m<e._minimumRotateRate&&(m=e._minimumRotateRate);var f=(i.startPosition.x-i.endPosition.x)/c.clientWidth,v=(i.startPosition.y-i.endPosition.y)/c.clientHeight;f=Math.min(f,e.maximumMovementRatio),v=Math.min(v,e.maximumMovementRatio);var g=m*f*Math.PI*2,p=m*v*Math.PI;r||l.rotateRight(g),a||l.rotateUp(p),l.constrainedAxis=h}var ig=po.clone(po.UNIT_W),ng=po.clone(po.UNIT_W),rg=new re,ag=new re,og=new re,sg=new re,ug=new dt,lg=new dt;function cg(e,t,i,n){var r=e._scene,a=r.camera,o=dt.clone(i.startPosition,ug),u=dt.clone(i.endPosition,lg),l=a.pickEllipsoid(o,n,ig),c=a.pickEllipsoid(u,n,ng);if(!s(l)||!s(c))return e._rotating=!0,void tg(e,t,i);if(l=a.worldToCameraCoordinates(l,l),c=a.worldToCameraCoordinates(c,c),s(a.constrainedAxis)){var h=a.constrainedAxis,d=re.mostOrthogonalAxis(h,rg);re.cross(d,h,d),re.normalize(d,d);var m=re.cross(h,d,ag),f=re.magnitude(l),v=re.dot(h,l),g=Math.acos(v/f),p=re.multiplyByScalar(h,v,og);re.subtract(l,p,p),re.normalize(p,p);var y=re.magnitude(c),_=re.dot(h,c),w=Math.acos(_/y),T=re.multiplyByScalar(h,_,sg);re.subtract(c,T,T),re.normalize(T,T);var x=Math.acos(re.dot(p,d));re.dot(p,m)<0&&(x=ne.TWO_PI-x);var E=Math.acos(re.dot(T,d));re.dot(T,m)<0&&(E=ne.TWO_PI-E);var S,b=x-E;S=re.equalsEpsilon(h,a.position,ne.EPSILON2)?a.right:re.cross(h,a.position,rg);var I,R=re.cross(h,S,rg),C=re.dot(R,re.subtract(l,h,ag)),O=re.dot(R,re.subtract(c,h,ag));I=C>0&&O>0?w-g:C>0&&O<=0?re.dot(a.position,h)>0?-g-w:g+w:g-w,a.rotateRight(b),a.rotateUp(I)}else{re.normalize(l,l),re.normalize(c,c);var k=re.dot(l,c),P=re.cross(l,c,rg);if(k<1&&!re.equalsEpsilon(P,re.ZERO,ne.EPSILON14)){var M=Math.acos(k);a.rotate(P,M)}}}var hg=new re,dg=new me;function mg(e,t,i){s(i.distance)&&(i=i.distance);var n,r=e._ellipsoid,a=e._scene,o=a.camera,u=a.canvas,l=e._cameraUnderground;l?n=t:(n=Uv,n.x=u.clientWidth/2,n.y=u.clientHeight/2);var c,h,d=o.getPickRay(n,Fv),m=r.cartesianToCartographic(o.position,dg).height;if(m<e._minimumPickingTerrainHeight&&(c=tv(e,n,Hv)),s(c)&&(h=re.distance(d.origin,c)),l){var f=av(e,d,m);h=s(h)?Math.min(h,f):f}s(h)||(h=m);var v=re.normalize(o.position,hg);qf(e,t,i,e._zoomFactor,h,re.dot(v,o.direction))}var fg=new dt,vg=new St,gg=new re,pg=new re,yg=new to,_g=new to,wg=new to,Tg=new Dh,xg=new He,Eg=new me,Sg=new re;new dt(1409,97),new dt(1409,97);function bg(e,t,i){var n=e._scene,r=n.camera;if(to.equals(r.transform,to.IDENTITY))if(s(i.angleAndHeight)&&(i=i.angleAndHeight),dt.equals(t,e._tiltCenterMousePosition)||(e._tiltOnEllipsoid=!1,e._looking=!1),e._looking){var a=e._ellipsoid.geodeticSurfaceNormal(r.position,Sg);Dg(e,t,i,a)}else{var o=e._ellipsoid,u=o.cartesianToCartographic(r.position,Eg);e._tiltOnEllipsoid||u.height>e._minimumCollisionTerrainHeight?(e._tiltOnEllipsoid=!0,Rg(e,t,i)):Cg(e,t,i)}}var Ig=new me;new n["q"],new n["q"];function Rg(e,t,i){var n=e._ellipsoid,r=e._scene,a=r.camera,o=.25*e.minimumZoomDistance,u=n.cartesianToCartographic(a.positionWC,Ig).height;if(!(u-o-1<ne.EPSILON3&&i.endPosition.y-i.startPosition.y<0)){var l=r.canvas,c=fg;c.x=l.clientWidth/2,c.y=l.clientHeight/2;var h,d=a.getPickRay(c,vg),m=bt.rayEllipsoid(d,n);if(s(m))h=St.getPoint(d,m.start,gg);else{if(!(u>e._minimumTrackBallHeight)){e._looking=!0;var f=e._ellipsoid.geodeticSurfaceNormal(a.position,Sg);return Dg(e,t,i,f),void dt.clone(t,e._tiltCenterMousePosition)}var v=bt.grazingAltitudeLocation(d,n);if(!s(v))return;var g=n.cartesianToCartographic(v,Eg);g.height=0,h=n.cartographicToCartesian(g,gg)}var p=To.eastNorthUpToFixedFrame(h,n,yg),y=e._globe,_=e._ellipsoid;e._globe=void 0,e._ellipsoid=Ie.UNIT_SPHERE,e._rotateFactor=1,e._rotateRateRangeAdjustment=1;var w=to.clone(a.transform,wg);a._setTransform(p),tg(e,t,i,re.UNIT_Z),a._setTransform(w),e._globe=y,e._ellipsoid=_;var T=_.maximumRadius;e._rotateFactor=1/T,e._rotateRateRangeAdjustment=T}}function Cg(e,t,i){var n,r,a,o=e._ellipsoid,u=e._scene,l=u.camera,c=e._cameraUnderground;if(dt.equals(t,e._tiltCenterMousePosition))n=re.clone(e._tiltCenter,gg);else{if(n=tv(e,t,gg),!s(n)){if(r=l.getPickRay(t,vg),a=bt.rayEllipsoid(r,o),!s(a)){var h=o.cartesianToCartographic(l.position,Eg);if(h.height<=e._minimumTrackBallHeight){e._looking=!0;var d=e._ellipsoid.geodeticSurfaceNormal(l.position,Sg);Dg(e,t,i,d),dt.clone(t,e._tiltCenterMousePosition)}return}n=St.getPoint(r,a.start,gg)}c&&(s(r)||(r=l.getPickRay(t,vg)),ov(e,r,n,n)),dt.clone(t,e._tiltCenterMousePosition),re.clone(n,e._tiltCenter)}var m=u.canvas,f=fg;f.x=m.clientWidth/2,f.y=e._tiltCenterMousePosition.y,r=l.getPickRay(f,vg);var v=re.magnitude(n),g=re.fromElements(v,v,v,Qv),p=Ie.fromCartesian3(g,Kv);if(a=bt.rayEllipsoid(r,p),s(a)){var y=re.magnitude(r.origin)>v?a.start:a.stop,_=St.getPoint(r,y,pg),w=To.eastNorthUpToFixedFrame(n,o,yg),T=To.eastNorthUpToFixedFrame(_,p,_g),x=e._globe,E=e._ellipsoid;e._globe=void 0,e._ellipsoid=Ie.UNIT_SPHERE,e._rotateFactor=1,e._rotateRateRangeAdjustment=1;var S=re.UNIT_Z,b=to.clone(l.transform,wg);l._setTransform(T);var I=re.cross(_,l.positionWC,Nv),R=re.dot(l.rightWC,I);if(R<0){var C=i.startPosition.y-i.endPosition.y;(c&&C<0||!c&&C>0)&&(S=void 0);var O=l.constrainedAxis;l.constrainedAxis=void 0,tg(e,t,i,S,!0,!1),l.constrainedAxis=O}else tg(e,t,i,S,!0,!1);if(l._setTransform(w),tg(e,t,i,S,!1,!0),s(l.constrainedAxis)){var k=re.cross(l.direction,l.constrainedAxis,Nv);re.equalsEpsilon(k,re.ZERO,ne.EPSILON6)||(re.dot(k,l.right)<0&&re.negate(k,k),re.cross(k,l.direction,l.up),re.cross(l.direction,l.up,l.right),re.normalize(l.up,l.up),re.normalize(l.right,l.right))}l._setTransform(b),e._globe=x,e._ellipsoid=E;var P=E.maximumRadius;e._rotateFactor=1/P,e._rotateRateRangeAdjustment=P;var M=re.clone(l.positionWC,Nv);if(e.enableCollisionDetection&&Hg(e),!re.equals(l.positionWC,M)){l._setTransform(T),l.worldToCameraCoordinatesPoint(M,M);var N=re.magnitudeSquared(M);re.magnitudeSquared(l.position)>N&&(re.normalize(l.position,l.position),re.multiplyByScalar(l.position,Math.sqrt(N),l.position));var A=re.angleBetween(M,l.position),D=re.cross(M,l.position,M);re.normalize(D,D);var L=Dh.fromAxisAngle(D,A,Tg),U=He.fromQuaternion(L,xg);He.multiplyByVector(U,l.direction,l.direction),He.multiplyByVector(U,l.up,l.up),re.cross(l.direction,l.up,l.right),re.cross(l.right,l.direction,l.up),l._setTransform(b)}}}var Og=new dt,kg=new dt,Pg=new St,Mg=new St,Ng=new re,Ag=new re;function Dg(e,t,i,n){var r=e._scene,a=r.camera,u=Og;u.x=i.startPosition.x,u.y=0;var l=kg;l.x=i.endPosition.x,l.y=0;var c,h,d=a.getPickRay(u,Pg),m=a.getPickRay(l,Mg),f=0;c=d.direction,h=m.direction;var v=re.dot(c,h);v<1&&(f=Math.acos(v)),f=i.startPosition.x>i.endPosition.x?-f:f;var g=e._horizontalRotationAxis;if(s(n)?a.look(n,-f):s(g)?a.look(g,-f):a.lookLeft(f),u.x=0,u.y=i.startPosition.y,l.x=0,l.y=i.endPosition.y,d=a.getPickRay(u,Pg),m=a.getPickRay(l,Mg),f=0,c=d.direction,h=m.direction,v=re.dot(c,h),v<1&&(f=Math.acos(v)),f=i.startPosition.y>i.endPosition.y?-f:f,n=o(n,g),s(n)){var p=a.direction,y=re.negate(n,Ng),_=re.equalsEpsilon(p,n,ne.EPSILON2),w=re.equalsEpsilon(p,y,ne.EPSILON2);if(_||w)(_&&f<0||w&&f>0)&&a.look(a.right,-f);else{v=re.dot(p,n);var T=ne.acosClamped(v);f>0&&f>T&&(f=T-ne.EPSILON4),v=re.dot(p,y),T=ne.acosClamped(v),f<0&&-f>T&&(f=-T+ne.EPSILON4);var x=re.cross(n,p,Ag);a.look(x,f)}}else a.lookUp(f)}function Lg(e){pf(e,e.enableRotate,e.rotateEventTypes,eg,e.inertiaSpin,"_lastInertiaSpinMovement"),pf(e,e.enableZoom,e.zoomEventTypes,mg,e.inertiaZoom,"_lastInertiaZoomMovement"),pf(e,e.enableTilt,e.tiltEventTypes,bg,e.inertiaSpin,"_lastInertiaTiltMovement"),pf(e,e.enableLook,e.lookEventTypes,Dg)}var Ug=new to,Fg=new me;function Hg(e){e._adjustedHeightForTerrain=!0;var t=e._scene,i=t.mode,n=t.globe;if(s(n)&&i!==cu.SCENE2D&&i!==cu.MORPHING){var r,a,o=t.camera,u=n.ellipsoid,l=t.mapProjection;to.equals(o.transform,to.IDENTITY)||(r=to.clone(o.transform,Ug),a=re.magnitude(o.position),o._setTransform(to.IDENTITY));var c=Fg;i===cu.SCENE3D?u.cartesianToCartographic(o.positionWC,c):l.unproject(o.position,c);var h=!1;if(c.height<e._minimumCollisionTerrainHeight){var d=e._scene.globeHeight;if(s(d)){var m=d+e.minimumZoomDistance;c.height<m&&(c.height=m,i===cu.SCENE3D?u.cartographicToCartesian(c,o.position):l.project(c,o.position),h=!0)}}s(r)&&(o._setTransform(r),h&&(re.normalize(o.position,o.position),re.negate(o.position,o.direction),re.multiplyByScalar(o.position,Math.max(a,e.minimumZoomDistance),o.position),re.normalize(o.direction,o.direction),re.cross(o.direction,o.up,o.right),re.cross(o.right,o.direction,o.up)))}}var zg=function(){function e(t){if(Object(r["a"])(this,e),!s(t))throw new u("scene is required.");this.enableInputs=!0,this.enableTranslate=!0,this.enableZoom=!0,this.enableRotate=!0,this.enableTilt=!0,this.enableLook=!0,this.inertiaSpin=.9,this.inertiaTranslate=.9,this.inertiaZoom=.8,this.maximumMovementRatio=.1,this.bounceAnimationTime=3,this.minimumZoomDistance=1,this.maximumZoomDistance=Number.POSITIVE_INFINITY,this.translateEventTypes=Lm.LEFT_DRAG,this.zoomEventTypes=[Lm.RIGHT_DRAG,Lm.WHEEL,Lm.PINCH],this.rotateEventTypes=Lm.LEFT_DRAG,this.tiltEventTypes=[Lm.MIDDLE_DRAG,Lm.PINCH,{eventType:Lm.LEFT_DRAG,modifier:ra.CTRL},{eventType:Lm.RIGHT_DRAG,modifier:ra.CTRL}],this.lookEventTypes={eventType:Lm.LEFT_DRAG,modifier:ra.SHIFT},this.minimumPickingTerrainHeight=15e4,this._minimumPickingTerrainHeight=this.minimumPickingTerrainHeight,this.minimumCollisionTerrainHeight=15e3,this._minimumCollisionTerrainHeight=this.minimumCollisionTerrainHeight,this.minimumTrackBallHeight=75e5,this._minimumTrackBallHeight=this.minimumTrackBallHeight,this.enableCollisionDetection=!0,this._scene=t,this._globe=void 0,this._ellipsoid=void 0,this._aggregator=new uf(t.canvas),this._lastInertiaSpinMovement=void 0,this._lastInertiaZoomMovement=void 0,this._lastInertiaTranslateMovement=void 0,this._lastInertiaTiltMovement=void 0,this._inertiaDisablers={_lastInertiaZoomMovement:["_lastInertiaSpinMovement","_lastInertiaTranslateMovement","_lastInertiaTiltMovement"],_lastInertiaTiltMovement:["_lastInertiaSpinMovement","_lastInertiaTranslateMovement"]},this._tweens=new Ih,this._tween=void 0,this._horizontalRotationAxis=void 0,this._tiltCenterMousePosition=new dt(-1,-1),this._tiltCenter=new re,this._rotateMousePosition=new dt(-1,-1),this._rotateStartPosition=new re,this._strafeStartPosition=new re,this._strafeMousePosition=new dt,this._strafeEndMousePosition=new dt,this._zoomMouseStart=new dt(-1,-1),this._zoomWorldPosition=new re,this._useZoomWorldPosition=!1,this._tiltCVOffMap=!1,this._looking=!1,this._rotating=!1,this._strafing=!1,this._zoomingOnVector=!1,this._zoomingUnderground=!1,this._rotatingZoom=!1,this._adjustedHeightForTerrain=!1,this._cameraUnderground=!1;var i=t.mapProjection;this._maxCoord=i.project(new me(Math.PI,ne.PI_OVER_TWO)),this._zoomFactor=5,this._rotateFactor=void 0,this._rotateRateRangeAdjustment=void 0,this._maximumRotateRate=1.77,this._minimumRotateRate=2e-4,this._minimumZoomRate=20,this._maximumZoomRate=5906376272e3,this._minimumUndergroundPickDistance=2e3,this._maximumUndergroundPickDistance=1e4}return Object(a["a"])(e,[{key:"onMap",value:function(){var e=this._scene,t=e.mode,i=e.camera;return t!==cu.COLUMBUS_VIEW||Math.abs(i.position.x)-this._maxCoord.x<0&&Math.abs(i.position.y)-this._maxCoord.y<0}},{key:"update",value:function(){var e=this._scene,t=e.camera,i=e.globe,n=e.mode;to.equals(t.transform,to.IDENTITY)?(this._globe=i,this._ellipsoid=s(this._globe)?this._globe.ellipsoid:e.mapProjection.ellipsoid):(this._globe=void 0,this._ellipsoid=Ie.UNIT_SPHERE);var r=s(this._globe)?this._globe.terrainExaggeration:1,a=s(this._globe)?this._globe.terrainExaggerationRelativeHeight:0;this._minimumCollisionTerrainHeight=Bs.getHeight(this.minimumCollisionTerrainHeight,r,a),this._minimumPickingTerrainHeight=Bs.getHeight(this.minimumPickingTerrainHeight,r,a),this._minimumTrackBallHeight=Bs.getHeight(this.minimumTrackBallHeight,r,a),this._cameraUnderground=e.cameraUnderground&&s(this._globe);var o=this._ellipsoid.maximumRadius;this._rotateFactor=1/o,this._rotateRateRangeAdjustment=o,this._adjustedHeightForTerrain=!1;var u=re.clone(t.positionWC,lf),l=re.clone(t.directionWC,cf);if(n===cu.SCENE2D?Kf(this):n===cu.COLUMBUS_VIEW?(this._horizontalRotationAxis=re.UNIT_Z,qv(this)):n===cu.SCENE3D&&(this._horizontalRotationAxis=void 0,Lg(this)),this.enableCollisionDetection&&!this._adjustedHeightForTerrain){var c=!re.equals(u,t.positionWC)||!re.equals(l,t.directionWC);c&&Hg(this)}this._aggregator.reset()}},{key:"isDestroyed",value:function(){return!1}},{key:"destroy",value:function(){return this._tweens.removeAll(),ti(this)}}]),e}(),qg="\n#ifdef USE_ENVMAP\n    #ifdef ENV_WORLDPOS\n        vec3 cameraToFrag;\n        if ( isOrthographic ) {\n            cameraToFrag = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );\n        } else {\n            cameraToFrag = normalize( vWorldPosition - cameraPosition );\n        }\n        vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n\n        #ifdef ENVMAP_MODE_REFLECTION\n            vec3 reflectVec = reflect( cameraToFrag, worldNormal );\n        #else\n            vec3 reflectVec = refract( cameraToFrag, worldNormal, refractionRatio );\n        #endif\n    #else\n        vec3 reflectVec = vReflect;\n    #endif\n    #ifdef ENVMAP_TYPE_CUBE\n        vec4 envColor = textureCube( envMap, vec3( flipEnvMap * reflectVec.x, reflectVec.zy ) );\n        envColor = envMapTexelToLinear( envColor );\n    #elif defined( ENVMAP_TYPE_CUBE_UV )\n        vec4 envColor = textureCubeUV( envMap, reflectVec, 0.0 );\n    #else\n        vec4 envColor = vec4( 0.0 );\n    #endif\n    #ifdef ENVMAP_BLENDING_MULTIPLY\n        outgoingLight = mix( outgoingLight, outgoingLight * envColor.xyz, specularStrength * reflectivity );\n    #elif defined( ENVMAP_BLENDING_MIX )\n        outgoingLight = mix( outgoingLight, envColor.xyz, specularStrength * reflectivity );\n    #elif defined( ENVMAP_BLENDING_ADD )\n        outgoingLight += envColor.xyz * specularStrength * reflectivity;\n    #endif\n#endif\n",Bg=/varying/g,jg="out",Wg="in",Vg=n["D"].cube,Gg="\n\n#include <envmap_common_pars_fragment>\nuniform float opacity;\nvarying vec3 vWorldDirection;\n#include <cube_uv_reflection_fragment>\n\nvoid main() {\n    vec3 vReflect = vWorldDirection;\n    ".concat(qg,"\n    gl_FragColor = envColor;\n    gl_FragColor.a *= opacity;\n    #include <tonemapping_fragment>\n    #include <encodings_fragment>\n    \n}");Vg.vertexShader=Vg.vertexShader.replace(Bg,jg),Vg.fragmentShader=Gg.replace(Bg,Wg),n["D"].cube=Vg;var Yg=function(){function e(t){Object(r["a"])(this,e);var i=new n["g"];i.setPath("./assets/skyBox/");var a=[["X","Y","Z"],["X","Z","Y"],["Y","X","Z"],["Y","Z","X"],["Z","X","Y"],["Z","Y","X"]],o=0,s=i.load(["pos".concat(a[o][0],".jpg"),"neg".concat(a[o][0],".jpg"),"pos".concat(a[o][1],".jpg"),"neg".concat(a[o][1],".jpg"),"pos".concat(a[o][2],".jpg"),"neg".concat(a[o][2],".jpg")]);s.encoding=n["R"],this.scene=t,this.textureCube=s,s.encoding=n["R"],t.background=s}return Object(a["a"])(e,[{key:"update",value:function(){}},{key:"render",value:function(){}}]),e}(),Zg=function(e){return function(){}};function Xg(e,t){for(var i=0;i<e._removeGlobeCallbacks.length;++i)e._removeGlobeCallbacks[i]();e._removeGlobeCallbacks.length=0;var n=[];s(t)&&(n.push(t.imageryLayersUpdatedEvent.addEventListener(Zg(e))),n.push(t.terrainProviderChanged.addEventListener(Zg(e)))),e._removeGlobeCallbacks=n}function Qg(e,t){var i=e._frameState;i.frameNumber=t}function Kg(e,t){try{t(e)}catch(i){if(console.log(i),e.renderError.raiseEvent(e,i),e.rethrowRenderErrors)throw i}}function Jg(e){var t=e._frameState;s(e.globe)&&e.globe.update(t)}function $g(e){e._frameState;on.update()}function ep(e){var t=e._frameState;e.context;e.updateFrameState(),t.passes.render=!0,s(e.globe)&&(e.globe.beginFrame(t),e.globe.tilesLoaded||(e._renderRequested=!0)),e.updateAndExecuteCommands(e.backgroundColor),s(e.globe)&&(e.globe.endFrame(t),e.globe.tilesLoaded||(e._renderRequested=!0))}function tp(e){var t=e._frameState;e._primitives.update(t),e._globe&&e._globe.render(t);var i,n=Object(xh["a"])(t.commandList);try{for(n.s();!(i=n.n()).done;){var r=i.value;e._renderCollection.add(r)}}catch(a){n.e(a)}finally{n.f()}}var ip=function(e){for(var t=e.frameState.computeCommandList,i=t.length,n=0;n<i;++n)t[n].execute(e._computeEngine)};function np(e,t,i){e&&ip(t),e||(t.frameState.commandList.length=0),tp(t),t.renderer.autoClear=!1,t.renderer.clear(),t.skyBox.render(),t.effectComposerCollection.render()}var rp=function(e){Object(Kn["a"])(i,e);var t=Object(Jn["a"])(i);function i(e){var a;Object(r["a"])(this,i),a=t.call(this),a._mode=cu.SCENE3D,n["E"].prototype.glslVersion=n["k"],a._mapProjection=o(e.mapProjection,new Ce),a._primitives=new Km,a.renderError=new si,a.postUpdate=new si,a.preRender=new si,a.renderer=new Zm(e.renderState),a.renderer.toneMapping=n["o"],a.renderer.outputEncoding=n["R"],a._camera=new Cd(Object(Th["a"])(a),{aspect:a.drawingBufferSize.width/a.drawingBufferSize.height,near:.1,far:1e10}),a._camera.constrainedAxis=re.UNIT_Z,a.requestRenderMode=o(e.requestRenderMode,!1),a._renderRequested=!0,a._shaderFrameCount=0,a.maximumRenderTimeChange=o(e.maximumRenderTimeChange,0),a._lastRenderTime=void 0,a._frameRateMonitor=void 0,a._removeRequestListenerCallback=on.requestCompletedEvent.addEventListener(Zg(Object(Th["a"])(a))),a._removeGlobeCallbacks=[],a._canvas=a.renderer.domElement,a._context=new zm(Object(Th["a"])(a));var s=a._context.sceneFrameBuffer;return a.renderer.setRenderTarget(s),a._computeEngine=new Nh(Object(Th["a"])(a),a._context),a._globeHeight=void 0,a._cameraUnderground=!1,a._frameState=new Gm(Object(Th["a"])(a)),a._removeGlobeCallbacks=[],a.rethrowRenderErrors=!1,a.backgroundColor=new Yn(1,0,0,1),a._renderCollection=new Jm,a.addObject(a._renderCollection),a._tweens=new Ih,a._screenSpaceCameraController=new zg(Object(Th["a"])(a)),a.effectComposerCollection=new Vm(Object(Th["a"])(a)),a._picking=new Qm(Object(Th["a"])(a)),a.useDepthPicking=!0,a.skyBox=new Yg(Object(Th["a"])(a)),a}return Object(a["a"])(i,[{key:"pixelRatio",get:function(){return this._frameState.pixelRatio},set:function(e){this._frameState.pixelRatio=e}},{key:"mode",get:function(){return this._mode}},{key:"context",get:function(){return this._context}},{key:"camera",get:function(){return this._camera}},{key:"activeCamera",get:function(){return this._camera.frustum}},{key:"frameState",get:function(){return this._frameState}},{key:"mapProjection",get:function(){return this._mapProjection}},{key:"canvas",get:function(){return this._canvas}},{key:"globe",get:function(){return this._globe},set:function(e){this._globe=e,Xg(this,e)}},{key:"drawingBufferSize",get:function(){return this.renderer.drawingBufferSize}},{key:"drawingBufferWidth",get:function(){return this.drawingBufferSize.width}},{key:"drawingBufferHeight",get:function(){return this.drawingBufferSize.height}},{key:"imageryLayers",get:function(){return this.globe.imageryLayers}},{key:"cameraUnderground",get:function(){return this._cameraUnderground}},{key:"screenSpaceCameraController",get:function(){return this._screenSpaceCameraController}},{key:"tweens",get:function(){return this._tweens}},{key:"pickPositionSupported",get:function(){return!0}},{key:"globeHeight",get:function(){return this._globeHeight}},{key:"requestRender",value:function(){this._renderRequested=!0}},{key:"setSize",value:function(e){this.camera.resize(e),this.renderer.setSize(e.clientWidth,e.clientHeight),this.effectComposerCollection.setSize(e)}},{key:"clearPasses",value:function(e){e.render=!1,e.pick=!1,e.depth=!1,e.postProcess=!1,e.offscreen=!1}},{key:"initializeFrame",value:function(){120===this._shaderFrameCount++&&(this._shaderFrameCount=0),this._tweens.update(),this._screenSpaceCameraController.update(),this.camera.update(this._mode),this.camera._updateCameraChanged()}},{key:"render",value:function(e){var t=this._frameState;t.newFrame=!1;var i=!0,n=!this.requestRenderMode||this._renderRequested||i||this.mode===cu.MORPHING;if(n){this._renderRequested=!1;var r=C(t.frameNumber,15e6,1);Qg(this,r),t.newFrame=!0}Kg(this,Jg),this.postUpdate.raiseEvent(this,e),n&&(this.preRender.raiseEvent(this,e),Kg(this,ep)),Kg(this,$g)}},{key:"updateFrameState",value:function(){var e=this.camera,t=this._frameState;t.commandList.length=0,t.computeCommandList.length=0,t.shadowMaps.length=0,t.mapProjection=this.mapProjection,t.mode=this._mode,t.cameraUnderground=this._cameraUnderground,this._renderCollection.children=[],t.cullingVolume=e.frustum.computeCullingVolume(e.positionWC,e.directionWC,e.upWC),this.clearPasses(t.passes)}},{key:"updateAndExecuteCommands",value:function(e){var t=this._frameState;t.mode;np(!0,this,e)}},{key:"pickPositionWorldCoordinates",value:function(e,t){return this.camera.pickEllipsoid(e,void 0,t)}}]),i}(n["C"]);function ap(e){if("string"===typeof e){var t=document.getElementById(e);if(null===t)throw new u('Element with id "'+e+'" does not exist in the document.');e=t}return e}var op=ap;function sp(e){e._renderLoopRunning=!0;var t=0;function i(n){if(!e.isDestroyed())if(e._useDefaultRenderLoop)try{var r=e._targetFrameRate;if(s(r)){var a=1e3/r,o=n-t;o>a&&(e.resize(),e.render(),t=n-o%a),requestAnimationFrame(i)}else e.resize(),e.render(),requestAnimationFrame(i)}catch(u){console.log(u),e._useDefaultRenderLoop=!1,e._renderLoopRunning=!1}else e._renderLoopRunning=!1}requestAnimationFrame(i)}var up=function(){function e(t,i){Object(r["a"])(this,e),t=op(t);var a=document.createElement("div");a.className="cesium-widget",t.appendChild(a);var u=document.createElement("canvas"),l=aa.supportsImageRenderingPixelated();function c(){u!==u.ownerDocument.activeElement&&u.ownerDocument.activeElement.blur()}l&&(u.style.imageRendering=aa.imageRenderingValue()),u.oncontextmenu=function(){return!1},u.onselectstart=function(){return!1},u.addEventListener("mousedown",c),u.addEventListener("pointerdown",c),a.appendChild(u);var h=o(i.useBrowserRecommendedResolution,!0);this._element=a,this._container=t,this._canvas=u,this._canvasClientWidth=0,this._canvasClientHeight=0,this._lastDevicePixelRatio=0,this._forceResize=!0,this._canRender=!1,this._renderLoopRunning=!1,this._resolutionScale=1,this._useBrowserRecommendedResolution=h,this._clock=new n["e"],this.configureCanvasSize();var d=ii({canvas:u,antialias:!0,logarithmicDepthBuffer:!0},i.renderState);this._scene=new rp({renderState:d,enabledEffect:null===i||void 0===i?void 0:i.enabledEffect,requestRenderMode:null===i||void 0===i?void 0:i.requestRenderMode});var m=o(this._scene.mapProjection.ellipsoid,Ie.WGS84),f=i.globe;s(f)||(f=new wh(m)),this._scene.globe=f,this._useDefaultRenderLoop=!1,this.useDefaultRenderLoop=o(i.useDefaultRenderLoop,!0),this._targetFrameRate=60,this.targetFrameRate=void 0,this._screenSpaceEventHandler=new Wa(u),this._scene.camera.lookAt(this._scene.camera.direction)}return Object(a["a"])(e,[{key:"container",get:function(){return this._container}},{key:"canvas",get:function(){return this._canvas}},{key:"scene",get:function(){return this._scene}},{key:"camera",get:function(){return this.scene.camera}},{key:"useDefaultRenderLoop",get:function(){return this._useDefaultRenderLoop},set:function(e){this._useDefaultRenderLoop!==e&&(this._useDefaultRenderLoop=e,e&&!this._renderLoopRunning&&sp(this))}},{key:"targetFrameRate",get:function(){return this._targetFrameRate},set:function(e){this._targetFrameRate=e}},{key:"screenSpaceEventHandler",get:function(){return this._screenSpaceEventHandler}},{key:"configurePixelRatio",value:function(){var e=this._useBrowserRecommendedResolution?1:window.devicePixelRatio;return e*=this._resolutionScale,s(this._scene)&&(this._scene.pixelRatio=e),e}},{key:"configureCanvasSize",value:function(){var e=this._element,t=this._canvas.clientWidth,i=e.clientHeight,n=this.configurePixelRatio();this._canvasClientWidth=t,this._canvasClientHeight=i,t*=n,i*=n,this._canvas.width=t,this._canvas.height=i,this._canRender=0!==t&&0!==i,this._lastDevicePixelRatio=window.devicePixelRatio}},{key:"resize",value:function(){var e=this._element;(this._forceResize||this._canvasClientWidth!==e.clientWidth||this._canvasClientHeight!==e.clientHeight||this._lastDevicePixelRatio!==window.devicePixelRatio)&&(this._forceResize=!1,this.configureCanvasSize(),this.scene.setSize(this.container),this._scene.requestRender())}},{key:"render",value:function(){if(this._canRender){this.scene.initializeFrame();var e=this._clock.getDelta();this.scene.render(e)}}},{key:"isDestroyed",value:function(){return!1}}]),e}(),lp=new up("app",{}),cp=lp.scene,hp=(cp.activeCamera,new n["a"](5e7));cp.add(hp);var dp="39d358c825ec7e59142958656c0a6864";cp.imageryLayers.addImageryProvider(new qn({url:"https://{s}.tianditu.gov.cn/img_w/wmts?SERVICE=WMTS&REQUEST=GetTile&version=1.0.0&LAYER=img&tileMatrixSet=w&TileMatrix={TileMatrix}&TileRow={TileRow}&TileCol={TileCol}&style=default&tk="+dp,subdomains:["t0","t1","t2","t3","t4","t5","t6","t7"],maximumLevel:17,layer:"tdtImgLayer",style:"default",format:"image/jpeg",tileMatrixSetID:"GoogleMapsCompatible"})),cp.imageryLayers.addImageryProvider(new qn({url:"https://{s}.tianditu.gov.cn/cva_w/wmts?service=wmts&request=GetTile&version=1.0.0&LAYER=cva&tileMatrixSet=w&TileMatrix={TileMatrix}&TileRow={TileRow}&TileCol={TileCol}&style=default.jpg&tk="+dp,layer:"cia_w",style:"default",format:"tiles",tileMatrixSetID:"GoogleMapsCompatible",subdomains:["t0","t1","t2","t3","t4","t5","t6","t7"],minimumLevel:0,maximumLevel:18}));var mp=new rr({url:"https://map.geoq.cn/a rcgis/rest/services/ChinaOnlineStreetPurplishBlue/MapServer/tile/{z}/{y}/{x}"});console.log(mp.proxy);var fp=new n["G"](1,64,64),vp=new n["s"]({side:n["h"],wireframe:!0}),gp=new n["r"](fp,vp);cp.add(gp);new dt;lp.screenSpaceEventHandler.setInputAction((function(e){var t=cp.camera.getPickRay(e.position),i=cp.globe.pickWorldCoordinates(t,cp,!0);gp.position.x=i.x,gp.position.y=i.y,gp.position.z=i.z}),Qn.LEFT_CLICK);var pp=new re(-.4903381374223797,.7704996762071239,-.407306714840142),yp=new re(30222806.15307514,-42745526.64600748,26630845.84547744),_p=new St(yp,pp),wp=new re(-12.277106075028938,-5250.839785214442,10077.616726956829),Tp=6379226.7259915285,xp=new ht(wp,Tp),Ep={start:0,stop:0};bt.raySphere(_p,xp,Ep),console.log(Ep),console.log(n["D"].basic),cp.renderer.toneMappingExposure=1.2}});